var ExtensionLoginDialog=function(e){LoginDialog.call(this,e,{closeButtonEnabled:!1}),this.populatedSavedLogin=!1,function(e){e.savedLoginCallback=function(a){for(var i=[],n=0,t=a.length;n<t;++n){var o=a[n].username,s=LPTools.createElement("li",{dropdownValue:o},"");s.appendChild(LPTools.createElement("span",{class:"dropdownText"},o));var r=LPTools.createElement("img",{src:"images/vault_4.0/Close_x.png",class:"ddl-remove"});LPPlatform.addEventListener(r,"mousedown",function(a){return function(i){bg.delete_saved_login(a),i.stopPropagation(),i.preventDefault();for(var n=0;n<e.data.savedLogins.length;n++)if(e.data.savedLogins[n].username===a){e.data.savedLogins.splice(n,1);break}e.inputFields.email.removeValue(a),e.inputFields.email.inputObject.input.val(""),e.inputFields.password.setValue(""),e.inputFields.email.updateDropdown(""),e.inputFields.email.clearHint()}}(o)),s.appendChild(r),i.push({value:o,label:o,element:s})}if(e.inputFields.email.setOptions(i),a.length>0){var l=a[0];e.data.savedLogins=a,e.inputFields.email.setValue(l.username),e.inputFields.password.focus()}else e.inputFields.email.focus()}}(this)};ExtensionLoginDialog.prototype=Object.create(LoginDialog.prototype),ExtensionLoginDialog.prototype.constructor=ExtensionLoginDialog,function(){ExtensionLoginDialog.prototype.populateSavedLogin=function(e){this.inputFields.password.setValue(e),this.inputFields.rememberPassword.setValue(""!==e),this.populatedSavedLogin=!0},ExtensionLoginDialog.prototype.parseSavedLogin=function(e){switch(e.protected){case 0:this.populateSavedLogin(e.password);break;case 1:bg.unprotect_data(e.password,!1,this.createDynamicHandler(function(e){this.populateSavedLogin(e)}));break;case 2:this.populateSavedLogin(bg.lpdec(e.password,bg.AES.hex2bin(bg.SHA256(e.username))))}},ExtensionLoginDialog.prototype.initialize=function(e){LoginDialog.prototype.initialize.apply(this,arguments),this.inputFields.rememberPassword.getElement().bind("click",function(e){var a=!1,i=function(){a=!0,e.inputFields.rememberPassword.setValue(!0)};return function(){var n=e.inputFields.rememberPassword.getValue();!a&&n?(dialogs.confirmation.open({title:Strings.translateString("Are you sure?"),text:Strings.translateString("Using 'remember password' makes it easier to forget your password and decreases your security if your device is infected or stolen."),handler:i,onResize:e.data.onResize}),e.inputFields.rememberPassword.setValue(!1)):a=!1}}(this));var a=function(e){var a;return function(i){var n=e.populatedSavedLogin;if(e.populatedSavedLogin=!1,e.data.savedLogins)for(var t=0,o=e.data.savedLogins.length;t<o;++t){var s=e.data.savedLogins[t];if(s.username===i){e.parseSavedLogin(s);break}}n&&!e.populatedSavedLogin&&(e.inputFields.password.clear(),e.inputFields.rememberPassword.clear());i&&bg.localStorage_getItem(bg.SHA256(i)+".noremember")?($("#ExtensionLoginDialogRememberPasswordContainer").hide(),a=!1):($("#ExtensionLoginDialogRememberPasswordContainer").show(),a=!0)}}(this);this.inputFields.email.onChange(a),this.inputFields.email.inputObject.onChange(a)},ExtensionLoginDialog.prototype.setup=function(){LoginDialog.prototype.setup.apply(this,arguments),bg.get_saved_logins(this.savedLoginCallback),$("#loginDialogDisableBrowserDiv").hide()},ExtensionLoginDialog.prototype.open=function(e){LoginDialog.prototype.open.call(this,$.extend(e,{defaultData:{rememberEmail:bg.Preferences.get("rememberemail"),rememberPassword:bg.Preferences.get("rememberpassword"),rememberShowVault:bg.Preferences.get("showvault")}}))},ExtensionLoginDialog.prototype.handleSubmit=function(){var e=null,a=function(a){null===e&&(e=setInterval(function(){"undefined"==typeof VaultState&&bg.getData&&bg.getData({context:"login"}),bg.get("lploggedin")&&(clearInterval(e),e=null,data.disablePasswordManager&&"undefined"==typeof InstallTrigger?bg.disablepasswordmanager(data.disablePasswordManager,a):a.close())},1e3))};return function(e){e.email=bg.fix_username(e.email),bg.Preferences.set({rememberemail:e.rememberEmail,rememberpassword:e.rememberPassword,showvault:e.rememberShowVault}),bg.make_lp_key_hash(e.email,e.password,function(a,i){return function(n,t){a.set("g_manual_login",!0),a.LP_do_login(e.email,e.password,e.rememberEmail,e.rememberPassword,null,e.rememberShowVault,n,t),i.data.isPopup&&(e.disablePasswordManager&&"undefined"==typeof InstallTrigger?a.disablepasswordmanager(e.disablePasswordManager,i):i.close(!0))}}(bg,this)),this.data.isPopup?e.disablePasswordManager&&"undefined"==typeof InstallTrigger&&bg.disablepasswordmanager(e.disablePasswordManager,this):a(this,e.disablePasswordManager)}}()}();
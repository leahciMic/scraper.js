function groupclicked(e){if(e.which&&3==e.which)return!0;if(_this.locked)return e.preventDefault(),e.target.blur(),_this.error("LOCKED");if("INS"==e.target.tagName&&e.target.nextSibling&&e.target.nextSibling.hasAttribute("isgroup")?e.target=e.target.nextSibling:"INS"==e.target.tagName&&e.target.parentNode&&e.target.parentNode.nextSibling&&e.target.parentNode.nextSibling.nextSibling&&e.target.parentNode.nextSibling.nextSibling.hasAttribute("isgroup")&&(e.target=e.target.parentNode.nextSibling.nextSibling),e.target.hasAttribute("isgroup")){if(_this.off_height(),e.pageY-$(e.target).offset().top>_this.li_height)return!0;_this.toggle_branch.apply(_this,[e.target])}else _this.select_branch.apply(_this,[e.target,e.ctrlKey||"on"==_this.settings.rules.multiple,e.shiftKey]);return _this.inp&&_this.inp.blur(),e.preventDefault(),e.target.blur(),!1}function lp_display_folders(e,t){e.parents("li").css("display",""),e.parents("li.closed").each(function(){t.open_branch(this,!0)})}var g_CNTfun=0,lastdblclick=new Date,g_tree=null;!function(e){function t(){return{cntr:++t.cntr,settings:e.extend({},e.tree.defaults),init:function(i,s){if(g_tree=this,this.container=e(i),0==this.container.size)return!1;if(t.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),t.inst[this.container.attr("id")]=t.inst[this.cntr],t.focused=this.cntr,this.settings=e.extend(!0,{},this.settings,s),this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];for(var r=!1,n="#"+this.container.attr("id"),a=0;a<this.settings.languages.length;a++)!1!==(r=t.add_css(n+" ."+this.settings.languages[a]))&&(r.style.display=this.settings.languages[a]==this.current_lang?"":"none")}else this.current_lang=!1;this.container.addClass("tree"),!1!==this.settings.ui.theme_name&&(""!=this.settings.ui.theme_path&&-1==e.inArray(this.settings.ui.theme_path,t.themes)&&(t.add_sheet({url:this.settings.ui.theme_path}),t.themes.push(this.settings.ui.theme_path)),this.container.addClass("tree-"+this.settings.ui.theme_name));var l="";for(var o in this.settings.types)this.settings.types.hasOwnProperty(o)&&this.settings.types[o].icon&&(this.settings.types[o].icon.image||this.settings.types[o].icon.position)&&(l+="default"==o?"#"+this.container.attr("id")+" li > a ins { ":"#"+this.container.attr("id")+" li[rel="+o+"] > a ins { ",this.settings.types[o].icon.image&&(l+=" background-image:url("+this.settings.types[o].icon.image+"); "),this.settings.types[o].icon.position&&(l+=" background-position:"+this.settings.types[o].icon.position+"; "),l+="} ");""!=l&&t.add_sheet({str:l}),this.settings.rules.multiple&&(this.selected_arr=[]),this.offset=!1,this.hovered=!1,this.locked=!1,!1===t.drag_drop.marker&&(t.drag_drop.marker=e("<div>").attr({id:"jstree-marker"}).hide().appendTo("body")),this.callback("oninit",[this]),this.refresh(),this.attach_events(),this.focus()},refresh:function(t){if(this.locked)return this.error("LOCKED");var i=this;if(t&&!this.settings.data.async&&(t=!1),this.is_partial_refresh=!!t,this.opened=Array(),0!=this.settings.opened?(e.each(this.settings.opened,function(e,t){this.replace(/^#/,"").length>0&&i.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(e){this.id&&i.opened.push("#"+this.id)}),this.selected)this.settings.selected=Array(),t?e(t).find("li:has(a.clicked)").each(function(){this.id&&i.settings.selected.push("#"+this.id)}):this.selected_arr?e.each(this.selected_arr,function(){this.attr("id")&&i.settings.selected.push("#"+this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(!1!==this.settings.selected){var s=Array();"object"==(typeof this.settings.selected).toLowerCase()?e.each(this.settings.selected,function(){this.replace(/^#/,"").length>0&&s.push("#"+this.replace(/^#/,""))}):this.settings.selected.replace(/^#/,"").length>0&&s.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=s}if(t&&this.settings.data.async)return this.opened=Array(),t=this.get_node(t),t.find("li.open").each(function(e){i.opened.push("#"+this.id)}),t.hasClass("open")&&t.removeClass("open").addClass("closed"),t.hasClass("leaf")&&t.removeClass("leaf"),t.children("ul:eq(0)").html(""),this.open_branch(t,!0,function(){i.reselect.apply(i)});var i=this,r=new e.tree.datastores[this.settings.data.type];0==this.container.children("ul").size()&&this.container.html("<ul class='ltr directionltr'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>"),r.load(this.callback("beforedata",[!1,this]),this,this.settings.data.opts,function(t){t=i.callback("ondata",[t,i]),r.parse(t,i,i.settings.data.opts,function(t){t=i.callback("onparse",[t,i]),i.container.empty().append(e("<ul class='ltr'>").html(t)),i.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),i.container.find("li").not(".open").not(".closed").addClass("leaf"),i.reselect()})})},reselect:function(t){var i=this;if(t?this.cl_count--:this.cl_count=0,this.opened&&this.opened.length){for(var s=!1,r=0;this.opened&&r<this.opened.length;r++)if(this.settings.data.async){var n=this.get_node(this.opened[r]);if(n.size()&&n.hasClass("closed")>0){s=!0;var n=this.opened[r].toString().replace("/","\\/");delete this.opened[r],this.open_branch(n,!0,function(){i.reselect.apply(i,[!0])}),this.cl_count++}}else this.open_branch(this.opened[r],!0);if(this.settings.data.async&&s)return;if(this.cl_count>0)return;delete this.opened}this.cl_count>0||(this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr"),0==this.settings.ui.dots&&this.container.children("ul:eq(0)").addClass("no_dots"),this.scrtop&&(this.container.scrollTop(i.scrtop),delete this.scrtop),!1!==this.settings.selected&&(e.each(this.settings.selected,function(t){i.is_partial_refresh?i.select_branch(e(i.settings.selected[t].toString().replace("/","\\/"),i.container),!1!==i.settings.rules.multiple):i.select_branch(e(i.settings.selected[t].toString().replace("/","\\/"),i.container),!1!==i.settings.rules.multiple&&t>0)}),this.settings.selected=!1),this.callback("onload",[i]))},get:function(t,i,s){return i||(i=this.settings.data.type),s||(s=this.settings.data.opts),(new e.tree.datastores[i]).get(t,this,s)},attach_events:function(){var i=this;this.container.bind("mousedown.jstree",function(e){if(t.drag_drop.isdown)return t.drag_drop.move_type=!1,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}).bind("mouseup.jstree",function(e){setTimeout(function(){i.focus.apply(i)},5)}).bind("click.jstree",function(e){return!0}),e("li",this.container.get(0)).live("click",function(t){return"LI"!=t.target.tagName&&"A"!=t.target.tagName||(i.off_height(),t.pageY-e(t.target).offset().top>i.li_height||(i.toggle_branch.apply(i,[t.target]),t.stopPropagation(),!1))}).live("contextmenu",function(e){return i.locked?(e.target.blur(),i.error("LOCKED")):i.callback("onrgtclk",[i.get_node(e.target).get(0),i,e])}).live("mousedown",function(e){i.domousedown(e)}),e("li > span",this.container.get(0)).live("click",groupclicked),e("a",this.container.get(0)).live("click",groupclicked).live("dblclick",function(e){if(i.locked)return e.preventDefault(),e.stopPropagation(),e.target.blur(),i.error("LOCKED");i.callback("ondblclk",[i.get_node(e.target).get(0),i]),e.preventDefault(),e.stopPropagation(),e.target.blur()}).live("contextmenu",function(e){return i.locked?(e.target.blur(),i.error("LOCKED")):i.callback("onrgtclk",[i.get_node(e.target).get(0),i,e])}).live("mouseover",function(e){if(i.locked)return e.preventDefault(),e.stopPropagation(),i.error("LOCKED");!1===i.hovered||"A"!=e.target.tagName&&"INS"!=e.target.tagName||(i.hovered.children("a").removeClass("hover"),i.hovered=!1),i.callback("onhover",[i.get_node(e.target).get(0),i])}).live("mousedown",function(e){i.domousedown(e)})},domousedown:function(i){for(var s=!1,r=i.target;r;){if("function"==typeof r.getAttribute&&"thetree"==r.getAttribute("id")){s=!0;break}r=r.parentNode}if(s){if(_this=g_tree,"left"==_this.settings.rules.drag_button&&i.which&&1!=i.which)return!0;if("right"==_this.settings.rules.drag_button&&i.which&&3!=i.which)return!0;if(_this.focus.apply(_this),_this.locked)return _this.error("LOCKED");var n=_this.get_node(i.target);if(0!=_this.settings.rules.multiple&&_this.selected_arr.length>1&&n.children("a:eq(0)").hasClass("clicked")){var a=0;for(var l in _this.selected_arr)_this.selected_arr.hasOwnProperty(l)&&_this.check("draggable",_this.selected_arr[l])&&(_this.selected_arr[l].addClass("dragged"),t.drag_drop.origin_tree=_this,a++);if(a>0){if(_this.check("draggable",n)?t.drag_drop.drag_node=n:t.drag_drop.drag_node=_this.container.find("li.dragged:eq(0)"),t.drag_drop.isdown=!0,"function"==typeof getDragHTML)t.drag_drop.drag_help=e(getDragHTML(null));else{t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree "+(""!=_this.settings.ui.theme_name?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+"' />");var o=t.drag_drop.drag_node.clone();_this.settings.languages.length>0&&o.find("a").not("."+_this.current_lang).hide(),t.drag_drop.drag_help.children("ul:eq(0)").append(o),t.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove()}t.drag_drop.dragged=_this.container.find("li.dragged")}}else if(_this.check("draggable",n)){_this.settings.languages.length>0&&o.find("a").not("."+_this.current_lang).hide(),t.drag_drop.drag_node=n;var o=n.clone();"function"==typeof getDragHTML?t.drag_drop.drag_help=e(getDragHTML(o)):(t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree "+(""!=_this.settings.ui.theme_name?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+"' />"),t.drag_drop.drag_help.children("ul:eq(0)").append(getDragHTML(o)),t.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last")),t.drag_drop.isdown=!0,t.drag_drop.foreign=!1,t.drag_drop.origin_tree=_this,n.addClass("dragged"),t.drag_drop.dragged=_this.container.find("li.dragged")}return t.drag_drop.init_x=i.pageX,t.drag_drop.init_y=i.pageY,n.blur(),i.preventDefault(),i.stopPropagation(),!1}},focus:function(){if(this.locked)return!1;t.focused!=this.cntr&&(t.focused=this.cntr,this.callback("onfocus",[this]))},off_height:function(){if(!1===this.offset){this.container.css({position:"relative"}),this.offset=this.container.offset();var t=0;t=parseInt(e.curCSS(this.container.get(0),"paddingTop",!0),10),t&&(this.offset.top+=t),t=parseInt(e.curCSS(this.container.get(0),"borderTopWidth",!0),10),t&&(this.offset.top+=t),this.container.css({position:""})}if(isSafariNative()&&!this.li_height)this.li_height=20;else if(!this.li_height){var t=this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=t.height(),t.children("ul:eq(0)").size()&&(this.li_height-=t.children("ul:eq(0)").height()),this.li_height||(this.li_height=18)}},scroll_check:function(e,i){var s=this,r=s.container,n=s.container.offset(),a=r.scrollTop(),l=r.scrollLeft(),o=r.get(0).scrollWidth>r.width()?40:20;i-n.top<20&&r.scrollTop(Math.max(a-s.settings.ui.scroll_spd,0)),r.height()-(i-n.top)<o&&r.scrollTop(a+s.settings.ui.scroll_spd),e-n.left<20&&r.scrollLeft(Math.max(l-s.settings.ui.scroll_spd,0)),r.width()-(e-n.left)<40&&r.scrollLeft(l+s.settings.ui.scroll_spd),r.scrollLeft()==l&&r.scrollTop()==a||(t.drag_drop.move_type=!1,t.drag_drop.ref_node=!1,t.drag_drop.marker.hide()),t.drag_drop.scroll_time=setTimeout(function(){s.scroll_check(e,i)},50)},scroll_into_view:function(e){if(!(e=e?this.get_node(e):this.selected))return!1;var t=e.offset().top,i=this.container.offset().top,s=i+this.container.height(),r=this.container.get(0).scrollWidth>this.container.width()?40:20;t+5<i&&this.container.scrollTop(this.container.scrollTop()-(i-t+5)),t+r>s&&this.container.scrollTop(this.container.scrollTop()+(t+r-s))},get_node:function(t){return e(t).closest("li")},get_type:function(e){if(e=e?this.get_node(e):this.selected){return e.attr(this.settings.rules.type_attr)||"default"}},set_type:function(e,t){(t=t?this.get_node(t):this.selected)&&e&&t.attr(this.settings.rules.type_attr,e)},get_text:function(e,t){if(!(e=this.get_node(e))||0==e.size())return"";this.settings.languages&&this.settings.languages.length?(t=t||this.current_lang,e=e.children("a."+t)):e=e.children("a:visible");var i="";return e.contents().each(function(){if(3==this.nodeType)return i=this.data,!1}),i},check:function(e,t){if(this.locked)return!1;var i=!1;if(-1===t)void 0!==this.settings.rules[e]&&(i=this.settings.rules[e]);else{if(!(t=t?this.get_node(t):this.selected))return;var s=this.get_type(t);void 0!==this.settings.types[s]&&void 0!==this.settings.types[s][e]?i=this.settings.types[s][e]:void 0!==this.settings.types.default&&void 0!==this.settings.types.default[e]&&(i=this.settings.types.default[e])}return"function"==typeof i&&(i=i.call(null,t,this)),i=this.callback("check",[e,t,i,this])},check_move:function(i,s,r){if(this.locked)return!1;if(e(s).closest("li.dragged").size())return!1;var n=i.parents(".tree:eq(0)").get(0),a=s.parents(".tree:eq(0)").get(0);if(n&&n!=a){var l=e.tree.reference(a.id).settings.rules.multitree;if("none"==l||e.isArray(l)&&-1==e.inArray(n.id,l))return!1}var o="inside"!=r?this.parent(s):this.get_node(s);if(i=this.get_node(i),0==o)return!1;var d={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",o):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",o):-1,valid_children:this.check("valid_children",o)},c="string"==typeof i?i:this.get_type(i);if(void 0!==d.valid_children&&("none"==d.valid_children||"object"==typeof d.valid_children&&-1==e.inArray(c,e.makeArray(d.valid_children))))return!1;if(this.settings.rules.use_max_children&&void 0!==d.max_children&&-1!=d.max_children){if(0==d.max_children)return!1;var h=1;if(1==t.drag_drop.moving&&0==t.drag_drop.foreign&&(h=t.drag_drop.dragged.size(),h-=o.find("> ul > li.dragged").size()),d.max_children<o.find("> ul > li").size()+h)return!1}if(this.settings.rules.use_max_depth){if(void 0!==d.max_depth&&0===d.max_depth)return this.error("MOVE: MAX-DEPTH REACHED");for(var g=d.max_depth>0&&d.max_depth,u=0,p=o;-1!==p;){p=this.parent(p),u++;var l=this.check("max_depth",p);if(l>=0&&(g=!1===g?l-u:Math.min(g,l-u)),!1!==g&&g<=0)return this.error("MOVE: MAX-DEPTH REACHED")}if(!1!==g&&g<=0)return this.error("MOVE: MAX-DEPTH REACHED");if(!1!==g){var f=1;if("string"!=typeof i)for(var p=i;p.size()>0;){if(g-f<0)return this.error("MOVE: MAX-DEPTH REACHED");p=p.children("ul").children("li"),f++}}}return 0!=this.callback("check_move",[i,s,r,this])},hover_branch:function(e){if(this.locked)return this.error("LOCKED");var t=this,e=t.get_node(e);return e.size()?t.check("clickable",e)?(this.hovered&&this.hovered.children("A").removeClass("hover"),this.hovered=e,this.hovered.children("a").addClass("hover"),void this.scroll_into_view(this.hovered)):this.error("SELECT: NODE NOT SELECTABLE"):this.error("HOVER: NOT A VALID NODE")},select_branch:function(t,i,s){if(this.locked)return this.error("LOCKED");t||!1===this.hovered||(t=this.hovered);var r=this;if(t=r.get_node(t),!t.size())return this.error("SELECT: NOT A VALID NODE");if(t.children("a").removeClass("hover"),!r.check("clickable",t))return this.error("SELECT: NODE NOT SELECTABLE");if(!1===r.callback("beforechange",[t.get(0),r]))return this.error("SELECT: STOPPED BY USER");if(0!=this.settings.rules.multiple&&i&&t.children("a.clicked").size()>0)return this.deselect_branch(t);if(0!=this.settings.rules.multiple&&(i||s)){if(s&&this.selected_arr.length>0){var n=this.selected_arr[this.selected_arr.length-1],a=this.container.find("li.leaf"),l=t.position().top,o=n.position().top,d=l>o?l:o,c=l<o?l:o;a.each(function(){if(e(this).height()>0){var i=e(this).position().top;i<d&&i>c&&e(this).html()!=t.html()&&(r.selected_arr.push(e(this)),e(this).addClass("clicked"),e(this).children("A").addClass("clicked"))}})}this.selected_arr.push(t)}if(0!=this.settings.rules.multiple&&!i&&!s){for(var h in this.selected_arr)this.selected_arr.hasOwnProperty(h)&&(this.selected_arr[h].children("A").removeClass("clicked"),this.selected_arr[h].removeClass("clicked"),this.callback("ondeselect",[this.selected_arr[h].get(0),r]));this.selected_arr=[],this.selected_arr.push(t),this.selected&&this.selected.children("A").hasClass("clicked")&&(this.selected.children("A").removeClass("clicked"),this.selected.removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),r]))}this.settings.rules.multiple||this.selected&&(this.selected.children("A").removeClass("clicked"),this.selected.removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),r])),this.selected=t,!1!==this.hovered&&(this.hovered.children("A").removeClass("hover"),this.hovered=t),this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){r.open_branch(this,!0)}),this.selected.addClass("clicked"),this.scroll_into_view(this.selected),this.callback("onselect",[this.selected.get(0),r]),this.callback("onchange",[this.selected.get(0),r])},deselect_branch:function(t){if(this.locked)return this.error("LOCKED");var i=this,t=this.get_node(t);if(0==t.children("a.clicked").size())return this.error("DESELECT: NODE NOT SELECTED");t.children("a").removeClass("clicked"),t.removeClass("clicked"),this.callback("ondeselect",[t.get(0),i]),0!=this.settings.rules.multiple&&this.selected_arr.length>1?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){i.selected_arr.push(e(this))}),t.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0])):(0!=this.settings.rules.multiple&&(this.selected_arr=[]),this.selected=!1),this.callback("onchange",[t.get(0),i])},toggle_branch:function(e){if(this.locked)return this.error("LOCKED");var e=this.get_node(e);return e.hasClass("closed")?this.open_branch(e):e.hasClass("open")?this.close_branch(e):void 0},open_branch:function(t,i,s){var r=this;if(this.locked)return this.error("LOCKED");var t=this.get_node(t);if(!t.size())return this.error("OPEN: NO SUCH NODE");if(t.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&0==t.find("li").size()){if(!1===this.callback("beforeopen",[t.get(0),this]))return this.error("OPEN: STOPPED BY USER");t.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(r.settings.lang.loading||"Loading ...")+"</a></li></ul>"),t.removeClass("closed").addClass("open");var n=new e.tree.datastores[this.settings.data.type];return n.load(this.callback("beforedata",[t,this]),this,this.settings.data.opts,function(i){if(!(i=r.callback("ondata",[i,r]))||0==i.length)return t.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),void(s&&s.call());n.parse(i,r,r.settings.data.opts,function(i){i=r.callback("onparse",[i,r]),t.children("ul:eq(0)").replaceWith(e("<ul>").html(i)),t.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),t.find("li").not(".open").not(".closed").addClass("leaf"),r.open_branch.apply(r,[t]),s&&s.call()})}),!0}return this.settings.data.async||!1!==this.callback("beforeopen",[t.get(0),this])?(parseInt(this.settings.ui.animation)>0&&!i?(t.children("ul:eq(0)").css("display","none"),t.removeClass("closed").addClass("open"),t.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){e(this).css("display",""),s&&s.call()})):(t.removeClass("closed").addClass("open"),s&&s.call()),this.callback("onopen",[t.get(0),this]),!0):this.error("OPEN: STOPPED BY USER")},close_branch:function(t,i){if(this.locked)return this.error("LOCKED");var s=this,t=this.get_node(t);return t.size()?!1===s.callback("beforeclose",[t.get(0),s])?this.error("CLOSE: STOPPED BY USER"):(parseInt(this.settings.ui.animation)>0&&!i&&1==t.children("ul:eq(0)").size()?t.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){t.hasClass("open")&&t.removeClass("open").addClass("closed"),e(this).css("display","")}):t.hasClass("open")&&t.removeClass("open").addClass("closed"),this.selected&&!1!==this.settings.ui.selected_parent_close&&t.children("ul:eq(0)").find("a.clicked").size()>0&&(t.find("li:has(a.clicked)").each(function(){s.deselect_branch(this)}),"select_parent"==this.settings.ui.selected_parent_close&&0==t.children("a.clicked").size()&&this.select_branch(t,0!=this.settings.rules.multiple&&this.selected_arr.length>0)),void this.callback("onclose",[t.get(0),this])):this.error("CLOSE: NO SUCH NODE")},open_all:function(e,t){if(this.locked)return this.error("LOCKED");var i=this;e=e?this.get_node(e):this.container;var s=e.find("li.closed").size();t?this.cl_count--:this.cl_count=0,s>0?(this.cl_count+=s,e.find("li.closed").each(function(){var e=this;i.open_branch.apply(i,[this,!0,function(){i.open_all.apply(i,[e,!0])}])})):0==this.cl_count&&this.callback("onopen_all",[this])},close_all:function(e){if(this.locked)return this.error("LOCKED");var t=this;e=e?this.get_node(e):this.container,e.find("li.open").each(function(){t.close_branch(this,!0)}),this.callback("onclose_all",[this])},set_lang:function(i){if(!e.isArray(this.settings.languages)||0==this.settings.languages.length)return!1;if(this.locked)return this.error("LOCKED");if(e.inArray(i,this.settings.languages)||void 0===this.settings.languages[i]||(i=this.settings.languages[i]),void 0===i)return!1;if(i==this.current_lang)return!0;var s=!1,r="#"+this.container.attr("id");return s=t.get_css(r+" ."+this.current_lang),!1!==s&&(s.style.display="none"),s=t.get_css(r+" ."+i),!1!==s&&(s.style.display=""),this.current_lang=i,!0},get_lang:function(){return!(!e.isArray(this.settings.languages)||0==this.settings.languages.length)&&this.current_lang},create:function(t,i,s){if(this.locked)return this.error("LOCKED");var r=!1;if(-1==i?(r=!0,i=this.container):i=i?this.get_node(i):this.selected,!(r||i&&i.size()))return this.error("CREATE: NO NODE SELECTED");var n=s,a=i;if("before"==s&&(s=i.parent().children().index(i),i=i.parents("li:eq(0)")),"after"==s&&(s=i.parent().children().index(i)+1,i=i.parents("li:eq(0)")),r||0!=i.size()||(r=!0,i=this.container),!r){if(!this.check("creatable",i))return this.error("CREATE: CANNOT CREATE IN NODE");if(i.hasClass("closed")){if(this.settings.data.async&&0==i.children("ul").size()){var l=this;return this.open_branch(i,!0,function(){l.create.apply(l,[t,i,s])})}this.open_branch(i,!0)}}var o=!1;if(t=t?e.extend(!0,{},t):{},t.attributes||(t.attributes={}),t.attributes[this.settings.rules.type_attr]||(t.attributes[this.settings.rules.type_attr]=this.get_type(a)||"default"),this.settings.languages.length){t.data||(t.data={},o=!0);for(var d=0;d<this.settings.languages.length;d++)t.data[this.settings.languages[d]]||(t.data[this.settings.languages[d]]="string"!=(typeof this.settings.lang.new_node).toLowerCase()&&this.settings.lang.new_node[d]?this.settings.lang.new_node[d]:this.settings.lang.new_node)}else t.data||(t.data=this.settings.lang.new_node,o=!0);t=this.callback("ondata",[t,this]);var c=e.tree.datastores.json().parse(t,this);c=this.callback("onparse",[c,this]);var h=e(c);h.children("ul").size()?h.is(".open")||h.addClass("closed"):h.addClass("leaf"),h.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),h.find("li").not(".open").not(".closed").addClass("leaf");var g={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",r?-1:i):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",r?-1:i):-1,valid_children:this.check("valid_children",r?-1:i)},u=this.get_type(h);if(void 0!==g.valid_children&&("none"==g.valid_children||e.isArray(g.valid_children)&&-1==e.inArray(u,g.valid_children)))return this.error("CREATE: NODE NOT A VALID CHILD");if(this.settings.rules.use_max_children&&void 0!==g.max_children&&-1!=g.max_children&&g.max_children>=this.children(i).size())return this.error("CREATE: MAX_CHILDREN REACHED");if(this.settings.rules.use_max_depth){if(void 0!==g.max_depth&&0===g.max_depth)return this.error("CREATE: MAX-DEPTH REACHED");for(var p=g.max_depth>0&&g.max_depth,d=0,f=i;-1!==f&&!r;){f=this.parent(f),d++;var _=this.check("max_depth",f);if(_>=0&&(p=!1===p?_-d:Math.min(p,_-d)),!1!==p&&p<=0)return this.error("CREATE: MAX-DEPTH REACHED")}if(!1!==p&&p<=0)return this.error("CREATE: MAX-DEPTH REACHED");if(!1!==p)for(var v=1,f=h;f.size()>0;){if(p-v<0)return this.error("CREATE: MAX-DEPTH REACHED");f=f.children("ul").children("li"),v++}}if("undefined"!=(typeof s).toLowerCase()&&"inside"!=s||(s="top"==this.settings.rules.createat?0:i.children("ul:eq(0)").children("li").size()),0==i.children("ul").size()||1==r&&0==i.children("ul").children("li").size())if(r)var m=this.moved(h,this.container.children("ul:eq(0)"),"inside",!0);else var m=this.moved(h,i.children("a:eq(0)"),"inside",!0);else if("before"==n&&i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").size())var m=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").children("a:eq(0)"),"before",!0);else if("after"==n&&i.children("ul:eq(0)").children("li:nth-child("+s+")").size())var m=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+s+")").children("a:eq(0)"),"after",!0);else if(i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").size())var m=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").children("a:eq(0)"),"before",!0);else var m=this.moved(h,i.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0);return!1===m?this.error("CREATE: ABORTED"):(o&&(this.select_branch(h.children("a:eq(0)")),this.rename()),h)},rename:function(t,i){if(this.locked)return this.error("LOCKED");t=t?this.get_node(t):this.selected;var s=this;if(!t||!t.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",t))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",[t.get(0),s.current_lang,s]))return this.error("RENAME: STOPPED BY USER");t.parents("li.closed").each(function(){s.open_branch(this)}),t=this.current_lang?t.find("a."+this.current_lang):t.find("a:first");var r={};r[this.container.attr("id")]=this.get_rollback();var n=t.children("ins").clone();if("string"==(typeof i).toLowerCase())t.text(i).prepend(n),s.callback("onrename",[s.get_node(t).get(0),s,r]);else{var a="";t.contents().each(function(){if(3==this.nodeType)return a=this.data,!1}),s.inp=e("<input type='text' autocomplete='off' />"),s.inp.val(a.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(e){e.stopPropagation()}).bind("mouseup",function(e){e.stopPropagation()}).bind("click",function(e){e.stopPropagation()}).bind("keyup",function(e){var t=e.keyCode||e.which;return 27==t?(this.value=a,void this.blur()):13==t?void this.blur():void 0}),s.inp.blur(function(e){""==this.value&&(this.value=a),t.text(this.value).prepend(n),t.get(0).style.display="",t.prevAll("span").remove(),s.inp=!1,s.callback("onrename",[s.get_node(t).get(0),s,r])});var l=e("<span />").addClass(t.attr("class")).append(n).append(s.inp);t.get(0).style.display="none",t.parent().prepend(l),s.inp.get(0).focus(),s.inp.get(0).select()}},remove:function(t){if(this.locked)return this.error("LOCKED");var i=this,s={};if(s[this.container.attr("id")]=this.get_rollback(),!t||this.selected&&this.get_node(t).get(0)==this.selected.get(0)){if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[this.selected.get(0),i]))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();var t=this.selected;if(0==this.settings.rules.multiple||1==this.selected_arr.length)var r=!0,n="select_previous"==this.settings.ui.selected_delete&&this.prev(this.selected);if(t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),!r&&0!=this.settings.rules.multiple){var i=this;this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){i.selected_arr.push(e(this))}),this.selected_arr.length>0&&(this.selected=this.selected_arr[0],this.remove())}r&&n&&this.select_branch(n),this.callback("ondelete",[t.get(0),this,s])}else if(t=this.get_node(t),t.size()){if(!this.check("deletable",t))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[t.get(0),i]))return this.error("DELETE: STOPPED BY USER");if($parent=t.parent(),t.find("a.clicked").size()){var a=!1;i.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){if(a||this!=i.selected.get(0)||(a=!0),-1!=e(this).parents().index(t))return!0;i.selected_arr.push(e(this))}),a&&(this.selected=this.selected_arr[0]||!1)}t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),this.callback("ondelete",[t.get(0),this,s])}},next:function(e,t){return"function"==typeof this.get_node&&(e=this.get_node(e)),!!e.size()&&(t?e.nextAll("li").size()>0&&e.nextAll("li:eq(0)"):e.hasClass("open")?e.find("li:eq(0)"):e.nextAll("li").size()>0?e.nextAll("li:eq(0)"):e.parents("li").next("li").eq(0))},prev:function(e,t){if("function"==typeof this.get_node&&(e=this.get_node(e)),!e.size())return!1;if(t)return e.prevAll("li").size()>0&&e.prevAll("li:eq(0)");if(e.prev("li").size()){for(var e=e.prev("li").eq(0);e.hasClass("open");)e=e.children("ul:eq(0)").children("li:last");return e}return!!e.parents("li:eq(0)").size()&&e.parents("li:eq(0)")},parent:function(e){return e=this.get_node(e),!!e.size()&&(e.parents("li:eq(0)").size()?e.parents("li:eq(0)"):-1)},children:function(e){return-1===e?this.container.children("ul:eq(0)").children("li"):(e=this.get_node(e),!!e.size()&&e.children("ul:eq(0)").children("li"))},toggle_dots:function(){this.settings.ui.dots?(this.settings.ui.dots=!1,this.container.children("ul:eq(0)").addClass("no_dots")):(this.settings.ui.dots=!0,this.container.children("ul:eq(0)").removeClass("no_dots"))},callback:function(t,i){var s=!1,r=null;for(var n in this.settings.plugins)if("object"==typeof e.tree.plugins[n]&&(s=e.tree.plugins[n],s.callbacks&&"function"==typeof s.callbacks[t]&&(r=s.callbacks[t].apply(this,i)),void 0!==r&&null!==r)){if("ondata"!=t&&"onparse"!=t)return r;i[0]=r}if("function"==typeof(s=this.settings.callback[t]))return s.apply(null,i)},get_rollback:function(){var e={};return e.html=this.container.html(),e.selected=!!this.selected&&this.selected.attr("id"),e},moved:function(i,s,r,n,a,l){var i=e(i),o=e(i).parents("ul:eq(0)"),d=e(s);if(d.is("ins")&&(d=d.parent()),!l){var l={};if(l[this.container.attr("id")]=this.get_rollback(),!n){var c=i.size()>1?i.eq(0).parents(".tree:eq(0)"):i.parents(".tree:eq(0)");c.get(0)!=this.container.get(0)&&(c=t.inst[c.attr("id")],l[c.container.attr("id")]=c.get_rollback()),delete c}}if("inside"==r&&this.settings.data.async){var h=this;if(this.get_node(d).hasClass("closed"))return this.open_branch(this.get_node(d),!0,function(){h.moved.apply(h,[i,s,r,n,a,l])});if(1==this.get_node(d).find("> ul > li > a.loading").size())return void setTimeout(function(){h.moved.apply(h,[i,s,r,n,a])},200)}if(i.size()>1){var h=this,c=this.moved(i.eq(0),s,r,!1,a,l);return i.each(function(e){0!=e&&c&&(c=h.moved(this,c.children("a:eq(0)"),"after",!1,a,l))}),i}if(a?(_what=i.clone(),_what.each(function(t){this.id=this.id+"_copy",e(this).find("li").each(function(){this.id=this.id+"_copy"}),e(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged"),e(this).removeClass("dragged").find("li.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})):_what=i,n){if(!this.callback("beforecreate",[this.get_node(i).get(0),this.get_node(s).get(0),r,this]))return!1}else if(!this.callback("beforemove",[i,s,r,this]))return!1;if(!n){var c=i.parents(".tree:eq(0)");if(c.get(0)!=this.container.get(0)){if(c=t.inst[c.attr("id")],c.settings.languages.length){var g=[];if(0==this.settings.languages.length)g.push("."+c.current_lang);else for(var u in this.settings.languages)if(this.settings.languages.hasOwnProperty(u))for(var p in c.settings.languages)c.settings.languages.hasOwnProperty(p)&&this.settings.languages[u]==c.settings.languages[p]&&g.push("."+this.settings.languages[u]);if(0==g.length)return this.error("MOVE: NO COMMON LANGUAGES");_what.find("a").not(g.join(",")).remove()}_what.find("a.clicked").removeClass("clicked"),_what.find("li.clicked").removeClass("clicked")}}switch(i=_what,r){case"before":d.parents("ul:eq(0)").children("li.last").removeClass("last"),d.parent().before(i.removeClass("last")),d.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":d.parents("ul:eq(0)").children("li.last").removeClass("last"),d.parent().after(i.removeClass("last")),d.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":if(d.parent().children("ul:first").size())if("top"==this.settings.rules.createat){d.parent().children("ul:first").prepend(i.removeClass("last")).children("li:last").addClass("last");var f=d.parent().children("ul:first").children("li:first");f.size()&&(r="before",s=f)}else{var f=d.parent().children("ul:first").children(".last");f.size()&&(r="after",s=f),d.parent().children("ul:first").children(".last").removeClass("last").end().append(i.removeClass("last")).children("li:last").addClass("last")}else i.addClass("last"),d.parent().removeClass("leaf").append("<ul/>"),d.parent().hasClass("open")||d.parent().addClass("closed"),d.parent().children("ul:first").prepend(i);d.parent().hasClass("closed")&&this.open_branch(d)}if(0==o.find("li").size()){var _=o.parent();_.removeClass("open").removeClass("closed").addClass("leaf"),_.is(".tree")||_.children("ul").remove(),_.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last")}else o.children("li.last").removeClass("last"),o.children("li:last").addClass("last");return a?this.callback("oncopy",[this.get_node(i).get(0),this.get_node(s).get(0),r,this,l]):n?this.callback("oncreate",[this.get_node(i).get(0),d.is("ul")?-1:this.get_node(s).get(0),r,this,l]):this.callback("onmove",[this.get_node(i).get(0),this.get_node(s).get(0),r,this,l]),i},error:function(e){return this.callback("error",[e,this]),!1},lock:function(e){this.locked=e,this.locked?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},cut:function(e){return this.locked?this.error("LOCKED"):(e=e?this.get_node(e):this.container.find("a.clicked").filter(":first-child").parent())&&e.size()?(t.cut_copy.copy_nodes=!1,void(t.cut_copy.cut_nodes=e)):this.error("CUT: NO NODE SELECTED")},copy:function(e){return this.locked?this.error("LOCKED"):(e=e?this.get_node(e):this.container.find("a.clicked").filter(":first-child").parent())&&e.size()?(t.cut_copy.copy_nodes=e,void(t.cut_copy.cut_nodes=!1)):this.error("COPY: NO NODE SELECTED")},paste:function(e,i){if(this.locked)return this.error("LOCKED");var s=!1;if(-1==e?(s=!0,e=this.container):e=e?this.get_node(e):this.selected,!(s||e&&e.size()))return this.error("PASTE: NO NODE SELECTED");if(!t.cut_copy.copy_nodes&&!t.cut_copy.cut_nodes)return this.error("PASTE: NOTHING TO DO");var r=i;if("before"==i?(i=e.parent().children().index(e),e=e.parents("li:eq(0)")):"after"==i?(i=e.parent().children().index(e)+1,e=e.parents("li:eq(0)")):"undefined"!=(typeof i).toLowerCase()&&"inside"!=i||(i="top"==this.settings.rules.createat?0:e.children("ul:eq(0)").children("li").size()),s||0!=e.size()||(s=!0,e=this.container),t.cut_copy.copy_nodes&&t.cut_copy.copy_nodes.size()){var n=!0;if(!s&&!this.check_move(t.cut_copy.copy_nodes,e.children("a:eq(0)"),"inside"))return!1;if(0==e.children("ul").size()||1==s&&0==e.children("ul").children("li").size())if(s){this.moved(t.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",!1,!0)}else{this.moved(t.cut_copy.copy_nodes,e.children("a:eq(0)"),"inside",!1,!0)}else if("before"==r&&e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size()){this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before",!1,!0)}else if("after"==r&&e.children("ul:eq(0)").children("li:nth-child("+i+")").size()){this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+i+")").children("a:eq(0)"),"after",!1,!0)}else if(e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size()){this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before",!1,!0)}else{this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!1,!0)}t.cut_copy.copy_nodes=!1}if(t.cut_copy.cut_nodes&&t.cut_copy.cut_nodes.size()){var n=!0;if(e.parents().andSelf().each(function(){if(-1!=t.cut_copy.cut_nodes.index(this))return n=!1,!1}),!n)return this.error("Invalid paste");if(!s&&!this.check_move(t.cut_copy.cut_nodes,e.children("a:eq(0)"),"inside"))return!1;if(0==e.children("ul").size()||1==s&&0==e.children("ul").children("li").size())if(s){this.moved(t.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside")}else{this.moved(t.cut_copy.cut_nodes,e.children("a:eq(0)"),"inside")}else if("before"==r&&e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size()){this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before")}else if("after"==r&&e.children("ul:eq(0)").children("li:nth-child("+i+")").size()){this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+i+")").children("a:eq(0)"),"after")}else if(e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size()){this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before")}else{this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after")}t.cut_copy.cut_nodes=!1}},search:function(e,t){var i=this;if((!e||this.srch&&e!=this.srch)&&(this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search")),this.srch=e,e){t||(t="contains");var s="a";this.settings.languages.length&&(s+="."+this.current_lang),e=e.toLowerCase();var r=null,n=search_string_tokenize(e);"undefined"!=g_all_li&&null!=g_all_li&&n.length>=0&&(g_CNTfun++,r=g_all_li.filter(function(){var e=search_it(this.id,n);return this.style.display=e?"":"none",e}),lp_display_folders(r,i),this.callback("onsearch",[r,this]))}},add_sheet:t.add_sheet,destroy:function(){if(this.callback("ondestroy",[this]),("undefined"==typeof LPFromWebsite||"function"!=typeof LPFromWebsite.ipad)&&(this.container.unbind(".jstree"),e("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree"),this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search"),this.cntr==t.focused))for(var i in t.inst)if(i!=this.cntr&&i!=this.container.attr("id")){t.inst[i].focus();break}t.inst[this.cntr]=!1,t.inst[this.container.attr("id")]=!1,delete t.inst[this.cntr],delete t.inst[this.container.attr("id")],t.cntr--}}}e.tree={datastores:{},plugins:{},defaults:{data:{async:!1,type:"html",opts:{method:"GET",url:!1}},selected:!1,opened:[],languages:[],ui:{dots:!0,animation:0,scroll_spd:7,theme_path:!1,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{default:{clickable:!0,renameable:!0,deletable:!0,creatable:!0,draggable:"undefined"==typeof LPFromWebsite||"function"!=typeof LPFromWebsite.ipad,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:!1,position:!1}}},rules:{multiple:!1,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:!0,use_max_depth:!0,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(e,t){return!0},beforeopen:function(e,t){return!0},beforeclose:function(e,t){return!0},beforemove:function(e,t,i,s){return!0},beforecreate:function(e,t,i,s){return!0},beforerename:function(e,t,i){return!0},beforedelete:function(e,t){return!0},beforedata:function(t,i){return{id:e(t).attr("id")||0}},ondata:function(e,t){return e},onparse:function(e,t){return e},onhover:function(e,t){},onselect:function(e,t){},ondeselect:function(e,t){},onchange:function(e,t){},onrename:function(e,t,i){},onmove:function(e,t,i,s,r){},oncopy:function(e,t,i,s,r){},oncreate:function(e,t,i,s,r){},ondelete:function(e,t,i){},onopen:function(e,t){"function"==typeof lponopen&&lponopen(e,t)},onopen_all:function(e){},onclose_all:function(e){},onclose:function(e,t){"function"==typeof lponclose&&lponclose(e,t)},error:function(e,t){},ondblclk:function(e,t){var i=lastdblclick;lastdblclick=new Date,i.getTime()>lastdblclick.getTime()-1e3||(t.toggle_branch.call(t,e),t.select_branch.call(t,e))},onrgtclk:function(e,t,i){},onload:function(e){},oninit:function(e){},onfocus:function(e){},ondestroy:function(e){},onsearch:function(e,t){e.addClass("search")},ondrop:function(e,t,i,s){},check:function(e,t,i,s){return i},check_move:function(e,t,i,s){return!0}},plugins:{}},create:function(){return new t},focused:function(){return t.inst[t.focused]},reference:function(i){var s=e(i);return s.size()||(s=e("#"+i)),s.size()?(s=s.is(".tree")?s.attr("id"):s.parents(".tree:eq(0)").attr("id"),t.inst[s]||null):null},rollback:function(i){for(var s in i)if(i.hasOwnProperty(s)){var r=t.inst[s],n=!r.locked;n&&r.lock(!0),r.inp=!1,r.container.html(i[s].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover"),i[s].selected&&(r.selected=e("#"+i[s].selected),r.selected_arr=[],r.container.find("a.clicked").each(function(){r.selected_arr.push(r.get_node(this))})),n&&r.lock(!1),delete n,delete r}},drop_mode:function(i){i=e.extend(i,{show:!1,type:"default",str:"Foreign node"}),t.drag_drop.foreign=!0,t.drag_drop.isdown=!0,t.drag_drop.moving=!0,t.drag_drop.appended=!1,t.drag_drop.f_type=i.type,t.drag_drop.f_data=i,i.show?(t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+i.str+"</a></li></ul></div>"),t.drag_drop.drag_node=t.drag_drop.drag_help.find("li:eq(0)")):(t.drag_drop.drag_help=!1,t.drag_drop.drag_node=!1),!1!==e.tree.drag_start&&e.tree.drag_start.call(null,!1)},drag_start:!1,drag:!1,drag_end:!1},e.fn.tree=function(i){return this.each(function(){var s=e.extend({},i);t.inst&&t.inst[e(this).attr("id")]&&t.inst[e(this).attr("id")].destroy(),!1!==s&&(new t).init(this,s)})},t.cntr=0,t.inst={},t.themes=[],t.drag_drop={isdown:!1,drag_node:!1,drag_help:!1,dragged:!1,init_x:!1,init_y:!1,moving:!1,origin_tree:!1,marker:!1,move_type:!1,ref_node:!1,appended:!1,foreign:!1,droppable:[],open_time:!1,scroll_time:!1},t.mouseup=function(i){var s=t.drag_drop;if(s.open_time&&clearTimeout(s.open_time),s.scroll_time&&clearTimeout(s.scroll_time),s.moving&&!1!==e.tree.drag_end&&e.tree.drag_end.call(null,i,s),!1===s.foreign&&s.drag_node&&s.drag_node.size()){if(s.drag_help.remove(),s.move_type){var r=t.inst[s.ref_node.parents(".tree:eq(0)").attr("id")];r&&r.moved(s.dragged,s.ref_node,s.move_type,!1,"on"==s.origin_tree.settings.rules.drag_copy||"ctrl"==s.origin_tree.settings.rules.drag_copy&&i.ctrlKey)}s.move_type=!1,s.ref_node=!1}if(!1!==s.foreign){if(s.drag_help&&s.drag_help.remove(),s.move_type){var r=t.inst[s.ref_node.parents(".tree:eq(0)").attr("id")];r&&r.callback("ondrop",[s.f_data,r.get_node(s.ref_node).get(0),s.move_type,r])}s.foreign=!1,s.move_type=!1,s.ref_node=!1}if(t.drag_drop.marker&&t.drag_drop.marker.hide(),s.dragged&&s.dragged.size()&&s.dragged.removeClass("dragged"),s.dragged=!1,s.drag_help=!1,s.drag_node=!1,s.f_type=!1,s.f_data=!1,s.init_x=!1,s.init_y=!1,s.moving=!1,s.appended=!1,s.origin_tree=!1,s.isdown)return s.isdown=!1,i.preventDefault(),i.stopPropagation(),!1},t.mousemove=function(i){var s=t.drag_drop,r=!1;if(s.isdown){if(!s.moving&&Math.abs(s.init_x-i.pageX)<5&&Math.abs(s.init_y-i.pageY)<5)return i.preventDefault(),i.stopPropagation(),!1;if(s.moving||(t.drag_drop.moving=!0,r=!0),s.open_time&&clearTimeout(s.open_time),!1!==s.drag_help&&(s.appended||(!1!==s.foreign&&(s.origin_tree=e.tree.focused()),e("body").append(s.drag_help),s.w=s.drag_help.width(),s.appended=!0),s.drag_help.css({left:i.pageX+5,top:i.pageY+15})),r&&!1!==e.tree.drag_start&&e.tree.drag_start.call(null,i,s),!1!==e.tree.drag&&e.tree.drag.call(null,i,s),"DIV"==i.target.tagName&&"jstree-marker"==i.target.id)return!1;var n=e(i.target);n.is("ins")&&(n=n.parent());var a=n.is(".tree")?n:n.parents(".tree:eq(0)");if(0==a.size()||!t.inst[a.attr("id")])return s.scroll_time&&clearTimeout(s.scroll_time),!1!==s.drag_help&&s.drag_help.find("li:eq(0) ins").addClass("forbidden"),s.move_type=!1,s.ref_node=!1,t.drag_drop.marker.hide(),!1;var l=t.inst[a.attr("id")];l.off_height(),s.scroll_time&&clearTimeout(s.scroll_time),s.scroll_time=setTimeout(function(){l.scroll_check(i.pageX,i.pageY)},50);var o=!1;a.scrollTop();if("A"==i.target.tagName||"INS"==i.target.tagName){if(n.is("#jstree-dragged"))return!1;l.get_node(i.target).hasClass("closed")&&(s.open_time=setTimeout(function(){l.open_branch(n)},500));var d=n.offset(),c={x:d.left-1,y:i.pageY-d.top},h=[];h=c.y<l.li_height/3+1?["before","inside","after"]:c.y>2*l.li_height/3-1?["after","inside","before"]:c.y<l.li_height/2?["inside","before","after"]:["inside","after","before"];var g=!1,u=0==s.foreign?s.origin_tree.container.find("li.dragged"):s.f_type;if(e.each(h,function(e,t){if(l.check_move(u,n,t))return o=t,g=!0,!1}),g){switch(o){case"before":c.y=d.top-2,t.drag_drop.marker.attr("class","marker");break;case"after":c.y=d.top-2+l.li_height,t.drag_drop.marker.attr("class","marker");break;case"inside":c.x-=2,c.y=d.top-2+l.li_height/2,t.drag_drop.marker.attr("class","marker_plus")}s.move_type=o,s.ref_node=e(i.target),!1!==s.drag_help&&s.drag_help.find(".forbidden").removeClass("forbidden"),t.drag_drop.marker.css({left:c.x,top:c.y}).show()}}if((n.is(".tree")||n.is("ul"))&&0==n.find("li:eq(0)").size()){var d=n.offset();s.move_type="inside",s.ref_node=a.children("ul:eq(0)"),!1!==s.drag_help&&s.drag_help.find(".forbidden").removeClass("forbidden"),t.drag_drop.marker.attr("class","marker_plus"),t.drag_drop.marker.css({left:d.left+10,top:d.top+15}).show()}else("A"!=i.target.tagName&&"INS"!=i.target.tagName||!g)&&(!1!==s.drag_help&&s.drag_help.find("li:eq(0) ins").addClass("forbidden"),s.move_type=!1,s.ref_node=!1,t.drag_drop.marker.hide());return i.preventDefault(),i.stopPropagation(),!1}return!0},e(function(){e(document).bind("mousemove.jstree",t.mousemove),e(document).bind("mouseup.jstree",t.mouseup)}),t.cut_copy={copy_nodes:!1,cut_nodes:!1},t.css=!1,t.get_css=function(e,s){e=e.toLowerCase();var r=t.css.cssRules||t.css.rules,n=0;do{if(r.length&&n>r.length+5)return!1;if(r[n].selectorText&&r[n].selectorText.toLowerCase()==e)return 1==s?(t.css.removeRule&&document.styleSheets[i].removeRule(n),t.css.deleteRule&&document.styleSheets[i].deleteRule(n),!0):r[n]}while(r[++n]);return!1},t.add_css=function(e){return!t.get_css(e)&&(t.css.insertRule?t.css.insertRule(e+" { }",0):t.css.addRule(e,null,0),t.get_css(e))},t.remove_css=function(e){return t.get_css(e,!0)},t.add_sheet=function(e){if(e.str){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.styleSheet?(document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet.cssText=e.str):(t.appendChild(document.createTextNode(e.str)),document.getElementsByTagName("head")[0].appendChild(t)),t.sheet||t.styleSheet}if(e.url){if(!document.createStyleSheet){var i=document.createElement("link");return i.rel="stylesheet",i.type="text/css",i.media="all",i.href=e.url,document.getElementsByTagName("head")[0].appendChild(i),i.styleSheet}try{document.createStyleSheet(e.url)}catch(e){}}},e(function(){var i=navigator.userAgent.toLowerCase(),s=(i.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/),"");e.browser.msie&&(6==e.browser.version&&(s+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }'),7==e.browser.version&&(s+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }')),e.browser.opera&&(s+='.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }'),e.browser.mozilla&&0==e.browser.version.indexOf("1.8")&&(s+=".tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }"),""!=s&&(t.css=t.add_sheet({str:s}))})}(jQuery),function(e){e.extend(e.tree.datastores,{html:function(){return{get:function(t,i,s){return t&&e(t).size()?e("<div>").append(i.get_node(t).clone()).html():i.container.children("ul:eq(0)").html()},parse:function(e,t,i,s){return s&&s.call(null,e),e},load:function(t,i,s,r){s.url?e.ajax({type:s.method,url:s.url,data:t,dataType:"html",success:function(e,t){r.call(null,e)},error:function(e,t,s){r.call(null,!1),i.error(s+" "+t)}}):r.call(null,s.static||i.container.children("ul:eq(0)").html())}}},json:function(){return{get:function(t,i,s){var r=this;if(t=t&&0!=e(t).size()?e(t):i.container.children("ul").children("li"),s||(s={}),s.outer_attrib||(s.outer_attrib=["id","rel","class"]),s.inner_attrib||(s.inner_attrib=[]),t.size()>1){var n=[];return t.each(function(){n.push(r.get(this,i,s))}),n}if(0==t.size())return[];var a={attributes:{},data:{}};t.hasClass("open")&&(a.data.state="open"),t.hasClass("closed")&&(a.data.state="closed");for(var l in s.outer_attrib)if(s.outer_attrib.hasOwnProperty(l)){var o="class"==s.outer_attrib[l]?t.attr(s.outer_attrib[l]).replace(/(^| )last( |$)/gi," ").replace(/(^| )(leaf|closed|open)( |$)/gi," "):t.attr(s.outer_attrib[l]);void 0!==o&&o.toString().replace(" ","").length>0&&(a.attributes[s.outer_attrib[l]]=o),delete o}if(i.settings.languages.length){for(var l in i.settings.languages)if(i.settings.languages.hasOwnProperty(l)){var d=t.children("a."+i.settings.languages[l]);if(s.force||s.inner_attrib.length||d.children("ins").get(0).style.backgroundImage.toString().length||d.children("ins").get(0).className.length){if(a.data[i.settings.languages[l]]={},a.data[i.settings.languages[l]].title=i.get_text(t,i.settings.languages[l]),d.children("ins").get(0).style.className.length&&(a.data[i.settings.languages[l]].icon=d.children("ins").get(0).style.className),d.children("ins").get(0).style.backgroundImage.length&&(a.data[i.settings.languages[l]].icon=d.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),s.inner_attrib.length){a.data[i.settings.languages[l]].attributes={};for(var c in s.inner_attrib)if(s.inner_attrib.hasOwnProperty(c)){var o=d.attr(s.inner_attrib[c]);void 0!==o&&o.toString().replace(" ","").length>0&&(a.data[i.settings.languages[l]].attributes[s.inner_attrib[c]]=o),delete o}}}else a.data[i.settings.languages[l]]=i.get_text(t,i.settings.languages[l])}}else{var d=t.children("a");if(a.data.title=i.get_text(t),d.children("ins").size()&&d.children("ins").get(0).className.length&&(a.data.icon=d.children("ins").get(0).className),d.children("ins").size()&&d.children("ins").get(0).style.backgroundImage.length&&(a.data.icon=d.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),s.inner_attrib.length){a.data.attributes={};for(var c in s.inner_attrib)if(s.inner_attrib.hasOwnProperty(c)){var o=d.attr(s.inner_attrib[c]);void 0!==o&&o.toString().replace(" ","").length>0&&(a.data.attributes[s.inner_attrib[c]]=o),delete o}}}return t.children("ul").size()>0&&(a.children=[],t.children("ul").children("li").each(function(){a.children.push(r.get(this,i,s))})),a},parse:function(e,t,i,s){if("[object Array]"===Object.prototype.toString.apply(e)){for(var r="",n=0;n<e.length;n++)"function"!=typeof e[n]&&(r+=this.parse(e[n],t,i));return s&&s.call(null,r),r}if(!e||!e.data)return s&&s.call(null,!1),"";var r="";r+="<li ";var a=!1;if(e.attributes)for(var n in e.attributes)e.attributes.hasOwnProperty(n)&&("class"==n?(r+=" class='"+e.attributes[n]+" ","closed"!=e.state&&"open"!=e.state||(r+=" "+e.state+" "),r+="' ",a=!0):r+=" "+n+"='"+e.attributes[n]+"' ");if(a||"closed"!=e.state&&"open"!=e.state||(r+=" class='"+e.state+"' "),r+=">",t.settings.languages.length)for(var n=0;n<t.settings.languages.length;n++){var l={};if(l.href="",l.style="",l.class=t.settings.languages[n],e.data[t.settings.languages[n]]&&"undefined"!=(typeof e.data[t.settings.languages[n]].attributes).toLowerCase())for(var o in e.data[t.settings.languages[n]].attributes)e.data[t.settings.languages[n]].attributes.hasOwnProperty(o)&&("style"==o||"class"==o?l[o]+=" "+e.data[t.settings.languages[n]].attributes[o]:l[o]=e.data[t.settings.languages[n]].attributes[o]);r+="<a";for(var o in l)l.hasOwnProperty(o)&&("style"==o&&""==l[o]||(r+=" "+o+'="'+l[o]+'" '));r+=">",e.data[t.settings.languages[n]]&&e.data[t.settings.languages[n]].icon?r+="<ins "+(-1==e.data[t.settings.languages[n]].icon.indexOf("/")?" class='"+e.data[t.settings.languages[n]].icon+"' ":" style='background-image:url(\""+e.data[t.settings.languages[n]].icon+"\");' ")+">&nbsp;</ins>":r+="<ins>&nbsp;</ins>",r+=("undefined"!=(typeof e.data[t.settings.languages[n]].title).toLowerCase()?e.data[t.settings.languages[n]].title:e.data[t.settings.languages[n]])+"</a>"}else{var l={};if(l.href="",l.style="",l.class="","undefined"!=(typeof e.data.attributes).toLowerCase())for(var n in e.data.attributes)e.data.attributes.hasOwnProperty(n)&&("style"==n||"class"==n?l[n]+=" "+e.data.attributes[n]:l[n]=e.data.attributes[n]);r+="<a";for(var n in l)l.hasOwnProperty(n)&&("style"==n&&""==l[n]||(r+=" "+n+'="'+l[n]+'" '));r+=">";var d=null,c=null;if("object"==typeof e.data){var n="icon";void 0!==e.data[n]&&(d=e.data[n]);var n="title";void 0!==e.data[n]&&(c=e.data[n])}r+=d?'<img src="'+d+'" />':"<ins>&nbsp;</ins>",r+=(c||e.data)+"</a>"}if(e.children&&e.children.length){r+="<ul>";for(var n=0;n<e.children.length;n++)r+=this.parse(e.children[n],t,i);r+="</ul>"}return r+="</li>",s&&s.call(null,r),r},load:function(t,i,s,r){s.static?(r.call(null,s.static),s.static=null):e.ajax({type:s.method,url:s.url,data:t,dataType:"json",success:function(e,t){r.call(null,e)},error:function(e,t,s){r.call(null,!1),i.error(s+" "+t)}})}}}})}(jQuery);
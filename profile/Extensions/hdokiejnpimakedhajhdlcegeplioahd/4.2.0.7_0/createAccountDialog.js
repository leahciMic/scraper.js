var CreateAccountDialog=function(e){Dialog.call(this,e,{views:[{selector:"#dataEntry"},{selector:"#confirmation",title:Strings.translateString("Confirm Password")}],dynamicHeight:!0,additionalHeaderClasses:["icon"],nextButtonText:Strings.translateString("Create Account"),largeButtons:!0,title:Strings.translateString("Create Account")})};CreateAccountDialog.prototype=Object.create(Dialog.prototype),CreateAccountDialog.prototype.constructor=CreateAccountDialog,function(){CreateAccountDialog.prototype.initialize=function(e){Dialog.prototype.initialize.apply(this,arguments),this.inputFields.password.getElement().LP_addPasswordMeter(),function(e){e.inputFields.email.onChange(function(t){t&&getBG().LPServer.textRequest({type:"GET",url:"create_account.php",CSRFToken:!1,data:{username:t,check:"avail",mistype:1},success:function(t){0===t.indexOf("mistype:")?e.addError("email",t.substring(8)):"no"===t&&e.addError("email",Strings.translateString("Email already in use."))}})})}(this)},CreateAccountDialog.prototype.close=function(e){e?Dialog.prototype.close.apply(this,arguments):function(e){LPTools.getOption(e.data,"showcloseconfirm",!0)?dialogs.confirmation.open({title:"LastPass",text:Strings.translateString("Do you really want to quit?  You cannot use LastPass without creating an account."),handler:function(){dialogs.alert.open({title:"LastPass",text:Strings.translateString("Please visit https://lastpass.com to create an account at a later time."),handler:function(){e.close(!0)}})}}):e.close(!0)}(this)},CreateAccountDialog.prototype.validate=function(e){var t=Dialog.prototype.validate.apply(this,arguments);return e.email.length<5&&(this.addError("email",Strings.translateString("It looks like you've entered an invalid or incomplete email address. Please try again.")),t=!1),e.agreeTerms||(this.addError("agreeTerms",Strings.translateString("You must agree to the Terms and Conditions in order to continue")),t=!1),e.password.length<8&&(this.addError("password",Strings.translateString("Sorry, your password is too short. It must be a minimum of 8 characters long for security reasons.")),t=!1),e.password&&e.password===e.email&&(this.addError("password",Strings.translateString("Sorry, your password can not be the same as your email address.")),t=!1),(e.password.match(/^password\d{0,3}$/i)||"12345678"===e.password||"123456789"===e.password||"1234567890"===e.password||e.password.match(/^lastpass\d{0,3}$/i)||"lastpass.com"===e.password||"qwertyuiop"===e.password||"abcd1234"===e.password)&&(this.addError("password",Strings.translateString("Your password is easily guessable, avoid simple runs of characters, or variations of 'password' or 'lastpass'.")),t=!1),e.password&&-1!==e.reminder.toLowerCase().indexOf(e.password.toLowerCase())&&(this.addError("reminder",Strings.translateString("Your Password Reminder can not be the same as your chosen Master Password for security reasons. Please edit your Reminder so that it does not contain your Master Password.")),t=!1),this.currentViewIndex===this.views.length-1&&e.password!==e.reconfirm&&(this.addError("reconfirm",Strings.translateString("Your Master Password and Confirm Master Password entries do not match, please enter them again.")),t=!1),t},CreateAccountDialog.prototype.handleSubmit=function(){var e=function(e,r,a,s,o){var i="";if(e){var n=e;if(n.indexOf("ok")>=0)a.set("g_manual_login",!0),a.LP_do_login(r.email,r.password,!0,!1,null,!0,null,null,function(){o.close(!0)});else if(n.indexOf("usernametaken")>=0)i=Strings.translateString("Email already in use, have you forgotten your password?");else if(n.indexOf("usernameinvalid")>=0||n.indexOf("emailfailed")>=0)i=Strings.translateString("Invalid email address, try again");else{var l=jQuery.parseXML(e);if(l&&l.documentElement){var d=l.getElementsByTagName("error");d&&d.length>0&&d[0].getAttribute("msg")&&(i=d[0].getAttribute("msg"))}""===i&&(i=Strings.translateString("A server error occurred while processing your request."))}}else i=Strings.translateString("Received empty response from server.");i&&t(i,r,s)},t=function(e,t,r){Topics.get(Topics.ERROR).publish(e),Topics.get(Topics.REQUEST_ERROR).publish({requestID:r})};return function(r){r.email=bg.fix_username(r.email);var a=LPRequest.getNewRequestID();!function(s,o){s.make_lp_key_hash(r.email,r.password,function(i,n,l){var d={username:r.email,email:r.email,hash:n,password_hint:r.reminder,improve:1,loglogins:1,iterations:l,xml:1};BuildVariables&&BuildVariables.createSource&&(d[BuildVariables.createSource]=1),Topics.get(Topics.REQUEST_START).publish({requestID:a}),s.create_account_safe($.param(d),function(t){e(t,r,s,a,o)},t)})}(bg,this)}}()}();
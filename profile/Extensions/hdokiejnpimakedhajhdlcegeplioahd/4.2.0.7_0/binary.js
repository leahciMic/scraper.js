function hasProperty(e,s,n){if("object"!=typeof e||null===e)return!1;var a=s.split("."),t=e[a[0]];return 1===a.length?n?typeof t===n:void 0!==t||null!==t:hasProperty(t,a.slice(1).join("."))}function have_binary(){return have_nplastpass()||have_native_messaging()||have_ws()}function have_binary_function(e,s){return!(!have_nplastpass(null,s)||"function"!=typeof g_nplastpass[e])||(!(!have_native_messaging()||!lp_in_array(e,g_native_messaging_functions))||!(!have_ws()||!lp_in_array(e,g_ws_functions)))}function call_binary_function(){if(arguments.length>0){for(var e=arguments[0],s=new Array,n=null,a=1;a<arguments.length;a++)a==arguments.length-1&&"function"==typeof arguments[a]?n=arguments[a]:s[s.length]=arguments[a];if(have_nplastpass()&&"function"==typeof g_nplastpass[e]){var t;0==s.length?t=g_nplastpass[e]():1==s.length?t=g_nplastpass[e](s[0]):2==s.length?t=g_nplastpass[e](s[0],s[1]):3==s.length?t=g_nplastpass[e](s[0],s[1],s[2]):4==s.length?t=g_nplastpass[e](s[0],s[1],s[2],s[3]):5==s.length?t=g_nplastpass[e](s[0],s[1],s[2],s[3],s[4]):6==s.length?t=g_nplastpass[e](s[0],s[1],s[2],s[3],s[4],s[5]):lplog("too many arguments passed to call_binary_function, funcname="+e+", argslen="+s.length),n&&n(t)}else if(have_native_messaging()&&lp_in_array(e,g_native_messaging_functions)){for(var i={cmd:e,argcount:s.length},a=0;a<s.length;a++)i["arg"+a]=s[a];var r;"get_chrome_passwords"==e&&(r=n,n=function(e){r(JSON.parse(e))}),native_messaging_send_message(i,n)}else if(lp_ws&&lp_ws.isconnected()&&lp_in_array(e,g_ws_functions)){for(var i={cmd:e,argcount:s.length},a=0;a<s.length;a++)i["arg"+a]=s[a];var r;"get_chrome_passwords"==e&&(r=n,n=function(e){r(JSON.parse(e))}),ws_send_message(i,n)}}}function call_binary_function_if(){if(arguments.length>0){have_binary_function(arguments[0])?call_binary_function.apply(this,arguments):arguments.length>1&&"function"==typeof arguments[arguments.length-1]&&arguments[arguments.length-1](!1)}}function resolveToFile(e){switch(e.scheme){case"chrome":return resolveToFile(g_chrome.Cc["@mozilla.org/chrome/chrome-registry;1"].getService(g_chrome.Ci.nsIChromeRegistry).convertChromeURL(e));case"resource":return resolveToFile(g_chrome.Cu.import("resource://gre/modules/Services.jsm").Services.io.newURI(g_chrome.Cu.import("resource://gre/modules/Services.jsm").Services.io.getProtocolHandler("resource").QueryInterface(g_chrome.Ci.nsIResProtocolHandler).resolveURI(e),null,null));case"file":return e.QueryInterface(g_chrome.Ci.nsIFileURL).file;case"jar":return{exists:function(){return!0},path:e.spec};default:throw new Error("Cannot resolve")}}function connect_native_messaging(){try{if(g_isfirefoxsdk){if(!g_is_win&&!g_is_mac&&!g_is_linux)return;var e;if(g_is_win?e=-1!=g_system.architecture.indexOf("64")?"nplastpass64.dll":"nplastpass.dll":g_is_mac?e="nplastpass.bundle/Contents/MacOS/nplastpass":g_is_linux&&(e=-1!=g_system.architecture.indexOf("64")?"libnplastpass64.so":"libnplastpass.so"),e=resolveToFile(g_chrome.Cu.import("resource://gre/modules/Services.jsm").Services.io.newURI(self.data.url(e),null,null)),!e.exists())return;lpctypes=g_chrome.Cu.import("resource://gre/modules/ctypes.jsm").ctypes,lpctypeslib=lpctypes.open(e.path),lpctypesabi=g_is_win&&-1==g_system.architecture.indexOf("64")?lpctypes.winapi_abi:lpctypes.default_abi,lpctypesfree=lpctypeslib.declare("lp_free",lpctypesabi,lpctypes.void_t,lpctypes.void_t.ptr),lpctypes_call_binary_function=function(e){try{var s,n=lpctypeslib.declare("call_binary_function",lpctypesabi,lpctypes.char.ptr,lpctypes.char.ptr),a=n(e);return a.isNull()?s="":(s=a.readString(),lpctypesfree(a)),s}catch(e){return""}}}else{if("undefined"==typeof chrome)return;if(hasProperty(chrome,"runtime.connectNative"))g_native_messaging=chrome.runtime.connectNative("com.lastpass.nplastpass");else{if(!hasProperty(chrome,"extension.connectNative"))return;g_native_messaging=chrome.extension.connectNative("com.lastpass.nplastpass")}g_native_messaging.onMessage.addListener(native_messaging_message),g_native_messaging.onDisconnect.addListener(function(){g_native_messaging_loaded=!1,lplog("native messaging host disconnected"),hasProperty(chrome,"runtime.lastError.message")?lplog("last error: "+chrome.runtime.lastError.message):hasProperty(chrome,"extension.lastError.message")&&lplog("last error: "+chrome.extension.lastError.message)})}native_messaging_send_message({cmd:"get_function_names",argcount:0},function(e){e&&(g_native_messaging_functions=e.split(","),g_native_messaging_loaded=!0,localStorage_setItem("hadNativeMessaging","1"),setup_wlan_variables(),setup_is_chrome_portable(),!have_nplastpass()&&g_onload_started&&onLoad(!0))}),native_messaging_send_message({cmd:"get_version",argcount:0},function(e){if(CompareLastPassVersions(e,"3.0.15")<=0)return g_native_messaging_loaded=!1,g_native_messaging.disconnect(),void lplog("blocked old native messaging host version "+e);g_native_messaging_version=e}),native_messaging_send_message({cmd:"get_build_date",argcount:0},function(e){g_native_messaging_build_date=e}),native_messaging_send_message({cmd:"get_build_time",argcount:0},function(e){g_native_messaging_build_time=e})}catch(e){}}function native_messaging_message(e,s,n){if(void 0!==e.id){var a=n?g_ws_callbacks:g_native_messaging_callbacks;lpdbg("nativemessaging","got message, id="+e.id);var t=!1;if(void 0!==e.retval)t=!0;else if(void 0!==e.parts&&void 0!==e.part&&void 0!==e.retvalpart){if(void 0===g_native_messaging_parts[e.id]){g_native_messaging_parts[e.id]=new Array;for(var i=0;i<e.parts;i++)g_native_messaging_parts[e.id][i]=null}g_native_messaging_parts[e.id][e.part]=e.retvalpart,t=!0;for(var i=0;i<e.parts;i++)if(null==g_native_messaging_parts[e.id][i]){t=!1;break}if(t){e.retval="";for(var i=0;i<e.parts;i++)e.retval+=g_native_messaging_parts[e.id][i];g_native_messaging_parts[e.id]=null}}if(t&&"function"==typeof a[e.id]){var r=a[e.id];a[e.id]=null,r(e.retval)}}else if(void 0!==e.cmd)switch(lpdbg("nativemessaging","got message, cmd="+e.cmd),e.cmd){case"namedpipeobserverfunction":namedpipeobserverfunction(e.arg0,e.arg1,e.arg2);break;case"basicauth_save":basicauth_save(e.arg0,e.arg1,e.arg2,e.arg3);break;case"basicauth_found":basicauth_found(e.arg0,e.arg1,e.arg2)}}function have_native_messaging(){return g_native_messaging_loaded}function have_ws(){return"undefined"!=typeof lp_ws&&lp_ws.isconnected()}function native_messaging_send_message(e,s){try{var n=(new Date).getTime()+"_"+Math.floor(100*Math.random());if(lpdbg("nativemessaging","sending message, cmd="+(void 0!==e.cmd?e.cmd:"undefined")+", id="+n),e.id=n,g_isfirefoxsdk){e.extension_url="data:application/vnd.mozilla.xul+xml";var a=lpctypes_call_binary_function(JSON.stringify(e));"function"==typeof s&&s(JSON.parse(a).retval)}else g_native_messaging_callbacks[n]=s,g_native_messaging.postMessage(e)}catch(e){}}function ws_send_part(e,s){var n=g_ws_parts[e].message,a=g_ws_parts[e].arg;n.part=s,n["arg"+n.argpart]=a.substring(s*chunk_size,(s+1)*chunk_size),s>=n.parts-1?g_ws_callbacks[e]=function(s){g_ws_parts[e].callback(s),g_ws_parts[e]=null}:g_ws_callbacks[e]=function(s){ws_send_part(e,s+1)},lp_ws.send(LPJSON.stringify(n))}function ws_send_message(e,s){try{var n=(new Date).getTime()+"_"+Math.floor(100*Math.random());e.id=n;var a=-1;if(g_ischrome)for(var t=0;t<e.argcount;t++)if("string"==typeof e["arg"+t]&&e["arg"+t].length>chunk_size){a=t;break}if(-1!=a){var i=e["arg"+a];e.cmdparts=e.cmd,delete e.cmd,e.argpart=a,e.parts=Math.ceil(i.length/chunk_size),g_ws_parts[n]={message:e,arg:i,callback:s},ws_send_part(n,0)}else g_ws_callbacks[n]=s,lp_ws.send(LPJSON.stringify(e))}catch(e){}}function test_native_messaging(e){try{if(g_isfirefoxsdk||is_firefox_webext())return void e(!0);if(!g_ischrome||"undefined"==typeof chrome||void 0===chrome.permissions||void 0===chrome.permissions.contains)return void(g_do_native_messaging=!1);var s=navigator.userAgent.match(/Chrome\/(\d+)/);if(s&&parseInt(s[1])<29)return void(g_do_native_messaging=!1);if(!g_is_win&&!g_is_mac&&!g_is_linux)return void(g_do_native_messaging=!1);chrome.permissions.contains({permissions:["nativeMessaging"]},e)}catch(e){g_do_native_messaging=!1}}function request_native_messaging(e){getBG().lpPutGblPref("native_messaging_asked","1"),e?openURL(getchromeurl("native_messaging.html?hidenever=1")):void 0!==chrome.permissions&&chrome.permissions.request({permissions:["nativeMessaging","privacy"]},function(e){e&&alert(gs("Please restart your browser to finish enabling native messaging."))})}function native_messaging_never_ask_again(){var e=getBG();e.lpPutGblPref("native_messaging_never_ask_again","1"),e.lpWriteAllPrefs(),e.closecurrenttab("native_messaging.html")}function open_native_messaging_html_if(){}function install_binary(e,s){if(g_do_native_messaging&&!e&&!g_have_native_messaging_permission&&supports_native_messaging())return void request_native_messaging(s);openURL(base_url+"installer/")}function debug_nplastpass(e){g_debug_nplastpass&&lpdbg("nplastpass",e)}function have_nplastpass(e,s){debug_nplastpass("checking for binary component");try{g_nplastpass&&g_nplastpass_loaded&&void 0===g_nplastpass.alert&&(debug_nplastpass("binary component loaded but alert function not found, resetting"),g_nplastpass=null)}catch(e){debug_nplastpass("caught exception while resetting binary component: "+e.message)}if(!g_nplastpass){if(g_nplastpass_exception&&!s)return!1;debug_nplastpass("attempting to setup binary component");for(var n=0;n<(g_issafari?2:1);n++)try{if(0==n){if(debug_nplastpass("setting binary component global"),g_nplastpass=document.getElementById("nplastpass"),!g_nplastpass&&g_isopera&&allow_nplastpass()){var a=document.createElement("embed");a.setAttribute("id","nplastpass"),a.setAttribute("type","application/x-vnd-lastpass"),document.body.appendChild(a),g_nplastpass=a}}else if(g_issafari)for(var t=0;t<safari.extension.bars.length;t++)if("LPMenu"==safari.extension.bars[t].identifier){var i=safari.extension.bars[t].contentWindow.document;i.getElementById("nplastpass")&&i.body.removeChild(i.getElementById("nplastpass"));var a=i.createElement("embed");a.setAttribute("id","nplastpass"),a.setAttribute("type","application/x-vnd-lastpass"),a.style.visibility="hidden",i.body.appendChild(a),g_nplastpass=a;break}if(!g_nplastpass){debug_nplastpass("exiting loop early, prior to triggering exception due to null/undefined g_nplastpass object."),g_nplastpass=null,g_nplastpass_exception=!0;continue}debug_nplastpass("type of alert is "+typeof g_nplastpass.alert),debug_nplastpass("checking for chrome portable"),g_nplastpass.is_chrome_portable(),debug_nplastpass("checking for wlan stuff"),setup_wlan_variables(),setup_is_chrome_portable(),debug_nplastpass("checking for alert function"),g_nplastpass_loaded=hasProperty(g_nplastpass,"alert"),debug_nplastpass(g_nplastpass_loaded?"binary component is loaded":"binary component failed to load");break}catch(e){debug_nplastpass("caught exception while setting up binary component: "+e.message),g_nplastpass=null,g_nplastpass_exception=!0}}g_debug_nplastpass=!1;try{return hasProperty(g_nplastpass,"alert")&&(e||-1==navigator.userAgent.indexOf("Chrome/4.1.249.1042"))}catch(e){return!1}}function get_nplastpass_version(){return have_nplastpass()&&"function"==typeof g_nplastpass.get_version?g_nplastpass.get_version():gs("Unknown")}function get_nplastpass_build_date_time(){return have_nplastpass()&&"function"==typeof g_nplastpass.get_build_date&&"function"==typeof g_nplastpass.get_build_time?g_nplastpass.get_build_date()+" "+g_nplastpass.get_build_time():gs("Unknown")}function close_lpctypeslib(){g_isfirefoxsdk&&lpctypeslib&&(ctypeslib=lpctypeslib,g_native_messaging_loaded=!1,lpctypesfree=null,lpctypeslib=null,g_is_mac||ctypeslib.close())}function lpuseopensslpbkdf2(){if("undefined"==typeof is_fennec||!is_fennec())return!1;try{lpopenssllib||(lpctypes||(lpctypes=g_chrome.Cu.import("resource://gre/modules/ctypes.jsm").ctypes),lpopenssllib=lpctypes.open("libcrypto.so"),lp_EVP_MD=new lpctypes.StructType("EVP_MD").ptr),lpopenssllib&&(lp_PKCS5_PBKDF2_HMAC||(lp_PKCS5_PBKDF2_HMAC=lpopenssllib.declare("PKCS5_PBKDF2_HMAC",lpctypes.default_abi,lpctypes.int,lpctypes.char.ptr,lpctypes.int,lpctypes.unsigned_char.ptr,lpctypes.int,lpctypes.int,lp_EVP_MD,lpctypes.int,lpctypes.unsigned_char.ptr)),lp_EVP_sha256||(lp_EVP_sha256=lpopenssllib.declare("EVP_sha256",lpctypes.default_abi,lp_EVP_MD)))}catch(e){}return lpopenssllib&&lp_PKCS5_PBKDF2_HMAC&&lp_EVP_sha256}function lpopensslpbkdf2(e,s,n,a){try{for(var t=new lpctypes.ArrayType(lpctypes.char)(e.length),i=0;i<e.length;i++){var r=e.charCodeAt(i);try{t[i]=new lpctypes.char(r)}catch(e){r>=128&&(r-=256),t[i]=new lpctypes.char(r)}}for(var l=new lpctypes.ArrayType(lpctypes.unsigned_char)(s.length),i=0;i<s.length;i++)l[i]=new lpctypes.unsigned_char(s.charCodeAt(i));var _=new lpctypes.ArrayType(lpctypes.unsigned_char)(a);lp_PKCS5_PBKDF2_HMAC(t,e.length,l,s.length,n,lp_EVP_sha256(),a,_);for(var p="",i=0;i<a;i++)p+=String.fromCharCode(_[i]);return AES.bin2hex(p)}catch(e){return""}}var lpctypes=null,lpctypeslib=null,lpctypesabi=null,lpctypesfree=null,lpctypes_call_binary_function=null,g_native_messaging=null,g_native_messaging_loaded=!1,g_native_messaging_functions=new Array,g_native_messaging_version=gs("Unknown"),g_native_messaging_build_date=gs("Unknown"),g_native_messaging_build_time=gs("Unknown"),g_native_messaging_parts=new Array,g_native_messaging_callbacks=new Object,g_ws_parts=new Object,chunk_size=5e4,g_ws_callbacks=new Object,g_ask_native_messaging_from_button=!1,g_debug_nplastpass=!0,g_nplastpass_loaded=!1,g_nplastpass_exception=!1,lpopenssllib=null,lp_EVP_MD=null,lp_PKCS5_PBKDF2_HMAC=null,lp_EVP_sha256=null;
var SiteDialog=function(A){EditableFieldsDialog.call(this,A,{closeButtonEnabled:!0,maximizeButtonEnabled:!0,dynamicHeight:!0,type:Account}),this.changePasswordButton=null};SiteDialog.prototype=Object.create(EditableFieldsDialog.prototype),SiteDialog.prototype.constructor=SiteDialog,function(){var A=function(A){var e=A.domain;return""!==A.a&&(e=A.a+" ("+A.domain+")"),e};SiteDialog.prototype.initialize=function(t){EditableFieldsDialog.prototype.initialize.apply(this,arguments),this.changePasswordButton=$("#autoChangePassword"),this.inputFields.password.getElement().LP_addPasswordMeter(this.inputFields.unencryptedUsername.getElement()),this.inputFields.url=new BloodhoundDropdown(document.getElementById("siteDialogURL"),{identify:function(A){return A.domain},remote:{url:LPProxy.getBaseURL()+"typeahead_addsite.php?q=%QUERY",wildcard:"%QUERY"}},{optionLabel:function(e){return A(e)},elementTemplate:{template:function(e){var t=""!==e.favicon?e.favicon:"R0lGODlhEAAQAIcAAAAAAExnf1BpgWR0iHZ6hHeBkX+GkYiOmpeaopucoaSlqqWmqrm9w7q+xL+/wry/xcXGyc3Oz9HS1NPU1tnZ2d/h4+Di5OLj5uPl5+Tk5OXm6O7u7+7v8O/w8e/w8vDw8fHx8vLy8/Pz8/Pz9PT09fX19fX29vb29vf39/f3+Pj4+Pj4+fn5+vr6+/v7/Pz8/P39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAAQABAAAAiQAAEIHEiw4MAFCBEmQCjBIIAFMiLK8CBjA4QIBiFu2Fgh4oYJDgpq5Chxw4KCCiqSlKigIAKVGyowYNDgAYGCB2BWsHABgwYDBQvA/CCiBAoVBQoOUNlBhAkVLV4MKCigIgenK1zAiCGgYICKIEhAhRExgFcZHEKcYEG27NkOI1K0aCvDLMEAePPqteuwr8CAADs=",a=LPTools.createElement("li","siteTypeaheadOption"),i=LPTools.createElement("div","itemIcon"),o=LPTools.createElement("img",{src:"data:image/gif;base64,"+t});return a.appendChild(i),a.appendChild(LPTools.createElement("span","siteTypeaheadOptionText",A(e))),i.appendChild(o),a},value:function(A){return A.url},hint:function(e){return A(e)}}}),this.addFavButton().appendChild(this.editFormFieldsButton.get(0)),function(A){A.inputFields.url.onChange(function(e){var t=LPProxy.getDomain(e.domain),a=t.indexOf("."),i=t.charAt(0).toUpperCase()+t.substring(1,a>0?a:t.length);if(A.inputFields.name.setValue(i),!bg.get("g_nofolder_feature_enabled")){var o=bg.get("siteCats");o&&o[t]&&A.inputFields.group.setValue(o[t])}var n=bg.Policies.getSaveSiteToPersonal();if(n){var s=LPProxy.getLinkedAccount();s&&o&&o[t]&&-1===n.indexOf(t)&&A.inputFields.group.setValue(s._data.group+"\\"+o[t])}}),t.find("#siteDialogPasswordHistory").bind("click",function(){if(!A.vaultItem.canViewPassword())return void Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password."));LPProxy.reprompt(function(){LPRequest.makeRequest(LPProxy.getPasswordHistory,{params:{aid:A.vaultItem.getID(),shareId:A.vaultItem.getShareID()},success:function(t){e(t,A.vaultItem,Constants.HISTORY_TYPES.PASSWORD)},requestSuccessOptions:{closeDialog:!1}}),bg.loglogin(A.vaultItem.getID())},{types:AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW})}),t.find("#siteDialogUsernameHistory").bind("click",function(){LPRequest.makeRequest(LPProxy.getUsernameHistory,{params:{aid:A.vaultItem.getID(),shareId:A.vaultItem.getShareID()},success:function(t){e(t,A.vaultItem,Constants.HISTORY_TYPES.USERNAME)},requestSuccessOptions:{closeDialog:!1}})}),t.find("#siteDialogNoteHistory").bind("click",function(){LPRequest.makeRequest(LPProxy.getNoteHistory,{params:{aid:A.vaultItem.getID(),shareId:A.vaultItem.getShareID()},success:function(t){e(t,A.vaultItem,Constants.HISTORY_TYPES.NOTE)},requestSuccessOptions:{closeDialog:!1}})}),A.changePasswordButton.bind("click",function(){var e=function(){LPProxy.autoChangePassword(A.vaultItem.getID()),A.close(!0)};if(!A.vaultItem.canViewPassword())return void Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password."));A.isModified()?dialogs.confirmation.open({title:Strings.translateString("Auto Change Password"),text:Strings.translateString("Changes you have made have not been saved. Are you sure you want to continue?"),handler:e}):e()})}(this)};var e=function(A,e,t){dialogs.fieldHistory.open({history:A,vaultItem:e,type:t})};SiteDialog.prototype.preSetup=function(A){var e=null;if(this.siteTypeName=null,LPFeatures.allowOmarIA()){var t=LPProxy.getConfigTypeObject("Password");t&&(this.siteTypeName=t.name,e=A&&A.vaultItem?Strings.translateString("Edit %1",t.name.toLocaleLowerCase()):Strings.translateString("Add %1",t.name.toLocaleLowerCase()))}e||(e=A&&A.vaultItem?Strings.translateString("Edit Site"):Strings.translateString("Add Site")),A?A.title=e:A={title:e}},SiteDialog.prototype.open=function(A){if(A=$.extend(A,{sourceFunction:LPProxy.getSiteModel}),A.saveAllData){var e=A.saveAllData;delete A.saveAllData,A.defaultData={url:e.url,save_all:!0},t(e.formdata,A.defaultData)}else A.defaultData&&A.defaultData.formdata&&(t(A.defaultData.formdata,A.defaultData),delete A.defaultData.formdata);if(A.defaultData&&A.defaultData.url){var a=LPProxy.getDomain(A.defaultData.url),i=bg.get("siteCats");void 0===A.defaultData.group&&i[a]&&(bg.get("g_nofolder_feature_enabled")||(A.defaultData.group=i[a])),void 0===A.defaultData.name&&(A.defaultData.name=a)}if(bg.Policies.getSaveSiteToPersonal()){var o=LPProxy.getLinkedAccount();o&&(A.defaultData={group:o._data.group})}if(A.saveOptions&&A.saveOptions.checkForReplacement){for(var a=LPProxy.getDomain(A.defaultData.url),n=[],s=LPProxy.getSiteModels(),l=0,r=s.length;l<r;++l){var d=s[l];LPProxy.getDomain(d.getURL())===a&&A.defaultData.unencryptedUsername===d.getUsername()&&n.push(d)}if(n.length>0)return void dialogs.vaultItemSelect.open({title:this.siteTypeName?Strings.translateString("Replace %1",this.siteTypeName):Strings.translateString("Replace Site"),nextButtonText:Strings.translateString("Replace"),backButtonText:Strings.Vault.NO,text:Strings.translateString("Would you like to replace an existing entry you have for %1?",a),items:n,closeHandler:this.createHandler(EditableFieldsDialog.prototype.open,A),handler:this.createDynamicHandler(function(e){var t=A.defaultData;delete A.defaultData,EditableFieldsDialog.prototype.open.call(this,$.extend(A,{vaultItem:e[0],postSetup:function(A){A.populateFields(t)}}))}),buildOptions:{multiSelect:!1}})}EditableFieldsDialog.prototype.open.call(this,A)},SiteDialog.prototype.setup=function(A,e){EditableFieldsDialog.prototype.setup.call(this,A,e),this.changePasswordButton.hide(),this.vaultItem?(A.find(".history").show(),"1"===this.vaultItem._data.pwch&&this.changePasswordButton.show(),this.inputFields.url.disableDropdown()):(A.find(".history").hide(),this.inputFields.url.enableDropdown())},SiteDialog.prototype.validate=function(A){var e=EditableFieldsDialog.prototype.validate.apply(this,arguments);return""===A.name&&(this.addError("name","Name is required."),e=!1),e};var t=function(A,e){e.fields=[];for(var t=A.split("\n"),a=0,i=t.length;a<i;++a){var o=t[a].split("\t"),n=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),l=decodeURIComponent(o[2]),r=decodeURIComponent(o[3]);if("action"===r)e.action=l;else if("method"===r)e.method=l;else if(s)switch(r){case"email":case"text":case"url":case"tel":case"password":case"checkbox":case"radio":case"select":case"select-one":var d={formname:n,name:s,type:r,value:l};if("checkbox"===r)d.value="-1"===l.substring(l.length-2),d.valueAttribute=l.substring(0,l.length-2);else if("radio"===r){if("-1"!==l.substring(l.length-2))continue;d.value=l.substring(0,l.length-2)}e.fields.push(d)}}}}();
function initCheckpoint(){return void 0!==Checkpoint&&null!==Checkpoint||(Checkpoint=new checkpoint_lib),void 0!==Checkpoint&&null!==Checkpoint}function doCheckpoint(){return!g_enable_checkpoint||"undefined"==typeof g_isdebug||!g_isdebug||(initCheckpoint(),Checkpoint.assert.apply(this,arguments))}function checkpoint_lib(){function e(e,n){return sprintf("%sproperty '%s' is missing or wrong type",n?"["+n+"] ":"",e)}function n(e,n){return sprintf("%sunexpected value of %s was found",n?"["+n+"] ":"",e)}function r(e,n){return n=LPPerl.chomp(n),d+=n,"undefined"!=typeof console&&console&&(e===c?console.warn(n):e===l?console.error(n):console.log(n)),!0}var t=this,i=0,a=0,s=0,o=0;if("undefined"!=typeof Date){o=(new Date).getTime();var d="",l=2,c=1;this.checkpoint=function(e,n,r){return!0},this.init=function(){i=0,a=0,s=0,o=(new Date).getTime(),d=""},this.reset=function(){t.init()},this.assert=function(){var e=arguments;if("undefined"==typeof g_isdebug||!g_isdebug)return s++,!0;var n=null;return void 0!==e[3]&&"function"==typeof e[3]&&(n=e[3],void 0!==e[4]?n(e[4]):n()),e.length<=0?(a++,n(),!1):void 0!==e[2]&&e[2]?(s++,!0):!0===e[0]?(i++,!0):(a++,void r(l,sprintf("ASSERT FAILED: %s !== true%s",e[0],e[1]?" : "+e[1]:"")))},this.stats=function(){var e;return e=void 0!==new Date(o).toUTCString?new Date(o).toUTCString():parseInt(o/1e3).toString(),r(0,sprintf("Since %s, %d good, %d bad, %d skipped\n",e,i,a,s))},this.getstats=function(){return{good:i,bad:a,skipped:s}},this.validate_share_type=function(r,i){if(!r)return!1;var a=!0;return a=a&&t.assert("string"==typeof r.id,e("id",i)),a=a&&t.assert("string"==typeof r.sharekey,e("sharekey",i)),a=a&&t.assert("string"==typeof r.sharename,e("sharename",i)),a=a&&t.assert(t.in_array(r.readonly,["0","1"]),e("readonly",i)),a=a&&t.assert(t.in_array(r.give,["0","1"]),e("give",i)),a=a&&t.assert("string"==typeof r.sharekeyaes||""===r.sharekeyaes,e("sharekeyaes",i)),a=a&&t.assert(t.in_array(r.associative,[0,"0","1"]),e("associative",i)),void 0!==r.linkedshare&&(a=a&&t.assert(t.in_array(r.linkedshare,["0","1"]),e("linkedshare",i))),a=a&&t.assert("string"==typeof r.key,e("key",i)),a=a&&t.assert("string"==typeof r.decsharename,e("decsharename",i)),a=a&&t.assert(lpdec(r.sharename,r.key)===r.decsharename,n("sharename/decsharename",i)),a=a&&t.assert(AES.hex2bin(lpmdec(r.sharekeyaes,!0))===r.key,n("decrypted sharing key",i))},this.validate_shareinfo_type=function(n,r){if(!n)return!1;var i=!0;return i=i&&t.assert("string"==typeof n.id,e("id",r)),i=i&&t.assert("string"==typeof n.sharekey,e("sharekey",r)),i=i&&t.assert("string"==typeof n.decsharename,e("decsharename",r)),i=i&&t.assert(t.in_array(n.readonly,["0","1"]),e("readonly",r)),i=i&&t.assert(t.in_array(n.give,["0","1"]),e("give",r)),i=i&&t.assert(t.in_array(n.associative,[0,"0","1"]),e("associative",r)),i=i&&t.assert(t.in_array(n.linkedshare,["0","1"]),e("linkedshare",r))},this.in_array=function(e,n){if(void 0===n||null===n)return!1;for(var r=n.length,t=0;t<=r;t++)if(void 0!==n[t]&&n[t]===e)return lpArrayOffset=t,!0;return!1},this.validate_fieldinfo=function(e,n){if(!e)return!1;n||(n={});var r=!0;n.save_all,null!==e.name&&"string"==typeof e.name||(console_warn("FAIL: field.name"),r=!1),null!==e.type&&("string"==typeof e.type||lp_in_array(e.type,["text","password","button","file","hidden","checkbox","radio","textarea","submit","image","select","select-one"])||lp_in_array(e.type,["color","date","datetime","datetime-local","email","month","number","range","search","tel","time","url","week"]))||(console_warn("FAIL: field.type"),r=!1),"radio"==e.type||"checkbox"==e.type?!0!==e.checked&&!1!==e.checked&&(console_warn("FAIL: field.checked for "+e.type),r=!1):!1!==e.checked&&(r=!1),"1"===e.otherlogin?(""===e.url?(console_warn("FAIL: field.url should be set in addruid case"),r=!1):hex2url(e.url).match(/^https?:\/\//,"i")||(console_warn("FAIL: invalid field.url"),r=!1),""!==e.urid&&"0"!==e.urid||(console_warn("FAIL: field.urid should be set in addurid case"),r=!1),!1!==e.otherfield&&(console_warn("FAIL: field.otherfield must be false in addurid case"),r=!1)):("0"!==e.otherlogin&&""!==e.otherlogin&&(console_warn("FAIL: field.otherlogin [deprecated?]"),r=!1),""!==e.url&&(console_warn("FAIL: field.url should be empty in non-addurid case"),r=!1),"0"!==e.urid&&""!==e.urid&&(console_warn("FAIL: field.urid should be empty in non-addurid case"),r=!1)),!0!==e.otherfield&&!1!==e.otherfield&&(console_warn("FAIL: field.otherfield [deprecated?]"),r=!1);for(var t in e)e.hasOwnProperty(t)&&(lp_in_array(t,["name","type","value","formname","checked","urid","otherlogin","url","otherfield"])||(console_warn("found an unexpected property in field info: "+t),r=!1));return r}}}var Checkpoint=new checkpoint_lib;initCheckpoint();
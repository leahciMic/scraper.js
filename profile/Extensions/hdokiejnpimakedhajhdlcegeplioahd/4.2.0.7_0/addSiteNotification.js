LPSiteNotification=function(){var e=!1,t=!1,n=!1,r=function(){var t=!1,n=function(e){for(var t=0;t<e.fields.length;++t)if("password"===e.fields[t].type)return!0;return!1};return function(r){t||(t=!0,setTimeout(function(){t=!1},0),n(r)?(r.generatedPassword||(e=!0),bg.LPTabState.processPasswordSubmit({formData:r,callback:r.generatedPassword||LPContentScriptTools.isUnloading()?null:s})):(r.fields.length>0&&bg.LPTabState.processTextSubmit(r),bg.LPTabState.clear()))}}(),i=function(){var e=function(e){return e.value&&(e.value!==e.getAttribute("value")||e.value.length>1)&&LPContentScriptTools.isVisible(e)},t=function(t){for(var n=t||document.body,r=[],i=n.querySelectorAll('input:not([type]),input[type="text"],input[type="email"],input[type="password"]'),a=0;a<i.length;++a)e(i[a])&&r.push(i[a]);return r},n=function(e){for(var t=[],n={},r={},i=0;i<e.length;++i){var a=e[i];switch(a.type){case"hidden":case"text":case"email":!a.value||"hidden"!==a.type&&LPContentScriptTools.isVisible(a)||(n.hasOwnProperty(a.value)?delete r[a.value]:(r[a.value]=a,n[a.value]=!0))}}var o=LPContentScriptTools.findTextNodes({searches:Object.keys(r),searchAll:!0,exactMatch:!0,allowEmails:!0}),u={};return o.filter(function(e){return!u.hasOwnProperty(e.match)&&(u[e.match]=!0,!0)}).forEach(function(e){e.parent&&"OPTION"!==e.parent.nodeName&&LPContentScriptTools.isVisible(e.parent)&&t.push(r[e.match])}),t},i=function(e){var t={type:e.type,value:e.value,id:e.id,label:LPContentScriptTools.getLabel(e),attributes:LPContentScriptTools.getAttributes(e,["name","ng-model","data-reactid"])};return"password"!==t.type&&"disc"===LPContentScriptTools.getCSS(e,"text-security")&&(t.type="password"),t},a=function(e,t){for(var n=[],r=0;r<e.length;++r){var i=e[r];"password"!==i.inputData.type&&(i.inputData.value=v.getUnmaskedValue({input:i.input,inputValue:i.inputData.value,form:t.form})),i.inputData.formname=t.form&&t.form.getAttribute("name")||"",n.push(i.inputData)}return{url:document.location.href,top:window===top,fields:n,generatedPassword:t.generatedPassword,username:v.getUsername()}};return function(e){var o=t(e.form);e.form&&(o=n(e.form).concat(o));for(var u=[],s=0;s<o.length;++s){var c=o[s],l=i(c);u.push({input:c,inputData:l})}var f=a(u,e);return e.deferred||r(f),f}}(),a=function(){var e=null,t=function(){e=null};return function(n){return function(r){if(e=!1!==r.isTrusted&&!1!==e)try{n(r)}catch(e){console.log(e)}setTimeout(t,0)}}}(),o=function(){var n=function(e,n,i){var a=r(e);return!(!a||!LPContentScriptTools.isVisible(a))&&(i&&!LPContentScriptTools.isClickable(a)?(t=!0,!1):!n.passwordChangeForm||a.val()===e.value)},r=function(e){if(e.id)return document.getElementById(e.id);for(var t in e.attributes){var n=document.querySelector("input["+t+'="'+e.attributes[t]+'"]');if(n)return n}return null},i=function(e,t){for(var r=0;r<e.fields.length;++r){var i=e.fields[r];if("password"===i.type)return n(i,e,t)}return!1},o=function(){var e=function(e,t){var n=r(e);n&&n.addEventListener("input",a(function(){t(!0)}))};return function(t,n){for(var r=0;r<t.fields.length;++r){var i=t.fields[r];"password"===i.type&&e(i,n)}}}();return function(t,n){var r=0,a=null,u=!1,s=function(t){u||(e=!1,u=!0,clearInterval(a),n(t))};e?(a=setInterval(function(){++r;var e=5===r,n=i(t,e);n&&!e||s(n)},1e3),o(t,s)):s(i(t))}}(),u=function(e){if(!n){n=!0,e.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(r)};var t=bg.get("LPContentScriptFeatures");if(t.angularFrontendEnabled)var r=LPFrame.openAngularDialog("save-new",e,{css:{top:0,right:0}});else if(t.bunk2)var r=LPFrame.openDialog("contentScriptSiteBunk2",e,{css:{top:10,right:10}});else var r=LPFrame.openDialog("contentScriptSite",e,{css:{top:10,right:10}});r.onClose(function(){c(),n=!1})}},s=function(e){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(e),bg.get("LPContentScriptFeatures").new_save_site&&e.dialogData&&!t?csTop.LPSiteNotification.showSiteNotification(e):c())},c=function(){bg.PreferencesAsync.get("showFamiliesIsHere",0,function(e){var t=Boolean(Number(e)),n=Boolean(Number(bg.get("g_enterpriseuser"))),r=Boolean(Number(bg.get("g_predates_families")));if(bg.get("LPContentScriptFeatures").families_is_here_enabled&&t&&!n&&r){LPFrame.openDialog("familiesIsHereDialog",{hasOverlay:!0},{css:{top:0,right:0}}).onClose(function(){bg.PreferencesAsync.set("showFamiliesIsHere",0)})}})},l=function(){bg.PreferencesAsync.get("showFamiliesIsHere",null,function(e){null===e&&bg.PreferencesAsync.set("showFamiliesIsHere",1)})},f=function(){var e=function(e){return e=e.toLowerCase(),e.indexOf("submit")>-1||e.indexOf("save")>-1},t=function(t){for(var n=t.attributes,r=0;r<n.length;++r){var i=n[r];if(e(i.name)||e(i.value))return!0}return!1};return function(e){if("INPUT"===e.nodeName)return"submit"===e.type||"button"===e.type&&t(e);for(var n=e;n&&0===n.getElementsByTagName("input").length;){if("BUTTON"===n.nodeName)return"submit"===n.type||t(n);if(t(n))return!0;n=n.parentElement}return!1}}(),p=function(e){switch(e.nodeName){case"TEXTAREA":case"SELECT":return!0;case"INPUT":switch(e.type){case"button":case"submit":return!1;default:return!0}default:return!1}},d=function(){var e=null,t=[],n=function(){e&&(e.disconnect(),e=null),t=[]},r=function(e){for(var t=0;t<e.length;++t){var n=e[t];switch(n.type){case"attributes":if(n.target.getAttribute(n.attributeName)!==n.oldValue)return!0;break;default:return!0}}return!1},i=function(e){r(e)&&(t.forEach(function(e){e()}),n())};return{reset:n,onChange:function(r){"undefined"!=typeof MutationObserver&&(e||(e=new MutationObserver(i),e.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0})),-1===t.indexOf(r)&&t.push(r),setTimeout(function(){n()},0))}}}(),g=function(){var e=[],t=function(){e.forEach(function(e){window.removeEventListener("lprequeststart",e)}),e=[]};return{startTracking:function(t,n){var r=function(e){if(t(e.detail)){window.removeEventListener("lprequeststart",r);var i=function(t){e.detail.requestID===t.detail.requestID&&(window.removeEventListener("lprequestend",i),n(t.detail))};window.addEventListener("lprequestend",i)}};window.addEventListener("lprequeststart",r),e.push(r)},stopTracking:t}}(),v=function(){var t=null,n=!1,o=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(e){u({target:e.element,generatedPassword:e.password})}),Topics.get(Topics.CLEAR_DATA).subscribe(function(e){P()}),Topics.get(Topics.LOGIN).subscribe(function(e){bg.LPTabState.getState(function(e){e.enabled&&L(e)})});var u=function(e){return e.form=LPContentScriptTools.getForm(e.target),i(e)},s=function(){e=!1,bg.LPTabState.clear()},c=function(e){try{return decodeURIComponent(e)}catch(e){}return null},v=function(e){var t=e&&e.formData;t&&t.fields.length>0&&(g.stopTracking(),g.startTracking(function(e){if(e&&e.data)for(var n=c(e.data),r=0;r<t.fields.length;++r){var i=t.fields[r].value;if(n&&n.indexOf(i)>-1||e.data.indexOf(i)>-1)return!0}return!1},e.responseHandler))},m=function(){var e=/^2[0-9][0-9]$/;return function(t){return e.test(t)}}(),b=function(e){v({formData:e,responseHandler:function(e){m(e.statusCode)||s()}})},h=function(e){var t=u({target:e,deferred:!0});v({formData:t,responseHandler:function(e){m(e.statusCode)&&r(t)}})},T={submit:a(function(e){l(),d.reset(),b(i({form:LPContentScriptTools.getForm(e.target),type:e.type}))}),lpsubmit:function(e){d.reset(),i({form:e.target,type:"submit"})},mouseup:a(function(t){var n=t.target;f(n)?(d.reset(),b(u({target:n,type:t.type}))):p(n)||(e&&d.onChange(s),h(n))}),keydown:a(function(t){if(13===(t.keyCode||t.which)){var n=t.target;p(n)||f(n)?(d.reset(),b(u({target:n,type:t.type}))):(e&&d.onChange(s),h(n))}}),change:a(function(e){var t=e.target;if("INPUT"===t.nodeName&&t.value)switch(t.type){case"text":case"email":for(var n=0;n<o.length;++n)if(o[n].input===t)return void(o[n].value=t.value);o.push({input:t,value:t.value})}}),paste:a(function(e){var t=e.target;p(e.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(e){t.value===e&&u({target:t,generatedPassword:e})})})},w=function(e){t=e},S=function(){if(t.usernames&&t.usernames.length>0)return LPContentScriptTools.findText({searches:t.usernames,wordMatch:!0})},L=function(e){if(w(e),!n){for(var t in T)document.addEventListener(t,T[t],!0);n=!0}},P=function(){if(n){for(var e in T)document.removeEventListener(e,T[e],!0);n=!1}o=[]},y=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1},C=function(e,t){return e.value&&!y(e.value)&&e.value.length===t.length&&(e.value[0]===t[0]||e.value[e.value.length-1]===t[t.length-1])},E=function(e){if(y(e.inputValue)){var t;for(t=0;t<o.length;++t){var n=o[t];if(n.input===e.input&&n.value!==e.inputValue)return n.value}if(e.form)for(t=0;t<e.form.length;++t){var r=e.form[t];if(C(r,e.inputValue))return r.value}}return e.inputValue};return function(){var e=document.documentElement;if(e&&"HTML"===e.nodeName)if(g_ischrome){var t=document.createElement("script");t.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents)),e.appendChild(t),e.removeChild(t)}else Topics.get(Topics.INITIALIZED).subscribe(function(){var t=bg.get("extensionBaseURL");if(t){var n=document.createElement("script");n.src=t+"pageWebRequestEvents.js",e.appendChild(n),e.removeChild(n)}})}(),{setup:L,teardown:P,getUnmaskedValue:E,getUsername:S}}(),m=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:s})},1e3,!0);return Topics.get(Topics.INITIALIZED).subscribe(function(){bg.LPTabState.getState(function(e){e.enabled&&(v.setup(e),window===top?m():e.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())})}),window!==top&&window.addEventListener("beforeunload",function(){e&&csTop.LPSiteNotification.getSiteNotification()},!0),{formExists:o,showSiteNotification:u,getSiteNotification:m}}();
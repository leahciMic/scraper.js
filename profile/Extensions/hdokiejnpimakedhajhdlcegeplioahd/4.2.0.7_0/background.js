function lpobjrejectedaddsite(){}function migrate_from_old_firefox(){if(g_isfirefoxsdk&&!localStorage_getItem("migrated_from_old_firefox")){for(var e={},t={offerGeneratePasswd:"showGenerateNotifications",showChangePasswordNotifications:"showChangeNotificationBar",showFillNotifications:"showFillNotificationBar",showHomepageAfterLogin:"showvault",StoreLostPWOTP:"storeLostOTP",genpw_showadv:"generate_advanced",genpw_passlen:"generate_length",genpw_upper:"generate_upper",genpw_lower:"generate_lower",genpw_digits:"generate_digits",genpw_special:"generate_special",genpw_mindigits:"generate_mindigits",genpw_ambig:"generate_ambig",genpw_reqevery:"generate_reqevery",genpw_pronounceable:"generate_pronounceable"},a=g_preferences_service.keys("extensions.lastpass"),n="REPLACE INTO LastPassPreferences (username_hash, prefname, prefvalue) VALUES ",o="",r=[],i=0,s="",l="",_={},c={},g={},d={},p={},u={},f={},m={},h={},b={},v={},y={},w=!1,k=-1,x=0;x<a.length;x++){var P=a[x].split(".");if(P.length>=3){var S,C,L=g_preferences_service.get(a[x]);if(P.length>=4?(S=P[2],e[S]=1,C=P[3]):(S="",C=P[2]),""==S){if("loginusers"==C){s=L;continue}if("loginpws"==C){l=L;continue}}if("pageOpenSameTab"==C){_[S]=L;continue}if("pageOpenTab"==C){c[S]=L;continue}if("idleLogoff"==C){g[S]=L;continue}if("idleLogoffVal"==C){d[S]=L;continue}if("autoauto"==C){p[S]=L;continue}if("autoautoVal"==C){u[S]=L;continue}if("pollServer"==C){f[S]=L;continue}if("pollServerVal"==C){m[S]=L;continue}if("clearClipboard"==C){h[S]=L;continue}if("clearClipboardSecsVal"==C){b[S]=L;continue}if("recentUsed"==C){v[S]=L;continue}if("recentUsedCount"==C){y[S]=L;continue}if("logOffWhenCloseBrowser"==C){L&&(w=!0);continue}if("logOffWhenCloseBrowserVal"==C){(-1==k||L<k)&&(k=L);continue}void 0!==t[C]&&(C=t[C]),"lastpollcheck"==C&&(L*=1e3),n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push(C),r.push(L),i++}}for(var S in _)_[S]?(n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("openpref"),r.push("same"),i++):void 0!==c[S]&&(n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("openpref"),r.push(c[S]?"tabs":"windows"),i++);for(var S in g)n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("idleLogoffVal"),r.push(g[S]&&void 0!==d[S]?d[S]:0),i++;for(var S in p)n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("autoautoVal"),r.push(p[S]&&void 0!==u[S]?u[S]:0),i++;for(var S in f)n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("pollServerVal"),r.push(f[S]&&void 0!==m[S]?m[S]:0),i++;for(var S in h)n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("clearClipboardSecsVal"),r.push(h[S]&&void 0!==b[S]?b[S]:0),i++;for(var S in v)n+=o+"(?, ?, ?)",o=", ",r.push(S),r.push("recentUsedCount"),r.push(v[S]&&void 0!==y[S]?y[S]:0),i++;if(w&&(n+=o+"(?, ?, ?)",o=", ",r.push(""),r.push("logoffWhenCloseBrowser"),r.push(!0),i++,n+=o+"(?, ?, ?)",o=", ",r.push(""),r.push("logoffWhenCloseBrowserVal"),r.push(k),i++),i>0){var I=opendb();if(createPrefsTable(I),I)if(g_indexeddb)for(var O=I.transaction("LastPassPreferences","readwrite").objectStore("LastPassPreferences"),x=0;x<r.length;x+=3)O.put({username_hash:r[x],prefname:r[x+1],prefvalue:r[x+2],userkey:r[x]+"_"+r[x+1]});else I.transaction(function(e){e.executeSql(n,r,function(e,t){},function(e,t){console_log(t)})})}""!=s&&unprotect_data(l,!1,function(t){var a={};if(""!=t){t=t.split("|");for(var n=0;n<t.length;n++){var o=t[n].split("=");if(2==o.length){var r=decodeURIComponent(o[0]);a[r]=lpdec(decodeURIComponent(o[1]),AES.hex2bin(SHA256(r)))}}}var i="REPLACE INTO LastPassSavedLogins2 (username, password, last_login, protected) VALUES ",l="",_=[],c=0;s=s.split("|");for(var n=0;n<s.length;n++){var r=decodeURIComponent(s[n]);e[SHA256(r)]=1;var g=void 0!==a[r]?a[r]:"",d="";protect_data(g,!1,r,function(e){d=e});var p=d!=g?1:0;p||""==g||(d=lpenc(d,AES.hex2bin(SHA256(r))),p=2),i+=l+"(?, ?, ?, ?)",l=", ",_.push(r),_.push(d),_.push(0==n?(new Date).getTime():0),_.push(p),c++}if(c>0){var u=opendb();if(createSavedLoginsTable(u),u)if(g_indexeddb)for(var f=u.transaction("LastPassSavedLogins2","readwrite").objectStore("LastPassSavedLogins2"),n=0;n<_.length;n+=4)f.put({username:_[n],password:_[n+1],last_login:_[n+2],protected:_[n+3]});else u.transaction(function(e){e.executeSql(i,_,function(e,t){},function(e,t){console_log(t)})})}}),n="REPLACE INTO LastPassData (username_hash, type, data) VALUES ",o="",r=[],i=0;for(var A in e){var N="";call_binary_function("read_file",A+"_lpall.slps",function(e){""!=e&&unprotect_data(e,!0,function(e){N=e})}),""!=N&&(n+=o+"(?, ?, ?)",o=", ",r.push(A),r.push("key"),r.push(N),i++)}if(i>0){var I=opendb();if(createDataTable(I),I)if(g_indexeddb)for(var O=I.transaction("LastPassData","readwrite").objectStore("LastPassData"),x=0;x<r.length;x+=3)O.put({username_hash:r[x],type:r[x+1],data:r[x+2],usertype:r[x]+"_"+r[x+1]});else I.transaction(function(e){e.executeSql(n,r,function(e,t){},function(e,t){console_log(t)})})}localStorage_setItem("migrated_from_old_firefox",1)}}function setup_wlan_variables(){(g_is_win||g_is_mac)&&have_binary_function("wlan_works")?call_binary_function("wlan_works",function(e){g_wlan_works=e}):g_wlan_works=!1,g_is_win&&have_binary_function("wlan_has_exe")?call_binary_function("wlan_has_exe",function(e){g_wlan_has_exe=e}):g_wlan_has_exe=!0}function navigate_handler(e){if(e.target instanceof SafariBrowserTab){var t=e.target,a=gettabid(t);if(t.url&&g_badgedata&&g_badgedata.type&&"alert"==g_badgedata.type&&g_badgedata.tabid&&g_badgedata.tabid==a){var n=t.url;compare_tlds(lp_gettld_url(n),g_badgedata.tld)||(g_badgedata=null,drawIconAtRotation(0))}}}function command_handler(e){"LPToolButtonClick"==e.command?buttonclick():"LPContextMenuClick"==e.command&&cm_handler()}function buttonclick(){if(lploggedin||!shouldOpenLogin4_0()&&g_badgedata&&"notification"==g_badgedata.cmd&&("error"==g_badgedata.type||"mpwchange"==g_badgedata.type)){if(g_isfirefoxsdk)return void showFirefoxPanel();try{if("undefined"!=typeof SafariExtensionPopover)return void openpopover(0)}catch(e){g_can_open_popover=!1}update_menus(),toggle_menu()}else open_login()}function openpopover(e){for(var t=safari.application.activeBrowserWindow,a=0;a<safari.extension.toolbarItems.length;a++){var n=safari.extension.toolbarItems[a];if(t==n.browserWindow&&-1!=n.identifier.indexOf("LPToolButton"))if(shouldOpenDropdown4_0())LPPlatform.openDropdownPopover();else{if(!g_badgedata||"notification"!=g_badgedata.cmd||"alert"!=g_badgedata.type&&"lpalert"!=g_badgedata.type&&"error"!=g_badgedata.type&&"mpwchange"!=g_badgedata.type){n.popover=LPPlatform.getPopover("LPPopoverMenu"),n.popover.width=400,n.popover.height=497;var o=3==e?"&generate=1":"";n.popover.contentWindow.showwin(n.popover.width,n.popover.height,getchromeurl("lp_toolstrip.html?browseraction=1"+o))}else n.popover=LPPlatform.getPopover("LPPopoverMenu"),"lpalert"==g_badgedata.type?n.popover.width=500:"mpwchange"==g_badgedata.type?n.popover.width=568:n.popover.width=360,"mpwchange"==g_badgedata.type?n.popover.height=716:n.popover.height=348,n.popover.contentWindow.menuload(0),"mpwchange"==g_badgedata.type?n.popover.contentWindow.showwin(568,716,getchromeurl("mpwchange.html?domain="+encodeURIComponent(g_notification_data.domain)+"&requirechangereuse="+(requirechangereuse()?"1":"0"))):n.popover.contentWindow.showwin(460,248,getchromeurl("lp_toolstrip.html?browseraction=1&alert=1")),setTimeout(function(){var e=getBG();e.g_badgedata=null,e.drawIconAtRotation()},500);n.showPopover(),g_popoverstartpage=e}}}function gettabid(e){if(g_ischrome||g_ismaxthon||g_isfirefoxsdk||g_iscasper)try{return e?e.id:-1}catch(e){return-1}else{if(g_issafari)return void 0===e.myData&&(e.myData=g_nexttabid++,g_CS_tabs[e.myData]=e),e.myData;if(g_isopera){for(var t in g_CS_tabs)if(gettaburl(g_CS_tabs[t])==gettaburl(e))return t;var a=g_nexttabid++;return g_CS_tabs[a]=e,a}}}function get_all_windows(e,t){g_ischrome?chrome.windows.getAll(e,t):g_issafari?t(safari.application.browserWindows):g_isopera?t(opera.extension.windows.getAll()):g_ismaxthon?t([window.external.mxGetRuntime().create("mx.browser")]):g_isfirefoxsdk&&t(g_windows.browserWindows)}function get_tabs(e){try{if(g_isopera&&void 0===e.tabs.length)return e.tabs.getAll();if(g_ismaxthon){for(var t=new Array,a=0;a<e.tabs.length;a++)t.push(e.tabs.getTab(a));return t}return e.tabs}catch(e){return new Array}}function get_tabs_length(e){try{return get_tabs(e).length}catch(e){return 0}}function close_tab(e){get_all_windows({populate:!0},function(t){var a=!1;if(1==t.length&&1==get_tabs_length(t[0])&&gettabid(get_tabs(t[0])[0])==gettabid(e)&&(openURL(g_isopera?"about:blank":"about:newtab"),a=!0),g_ischrome)try{chrome.tabs.remove(gettabid(e))}catch(e){console_error(e)}else(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&(a?setTimeout(function(){e.close()},0):e.close())})}function cleanup_tabs(){if(g_issafari)for(var e in g_CS){delete_cs_for_tab(e);for(var t in g_CS[e]){void 0!==g_CS[e][t].browserWindow&&g_CS[e][t].browserWindow||(delete g_CS[e],void 0!==g_CS_tabs[e]&&delete g_CS_tabs[e]);break}}}function message_handler(e){g_isopera?(e.message=e.data,e.name=e.data.messagetype):(g_ismaxthon||g_isfirefoxsdk)&&(e.message=JSON.parse(JSON.stringify(e)),e.name=e.messagetype);var t=!1;if(void 0!==e.message.g_user_prefs_to_write){t=!0;var a=LPJSON.parse(e.message.g_user_prefs_to_write);for(var n in a)lpPutUserPref(n,a[n])}if(void 0!==e.message.g_global_prefs_to_write){t=!0;var o=LPJSON.parse(e.message.g_global_prefs_to_write);for(var n in o)lpPutGblPref(n,o[n])}switch(t&&lpWriteAllPrefs(),e.name){case"writeAllPrefs":break;case"toggleVault4_0":closecurrenttab(e.message.page),VaultToggle.toggleVault4_0();break;case"closepop":closePop();break;case"connect":connect_eventHandler(e);break;case"focus":var r=lp_gettld_url(gettaburl(e.message));compare_tlds(r,g_currenttld)||(update_menus(),g_currenttld=r);break;case"message":receiveCS(gettabidfromevent(e),e.message,0,{tab:geteventtarget(e)});break;case"processCS":var i=LPJSON.parse(e.message.data);i.callback=function(t){event_dispatch_message(e,"website_event_callback",{data:LPJSON.stringify(t)})},processCS(null,i,null);break;case"disablepasswordmanager":disablepasswordmanager(e.message.disable);break;case"LP_do_login":g_manual_login=e.message.manual_login,LP_do_login(e.message.u,e.message.p,e.message.rememberemail,e.message.rememberpassword,e.message.donotclearmultifactor,e.message.showvault,e.message.lpkey,e.message.lphash);break;case"openURL":if(void 0!==e.message.g_site_data){g_site_data=LPJSON.parse(e.message.g_site_data);var s=get_record(get_record_id(g_site_data));s&&(g_site_data.fields=s.fields)}openURL(e.message.url);break;case"start_trial":start_trial();break;case"install_binary":install_binary();break;case"reprompt_callback":g_isfirefoxsdk&&closecurrenttab("login.html"),setTimeout(function(){set_last_reprompt_time(),g_reprompt_callback_save()},0);break;case"reprompt_error_callback":g_reprompt_error_callback_save();break;case"omnikey_callback":g_omnikey_callback_save(e.message.pin);break;case"update_prefs":"prefs"==e.message.page?(lpGetPref("storeLostOTP")||DeleteOTP(),lpdbg("idle","updating prefs, idleLogoffVal is "+lpGetPref("idleLogoffVal")),(lpGetPref("logoffWhenCloseBrowser")||lpGetPref("idleLogoffVal")>0)&&0==lpGetPref("rememberpassword")&&deletesavedpw(g_username),start_idle_checker(),setprefs("all","all"),setup_hotkeys(),g_isfirefoxsdk&&1==lpGetPref("disablecrpw")&&g_preferences_service.set("signon.rememberSignons",!1),drawIconAtRotation(0)):"generate"==e.message.page&&(g_genpws=e.message.g_genpws);break;case"setup_hotkeys":setup_hotkeys();break;case"copytoclipboard":copytoclipboard(e.message.g_data);break;case"update_prompts":g_prompts=JSON.parse(e.message.g_prompts);break;case"openall":openall(e.message.group);break;case"openAllSites":openAllSites(e.message.sites);break;case"deleteGroup":deleteGroup(e.message.group,null,function(){event_dispatch_message(e,"delete_group_callback",{})});break;case"copyusername":var l=void 0!==e.message.fromiframe&&e.message.fromiframe?1:0,_=gettabidfromevent(e);copyusername(e.message.aid,l,_);break;case"copypassword":var l=void 0!==e.message.fromiframe&&e.message.fromiframe?1:0,_=gettabidfromevent(e);copypassword(e.message.aid,null,l,_);break;case"copyurl":var l=void 0!==e.message.fromiframe&&e.message.fromiframe?1:0,_=gettabidfromevent(e);copyurl(e.message.aid,l,_);break;case"copynote":copynote(e.message.aid);break;case"deleteAid":g_isfirefoxsdk&&g_firefox_button.state("window",{checked:!1}),deleteAid(e.message.aid,null,!1,!1,function(){event_dispatch_message(e,"delete_aid_callback",{})});break;case"editAid":editAid(e.message.aid,null,null,e.message.openchpw);break;case"unlock_plug2web":unlock_plug2web();break;case"gotourl":gotourl(e.message.aid);break;case"launch":var c=e.message.aid,g=e.message.skip_pwprotect;setTimeout(function(){launch(c,g)},0);break;case"open_login":open_login(e.message.forcetab);break;case"addprofile":addprofile(null,e.message.source);break;case"update_create_account_data":g_create_account_data=LPJSON.parse(e.message.create_account_data);break;case"addcreditcard":addcreditcard(null,e.message.source);break;case"editprofile":editprofile(e.message.ffid,null,e.message.source);break;case"openprefs":openprefs(e.message.tab);break;case"openbaseurl":openbaseurl(e.message.suffix);break;case"changemasterpassword":changemasterpassword();break;case"addDomainToMPWNever":addDomainToMPWNever();break;case"MPWNoNag":MPWNoNag();break;case"openaddsecurenote":openaddsecurenote();break;case"openeditsecurenote":openeditsecurenote();break;case"loggedOut":loggedOut(e.message.skiprequest,e.message.from);break;case"switch_identity":switch_identity(e.message.iid,e.message.skip_reprompt);break;case"renameGroup":renameGroup(e.message.origgrp,e.message.newgrp);break;case"addEmptyGroup":addEmptyGroup(e.message.newgrp);break;case"moveSelectedToGroup":moveSelectedToGroup(e.message.group,e.message.aids);break;case"security_prompt":security_prompt(function(){event_dispatch_message(e,"security_prompt_callback",{})});break;case"savePassword":var _,d,p;_=null==e.message.tabid?gettabidfromevent(e):e.message.tabid,p=null!=e.message.saveOptions?e.message.saveOptions:{},d=null!=e.message.nofill&&e.message.nofill,savePassword(e.message.pass,e.message.url,_,d,p);break;case"checkgeneratepassword":g_checkgeneratepasswordcallback=function(){event_dispatch_message(e,"generatepasswordfound",{})},sendCS(e.message.tabid,{cmd:"checkgeneratepassword"});break;case"fillform":fillform(e.message.ffid,!1,e.message.origtabid,e.message.ccffid);break;case"changePassword":changePassword(e.message.password,e.message.aids);break;case"receiveTS":receiveTS(null,e.message);break;case"deleteformfill":deleteformfill(e.message.ffid,null,e.message.fromiframe,gettabidfromevent(e),null,null,e.message.source);break;case"addeditformfill":addeditformfill(LPJSON.parse(e.message.ffdata),LPJSON.parse(e.message.site),e.message.source);break;case"fix_tlds":fix_tlds(e.message.oldtld,e.message.newtld,e.message.aid);break;case"moveIntoSharedFolder":moveIntoSharedFolder(LPJSON.parse(e.message.shareinfo),LPJSON.parse(e.message.shareinfoorig),LPJSON.parse(e.message.aidsThatChangedGroups),LPJSON.parse(e.message.aidsnewgrps),e.message.copy,e.message.onlycheck,e.message.skipcheck);break;case"increment_local_accts_version":increment_local_accts_version();break;case"rewritelocalfile":rewritelocalfile();break;case"saveSite":saveSite(e.message.postdata,e.message.acct);break;case"showImageAttach":showImageAttach(e.message.data);break;case"openAttach":openAttach(e.message.id,e.message.attachid,e.message.filename);break;case"exportAttachment":exportAttachment(e.message.id,e.message.attachid,e.message.filename);break;case"openLinkedSites":openLinkedSites(e.message.password,e.message.tld,e.message.excludeid);break;case"generate":opengenpw();break;case"ping_ack":case"basicauthmoreinfobtn":case"basicauthneverbtn":case"changepw":case"chooseprofilecc":case"createaccountbtn":case"custombtn":case"disablebtn":case"feedbackbtn":case"starttrialbtn":case"fillformffid":case"popupfillresize":case"recheckpagecontext":case"savesiteicon":case"savethesite":case"startsaveall":case"tryagainbtn":var _=gettabidfromevent(e);processCS(_,e.message);break;case"saveAllSite":saveAllSite(e.message.postdata,fix_fields(LPJSON.parse(e.message.acct)));break;case"saveSiteFromSubmit":saveSiteFromSubmit(e.message.postdata,fix_fields(LPJSON.parse(e.message.acct)));break;case"saveFields":saveFields(e.message.getdata,e.message.postdata,fix_fields(LPJSON.parse(e.message.aData)));break;case"set_editfieldsopener":set_editfieldsopener(geteventtarget(e));break;case"close_editfieldsopener":close_editfieldsopener();break;case"unprotect_data":unprotect_data(e.message.data,e.message.windowsonly,function(t){event_dispatch_message(e,"unprotect_data_callback",{protected_data:e.message.data,unprotected_data:t})});break;case"change_master_password":event_dispatch_message(e,"change_master_password_callback",{newdata:change_master_password(e.message.newusername,e.message.newpassword,e.message.toserver)});break;case"make_lp_key_hash_iterations":make_lp_key_hash_iterations(e.message.u,e.message.p,get_key_iterations(e.message.u),function(t,a){event_dispatch_message(e,"make_lp_key_hash_iterations_callback",{lpkey:t,lphash:a})});break;case"lpvt_store_data_and_setsinglefactortype":lpvt_store_data_and_setsinglefactortype(e.message.data);break;case"delete_file":delete_file(e.message.f);break;case"lpevent":lpevent(e.message.w);break;case"applyattacharraychanges":var u=LPJSON.parse(e.message.changes);applyattacharraychanges(u);break;case"update_site":var f=fix_fields(LPJSON.parse(e.message.site));is_application(f)?g_applications[f.appaid]=f:f.sn?g_securenotes[f.aid]=f:g_sites[f.aid]=f;break;case"fastDecryptAttachment":fastDecryptAttachment(e.message.id,e.message.mimetype,e.message.data,e.message.attachkey,e.message.key,function(t){event_dispatch_message(e,"fast_decryptatt_callback",{result:t,id:e.message.id,mimetype:e.message.mimetype})});break;case"fastEncryptAttachments":fastEncryptAttachments(e.message.akey,LPJSON.parse(e.message.attachments),function(t){event_dispatch_message(e,"fast_encryptatt_callback",{data:LPJSON.stringify(t)})});break;case"get_saved_logins":get_saved_logins(function(t){event_dispatch_message(e,"get_saved_logins_callback",{rows:t})});break;case"delete_saved_login":delete_saved_login(e.message.username);break;case"update_fields":g_sites[e.message.aid].fields=LPJSON.parse(e.message.fields),g_sites[e.message.aid]=fix_fields(g_sites[e.message.aid]);break;case"select_selectedtabid":select_selectedtabid();break;case"closecurrenttab":closecurrenttab(e.message.page);break;case"add_identity":add_identity();break;case"checkforupdates":checkforupdates();break;case"clearforms":clearforms(e.message.source);break;case"clearrecent":clearrecent();break;case"openabout":openabout();break;case"openaddsite":openaddsite();break;case"openeditsite":openeditsite();break;case"openchooseprofilecc":openchooseprofilecc();break;case"openexport":openexport();break;case"openfavorites":openfavorites();break;case"openfeedback":openfeedback();break;case"opengenpw":opengenpw();break;case"openhelp":openhelp(e.message.topic);break;case"openimport":openimport();break;case"doimport":doimport(e.message.source,e.message.filename);break;case"openimportchrome":openimportchrome();break;case"openlastpassexport":openlastpassexport();break;case"wlanexport":wlanexport();break;case"formfillexport":formfillexport();break;case"openpremium":openpremium();break;case"openentconsole":openentconsole();break;case"openfamilyconsole":openFamilyConsole();break;case"opensearch":opensearch();break;case"openseccheck":openseccheck();break;case"opensessions":opensessions();break;case"openmyaccount":openmyaccount();break;case"openvault":openvault();break;case"recheckpage":recheckpage();break;case"refreshsites":refreshsites();break;case"saveall":saveall();break;case"upgradetoserver":upgradetoserver();break;case"clearCache":clearCache(e.message.noprompt);break;case"loglogin":loglogin(e.message.aid);break;case"deleteNever":deleteNever(LPJSON.parse(e.message.n));break;case"fillaid":fillaid(e.message.aid);break;case"openprint":openprint(e.message.notes);break;case"getnotificationdata":var _=gettabidfromevent(e);if(void 0!==g_datacache[_]){var m={cmd:"gotnotificationdata",html:g_datacache[_].html,extra:g_datacache[_].extra};g_isfirefoxsdk?e.target.port.emit("message",m):sendCS(_,m,"all")}break;case"getcpwmsg":var _=gettabidfromevent(e);if(CPWbot_bg){var m={cmd:"gotcpwmsg",msg:CPWbot_bg.get_last_overlay_message(),minimize_state:cpwbot_get_minimize_dialog_state()};g_isfirefoxsdk?e.target.port.emit("message",m):sendCS(_,m,"all")}break;case"disabletotp":disabletotp(e.message.tld);break;case"enabletotp":enabletotp(e.message.tld,gettabidfromevent(e),null,e.target.port);break;case"invitetotp":invitetotp(e.message.email,e.message.phone);break;case"closepopupfills":case"hidecontext":case"hideoverlay":case"hidetotp":case"slidedownoverlay":case"slideupoverlay":var _=gettabidfromevent(e);sendCS(_,{cmd:e.name},"all"),"hideoverlay"==e.name?(g_persistent_notifications[_]=null,clear_badge()):"hidetotp"==e.name&&(g_ask_totp[_]=null);break;case"popupfillscreateack":var _=gettabidfromevent(e);do_popupfillscreateack(_);break;case"autofillaid":case"autologinaid":var _=gettabidfromevent(e);e.message.topurl=geteventtargeturl(e),handleFill(_,e.message);break;case"fillcurrentaid":fillcurrent(e.message.aid);break;case"never":case"neverautofill":case"neverpage":case"neverdomain":var _=gettabidfromevent(e),h=e.message.url;handleNever(_,e.message),void 0!==e.message.fromsave&&(g_persistent_notifications[_]=null,clear_badge()),do_experimental_popupfill&&(hasNeverAutologin(h,lp_gettld_url(h))||hasNeverFormFill(h,lp_gettld_url(h))||hasNeverGenerate(h,lp_gettld_url(h))||hasNeverShowIcon(h,lp_gettld_url(h))||hasNeverSave(h,lp_gettld_url(h)))&&(handleGetNevers(_,h),closeclickables(_),recheckpage(!0));break;case"getdata":getdata_eventHandler(e);break;case"save_opened":sendCS(gettabidfromevent(e),{cmd:"save_opened"},"all");break;case"getpopupfilldata":var _=gettabidfromevent(e),b=do_getpopupfilldata(_);g_isfirefoxsdk?e.target.port.emit("message",b):sendCS(_,b,"all");break;case"popupfillinputget":var _=gettabidfromevent(e),b=do_popupfillinputget(_);b&&(g_isfirefoxsdk?e.target.port.emit("message",b):sendCS(_,b,"all"));break;case"popupfillgetgenerateprefs":var _=gettabidfromevent(e),b=do_popupfillgetgenerateprefs(_,e.message);b.cmd="gotpopupfillgenerateprefs",g_isfirefoxsdk?e.target.port.emit("message",b):sendCS(_,b,"all");break;case"popupfillsetgenerateprefs":var _=gettabidfromevent(e);do_popupfillsetgenerateprefs(_,e.message);break;case"deleteaid":var l=void 0!==e.message.fromiframe&&e.message.fromiframe?1:0,_=gettabidfromevent(e);do_experimental_popupfill&&deleteAid(e.message.aid,null,!1,!0,function(){recheckpage(!0)},null,l,_);break;case"editaid":editAid(e.message.aid);break;case"openchooseprofilecc":openchooseprofilecc();break;case"dosaveiframe":var _=gettabidfromevent(e),b=savesite_from_iframe(e.message,_);break;case"popupfillsaveget":if(do_experimental_popupfill){var b=g_popupfill_save_data;if(b.formdata2){var v=new Array;for(var c in g_sites)if(check_ident_aid(c)){var y=g_sites[c].group;""==y||lp_in_array(y,v)||(v[v.length]=y)}v.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}),b.groups=v,void 0!==e.message.url&&(b.group=get_default_group(e.message.url))}else void 0!==b.close||g_prompts.view_pw_prompt&&(b.prompting=!0);var _=gettabidfromevent(e);b.cmd="gotpopupfillsave",g_isfirefoxsdk?e.target.port.emit("message",b):sendCS(_,b,"all")}break;case"dologinaction":lploggedin||open_login();break;case"dopwchallenge":var _=gettabidfromevent(e);security_prompt(function(){var t={cmd:"didpwchallenge",result:1};g_isfirefoxsdk?e.target.port.emit("message",t):sendCS(_,t,"all")},function(){var t={cmd:"didpwchallenge",result:1};g_isfirefoxsdk?e.target.port.emit("message",t):sendCS(_,t,"all")},!1);break;case"set_share_folder_id":set_share_folder_id(e.message.id);break;case"set_share_folder_group":set_share_folder_group(e.message.group);break;case"disablesitealert":disablesitealert(e.message.aid);break;case"disableallalerts":disableallalerts();break;case"lpdbg":lpdbg(e.message.type,e.message.string);break;case"cpwbot_finish_ack":if(g_cpwbot&&CPWbot_bg){var _=gettabidfromevent(e);CPWbot_bg.cpwbot_finish_ack_handler(_,e.message)}break;case"cpwbot_validate_state_result":if(g_cpwbot&&CPWbot_bg){var _=gettabidfromevent(e),m=e.message;CPWbot_bg.cpwbot_validate_state_result_handler(_,m)}break;case"dopwchange":var w=(gettabidfromevent(e),geteventtarget(e)),g=!1;dopwchange(e.message.aid,g,w);break;case"cpwbot_get_user_debug_messages":if(g_cpwbot&&CPWbot_bg){var _=gettabidfromevent(e),k=cpwbot_get_user_debug_messages(),x=LPJSON.stringify(k);event_dispatch_message(e,"cpwbot_got_user_debug_messages",{value:x})}break;case"cpwbot_getpwchangestate":var _=gettabidfromevent(e),k=cpwbot_getpwchangestate(),x=LPJSON.stringify(k);event_dispatch_message(e,"cpwbot_gotpwchangestate",{value:x});break;case"cpwbot_get_dialog_msg":if(g_cpwbot&&CPWbot_bg){var _=gettabidfromevent(e),k=cpwbot_get_dialog_msg(),x=LPJSON.stringify(k);event_dispatch_message(e,"cpwbot_got_dialog_msg",{value:x})}break;case"cpwbot_preinit":g_cpwbot&&CPWbot_bg&&cpwbot_preinit();break;case"cpwbot_halt":g_cpwbot&&CPWbot_bg&&cpwbot_halt();break;case"close_cpw_tabs":if(g_cpwbot&&CPWbot_bg){var P=geteventtarget(e);cpwbot_close_cpw_tab_handler(P)}break;case"send_sms_passcodes":send_sms_passcodes(e.message.postdata);break;case"create_account":create_account(e.message.postdata,function(t){event_dispatch_message(e,"create_account_success_callback",{req:{readyState:t.readyState,status:t.status,responseText:t.responseText}})},function(){event_dispatch_message(e,"create_account_failure_callback",{})});break;case"enable_credit_monitoring":enable_credit_monitoring(e.message.postdata,function(t){event_dispatch_message(e,"enable_credit_monitoring_success_callback",{req:{readyState:t.readyState,status:t.status,responseText:t.responseText}})},function(){event_dispatch_message(e,"enable_credit_monitoring_failure_callback",{})});break;case"clear_badge":clear_badge();break;case"resize_panel":g_firefox_panel.resize(e.message.width,e.message.height);break;case"resize_login_panel":g_firefox_login_panel&&g_firefox_login_panel.resize(e.message.width,e.message.height);break;case"resize_html_panel":g_firefox_html_panel&&g_firefox_html_panel.resize(e.message.width,e.message.height);break;case"resize_html_dialog":g_firefox_html_dialog&&(g_firefox_html_dialog.resizeTo(e.message.width,e.message.height),g_firefox_html_dialog.moveTo(g_firefox_html_dialog.screen.left+(g_firefox_html_dialog.screen.width-e.message.width)/2,g_firefox_html_dialog.screen.top+(g_firefox_html_dialog.screen.height-e.message.height)/2));break;case"deletesavedpw":deletesavedpw(e.message.username);break;case"sr_add_secret":SecureReprompter.add_secret(e.message.aid,e.message.acct,e.message.t,e.message.hash);break;case"minimize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1);break;case"maximize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0);break;case"addAttach":addAttach(function(){event_dispatch_message(e,"addattachcb",{attachname:g_attachname,attachbytes:g_attachbytes}),g_attachname=g_attachbytes=""});break;case"onload_done":g_firefox_preload_menu&&g_firefox_button_clicked&&(g_firefox_panel.show({position:g_firefox_button}),g_firefox_button_clicked=!1),void 0!==e.message.need_data&&e.message.need_data&&setTimeout(function(){var t=new Object,a=new Array;for(var n in g_sites)check_ident_aid(g_sites[n].aid)&&(a[n]=g_sites[n]);t.g_sites=LPJSON.stringify(a);var o=new Array;for(var n in g_securenotes)check_ident_aid(g_securenotes[n].aid)&&(o[n]=g_securenotes[n]);t.g_securenotes=LPJSON.stringify(o);var r=new Array;for(var n in g_applications)check_ident_appaid(g_applications[n].appaid)&&(r[n]=g_applications[n]);t.g_applications=LPJSON.stringify(r);for(var i=new Array,n=0;n<g_formfills.length;n++)check_ident_ffid(g_formfills[n].ffid)&&(i[i.length]=g_formfills[n]);t.g_formfills=LPJSON.stringify(i),event_dispatch_message(e,"data_callback",t)},200);break;case"rebuildcontextonload":rebuildcontextonload();break;case"setbadgetextonload":setbadgetextonload();break;case"openlastpasslegacy":openlastpasslegacy();break;case"opendebugtab":is_user_debug_enabled()&&opendebugtab();break;case"reset_history":is_user_debug_enabled()&&reset_history();break;case"savesite_dialog_changed":savesite_dialog_changed_handler(gettabidfromevent(e),e.message);break;case"lpimprove":sendLpImprove(request.event,request.properties)}}function disablepasswordmanager(e,t,a){if(g_isfirefoxsdk||g_ischrome)if(e){if(lpPutGblPref("disablepasswordmanagerasked",a||g_isfirefoxsdk?1:0),lpWriteAllPrefs(),g_isfirefoxsdk)g_preferences_service.set("signon.rememberSignons",!1);else if(g_ischrome)if(void 0!==chrome.privacy&&void 0!==chrome.privacy.services&&void 0!==chrome.privacy.services.passwordSavingEnabled){if(chrome.privacy.services.passwordSavingEnabled.set({value:!1}),t)try{t.close(!0)}catch(e){L("dialog already closed")}}else chrome.permissions.request({permissions:["privacy"]},function(e){disablepasswordmanager(e,t,!0)})}else if(t)try{t.close(!0)}catch(e){L("dialog already closed")}}function set_share_folder_id(e){share_folder_id=e}function set_share_folder_group(e){share_folder_group=e}function totp_tld_convert(e){return"force.com"==e&&(e="salesforce.com"),e}function add_totp_data(e,t,a,n){if(t=totp_tld_convert(t),void 0!==g_usercache[t]&&void 0!==g_totp.domains&&void 0!==g_totp.domains[t]&&void 0!==g_totp.domains[t][SHA256(g_usercache[t].trim().toLowerCase())]&&(n.can_get_totp=!0),lploggedin&&a&&void 0!==g_ask_totp[e]&&g_ask_totp[e]==t&&void 0!==g_usercache[t]){var o=!1;void 0!==g_totp.domains&&void 0!==g_totp.domains.disabled&&void 0!==g_totp.domains.disabled.all&&g_totp.domains.disabled.all?o=!0:void 0!==g_totp.domains&&void 0!==g_totp.domains.disabled&&void 0!==g_totp.domains.disabled[t]&&g_totp.domains.disabled[t]&&(o=!0),o||(n.ask_totp=!0,n.ask_totp_multifactorenabled=void 0!==g_totp.multifactorenabled&&g_totp.multifactorenabled,n.ask_totp_lastpassauthenabled=void 0!==g_totp.lastpassauthenabled&&g_totp.lastpassauthenabled,n.ask_totp_username=g_username)}n.do_totp=g_do_totp}function connect_eventHandler(e){var t=!1,a=!0,n=gettabidfromevent(e),o=e.message.docnum;if(void 0!==e.message.top&&(t=e.message.top,a=!1),(t||a&&e.message.name==geteventtargeturl(e))&&(cleanup_tabs(),g_CS[n]=new Array,g_CS_count[n]=0,g_loggedLogins=new Array,t=!0,g_CS_tops[n]=o),void 0!==g_CS[n]&&g_CS[n]||(g_CS[n]=new Array,g_CS_count[n]=0),g_CS[n][o]=g_isfirefoxsdk?e.worker:geteventtarget(e),register_new_cs(n,o,e.message.name,t,e.message.docstate,e.message.docflags),g_issafari){if(g_CS_count[n]>=2&&("http://chat.major-design.ru/"==e.message.name||e.message.name.indexOf("facebook.com/ajax/")>0))return lpdbg("connect","skipping connect to document with tabcount="+g_CS_count[n]+", istop="+t+", url="+e.message.name),sendCS(n,{cmd:"remove_event_listener"},o),void delete g_CS[n][o];lpdbg("connect","connecting to document with tabcount="+g_CS_count[n]+", istop="+t+", url="+e.message.name)}g_CS_count[n]++;var r={cmd:"setdocnum",docnum:o};void 0!==e.message.haslang&&1==e.message.haslang||(g_issafari||g_isopera||g_isfirefoxsdk?r.language_data=g_language_data:g_ismaxthon&&(r.language_data="lptranslations={}",r.g_language=lpGetPref("language","")));var i=lp_gettld_url(e.message.name);if(hasNeverSave(e.message.name,i)&&(r.neversave=!0),!t&&is_max_frames_exceeded(n,g_CS_count)||hasNeverEnableLP(e.message.name,i))L("set killswitch for tab:"+n+" url:"+e.message.name),r.killswitch=1,set_killswitch_value(n,o,r.killswitch);else if(!t&&g_skip_ad_frames&&skip_CS_by_score(n,o))console.warn("EXPERIMENT: skipping ads/rich content frame "+e.message.name),r.killswitch=1,set_killswitch_value(n,o,r.killswitch);else{var s=i.lastIndexOf(".")>0?i.substr(i.lastIndexOf(".")+1):"";r.tld=s,r.tlddata=LPJSON.stringify(void 0===lp_all_tlds[s]?[]:lp_all_tlds[s]),do_experimental_popupfill||0!=lpGetPref("showNotificationsAfterClick",1)||(r.ff=g_cachedffdat),set_killswitch_value(n,o,0);var l=null!==g_pending_launch&&void 0!==g_last_launch&&void 0!==g_last_launch[g_pending_launch]&&(new Date).getTime()-g_last_launch[g_pending_launch]<=25e3;r.is_launch=l}add_totp_data(n,i,t,r),sendCS(n,r,o),t?(void 0!==g_persistent_notifications[n]&&g_persistent_notifications[n]&&sendCS(n,g_persistent_notifications[n]),g_cpwbot&&CPWbot_bg&&CPWbot_bg.score_topdoc(n,o,e.message.name)):void 0!==g_persistent_notifications[n]&&g_persistent_notifications[n]&&-1!=e.message.name.indexOf("streetscape.com")&&setTimeout(function(){sendCS(n,g_persistent_notifications[n],"all")},10),!t&&is_max_frames_exceeded(n,g_CS_count)&&(g_issafari&&sendCS(n,{cmd:"remove_event_listener"},o),debug&&L("exceeded max frames on tabid "+n),delete g_CS[n][o])}function getdata_eventHandler(e,t){if(g_isedge&&"toolstrip"==e.message.page&&!t)return void get_selected_tab(null,function(t){setcurrenttabid(t.id),setcurrenturl(gettaburl(t)),getdata_eventHandler(e,!0)});var a={g_userprefsstr:LPJSON.stringify(g_userprefs),g_gblprefsstr:LPJSON.stringify(g_gblprefs),g_username:g_username,ischrome:ischrome,LPISLOC:LPISLOC,LPISUPEK:LPISUPEK,LPISUPEKCAPABLE:LPISUPEKCAPABLE,lp_iscbc:lp_iscbc,g_promptsstr:LPJSON.stringify(g_prompts),lploggedin:lploggedin,g_can_copy_to_clipboard:can_copy_to_clipboard(),g_can_clear_clipboard:can_clear_clipboard()};switch(a.g_is_win=g_is_win,a.g_is_linux=g_is_linux,a.g_is_mac=g_is_mac,a.g_have_nplastpass=have_nplastpass(),a.g_have_native_messaging=have_native_messaging(),a.g_have_pplastpass=have_pplastpass(),a.g_have_ws=have_ws(),a.g_isadmin=g_isadmin,a.g_iscompanyadmin=g_iscompanyadmin,a.g_enterprisemodel=g_enterprisemodel,a.g_showcredmon=g_showcredmon,a.g_premium_exp=g_premium_exp,a.base_url=base_url,a.g_hidevault=g_hidevault,a.g_hideshowvault=g_hideshowvault,a.g_hidenotes=g_hidenotes,a.g_hideidentities=g_hideidentities,a.g_hideexport=g_hideexport,a.g_hideimport=g_hideimport,a.g_hidesharing=g_hidesharing,a.g_hideprint=g_hideprint,a.g_hidecreate=g_hidecreate,a.g_hideacctsettings=g_hideacctsettings,a.g_nopoll=g_nopoll,a.g_norecovery=g_norecovery,a.g_nosharingkeys=g_nosharingkeys,a.g_skiphttptest=g_skiphttptest,a.g_hidesearch=g_hidesearch,a.g_offer_popupfill=g_offer_popupfill,a.g_hidesessions=g_hidesessions,a.g_hideseccheck=g_hideseccheck,a.g_hidelogoffprefs=g_hidelogoffprefs,a.g_hidescreenkeyboard=g_hidescreenkeyboard,a.g_hideappearancebox=g_hideappearancebox,a.g_hiderecentlyusedlistsize=g_hiderecentlyusedlistsize,a.g_hidelicenselink=g_hidelicenselink,a.g_hideaboutmanuallink=g_hideaboutmanuallink,a.g_hideabout=g_hideabout,a.g_hiderecheckpage=g_hiderecheckpage,a.g_hidecheckupdates=g_hidecheckupdates,a.g_hidegopremium=g_hidegopremium,a.g_shownewloginoption=g_shownewloginoption,a.g_hideopenfavs=g_hideopenfavs,a.g_showvaultdefault=g_showvaultdefault,a.g_showvaultalways=g_showvaultalways,a.g_hidesaedhotkey=g_hidesaedhotkey,a.g_key_iterations=get_key_iterations(g_username),a.g_cpwbot=g_cpwbot,a.g_chrome_url=getchromeurl("",!0),a.g_lp_model=g_lp_model,a.g_newvault=VaultToggle.useVault4_0(),a.g_supportsnewvault=VaultToggle.supportsVault4_0(),a.g_loggedinoffline=g_loggedinoffline,a.g_loggedinonline=g_loggedinonline,a.g_is_chrome_portable=g_is_chrome_portable,a.g_one_minute_inbox_importer_dialog_enabled=g_one_minute_inbox_importer_dialog_enabled,a.g_one_minute_signup_menu_enabled=g_one_minute_signup_menu_enabled,a.g_one_minute_signup_enabled=g_one_minute_signup_enabled,a.g_onemin_advert_enabled=g_onemin_advert_enabled,a.g_onemin_advert_app_threshold=g_onemin_advert_app_threshold,a.g_nofolder_feature_enabled=g_nofolder_feature_enabled,a.g_basicauth_feature_enabled=g_basicauth_feature_enabled,a.g_new_settings_enabled=g_new_settings_enabled,a.g_first_time_login=g_first_time_login,g_isfirefoxsdk&&(a.remembersignons=g_preferences_service.get("signon.rememberSignons",!0)),VaultToggle.useVault4_0()&&((g_issafari||g_isfirefoxsdk)&&(a.lp_phpsessid=lp_phpsessid),a.rsaprivatekeyhex=lp_rsaprivatekeyhex),e.message.page){case"about":a.g_nplastpass_version=get_nplastpass_version(),a.g_nplastpass_build_date_time=get_nplastpass_build_date_time(),a.g_native_messaging_version=g_native_messaging_version,a.g_native_messaging_build_date=g_native_messaging_build_date,a.g_native_messaging_build_time=g_native_messaging_build_time,a.g_issafari=g_issafari;break;case"import_other":a.g_wlan_works=g_wlan_works,a.g_wlan_has_exe=g_wlan_has_exe;break;case"img":a.g_img_data=LPJSON.stringify(g_img_data),a.g_audio_data=LPJSON.stringify(g_audio_data);break;case"login":a.g_badgedata=g_badgedata,a.g_notification_type=g_notification_type,a.g_notification_data=g_notification_data,g_reprompt_callback&&(a.g_reprompt_callback="g_reprompt_callback",g_reprompt_callback_save=g_reprompt_callback,g_reprompt_callback=null,a.g_local_key=g_local_key,a.g_cached_hash=g_cached_hash,a.g_local_key_hex=g_local_key_hex,a.g_can_allow_reprompt_skip=!(g_prompts.company_login_site_prompt||g_prompts.company_copyview_site_prompt)),g_reprompt_error_callback&&(a.g_reprompt_error_callback="g_reprompt_error_callback",g_reprompt_error_callback_save=g_reprompt_error_callback,g_reprompt_error_callback=null),a.g_forgotpwurl=g_forgotpwurl,a.lptoken=lptoken;var n=new Array;for(var o in g_sites)check_ident_aid(g_sites[o].aid)&&(n[o]=g_sites[o]);a.g_sites=LPJSON.stringify(n),a.g_prefoverrides=LPJSON.stringify(g_prefoverrides);break;case"omnikey":g_omnikey_callback&&(a.g_omnikey_callback="g_omnikey_callback",g_omnikey_callback_save=g_omnikey_callback,g_omnikey_callback=null);break;case"export":a.g_export_output=g_export_output,g_export_output="";break;case"attach":addAttach(function(){a.g_attachname=g_attachname,a.g_attachbytes=g_attachbytes,g_attachname=g_attachbytes=""});break;case"prefs":a.g_can_open_popover=g_can_open_popover,a.g_pref_tab=g_pref_tab,g_pref_tab=null,a.g_master_password_saved=g_master_password_saved;for(var r=new Array,o=0;o<g_formfills.length;o++)check_ident_ffid(g_formfills[o].ffid)&&(r[r.length]=g_formfills[o]);a.g_formfills=LPJSON.stringify(r),a.g_prefoverrides=LPJSON.stringify(g_prefoverrides),a.g_flags=LPJSON.stringify(g_flags),a.g_opera_context=!(!g_isopera||!opera.contexts.menu),a.g_firefoxsdk_context=!(!g_isfirefoxsdk||"undefined"==typeof g_context_menu),a.lppassusernamehash=lppassusernamehash;break;case"vault":if(a.g_username=g_username,a.g_local_accts_version=g_local_accts_version,a.lploggedin=lploggedin,a.g_identity=g_identity,a.g_isadmin=g_isadmin,a.g_icons_length=g_icons_length,a.recentCount=getRecentCount(),a.g_enterpriseuser=g_enterpriseuser,a.g_enterprisemodel=g_enterprisemodel,a.g_iscompanyadmin=g_iscompanyadmin,a.g_showcredmon=g_showcredmon,a.g_token=g_token,a.g_sharing_enabled=g_sharing_enabled,a.g_folder_sharing_enabled=g_folder_sharing_enabled,a.g_prefoverrides=LPJSON.stringify(g_prefoverrides),void 0===e.message.g_username||g_username!=e.message.g_username||g_local_accts_version>e.message.g_local_accts_version||lploggedin!=e.message.lploggedin||g_identity!=e.message.g_identity||g_isadmin!=e.message.g_isadmin){a.g_hideidentities=g_hideidentities,a.g_identities=JSON.stringify(g_identities);var n={};for(var o in g_sites)check_ident_aid(g_sites[o].aid)&&(n[o]=g_sites[o]);a.g_sites=JSON.stringify(n),a.g_shares=JSON.stringify(g_shares),a.lp_attaches=JSON.stringify(lp_attaches);var i={};for(var o in g_securenotes)check_ident_aid(g_securenotes[o].aid)&&(i[o]=g_securenotes[o]);a.g_securenotes=JSON.stringify(i);var s={};for(var o in g_applications)check_ident_appaid(g_applications[o].appaid)&&(s[o]=g_applications[o]);a.g_applications=JSON.stringify(s);for(var r=[],o=0;o<g_formfills.length;o++)check_ident_ffid(g_formfills[o].ffid)&&r.push(g_formfills[o]);a.g_formfills=JSON.stringify(r);for(var l=[],o=0;o<g_pendings.length;o++)check_ident_aid(g_pendings[o].aid)&&l.push(g_pendings[o]);a.g_pendings=JSON.stringify(l),a.g_username_hash=g_username_hash,a.searchinnotes=get_searchNotesPref(),a.lpclearrecent=lpclearrecent,a.g_icons_length=g_icons_length,a.clearRecentTime=getClearRecentTime(),a.g_icons=LPJSON.stringify(g_icons),a.g_bigicons=LPJSON.stringify(g_bigicons),a.g_local_key=g_local_key,a.g_local_key_hex=g_local_key_hex,a.g_promptsstr=LPJSON.stringify(g_prompts),a.g_emer_sharers=JSON.stringify(g_emer_sharers),a.g_emer_sharees=JSON.stringify(g_emer_sharees),a.g_pending_shares=JSON.stringify(g_pending_shares),a.g_note_templates=JSON.stringify(g_note_templates),a.g_reminders=JSON.stringify(g_reminders),a.g_genpws=g_genpws}break;case"toolstrip":case"toolstripchangepw":var _=void 0!==e.message.delay_data&&e.message.delay_data;if(g_isedge&&(a.g_bigicons=JSON.stringify(g_bigicons)),a.g_shares=LPJSON.stringify(g_shares),a.sitepwlen=LP.sitepwlen,a.g_wlan_works=g_wlan_works,a.g_wlan_has_exe=g_wlan_has_exe,a.g_secret_cache=g_secret_cache,"string"==typeof g_generate_url&&""!=g_generate_url||(g_generate_url=getcurrenturl()),a.g_generate_url=g_generate_url,""!=g_generate_url&&(g_generate_url_prev=g_generate_url),g_generate_url="",a.allowmultifactortrust=allowmultifactortrust,a.hidemultifactordisable=hidemultifactordisable,a.g_changepwnewpw=g_changepwnewpw,a.g_changepwtld=g_changepwtld,a.g_changepwexcludeid=g_changepwexcludeid,a.lploggedin=lploggedin,a.g_genpws=g_genpws,a.g_local_key=g_local_key,a.g_local_key_hex=g_local_key_hex,a.g_badgedata=g_badgedata,a.g_notification_type=g_notification_type,a.g_notification_data=g_notification_data,a.g_premium_exp=g_premium_exp,a.g_enterpriseuser=g_enterpriseuser,a.g_enterprisemodel=g_enterprisemodel,a.g_hideexport=g_hideexport,a.g_hideidentities=g_hideidentities,a.g_hideimport=g_hideimport,a.g_hidenotes=g_hidenotes,a.g_hideprint=g_hideprint,a.g_identity=g_identity,a.clearRecentTime=getClearRecentTime(),_){var c=!1;for(var o in g_applications)if(check_ident_appaid(g_applications[o].appaid)){c=!0;break}a.g_have_application=c}else{var n=new Array;if(g_enable_full_menu)for(var o in g_sites)g_sites[o]&&check_ident_aid(g_sites[o].aid)&&(n[o]=g_sites[o]);a.g_sites=LPJSON.stringify(n);var i=new Array;if(g_enable_full_menu)for(var o in g_securenotes)check_ident_aid(g_securenotes[o].aid)&&(i[o]=g_securenotes[o]);a.g_securenotes=LPJSON.stringify(i);var s=new Array;if(g_enable_full_menu)for(var o in g_applications)check_ident_appaid(g_applications[o].appaid)&&(s[o]=g_applications[o]);a.g_applications=LPJSON.stringify(s)}a.g_breach_data=LPJSON.stringify(g_breach_data);var g=getcurrenturl(),d=getsites("toolstripchangepw"==e.message.page?g_changepwtld:lp_gettld_url(g),"toolstripchangepw"==e.message.page,"toolstripchangepw"==e.message.page?g_changepwexcludeid:0);"toolstrip"==e.message.page&&(d=reorderOnURL(d,g));var p=new Array;if(g_enable_full_menu)for(var u in d)"toolstrip"==e.message.page&&(u=d[u].aid),p[u]=g_sites[u];if(a.g_sites_tld=LPJSON.stringify(p),!_){var r=new Array;if(g_enable_full_menu)for(var o=0;o<g_formfills.length;o++)check_ident_ffid(g_formfills[o].ffid)&&(r[r.length]=g_formfills[o]);a.g_formfills=JSON.stringify(r)}a.g_identities=LPJSON.stringify(g_identities),a.g_nevers=LPJSON.stringify(getnevers()),a.g_icons=LPJSON.stringify(g_enable_full_menu?g_icons:[]),g_firefox_preload_menu||(a.g_bigicons=LPJSON.stringify(g_enable_full_menu?g_icons:[])),a.g_menuheight=getmenuheight(!0,!0,!0,!0),a.g_tabid=getcurrenttabid(),a.g_language=lpGetPref("language",""),a.g_prefoverrides=LPJSON.stringify(g_prefoverrides);break;case"formfill":a.g_shares=LPJSON.stringify(g_shares),a.g_formfill_data=LPJSON.stringify(g_formfill_data),g_formfill_data=null,a.countryfromip=countryfromip,a.g_generatedpw=g_generatedpw,a.lploggedin=lploggedin,a.g_local_key=g_local_key,a.g_local_key_hex=g_local_key_hex;break;case"site":var g=g_site_data?g_site_data.url:"";a.g_site_data=LPJSON.stringify(g_site_data),g_site_data=null,a.g_generatedpw=g_generatedpw,a.g_showhistorylinks=g_showhistorylinks,a.g_local_key=g_local_key,a.g_local_key_hex=g_local_key_hex,a.g_secret_cache=LPJSON.stringify(g_secret_cache);var n=new Array;for(var o in g_sites)check_ident_aid(g_sites[o].aid)&&(n[o]=g_sites[o]);a.g_sites=LPJSON.stringify(n);var d=getsites(lp_gettld_url(g),!0),n=new Array;for(var u in d)n[u]=g_sites[u];a.g_sites_tld=LPJSON.stringify(n),a.g_shares=LPJSON.stringify(g_shares);var i=new Array;for(var o in g_securenotes)check_ident_aid(g_securenotes[o].aid)&&(i[o]=g_securenotes[o]);a.g_securenotes=LPJSON.stringify(i);var s=new Array;for(var o in g_applications)check_ident_appaid(g_applications[o].appaid)&&(s[o]=g_applications[o]);a.g_applications=LPJSON.stringify(s),a.lploggedin=lploggedin,a.g_prompts=g_prompts,a.g_savesitestopersonal=LPJSON.stringify("undefined"!=typeof g_savesitestopersonal?g_savesitestopersonal:new Array),a.g_sharing_enabled=g_sharing_enabled;break;case"create_account":case"reenter_password":a.g_create_account_data=LPJSON.stringify(g_create_account_data);break;case"siterefresh":var n=new Array;for(var o in g_sites)check_ident_aid(g_sites[o].aid)&&(n[o]=g_sites[o]);a.g_sites=LPJSON.stringify(n);var d=getsites(lp_gettld_url(g),!0),n=new Array;for(var u in d)n[u]=g_sites[u];a.g_sites_tld=LPJSON.stringify(n);var d=getsites(lp_gettld_url(g),!0);a.g_shares=LPJSON.stringify(g_shares),a.g_pending_pw_change=g_pending_pw_change;break;case"breach":a.g_breach_data=LPJSON.stringify(g_breach_data),a.g_username=g_username;var n=new Array;for(var u in g_sites)n[u]=g_sites[u];var f=new Array;for(var u in d)f[u]=g_sites[u];a.g_sites=LPJSON.stringify(n),a.g_shares=LPJSON.stringify(f),a.g_local_key=g_local_key;break;case"debug":a.g_historybuf=gethistorybuf(),a.g_user_debug_enabled=is_user_debug_enabled()}event_dispatch_message(e,"gotdata",a)}function update_menus(e){if((g_ischrome||g_isopera||g_isfirefoxsdk)&&get_selected_tab(null,function(t){e&&(lastcontexturl=null),rebuildcontext(gettaburl(t))}),g_issafari)for(var t=0;t<safari.extension.bars.length;t++)if("LPMenu"==safari.extension.bars[t].identifier){safari.extension.bars[t].label=gs("LastPass Menu"),safari.extension.bars[t].contentWindow.redraw_menu(),lploggedin||"undefined"!=typeof SafariExtensionPopover||safari.extension.bars[t].hide();break}}function toggle_menu(e){for(var t=0;t<safari.extension.bars.length;t++)"LPMenu"==safari.extension.bars[t].identifier&&(e||safari.extension.bars[t].visible?safari.extension.bars[t].hide():safari.extension.bars[t].show())}function close_menu(){"undefined"==typeof SafariExtensionPopover&&toggle_menu(!0)}function alert_reinstall(){g_alert_reinstall||(g_alert_reinstall=!0)}function show_firefox_alt_panel(e){var t="";"mpwchange"==e&&(t="mpwchange.html?domain="+encodeURIComponent(g_notification_data.domain)+"&requirechangereuse="+(requirechangereuse()?"1":"0"));var a=g_panel.Panel({width:568,height:716,contentURL:getchromeurl(t),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",contextMenu:!0});a.port.on("message",function(e){e.target=a,message_handler(e)}),a.show({position:g_firefox_button})}function create_firefox_button(){"undefined"!=typeof g_ui_button_toggle&&(g_firefox_button=g_ui_button_toggle.ToggleButton({id:"lastpass-button",label:"LastPass",icon:{19:self.data.url("images/iconset2/19x19_Gray.png"),38:self.data.url("images/iconset2/19x19_Gray_2x.png")},onChange:function(e){e.checked&&getsinglefactortype(function(e){!g_ask_native_messaging_from_button&&(lploggedin||null!=g_badgedata||""==e&&1==lpGetPref("enablenewlogin",1))?lploggedin?showFirefoxPanel():open_login_panel():(g_firefox_button.state("window",{checked:!1}),open_login(!0))})}}))}function create_firefox_panel(){if(!VaultToggle.useVault4_0()||g_firefox_preload_menu){var e="lp_toolstrip.html?browseraction=1&skip_pagemod=1";g_badgedata&&"mpwchange"==g_badgedata.type&&(e="mpwchange.html?domain="+encodeURIComponent(g_notification_data.domain)+"&requirechangereuse="+(requirechangereuse()?"1":"0")),g_firefox_delay_menu_data&&(e+="&delay_data=1"),g_firefox_panel=g_panel.Panel({width:390,height:497,contentURL:getchromeurl(e),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",onHide:function(){g_firefox_button.state("window",{checked:!1}),closePop()},contextMenu:!0}),g_firefox_panel.port.on("message",function(e){e.target=g_firefox_panel,message_handler(e)})}}function lpbackgroundcontainer(){this.receiveMessage=function(e){switch(e.json.messagename){case"frame_script_loaded":g_chrome.Cc["@mozilla.org/globalmessagemanager;1"].getService(g_chrome.Ci.nsIMessageListenerManager).broadcastAsyncMessage("lastpass:contentevent",{messagename:"set_url_prefix",url_prefix:getchromeurl("",!0),lplanguage:get_lplanguage()})}}}function onLoad(e){if(g_onload_started=!0,L("BG : loaded"),migrate_from_old_firefox(),!e){if(void 0!==LPPlatform.initialize&&LPPlatform.initialize(),g_isopera)g_opera_button=opera.contexts.toolbar.createItem({disabled:!1,title:"LastPass",icon:"icon_gray2_opera.png",popup:{width:"1px",height:"1px",href:getchromeurl("lp_toolstrip.html?browseraction=1")}}),opera.contexts.toolbar.addItem(g_opera_button),opera.extension.tabs.onfocus=function(){var e=opera.extension.tabs.getFocused(),t=e?gettaburl(e):"";"string"==typeof t&&""!=t&&-1==t.indexOf("widget")?(g_generate_url_prev=g_generate_url,g_generate_url=t,opera.postError("######################################################### Setting bg.g_generate_url="+g_generate_url)):""==g_generate_url&&""!=g_generate_url_prev?(g_generate_url=g_generate_url_prev,opera.postError("######################################################### Setting B bg.g_generate_url="+g_generate_url_prev)):opera.postError("######################################################### NOT changing bg.g_generate_url="+g_generate_url)};else if(g_isfirefoxsdk){if("undefined"!=typeof g_ui_button_toggle)g_firefox_preload_menu&&create_firefox_panel();else{var t=g_window_utils.getMostRecentBrowserWindow();void 0!==t.NativeWindow&&(g_fennec_menu_id=t.NativeWindow.menu.add(gs("LastPass"),null,fennec_menu))}new g_deprecated_window_utils.WindowTracker({onTrack:function(e){g_window_utils.isBrowser(e)||("chrome://global/content/commonDialog.xul"==e.location.href&&"function"==typeof LP.lphandlebasic?setTimeout(function(){LP.lphandlebasic(e.document,e)},0):"chrome://foxmarks/content/foxmarks-login.xul"==e.location.href&&setTimeout(function(){LP.lphandlexmarks(e.document,e)},0))}});var a=g_chrome.Cc["@mozilla.org/globalmessagemanager;1"].getService(g_chrome.Ci.nsIMessageListenerManager);a.loadFrameScript(getchromeurl("content.js",!0),!0),a.addMessageListener("lastpass:lpevent",lpbackground),AwesomeBarSuggestion({icon:getchromeurl("icon2.png"),matches:/^lp /i,onSearch:function(e,t){var a=e.substring(3).trim();if(lploggedin){if(0==a.length)return;var n=[],o=!g_prompts.edit_sn_prompt&&get_searchNotesPref(),r=search_results(a.toLowerCase(),o);r.sort(lp_sort_case_insensitive_name);var i=0;for(var s in r){var l,_=r[s];if(_.sn)l=of(_.name),"sn";else{l=of(_.name);var c=getusernamefromacct(_);""!=c&&(l+=" ("+of(c)+")")}var g=LP.is_application(r[s])?r[s].appname:r[s].url;if(n.push({url:getchromeurl("launch.html?aid="+encodeURIComponent(get_record_id(r[s]))),title:l,favicon:geticonurlfromrecord(r[s]),label:"http://sn"==g?gs("Secure Note"):g}),i++>7)break}t(n,!0)}}})}g_issafari?(g_hidemenubar&&"undefined"!=typeof SafariExtensionPopover&&toggle_menu(!0),safari.application.addEventListener("message",message_handler,!1),safari.application.addEventListener("command",command_handler,!1),safari.application.addEventListener("navigate",navigate_handler,!1)):g_isopera?opera.extension.addEventListener("message",message_handler,!1):g_ismaxthon&&window.external.mxGetRuntime().listen("lpbackground",message_handler)}if(have_binary_function("lpvt_setup_if")&&!is_guiless()&&call_binary_function("lpvt_setup_if"),have_binary_function("file_exists")&&(call_binary_function("file_exists","LPISLOC",function(e){e&&call_binary_function("read_file","LPISLOC",function(e){call_binary_function("lpvt_verify_file_contents",e,function(e){e?LPISLOC=!0:alert_reinstall()})})}),call_binary_function("file_exists","LPISUPEK",function(e){e&&call_binary_function("read_file","LPISUPEK",function(e){call_binary_function("lpvt_verify_file_contents",e,function(e){e?LPISUPEK=!0:alert_reinstall()})})}),call_binary_function("file_exists","LPISUPEKCAPABLE",function(e){e&&call_binary_function("read_file","LPISUPEKCAPABLE",function(e){call_binary_function("lpvt_verify_file_contents",e,function(e){e?LPISUPEKCAPABLE=!0:alert_reinstall()})})})),e||!g_ischrome||is_guiless()||("function"==typeof chrome.browserAction.setPopup&&chrome.browserAction.onClicked.addListener(function(e){g_ask_native_messaging_from_button?(g_ask_native_messaging_from_button=!1,request_native_messaging(),drawIconAtRotation(0)):open_login(!0)}),chrome.tabs.onUpdated.addListener(function(e,t,a){if("loading"==t.status){var n=gettabid(a);if(t.url&&g_badgedata&&g_badgedata.type&&"alert"==g_badgedata.type&&g_badgedata.tabid&&g_badgedata.tabid==n){var o=t.url;compare_tlds(lp_gettld_url(o),g_badgedata.tld)||(g_badgedata=null,drawIconAtRotation(0))}}}),void 0!==chrome.tabs.onActivated&&chrome.tabs.onActivated.addListener(function(e){get_selected_tab(null,function(e){var t=gettaburl(e);t&&0!=t.indexOf("http")&&rebuildcontext(t)})}),chrome.tabs.onCreated.addListener(function(e){clear_badge_text(),lastcontexturl=""})),drawIconAtRotation(0),get_reg_bool("hidevault",g_hidevault,function(e){g_hidevault=e}),get_reg_bool("hidenotes",g_hidenotes,function(e){g_hidenotes=e}),get_reg_bool("hideidentities",g_hideidentities,function(e){g_hideidentities=e}),get_reg_bool("hideexport",g_hideexport,function(e){g_hideexport=e}),get_reg_bool("hideimport",g_hideimport,function(e){g_hideimport=e}),get_reg_bool("hidesharing",g_hidesharing,function(e){g_hidesharing=e}),get_reg_bool("hideprint",g_hideprint,function(e){g_hideprint=e}),LPISLOC&&(g_hideidentities=g_hidesharing=g_hideprint=!0),g_is_mac&&g_issafari){new WebSocket("ws://127.0.0.1:19537","lp2")}if(e?1==lpGetPref("enablenamedpipes",1)&&have_binary()&&lpnp_init():(lpReadAllPrefs(function(e){createContextMenus(),drawIconAtRotation(0),lplog("base_url="+base_url),get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var a=0;a<get_tabs_length(e[t]);a++){var n=get_tabs(e[t])[a],o=gettabid(n),r=gettaburl(n);!r||-1==r.indexOf("https://lastpass.com/install.php")&&-1==r.indexOf(base_url+"install.php")||(lplog("Reloading install.php page"),chrome.tabs.reload(o))}}),0==e?g_ischrome?(lpPutGblPref("welcomedone",1),lpWriteAllPrefs(),LPISLOC||is_guiless()||g_hidecreate||g_hidecreatepop?open_native_messaging_html_if():check_show_welcome()):g_issafari&&"undefined"!=typeof SafariExtensionPopover&&toggle_menu(!0):open_native_messaging_html_if(),1==lpGetPref("enablenamedpipes",1)&&have_binary()&&lpnp_init(),lp_ws.startProcessing(),g_offer_popupfill&&(do_experimental_popupfill=1==lpGetPref("usepopupfill",1)),!LPISLOC&&g_np_init||httptest()}),setup_poll_timer(),DeleteOldDynamicFiles(),-1!=getchromeurl("needtoreinstall.html").indexOf("kegdhfdpgckamaoikbjiemmikleploeh")&&openURL(base_url+"/needtoreinstall.html")),setTimeout(function(){g_ischrome&&!g_basicauth_timer_started&&have_binary_function("setup_basicauth_timer")&&(g_basicauth_timer_started=!0,call_binary_function("setup_basicauth_timer"))},100),!e){LoadSpecialSites(),setTimeout(check_key_for_changes,6e4);try{g_ischrome&&chrome.webRequest.onAuthRequired.addListener(function(e,t){var a={};try{if(void 0!==g_launches[e.tabId]&&g_launches[e.tabId]){var n=g_launches[e.tabId];if(void 0!==g_sites[n]){var o=g_sites[n];compare_tlds(lp_gettld_url(o.url),lp_gettld_url(gettaburl(e)))&&(a.authCredentials={username:getusernamefromacct(o),password:getpasswordfromacct(o)},g_launches[e.tabId]=null)}}else{var r=gettaburl(e),i=reorderOnURL(getsites(lp_gettld_url(r)),r,!0);for(var s in i)if(1==i[s].basic_auth&&write_history({cmd:"check_autologin3",tabid:tabid,aid:i[s].aid,submit:"tbd"}),1==i[s].basic_auth&&check_autologin(!1,i[s])){a.authCredentials={username:getusernamefromacct(i[s]),password:getpasswordfromacct(i[s])};break}}}catch(e){}return a},{urls:["<all_urls>"]},["blocking"])}catch(e){}}}function chromeGetSelf(e){chrome&&chrome.management&&"function"==typeof chrome.management.getSelf?chrome.management.getSelf(e):e(null)}function check_show_welcome(){g_ischrome&&(LPContentScriptFeatures.intro_tutorial_version="context",chromeGetSelf(function(e){get_registry_value("Software\\LastPass","LoginUsers","",function(t){var a=""!=t;get_registry_value("Software\\LastPass","UniversalInstaller","",function(t){universalinstaller=""!=t,a||g_hidecreate||universalinstaller?(console.log("skipping wizard, looks like someone has logged in before"),open_native_messaging_html_if()):get_all_windows({populate:!0},function(t){for(var a=!1,n=!1,o=0;o<t.length;o++)for(var r=0;r<get_tabs_length(t[o]);r++){var i=get_tabs(t[o])[r],s=gettabid(i),l=gettaburl(i);l&&(l=l.toLowerCase()),-1==l.indexOf("https://lastpass.com/install.php")&&-1==l.indexOf(base_url+"install.php")||(a=!0),-1!=l.indexOf("?lpinstall")&&(n=!0,s),-1==l.indexOf("https://lastpass.com/dl/inline/")&&-1==l.indexOf(base_url+"dl/inline/")||close_tab(i)}if(!(a=a&&e&&"sideload"==e.installType)){var l=getbaseurl()+"how-it-works/index.php?storeRedirect";n||LPPlatform.openTab({url:l})}})})})}))}function get_reg_bool(e,t,a){get_registry_value("Software\\LastPass",e,"-1",function(e){a(-1==e?t:"1"==e)})}function onUnload(){if(close_lpctypeslib(),deleteallattachments(!0),g_fennec_menu_id){var e=g_window_utils.getMostRecentBrowserWindow();void 0!==e.NativeWindow&&e.NativeWindow.menu.remove(g_fennec_menu_id)}}function check_key_for_changes(){null==g_local_key_hash||""==g_local_key||null!=g_local_key_hash&&SHA256(g_local_key)!=g_local_key_hash&&(L("LOGGING OFF : cosmicrays"),loggedOut(),lpReportError("INVESTIGATE! KEY_HASH IS WRONG! COSMIC RAYS?")),this.setTimeout(check_key_for_changes,6e4)}function disabletotp(e){e=totp_tld_convert(e),void 0===g_totp.domains&&(g_totp.domains={}),void 0===g_totp.domains.disabled&&(g_totp.domains.disabled={}),g_totp.domains.disabled[e]=!0,g_local_accts_version++,rewritelocalfile(),lpMakeRequest(base_url+"totp.php","token="+encodeURIComponent(g_token)+"&disable=1&tld="+encodeURIComponent(e),function(){})}function enabletotp(e,t,a,n){e=totp_tld_convert(e),g_ask_totp[t]=null;var o=SHA256(g_usercache[e].trim().toLowerCase());lpMakeRequest(base_url+"totp.php","token="+encodeURIComponent(g_token)+"&enable=1&tld="+encodeURIComponent(e)+"&usernamehash="+encodeURIComponent(o),function(r){if(4==r.readyState&&200==r.status&&null!=r.responseXML&&null!=r.responseXML.documentElement){var i=r.responseXML.documentElement;void 0===g_totp.domains&&(g_totp.domains={}),void 0===g_totp.domains[e]&&(g_totp.domains[e]={}),g_totp.domains[e][o]=!0,g_local_accts_version++,rewritelocalfile();if(i.getElementsByTagName("ok").length>0)if(a)a({ok:!0});else{var s={cmd:"enabletotp_response",ok:!0};g_isfirefoxsdk?n.emit("message",s):sendCS(t,s,"all")}else if(a)a({ok:!1});else{var s={cmd:"enabletotp_response",ok:!1};g_isfirefoxsdk?n.emit("message",s):sendCS(t,s,"all")}}})}function invitetotp(e,t){lpMakeRequest(base_url+"totp.php","token="+encodeURIComponent(g_token)+"&invite=1&email="+encodeURIComponent(e)+"&phone="+encodeURIComponent(t),function(){})}function disconnectCS(e){if(void 0!==g_CS[e]&&g_CS[e]){for(var t in g_CS[e])g_CS[e][t].disconnect(),g_CS[e][t]=null,delete_cs_for_docnum(e,t);g_CS_count[e]=0,g_cpwbot&&CPWbot_bg&&(L("disconnect clear score [tabid:"+e+"]"),CPWbot_bg.reset_scores(e))}}function sendCS(e,t,a,n){if(t&&"string"==typeof t.cmd&&t.cmd.match(/show.*notification/)&&(t.notificationsBottom=getInt(lpGetPref("notificationsBottom",0))),void 0===n||0==n?n=0:1==n&&(n=1),debug&&("loadurl"==t.cmd?L("BG -> CS["+e+"] : initial "+t.cmd+" url:"+t.url):"gotpopupfillinput"!=t.cmd&&L("BG -> CS["+e+"] : initial "+t.cmd)),n>0&&(void 0!==t.cmd||L("BG -> CS["+e+"] : retry="+n)),"all"!=e){if(void 0===g_CS[e]||!g_CS[e]){if(n<0)return;if(n>=MAX_RETRY_SEND_CS)return;var o=150*n;return void setTimeout(function(){sendCS(e,t,a,n+1)},o)}t.urlprefix=getchromeurl("",!0),t.lplanguage=get_lplanguage();var r=!0;for(var i in g_CS[e]){if(void 0===a||null==a){if(!r)continue;r=!1}else if("all"!=a&&a!=i)continue;if(get_killswitch_value(e,i)>0){var s=getcsinfo(e,i),l=s?s.url:"unknown";write_history({cmd:"info",msg:sprintf("killswitch, ignoring %s to %s",t.cmd,l),tabid:e,docnum:i}),is_human_initiated_action(t)&&hasNeverEnableLP(l,lp_gettld_url(l))&&g_last_ui_warning-LPPerl.time()>60&&(g_last_ui_warning=LPPerl.time(),alertfrombg("manual fill blocked due to never rule"))}else try{g_ischrome?no_persistent_messaging()?chrome.tabs.sendMessage(e,t):g_CS[e][i].postMessage(t):g_issafari?(t.docnum=i,g_CS[e][i].page.dispatchMessage("message",t),"loadurl"==t.cmd&&delete g_CS[e][i]):g_isopera?(t.docnum=i,t.messagetype="message",g_CS[e][i].postMessage(t)):g_ismaxthon?(t.docnum=i,t.messagetype="message",window.external.mxGetRuntime().post(i,t)):g_isfirefoxsdk&&(t.docnum=i,t.messagetype="message",g_CS[e][i].port.emit("lpmessage",t))}catch(e){}}}else for(var i in g_CS)for(var _ in g_CS[e])try{debug&&L("calling sendCS["+i+"]["+_+"] cmd="+t.cmd),sendCS(i[_],t)}catch(e){"saveall"==t.cmd&&g_saveall_framestotal--}}function receiveCS(e,t,a,n){if(a){var o=g_CS[e]&&g_CS[e].indexOf(n);return o>-1&&(g_CS[e][o]=null,--g_CS_count[e]),void((g_CS_count[e]<=0||punycode.URLToASCII(n.name)==gettaburl(n.sender.tab))&&(g_CS[e]=null,delete_cs_for_tab(e),g_cpwbot&&CPWbot_bg&&(L("disconnect clear score [tabid:"+e+"]"),CPWbot_bg.reset_scores(e))))}if(void 0===t.cmd)return void L("CS["+e+"] -> BG : INVALIDMSG");processCS(e,t,n)||L("CS["+e+"] -> BG : INVALIDMSG")}function sendTS(e,t){if(!g_isopera&&!g_ismaxthon&&(!g_issafari||g_can_open_popover&&g_safari_error_notifications))try{if("notification"==e.cmd&&"upgrade"!=e.type&&set_badge(e),"notification"!=e.cmd||"upgrade"!=e.type||g_isfirefoxsdk||g_issafari)return;var a=void 0===t?"all":t,n=!1,o=chrome.extension.getViews();for(var r in o)if("function"==typeof o[r].receiveBG&&("all"==a||void 0!==o[r].g_toolstripid&&a==o[r].g_toolstripid)&&(L("BG -> TS : cmd="+e.cmd),o[r].receiveBG(e),n=!0,"all"!=a))break;n||L("BG -> TS : FAILED")}catch(e){L("BG -> TS : FAILED error="+e)}}function set_badge(e){if(g_issafari&&"alert"!=g_notification_type&&"lpalert"!=g_notification_type&&"error"!=g_notification_type||g_isopera||g_ismaxthon||is_guiless())return void(g_badgedata=null);g_badgedata=e,currrotation=0,animateFlip()}function clear_badge(){!VaultToggle.useVault4_0()&&(g_issafari||g_isopera||g_ismaxthon||is_guiless())||(currrotation=numrotations,g_badgedata=null,g_notification_type=null,drawIconAtRotation(0))}function set_badge_text(e){g_issafari||g_isopera||g_ismaxthon||is_guiless()||do_experimental_popupfill&&0!=lpGetPref("showmatchingbadge",1)&&("string"!=typeof e&&(e=""+e),lploggedin||(e=""),g_isfirefoxsdk?g_firefox_button&&(g_firefox_button.badgeColor="#555",g_firefox_button.badge=e):(chrome.browserAction.setBadgeBackgroundColor({color:"#555"}),chrome.browserAction.setBadgeText({text:e})))}function clear_badge_text(){g_issafari||g_isopera||g_ismaxthon||is_guiless()||g_iscasper||(g_isfirefoxsdk?g_firefox_button&&(g_firefox_button.badge=""):chrome.browserAction.setBadgeText({text:""}))}function receiveTS(e,t){if(void 0===t.cmd)return L("TS["+e+"] -> BG : INVALIDMSG"),null;switch(L("TS["+e+"] -> BG : cmd="+t.cmd),t.cmd){case"getloginstate":lploggedin&&sendTS({cmd:"login"},e);break;case"sesameauth":sesame_auth(t.otp,t.label);break;case"yubikeyauth":yubikey_auth(t.otp,t.label);break;case"googleauthauth":googleauth_auth(t.otp,t.label);break;case"outofbandauth":outofband_auth(t.otp,t.label);break;case"settrustlabel":g_trustlabel=t.trustlabel;break;case"securityquestionauth":securityquestion_auth(t.otp,t.label);break;case"gridauth":grid_auth(t.gridvalues,t.label);break;case"multifactorauth":multifactor_auth(["multifactorresponse"],t.label);break;case"lostkey":lostkey();break;case"googleauthlostkey":googleauthlostkey();break;case"outofbandlostkey":outofbandlostkey();break;case"securityquestionlostkey":securityquestionlostkey();break;case"sesamelostkey":sesamelostkey();break;case"gridlostkey":gridlostkey();break;case"multifactorlostkey":multifactorlostkey(t.type);break;case"turnofficon":lpTurnOffIcon();break;case"of":of(t.a);break;default:return L("TS["+g_toolstripid+"] -> BG : INVALIDMSG"),null}}function alertmpwchange(e){g_notification_type="mpwchange",g_notification_data=e;var t={cmd:"notification",type:"mpwchange"};sendTS(t),g_badgedata=t,drawIconAtRotation(0),g_isfirefoxsdk&&setTimeout(function(){showFirefoxPanel()},0)}function omnikey_get_pin(e){g_omnikey_callback=e,openURL(getchromeurl("omnikey.html"))}function processCS(e,t,a){switch(void 0!==t.url&&(t.url=punycode.URLToASCII(t.url)),void 0!==t.timestamp&&update_cs_timestamp(e,t),t.cmd){case"set_possiblemax":var n=(t.max,t.max);g_possiblemax_tuple=n<0||n>100?[]:[e,n];break;case"rsadecrypt":if(lp_url_is_lastpass(t.url)){var o=t.sharerpublickeyhex,r=(t.sharekeyenchexsig,t.sharekeyenchex),i="",s="",i="";o&&r?(i=lprsa_rsadecrypt(r),s=null==i||""==i?"rsaerror":"ok",sendCS(e,{cmd:"rsadecrypt",rc:s,sharekeyhex:i})):(s="rsaerror",sendCS(e,{cmd:"rsadecrypt",rc:s,sharekeyhex:i}))}break;case"rsaencryptmultiple":if(lp_url_is_lastpass(t.url)){var l=t.data,s="",_="";l?(_=lprsa_encryptmultiple(l),s=null==_||""==_?"rsaerror":"ok",sendCS(e,{cmd:"rsaencryptmultiple",rc:s,dataout:_})):(s="rsaerror",sendCS(e,{cmd:"rsaencryptmultiple",rc:s,dataout:_}))}break;case"ipcgetdata":case"plug2web":if(lp_url_is_lastpass(t.url)){if(g_protect_plug2web&&g_plug2web_last_initiated<lp_get_gmt_timestamp()-g_plug2web_timeout)break;g_plug2web_last_initiated=0;var c=lpParseUri(t.url),g=c.directory,d=c.file;if(""!=(g=g.replace(new RegExp("^/~[^/]*"),""))&&"/"!=g&&"/sso/"!=g&&"/sso/webroot/"!=g&&"/sso/aso/"!=g){lpdbg("error","Keyplug2web request from invalid directory: "+g);break}if(""!=(d=d.replace(new RegExp("#"),""))&&"index.php"!=d&&"misc_login.php"!=d&&"import.php"!=d&&"export.php"!=d&&"otp.php"!=d&&"frameset.php"!=d&&"frame_login.php"!=d&&"gettopost.php"!=d&&"misc_challenge.php"!=d&&"misc_challenge2.php"!=d&&"enterprise_users.php"!=d&&"share_overview.php"!=d&&"acctsiframe.php"!=d){lpdbg("error","Keyplug2web request from invalid file: "+d);break}if(null!=g_username&&""!=g_username)if(t.username&&""!=t.username&&fix_username(t.username)!=fix_username(g_username))loggedOut(!1,"plug2webA");else if("ipcgetdata"==t.cmd){var p={cmd:"ipcgotdata",username:g_username,key:btoa(g_local_key),version:lpversion,identity:g_identity,iterations:get_key_iterations(g_username)};void 0!==t.callback?t.callback(p):sendCS(e,p,t.docnum)}else sendCS(e,{cmd:"plug2web",username:g_username,key:AES.bin2hex(g_local_key),version:lpversion,identity:g_identity,hash:g_local_hash,g_cpwbot:g_cpwbot},t.docnum),"gettopost.php"==d&&unlock_plug2web()}break;case"openlogindialog":open_login();break;case"getversion":sendCS(e,{cmd:"getversion",version:lpversion,builddate:build_date,versionpre:lpversionpre,isloggedin:lploggedin?1:0},t.docnum);break;case"setdefaultloginusername":set_default_login_username(t.username);break;case"getdebuginfo":;sendCS(e,{cmd:"getdebuginfo",info:""},t.docnum);break;case"web2plug":lp_url_is_lastpass(t.url)&&web2plug(t);break;case"savesiteicon":g_popupfill_save_data={},savesiteicon_real(e,t);break;case"logout":case"logoff":lp_url_is_lastpass(t.url)&&lploggedin&&loggedOut(!1,"logoff");break;case"login":lp_url_is_lastpass(t.url)&&loginfromwebsite(t);break;case"fill":case"autofillaid":case"autologinaid":void 0!==t.docstate&&update_cs_docstate(e,t),void 0!==t.docflags&&update_cs_docflags(e,t),t.topurl=g_ischrome?gettaburl(a.sender.tab):gettaburl(a.tab),handleFill(e,t);break;case"checkgenpwfillforms":lploggedin&&checkgenpwfillforms(e,t.url,t.hasff);break;case"neverautofill":case"neverpage":case"neverdomain":var u=g_ischrome?gettaburl(a.sender.tab):gettaburl(a.tab);if(handleNever(e,t),void 0!==t.fromsave&&void 0===t.frompopupiframe){g_persistent_notifications[e]=null,t.notificationdata=LPJSON.parse(t.notificationdata);var f=t.notificationdata.username,m=t.notificationdata.password;lpAddRejectedSite(f,m,t.tld),clear_badge()}do_experimental_popupfill&&(hasNeverAutologin(u,lp_gettld_url(u))||hasNeverFormFill(u,lp_gettld_url(u))||hasNeverGenerate(u,lp_gettld_url(u))||hasNeverShowIcon(u,lp_gettld_url(u))||hasNeverSave(u,lp_gettld_url(u)))&&(handleGetNevers(e,u),closeclickables(e),g_popupform_active[e]=0,g_popupform_active_choose[e]=0,recheckpage(!0));break;case"clearnotification":clear_badge(),g_persistent_notifications[e]=null;break;case"notnow":t.notificationdata=LPJSON.parse(t.notificationdata);var f=t.notificationdata.username,m=t.notificationdata.password;lpAddRejectedSite(f,m,t.tld),g_persistent_notifications[e]=null,clear_badge();break;case"startsaveall":void 0!==t.iframe&&1==t.iframe&&(g_ischrome&&(g_popupfill_save_data={close:1}),g_issafari&&(g_popupfill_save_data={close:1})),saveall();break;case"savethesite":var h=t.notificationdata;if(void 0!==t.iframe&&1==t.iframe&&g_popup_tabid_save){if(g_popup_tab_docnum[e]!=g_CS_tops[e]){var b=g_ischrome?gettaburl(a.sender.tab):gettaburl(a.tab);b&&b.length>0&&(h.url=b)}g_popupfill_save_data=h;break}if("object"!=typeof h&&(h=LPJSON.parse(h)),void 0!==h.formdata2&&parse_formdata(h),h.addsite=1,shouldUseSaveAll(h.url))g_saveall_url=h.url,g_saveall_done=!0,g_saveall_tabid=e,h.url.indexOf("streetscape.com")&&(h.formdata=h.formdata.replace(/logon2/g,"logon1")),g_saveall_formdata=h.formdata,handleSaveAll(g_saveall_tabid,{cmd:"saveall",addsite:1,url:g_saveall_url,formdata:g_saveall_formdata});else if(VaultToggle.useVault4_0()){var v={defaultData:{url:h.url,unencryptedUsername:h.username,password:h.password,basic_auth:void 0===h.realm?"0":"1",realm_data:h.realm||"",formdata:h.formdata},saveOptions:{saveFromSubmit:void 0!==h.formdata,checkForReplacement:!0,source:"bar"}};IntroTutorial.getState(function(e){e.enabled&&e.tile&&(v.saveOptions.source+=e.tile),LPPlatform.openTabDialog(e.enabled?"siteTutorial":"site",v)})}else g_site_data=h,openURL(getchromeurl("site.html"));g_persistent_notifications[e]=null,clear_badge();break;case"changepw":var h=t.notificationdata;void 0===h.sitecount&&(h=LPJSON.parse(t.notificationdata));var y=0;void 0!==h.fromiframe&&(y=h.fromiframe),g_didchangepw[SHA256(h.newpw+h.tld)]=(new Date).getTime();var w=getsites(h.tld,!0),k="",x=0,P=0,S=0;if(""!=h.oldpw&&void 0!==h.oldpw&&null!==h.oldpw){for(var C in w){P++;var m=getpasswordfromacct(g_sites[C]);m!=h.oldpw?(x++,k+=","+C+","):S=C}P-x==1?(h.singleaid=S,h.sitecount=1):P!=x&&(h.excludeid=k)}if(1==h.sitecount){var I=!0;for(var O in g_sites)O==h.singleaid&&g_sites[O].pwprotect&&(I=!1);if(!check_for_frame_mismatch_ok(e,y,gs("Are you sure you would like to change your LastPass password for this site?"),"replace password"))return;I?changepw_wrapper(h):security_prompt(function(){changepw_wrapper(h)})}else{var A,I=!0;for(A in w)if(g_sites[A].pwprotect){I=!1;break}if(!check_for_frame_mismatch_ok(e,y,gs("Are you sure you would like to change your LastPass password for this site?"),"replace password(s)"))return;I?openchangepw_wrapper(h):security_prompt(function(){openchangepw_wrapper(h)})}g_persistent_notifications[e]=null,clear_badge();break;case"save":var N=getcsinfo_top(e,t.docnum);N&&t.docnum!=N.docnum&&(t.topdocurl=N.url),handleSave(e,t);break;case"updatefields":handleUpdateFields(e,t);break;case"addurid":handleAddUrid(e,t);break;case"saveall":void 0===g_saveall_docnumsdone[t.docnum]&&(g_saveall_docnumsdone[t.docnum]=1,g_saveall_formdata+=t.formdata,++g_saveall_framesdone>=g_saveall_framestotal&&finish_saveall());break;case"clearcache":lp_url_is_lastpass(t.url)&&clearCache(!0,!1,!1);break;case"getimportdata":if(lp_url_is_lastpass(t.url)){var c=lpParseUri(t.url),g=c.directory,d=c.file;if(""!=(g=g.replace(new RegExp("^/~[^/]*"),""))&&"/"!=g&&"/sso/"!=g)break;if("import.php"!=d)break;sendCS(e,{cmd:"gotimportdata",source:lpimportsource,data:btoa(AES._utf8_encode(lpimportdata))}),lpimportsource=lpimportdata=""}break;case"initmpw":
g_lp_mpw_user=localStorage.LPMPU,g_lp_iterations=localStorage[g_lp_mpw_user+"_key_iter"],unprotect_data(localStorage[g_lp_mpw_user+"LPMPS"],!0,function(e){g_lp_mpw_salt=e}),unprotect_data(localStorage[g_lp_mpw_user+"LPMPH"],!0,function(e){g_lp_mpw_hash=e}),unprotect_data(localStorage[g_lp_mpw_user+"LPMPD"],!0,function(e){g_lp_mpw_uid=e}),unprotect_data(localStorage[g_lp_mpw_user+"LPMNN"],!0,function(e){g_lp_mpw_nonag=1==e}),unprotect_data(localStorage[g_lp_mpw_user+"LPMEX"],!0,function(e){try{g_lp_mpw_exclude=JSON.parse(e)}catch(e){g_lp_mpw_exclude=null}null===g_lp_mpw_exclude&&(g_lp_mpw_exclude={})}),unprotect_data(localStorage[g_lp_mpw_user+"LPMDD"],!0,function(e){try{g_lp_mpw_dedupe=JSON.parse(e)}catch(e){g_lp_mpw_dedupe=null}null===g_lp_mpw_dedupe&&(g_lp_mpw_dedupe={})});break;case"chkmpw":!lp_url_is_lastpass(t.url)&&"undefined"!=typeof g_lp_iterations&&g_username&&make_lp_key_hash_iterations(g_lp_mpw_salt,t.pw,g_lp_iterations,function(e,a){if(a==g_lp_mpw_hash){if(g_lp_mpw_bad_url=lp_gettld_url(t.url),requirechangereuse()||!g_lp_mpw_nonag&&!(g_lp_mpw_bad_url in g_lp_mpw_exclude)&&!hasNeverMPReuse(t.url,lp_gettld_url(t.url))){g_requirechangereuse=requirechangereuse();var n={domain:g_lp_mpw_bad_url,data:{text:gs("Security Alert: This site has the same password as your LastPass account. To protect all of your online accounts, it is recommended that you change your LastPass Master Password."),notificationdata:{custombutton:"More Information",customaction:"mpwchange.html?requirechangereuse="+(g_requirechangereuse?"1":"0")}}};g_requirechangereuse&&(setTimeout(function(){loggedOut()},1e3),n.data.text=gs("Security Alert: This site has the same password as your LastPass account. To protect all of your online accounts, you have been logged off from LastPass, and you will be required to change your LastPass Master Password next time you login.")),alertmpwchange(n)}!g_enterpriseuser||!lploggedin||!requirechangereuse()&&g_lp_mpw_bad_url in g_lp_mpw_dedupe||(logmpwreuse(g_lp_mpw_bad_url),g_lp_mpw_dedupe[g_lp_mpw_bad_url]=1,localStorage_setItem(g_lp_mpw_user+"LPMDD",JSON.stringify(g_lp_mpw_dedupe)))}});break;case"recover":lp_url_is_lastpass(t.url)&&(g_is_recovery_login=!0,recover(e,t.url,t.username,t.docnum));break;case"launchautologin":lp_url_is_lastpass(t.url)&&launchautologin(t.aid);break;case"setformfillsactivetab":void 0!==e&&addFormfillTab(e);break;case"getprefs":void 0!==e&&removeFormfillTab(e),g_username_vals[t.url]=t.username_val,void 0!==t.docstate&&update_cs_docstate(e,t),void 0!==t.docflags&&update_cs_docflags(e,t);var T={};if(void 0!==t.actionlastparts)for(var R=0;R<t.actionlastparts.length;R++)void 0!==lp_all_tlds[t.actionlastparts[R]]&&(T[t.actionlastparts[R]]=lp_all_tlds[t.actionlastparts[R]]);setprefs(e,t.docnum,t.url,T);break;case"getuuid":getuuid(function(a){sendCS(e,{cmd:"setuuid",uuid:a},t.docnum)},t.username&&""!=t.username?SHA256(t.username):null);break;case"setuuid":setuuid(t.uuid,t.username&&""!=t.username?SHA256(t.username):null);break;case"clearuuid":clearuuid(t.username&&""!=t.username?SHA256(t.username):null);break;case"setupmultifactor":if(t.tabid=e,t.username==g_username){var E="type="+LP.en(t.type)+"&username="+LP.en(t.username);lpMakeRequest(base_url+"setupmultifactor.php",E,lpSetupMultifactorResponse,function(){lpSetupMultifactorError(t)},t)}else sendCS(e,{cmd:"setupmultifactor",result:"error"},t.docnum);break;case"setupsinglefactor":if(lpdbg("singlefactor","setting up single factor"),t.tabid=e,t.username==g_username||"1"==t.silent){var E="type="+LP.en(t.type)+"&username="+LP.en(t.username),M=!0,U=function(){if(lpdbg("singlefactor","make_request_if: "+M),M)lpdbg("singlefactor","making request"),lpMakeRequest(base_url+"setupmultifactor.php",E,lpSetupMultifactorResponse,function(){lpSetupMultifactorError(t)},t);else if("1"!=t.silent){var a={cmd:"setupsinglefactor",result:"error"};void 0!==t.callback?t.callback(a):sendCS(e,a,t.docnum)}};"omnikey"==t.type?omnikey_get_pin(function(e){var t="",a=function(){""==t?M=!1:E+="&secret="+encodeURIComponent(t),U()};have_binary_function("omnikey_get_public_key")?call_binary_function("omnikey_get_public_key",e,function(e){t=e,a()}):a()}):U()}else if("1"!=t.silent){var p={cmd:"setupsinglefactor",result:"error"};void 0!==t.callback?t.callback(p):sendCS(e,p,t.docnum)}break;case"checkmultifactorsupport":var W="",D="error",G=function(){var a={cmd:"checkmultifactorsupport",type:W,result:D};void 0!==t.callback?t.callback(a):sendCS(e,a,t.docnum)};if(have_binary()){var F=new Array;call_binary_function_if("nymi_supported",function(e){e&&(F[F.length]="nymi"),call_binary_function_if("omnikey_supported",function(e){e&&(F[F.length]="omnikey"),call_binary_function_if("winbio_supported",function(e){e&&(F[F.length]="winbio"),F.length>0&&(W=F.join(),D="done"),G()})})})}else(g_is_win||g_is_mac||g_is_linux)&&(W=g_do_native_messaging&&!g_have_native_messaging_permission&&supports_native_messaging()?"needs_native_messaging":"nobinary"),G();break;case"verifymultifactor":var W=t.eventdata1;"winbio"==W?have_binary_function("winbio_verify_user")&&call_binary_function("winbio_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(t){sendCS(e,{cmd:"verifymultifactor",eventdata3:lpenc(t),eventdata2:"done"},t.docnum)}):"nymi"==W&&have_binary_function("nymi_validate")&&call_binary_function("nymi_validate",function(t){sendCS(e,{cmd:"verifymultifactor",eventdata3:lpenc(t),eventdata2:"done"},t.docnum)});break;case"multifactorauth":var V="",G=function(){sendCS(e,{cmd:"multifactorauth",multifactorresponse:V,result:""!=V?"done":"error"},t.docnum)};if("trueapi"==t.type){var J=SHA256(SHA256(fix_username(t.username)+t.type));if(64!=J.length&&have_binary_function("trueapi_get_hash"))return void call_binary_function("trueapi_get_hash",t.username,function(e){J=e,""!=J&&(V=SHA256(J+t.challenge)),G()});""!=J&&(V=SHA256(J+t.challenge)),G()}else"omnikey"==t.type&&omnikey_get_pin(function(e){have_binary_function("omnikey_decrypt")?call_binary_function("omnikey_decrypt",t.challenge,e,function(e){V=e,G()}):G()});break;case"multifactorreprompt":security_prompt(function(){sendCS(e,{cmd:"multifactorauth",result:"done"},t.docnum)},function(){sendCS(e,{cmd:"multifactorauth",result:"error"},t.docnum)});break;case"refresh":lp_url_is_lastpass(t.url)&&("settings"==t.from?lplogincheck("2"==t.type?"websiterefreshrsa":"websiterefresh"):get_accts());break;case"switchidentity":lp_url_is_lastpass(t.url)&&switch_identity(t.iid,!0,!0);break;case"fillfieldconfirm":if(t.topurl=g_ischrome?gettaburl(a.sender.tab):gettaburl(a.tab),write_history({cmd:"fillfieldconfirm",tabid:e,url:t.url,aid:t.aid,result:t.result,docnum:t.docnum,manualfill:t.manualfill,allowforce:t.allowforce,name:t.name,force_fillbest:t.force_fillbest}),fillfieldsconfirm(t),g_launch_site_tracking_enabled&&t.result){var B=get_record(t.aid);SiteLaunchObserver.startFillTracking(e,B)}break;case"deleteaid":var y=void 0!==t.fromiframe&&t.fromiframe?1:0;do_experimental_popupfill?deleteAid(t.aid,null,!1,!0,function(){recheckpage(!0)},null,y,e):deleteAid(t.aid,null,!1,!0);break;case"savenotificationhtml":if(do_experimental_popupfill)if(void 0===g_datacache[e])g_datacache[e]={html:t.text,extra:t.extra};else{var q="";null!=e&&null!=g_popupfill_hint[e]&&null!=g_popupfill_last_active[e]&&null!=g_popupfill_hint[e][g_popupfill_last_active[e]]&&(q=g_popupfill_hint[e][g_popupfill_last_active[e]]),g_datacache[e]={html:t.text,extra:t.extra,popuphtml:g_datacache[e].popuphtml,url:g_datacache[e].url,rowtype:q},g_popupforminput[e]=[],g_popupform_active[e]=0,g_popupform_active_choose[e]=0}else g_datacache[e]={html:t.text,extra:t.extra};break;case"savepopupfillhtml":if(do_experimental_popupfill){var b=g_ischrome?gettaburl(a.sender.tab):gettaburl(a.tab);verbose_log("received popuphtml from tabid "+e+" url="+t.url+" but using url="+b),void 0===g_datacache[e]?g_datacache[e]={popuphtml:t.text,url:b,rowtype:t.rowtype}:g_datacache[e]={html:g_datacache[e].html,extra:g_datacache[e].extra,popuphtml:t.text,url:b,rowtype:t.rowtype},g_popupforminput[e]=[],g_popupform_active[e]=0,g_popupform_active_choose[e]=0}break;case"rebuildcontext":rebuildcontext(t.url);break;case"setbadgetext":setbadgetext(t.url);break;case"rebuildcontextonload":rebuildcontextonload();break;case"setbadgetextonload":setbadgetextonload();break;case"runhotkey":if(g_isfirefoxsdk){var H=getcurrenturl();if(ischromeurl(H)&&-1!=H.indexOf("prefs.html")||g_firefox_html_panel&&g_firefox_html_panel.isShowing&&ischromeurl(g_firefox_html_panel.url)&&-1!=g_firefox_html_panel.url.indexOf("prefs.html"))return}switch(t.hotkey){case"generateHk":opengenpw("hotkey");break;case"recheckHk":recheckpage();break;case"searchHk":opensearch();break;case"nextHk":fillnext(1);break;case"prevHk":fillnext(-1);break;case"homeHk":openvault();break;case"submitHk":fillnext(0,!0);break;case"saveallHk":saveall();break;case"logoffHk":loggedOut(!1,"hotkey");break;case"defaultffidHk":fill_default_ffid("hotkey");break;case"openpopoverHk":buttonclick()}break;case"reporterror":lpReportError(t.e,"");break;case"recheckpage":recheckpage(!0);break;case"copyusername":var y=void 0!==t.fromiframe&&t.fromiframe?1:0;copyusername(t.aid,y,e);break;case"copypassword":var y=void 0!==t.fromiframe&&t.fromiframe?1:0;copypassword(t.aid,null,y,e),sendLpImprove("copypass",{action:"sitepassword",source:t.source});break;case"copyurl":var y=void 0!==t.fromiframe&&t.fromiframe?1:0;copyurl(t.aid,y,e);break;case"editprofile":var j=void 0!==t.source&&t.source?t.source:"vault";editprofile(t.ffid,null,j);break;case"fillformffid":if(void 0!==t.fromiframe)var z=t.fromiframe;else var z=0;var Y=null;if(z&&!frame_and_topdoc_has_same_domain(e)){if(ftd_report_error(e,"fillform"),!lpConfirmYesNo(gs("Are you sure you would like your LastPass Form Fill information to be filled into the following site?")+"\n\n"+lp_gettld_url(ftd_get_frameparenturl(e))))return!1;Y=!0}var j=void 0!==t.source&&t.source?t.source:"vault";fillform(t.ffid,null,null,null,z,Y,j);break;case"addprofile":var j=void 0!==t.source&&t.source?t.source:"vault";addprofile(null,j);break;case"addcreditcard":var j=void 0!==t.source&&t.source?t.source:"vault";addcreditcard(null,j);break;case"clearforms":var j=void 0!==t.source&&t.source?t.source:"vault";clearforms(j);break;case"chooseprofilecc":var j=void 0!==t.source&&t.source?t.source:"vault";openchooseprofilecc(j);break;case"generate":opengenpw();break;case"fillcurrentaid":fillcurrent(t.aid);break;case"generatepasswordfound":g_checkgeneratepasswordcallback&&(g_checkgeneratepasswordcallback(),g_checkgeneratepasswordcallback=null);break;case"log":console_log(t.msg);break;case"disablebtn":var X="string"==typeof t.notificationdata?JSON.parse(t.notificationdata):t.notificationdata;openURL(base_url+X.multifactor_disable_url);break;case"createaccountbtn":g_hidecreate||LPPlatform.openTabDialog("createAccountSimple");break;case"tryagainbtn":open_login();break;case"custombtn":openURL(LPJSON.parse(t.notificationdata).customaction);break;case"feedbackbtn":openfeedback();break;case"starttrialbtn":start_trial();break;case"basicauthneverbtn":lpPutUserPref("basicauthnever","1"),lpWriteAllPrefs();break;case"basicauthmoreinfobtn":have_binary()?openURL(base_url+"chromebasicauth.php"):install_binary(!1,!0);break;case"gohome":var K="";if(void 0!==t.cmd2&&(K="?cmd="+encodeURIComponent(t.cmd2)),g_isedge){var $=(new Date).getTime();("undefined"==typeof g_last_gohome||$-g_last_gohome>1e3)&&(g_last_gohome=$,openURL(getchromeurl(VaultToggle.getVaultPage()+K),function(){chrome.tabs.remove(e)}))}else g_ischrome?chrome.tabs.update(e,{url:getchromeurl(VaultToggle.getVaultPage()+K)}):g_issafari||g_isfirefoxsdk?a.tab.url=getchromeurl(VaultToggle.getVaultPage()+K):g_isopera?a.tab.update({url:getchromeurl(VaultToggle.getVaultPage()+K)}):g_ismaxthon&&a.tab.navigate(getchromeurl(VaultToggle.getVaultPage()+K));""!=t.email&&""!=t.sesameotp&&(lplog("LOGGING OFF : gohome"),lplogoff(!1,"gohome"),sesame_setotp(t.sesameotp),openURL(getchromeurl("login.html?sesameusername="+encodeURIComponent(t.email))));break;case"checkattach":have_binary_function("choose_file")&&sendCS(e,{cmd:"canattach"},t.docnum);break;case"getattach":addAttach(function(){var a={};if(addattachcb(a),void 0!==a.mimetype){var n=enccbc(a.filename,AES.hex2bin(t.attachkey));enccbc(a.bytes,AES.hex2bin(t.attachkey),function(o){sendCS(e,{cmd:"gotattach",mimetype:a.mimetype,bytes:a.bytes,filename:n,encbytes:o},t.docnum)})}});break;case"openattach":openAttach(null,null,null,t.attachkey,t.data,t.mimetype);break;case"saveattach":exportAttachment(null,null,null,t.attachkey,t.data,t.mimetype);break;case"lpshownotificationtop":sendCS(e,{cmd:"lpshownotification",type:t.type,data:t.data,do_40notify:g_40notify},"all");break;case"getpopupfillsites":do_getpopupfillsites(e,t);break;case"setpopupfilllastactive":do_setpopupfilllastactive(e,t);break;case"addnevercrossdomain":lplog("XDOMAIN:Adding addnevercrossdomain url="+t.url);var u=lpcanonizeUrl(t.url),E="url="+en(AES.url2hex(u));E+="&type=3",g_neverurls.neverautologins.push(u),lpMakeRequest(base_url+"add_never.php",E,null,null),g_local_accts_version++,rewritelocalfile();break;case"deletenevercrossdomain":var u=t.url;"https://"==u.substring(0,8)?u=u.substring(8):"http://"==u.substring(0,7)&&(u=u.substring(7)),lplog("XDOMAIN:Deleting addnevercrossdomain url="+u);var Z=new Array;Z.type="neverautologins",Z.url=u,deleteNever(Z,!0);break;case"setpopupfillhint":do_setpopupfillhint(e,t);break;case"getisadmin":sendCS(e,{cmd:"gotisadmin",isadmin:g_isadmin},t.docnum);break;case"getloggedin":sendCS(e,{cmd:"gotloggedin",lploggedin:lploggedin},t.docnum);break;case"popupfillinputsave":do_popupfillinputsave(e,t);break;case"popupregister":do_popupregister(e,t);break;case"getnevers":handleGetNevers(e,t.url);break;case"popupfillresize":doPopupResize(e,t.width,t.height);break;case"popupfilliconnumber":var Q,ee;null==t&&(Q=-1,ee=-1),Q=null==t.sitenumber?-1:parseInt(t.sitenumber),ee=null==t.formfillsnumber?-1:parseInt(t.formfillsnumber),doPopupIconHint(e,Q,ee);break;case"popupfillinputfocusdecrement":do_popupfillinputfocusdecrement(e,t);break;case"popupfillinputfocusincrement":do_popupfillinputfocusincrement(e,t);break;case"popupfillinputfocuschoose":do_popupfillinputfocuschoose(e,t);break;case"popupfillinputmoreopen":do_popupfillinputmoreopen(e,t);break;case"popupfillinputshownavbar":do_popupfillinputshownavbar(e,t);break;case"lpimprove":sendLpImprove(t.event,t.properties);break;case"editaid":editAid(t.aid);break;case"openchooseprofilecc":var j=void 0!==t.source&&t.source?t.source:"vault";openchooseprofilecc(j);break;case"iframescrollenable":do_iframescrollenable(e);break;case"dologinaction":lploggedin||open_login();break;case"deleteformfill":var y=void 0!==t.fromiframe&&t.fromiframe?1:0,j=void 0!==t.source&&t.source?t.source:"vault";deleteformfill(t.ffid,null,y,e,null,null,j);break;case"setboolpref":t.includeuser?lpPutUserPref(t.name,t.value):lpPutGblPref(t.name,t.value),lpWriteAllPrefs();break;case"request_native_messaging":openURL(getchromeurl("native_messaging.html?hidenever=1"));break;case"checkduo":void 0!==t.uuid&&t.uuid&&""!=t.uuid&&setuuid(t.uuid,g_username_hash),closecurrenttab("duo.php"),outofband_auth("checkduo"+encodeURIComponent(t.code),"");break;case"closepopuptoplevel":closepopuptoplevel_handler(e,t);break;case"createpopuptoplevelfromframe":createpopuptoplevel_handler(e,t);break;case"cpwbot_click_ack":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("click_ack",e,t);break;case"cpwbot_fill_ack":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("fill_ack",e,t);break;case"cpwbot_finish_ack":g_cpwbot&&CPWbot_bg&&(!g_v2engine||CPWbot_bg.in_bagration()||CPWbot_bg.get_okstate()||CPWbot_bg.get_failstate()?CPWbot_bg.cpwbot_finish_ack_handler(e,t):CPWbot_bg.push_event_queue("finish_ack",e,t));break;case"cpwbot_validate_state_result":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("validate_response",e,t);break;case"ping_ack":ping_ack_handler(e,t);break;case"got_inner_text":got_inner_text_handler(e,t);break;case"got_inner_html":got_inner_html_handler(e,t);break;case"CS_unload":var te=t.docnum,u=t.url,ae=t.docstate;write_history({cmd:"CS_unload",docnum:te,tabid:e,docstate:ae}),L("received CS_unload from [tabid:"+e+"][docnum:"+te+"] docstate="+ae+" url="+u),null===te&&(te=find_docnum_for_tabid_by_url(e,u),L("CS_unload guessing assigned docnum to "+u+" is "+te),t.docnum=te),delete_cs_for_docnum(e,te),g_cpwbot&&CPWbot_bg&&(L("CS_unload clear score [tabid:"+e+"][docnum:"+te+"]"),CPWbot_bg.clear_frame_score(e,te,null),CPWbot_bg.push_event_queue("unload",e,t)),g_CS_tops&&g_CS_tops[e]===te&&clear_popup_heartbeat(e);break;case"cpwbot_js_ack":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.js_ack_handler(e,t),CPWbot_bg.push_event_queue("js_ack",e,t));break;case"minimize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1);break;case"maximize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0);break;case"copytoclipboard":void 0!==t.g_data&&copytoclipboard(t.g_data),t.action&&sendLpImprove("copypass",{action:t.action,source:t.source});break;case"debug_checkpoint":debug_checkpoint_handler(e,t);break;case"support_pwchg":if(!lploggedin)return!1;sendCS(e,{cmd:"support_pwchg",support:g_cpwbot,answer_loc:t.answer_location},g_CS_tops[e]);break;case"support_pwchg_batch":if(!lploggedin)return!1;sendCS(e,{cmd:"support_pwchg_batch",support:g_cpwbot_batch,answer_loc:t.answer_location},g_CS_tops[e]);break;case"auto_pwchg":if(!lploggedin)return!1;g_cpwbot&&lp_url_is_lastpass(t.url)&&(g_cpw_server_initiated_tabid=e,t.keep_in_frame?start_pwchange_from_server(e,t.aid):editAid(t.aid,null,!1,1));break;case"auto_pwchg_batch_alive":if(!lploggedin)return!1;if("undefined"==typeof g_batchpagealive)return;g_batchpagealive=!0;break;case"auto_pwchg_batch":if(!lploggedin)return!1;g_cpwfast=!0;if(g_cpwbot&&lp_url_is_lastpass(t.url)){if(CPWbatch||(CPWbatch=new CPWbatch_lib),t.n){var ne=t.n,oe=parseInt(ne);isNaN(oe)||(CPWbatch.m_max_workers=oe)}var re={};try{re=JSON.parse(t.aids)}catch(e){re={},console.error("JSON error, auto_pwchg_batch: "+e)}var ie;for(ie in re)re.hasOwnProperty(ie)&&CPWbatch.cpw_queue_push(re[ie]);g_cpw_server_initiated_tabid=e,t.keep_in_frame&&CPWbatch.cpw_batch_begin()}break;case"kill_batch_background":if(!lploggedin)return!1;CPWbatch&&CPWbatch.cpw_batch_end();break;case"auto_pwchg_hide":if(!lploggedin)return!1;g_cpwbot&&CPWbatch&&(end_pwchange_from_server(e,t.aid),CPWbatch.cpw_get_batchjob_state()&&CPWbatch.cpw_batch_end());break;case"auto_pwchg_status_update_ack":if(!lploggedin)return!1;g_cpwbot&&CPWbatch&&CPWbatch.cpw_set_status_update_ack();break;case"clear_popup_heartbeat":clear_popup_heartbeat(e);break;case"got_generate_pattern":var se=t.pattern_cooked,le=t.desc_cooked,_e="",ce="";se&&(_e=JSON.parse(se)),le&&(ce=JSON.parse(le)),g_generate_pw_pattern_hints[e]={pattern:_e,desc:ce};break;case"get_browser_history_tlds":get_browser_history_tlds(function(t){sendCS(e,{cmd:"got_browser_history_tlds",tlds:t.join()},g_CS_tops[e])});break;case"starttrial":start_trial()&&sendCS(e,{cmd:"trialstarted"},g_CS_tops[e]);break;case"from_selenium":if(g_cpwbot&&(!g_is_selenium&&CPWbot_bg&&CPWbot_bg.userlog(0,"Detected Selenium"),write_history({cmd:"SELENIUM",tabid:e,docnum:t.docnum,url:t.url,docstate:t.docstate,msg:"Selenium Bits: "+ie}),g_is_selenium=!0,void 0!==t.bits)){var ie=parseInt(t.bits);isNaN(ie)||(g_selenium_bits!=ie&&CPWbot_bg.userlog(0,"Selenium Bits: "+ie),g_selenium_bits=ie)}break;case"resizeIframe":case"moveIframe":e&&(void 0!==g_iframe_hack_src[e]?sendCS(e,t,g_CS_tops[e]):sendCS(e,t,"all"));break;case"get_plugin_capabilities":get_plugin_capabilities_handler(e);break;case"get_frame_loc":break;case"iframe_close_request":iframe_close_request_handler(e,t);break;case"savesite_dialog_changed":savesite_dialog_changed_handler(e,t);break;case"get_totp":get_totp(t.tld,e,null,t.name,t.id,t.className);break;case"usercacheset":g_usercache[t.tld]=t.username;break;case"ask_totp":g_ask_totp[e]=t.tld;break;case"oms_start":openvault(!1,"omsstart",function(e){sendLpImprove("oneminute::notificationomsstart",{provider:t.provider,elapsedTimeInSec:(Date.now()-notificationPopup.getNotificationSeenTimeStamp())/1e3})}),omsNotification.hidePopup();break;case"oms_cancel":localStorage_setItem(db_prepend("oms_state"),oneMinuteSignup.FeatureState.cancel),sendLpImprove("oneminute::notificationclose",{elapsedTimeInSec:(Date.now()-notificationPopup.getNotificationSeenTimeStamp())/1e3}),omsNotification.hidePopup();break;case"oms_postpone":localStorage_setItem(db_prepend("oms_state"),oneMinuteSignup.FeatureState.postpone),localStorage_setItem(db_prepend("oms_postponed_date"),Date.now()),sendLpImprove("oneminute::notificationnotnowclicked",{elapsedTimeInSec:(Date.now()-notificationPopup.getNotificationSeenTimeStamp())/1e3}),omsNotification.hidePopup();break;default:return L("CS["+e+"] -> BG : INVALIDMSG"),!1}return!0}function get_totp(e,t,a,n,o,r){if(void 0!==g_usercache[e]){if(!a&&void 0!==g_last_get_totp[e]&&(new Date).getTime()-g_last_get_totp[e]<25e3)return void lpReportError("skipped totp2push for domain="+e+" because we already did it within the past 25 seconds");g_last_get_totp[e]=(new Date).getTime();var i="tld="+encodeURIComponent(e)+"&usernamehash="+encodeURIComponent(SHA256(g_usercache[e].trim().toLowerCase()))+"&token="+encodeURIComponent(g_token);a&&(i+="&api_token="+encodeURIComponent(a)),n&&(i+="&name="+encodeURIComponent(n)),o&&(i+="&id="+encodeURIComponent(o)),r&&(i+="&className="+encodeURIComponent(r)),lpMakeRequest(base_url+"get_totp.php",i,function(i){if(4==i.readyState&&200==i.status&&null!=i.responseXML&&null!=i.responseXML.documentElement){var s=i.responseXML.documentElement.getElementsByTagName("ok");if(s.length>0){var l=s[0].getAttribute("status");if("allowed"==l){var _=s[0].getAttribute("totp_code");sendCS(t,{cmd:"got_totp",tld:e,totp_code:_})}else if("poll"==l){if(!a){var c=!1;void 0!==g_totp.domains&&void 0!==g_totp.domains.disabled&&void 0!==g_totp.domains.disabled.all&&g_totp.domains.disabled.all?c=!0:void 0!==g_totp.domains&&void 0!==g_totp.domains.disabled&&void 0!==g_totp.domains.disabled[e]&&g_totp.domains.disabled[e]&&(c=!0),c||sendCS(t,{cmd:"getting_totp",tld:e})}get_totp(e,t,s[0].getAttribute("token"),n,o,r)}else"declined"==l&&(a||sendCS(t,{cmd:"set_totp_form",tld:e}))}}},function(){})}}function open_login(e,t){skiplogin()||getsinglefactortype(function(a){if(!t&&"trueapi"==a&&have_binary_function("trueapi_default_login_exists"))return void call_binary_function("trueapi_default_login_exists",function(t){t?call_binary_function("trueapi_get_default_login",function(t){if(""!=t){var n=t.split("|");if(3==n.length){var o=atob(n[0]),r=atob(n[1]),i=atob(n[2]);return multifactor_setdata("password_offline",i),multifactor_setdata("type",a),g_manual_login=!0,void LP_do_login(o,r,null,null,!0)}}open_login(e,!0)}):open_login(e,!0)});if(!t&&(LPISUPEK||"vtapi"==a)&&have_binary_function("lpvt_verify_user")){var n=encodeURIComponent(lpCreatePass(8,1,1,1,0,1,0,1));return void call_binary_function("lpvt_verify_user",n,gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(t){if(""!=t){var a=t.split("|");if(2==a.length)return g_manual_login=!0,void LP_do_login(decodeURIComponent(a[0]),decodeURIComponent(a[1]))}if(LPISUPEK&&LPISLOC)return void call_binary_function("lpvt_has_data",function(e){e?lpshowError("LoginError",!1,!0):lpshowError("Before you can use LastPass, you must first connect your fingerprint reader and enroll one or more fingers.",!1,!0)});open_login(e,!0)})}if(!t&&"validity"==a&&have_binary_function("validity_verify_user"))return void call_binary_function("validity_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(t){if(""!=t){var a=t.split("|");if(2==a.length)return g_manual_login=!0,void LP_do_login(decodeURIComponent(a[0]),decodeURIComponent(a[1]))}open_login(e,!0)});if(!t&&"winbio"==a&&have_binary_function("winbio_verify_user"))return void call_binary_function("winbio_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(t){if(""!=t){var a=t.split("|");if(2==a.length)return g_manual_login=!0,void LP_do_login(decodeURIComponent(a[0]),decodeURIComponent(a[1]))}open_login(e,!0)});if(!t&&"nymi"==a&&have_binary_function("nymi_validate"))return void call_binary_function("nymi_validate",function(t){if(""!=t){var a=t.split("|");if(2==a.length)return g_manual_login=!0,void LP_do_login(decodeURIComponent(a[0]),decodeURIComponent(a[1]))}open_login(e,!0)});try{if("function"==typeof is_fennec&&is_fennec())return void openURL(getchromeurl("login.html"));if(shouldOpenLogin4_0())return void LPPlatform.openLoginPopover();if(g_issafari&&"undefined"!=typeof SafariExtensionPopover)for(var o=safari.application.activeBrowserWindow,r=0;r<safari.extension.toolbarItems.length;r++){var i=safari.extension.toolbarItems[r];if(o==i.browserWindow&&-1!=i.identifier.indexOf("LPToolButton")){var s=LPPlatform.getPopover("LPPopoverMenu");return s.width=310,s.height=380,s.contentWindow.showwin(i.popover.width,i.popover.height,getchromeurl("login.html?inline=1")),i.popover=s,void i.showPopover()}}}catch(e){g_can_open_popover=!1}g_isfirefoxsdk&&"undefined"!=typeof g_panel?open_login_panel():VaultToggle.useVault4_0()?LPPlatform.openTabDialog("loginSimple"):openURL(getchromeurl("login.html"))})}function open_login_panel(){shouldOpenLogin4_0()?LPPlatform.openLoginPopover():null!=g_badgedata?showFirefoxPanel():(g_firefox_login_panel=g_panel.Panel({width:400,height:g_is_linux?425:400,contentURL:getchromeurl("login.html?skip_pagemod=1&inline=1"),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",onHide:function(){g_firefox_button.state("window",{checked:!1}),closePop()},contextMenu:!0}),g_firefox_login_panel.port.on("message",function(e){e.target=g_firefox_login_panel,message_handler(e)}),g_firefox_login_panel.show({position:g_firefox_button}))}function closePop(){LPPlatform.closePopovers()}function fillnext(e,t){if(!lploggedin)return void open_login();get_selected_tab(null,function(a){var n=getBG();n.setcurrenttabid(gettabid(a)),n.setcurrenturl(gettaburl(a));var o=getmatchingsites(1);if(o.length>0){for(var r=0;r<o.length&&o[r].aid!=g_curr_fill_aid;r++);r==o.length?g_curr_fill_aid=-1==e?o[o.length-1].aid:o[0].aid:(1==e?++r>=o.length&&(r=0):-1==e&&--r<0&&(r=o.length-1),g_curr_fill_aid=o[r].aid),t?(fill({tabid:getcurrenttabid(),acct:g_sites[g_curr_fill_aid],docid:null,submit:!0,doconfirm:!1,docnum:"all",allowforce:!1,skip_pwprotect:!1,manualfill:!0,desc:"fill_A1",source:"notrack"}),sendLpImprove("sitelogin",{copy:0,autologin:g_sites[g_curr_fill_aid].autologin?1:0,source:"hotkey"})):(fillaid(g_curr_fill_aid,!1,"notrack"),sendLpImprove("sitelogin",{copy:0,autologin:g_sites[g_curr_fill_aid].autologin?1:0,source:"hotkey"}))}})}function getInt(e){var t=parseInt(e);return""!=t&&NaN!=t||(t=0),t}function loggedIn(e){if(L("BG : loggedIn"),lploggedin=!0,server_tries=0,lpReadAllPrefs(postlogin),"undefined"!=typeof localStorage){var t=localStorage_getItem(db_prepend("lastversion")),a=!1;localStorage_setItem(db_prepend("lastversion"),lpversion)||(a=!0),a||checkOpenUpgradePage(t);var n=opendb();createSavedLoginsTable(n),n&&(g_indexeddb?n.transaction("LastPassSavedLogins2","readonly").objectStore("LastPassSavedLogins2").openCursor(IDBKeyRange.only(g_username)).onsuccess=function(e){e.target.result&&""!=e.target.result.value.password&&(g_master_password_saved=!0)}:n.transaction(function(e){e.executeSql("SELECT * FROM LastPassSavedLogins2 WHERE username = ? AND password != ''",[g_username],function(e,t){t.rows.length>0&&(g_master_password_saved=!0)},function(e,t){})})),hydratetopsites(),e&&setTimeout(function(){refresh_windows()},500),CPWbot_bg=new CPWbot_bg_lib,drawIconAtRotation(0),sendTS({cmd:"login"}),Topics.get(Topics.LOGIN).publish(),LPTabs.get({interface:"ContentScriptInterface"}).forEach(function(e){e.forEachWindow({each:function(e){void 0!==e.Topics&&e.Topics.publish(Topics.LOGIN)}})})}}function checkOpenUpgradePage(e){if(g_showupgradenotes){var t=e,a=lpversion,n=0,o=0,r=0,i=0;if(t)for(var s=t.split("."),l=0;l<s.length;l++)0==l?n=parseInt(s[l]):1==l?o=parseInt(s[l]):2==l&&parseInt(s[l]);for(var _=a.split("."),l=0;l<_.length;l++)0==l?r=parseInt(_[l]):1==l?i=parseInt(_[l]):2==l&&parseInt(_[l]);t&&"null"!=t&&(r>n||i>o)&&(L("Lastversion: "+e+" this version: "+lpversion+" amaj:"+n+" aminor:"+o+" bmaj:"+r+" bminor:"+i),openURL(base_url+"upgrade.php?ver="+lpversion+"&lastver="+e+"&type="+encodeURIComponent(get_method())+"&upgrade="+t))}}function get_searchNotesPref(){return 1==lpGetPref("searchNotes",1)}function postlogin(){var e=(new Date).getTime();g_lastpollcheck=lastlogin=e,1==lpGetPref("logoffWhenCloseBrowser",0)&&lpGetPref("logoffWhenCloseBrowserVal",0)>0&&(lpPutUserPref("lastpollcheck",g_lastpollcheck),lpWriteAllPrefs()),drawIconAtRotation(0),g_offer_popupfill&&(do_experimental_popupfill=1==lpGetPref("usepopupfill",1))&&0==lpGetPref("changedpopupfill",0)&&(lpPutUserPref("showFormFillNotifications",0),lpPutUserPref("showFillNotificationBar",0),lpPutUserPref("showGenerateNotifications",0),lpPutUserPref("showNotificationsAfterClick",0),lpPutUserPref("changedpopupfill",1),lpWriteAllPrefs())}function lplogin(){open_login()}function lplogoff(e,t){loggedOut(!1,void 0!==t?t:"lplogoff")}function lplogoff_if(){lploggedin&&loggedOut(!1,"lplogoff_if")}function animateFlip(){rotation+=1/36,rotation>=1&&(rotation-=1),++currrotation>=numrotations?rotation=0:setTimeout(function(){animateFlip()},10),drawIconAtRotation(rotation)}function drawIconAtRotation(e){if(!is_guiless()){if(g_issafari){for(var t=0;t<safari.extension.toolbarItems.length;t++)-1!=safari.extension.toolbarItems[t].identifier.indexOf("LPToolButton")&&(!g_badgedata||"notification"!=g_badgedata.cmd||"alert"!=g_badgedata.type&&"mpwchange"!=g_badgedata.type?g_badgedata&&"notification"==g_badgedata.cmd&&"lpalert"==g_badgedata.type?safari.extension.toolbarItems[t].image=getchromeurl(get_safari_version()<6?"icon_breach_safari_16px.png":"icon_breach_safari.png"):g_badgedata&&"notification"==g_badgedata.cmd&&"error"==g_badgedata.type?safari.extension.toolbarItems[t].image=getchromeurl(get_safari_version()<6?"icon_breach_safari_16px.png":"icon_breach_safari.png"):get_safari_version()<6?safari.extension.toolbarItems[t].image=getchromeurl(lploggedin?"icon_on_16px.png":"icon_off_16px.png"):safari.extension.toolbarItems[t].image=getchromeurl(lploggedin?"icon_on.png":"icon_off.png"):safari.extension.toolbarItems[t].image=getchromeurl(get_safari_version()<6?"icon_breach_safari_16px.png":"icon_breach_safari.png"));return void update_menus()}if(g_isopera)return void setTimeout(function(){lploggedin?g_opera_button.icon!=get_icon(ICON_RED)&&(g_opera_button.icon=get_icon(ICON_RED),g_opera_button.popup.width="450px",g_opera_button.popup.height="450px",g_opera_button.popup.href=getchromeurl("lp_toolstrip.html?browseraction=1")):g_opera_button.icon!=get_icon(ICON_GRAY)&&(g_opera_button.icon=get_icon(ICON_GRAY),g_opera_button.popup.width="1px",g_opera_button.popup.height="1px",g_opera_button.popup.href=getchromeurl("lp_toolstrip.html?browseraction=1"))},0);if(g_ismaxthon)return void window.external.mxGetRuntime().icon.setIconImage(lploggedin?"icon":"icon_gray");if(g_isfirefoxsdk)return void(g_firefox_button&&(null!=g_badgedata?"notification"==g_badgedata.cmd&&"save"==g_badgedata.type?g_firefox_button.icon={19:self.data.url(get_icon(ICON_GREEN)),38:self.data.url(get_icon(ICON_GREEN_CHROME))}:"notification"!=g_badgedata.cmd||"lpalert"!=g_badgedata.type&&"mpwchange"!=g_badgedata.type?g_firefox_button.icon={19:self.data.url(get_icon(ICON_YELLOW)),38:self.data.url(get_icon(ICON_YELLOW_CHROME))}:g_firefox_button.icon={19:self.data.url(get_icon(ICON_BREACH)),38:self.data.url(get_icon(ICON_BREACH_CHROME))}:lploggedin?g_firefox_button.icon={19:self.data.url(get_icon(ICON_RED)),38:self.data.url(get_icon(ICON_RED_CHROME))}:g_firefox_button.icon={19:self.data.url(get_icon(ICON_GRAY)),38:self.data.url(get_icon(ICON_GRAY_CHROME))}));if(!g_iscasper&&g_ischrome){var a,n;null!=g_badgedata?"notification"==g_badgedata.cmd&&"save"==g_badgedata.type?(n=get_icon(ICON_GREEN_CHROME),a=get_icon(ICON_GREEN)):"notification"==g_badgedata.cmd&&"alert"==g_badgedata.type?(a=get_icon(ICON_YELLOW),n=get_icon(ICON_YELLOW_CHROME)):"notification"!=g_badgedata.cmd||"lpalert"!=g_badgedata.type&&"mpwchange"!=g_badgedata.type?(a=get_icon(ICON_YELLOW),n=get_icon(ICON_YELLOW_CHROME)):(a=get_icon(ICON_BREACH),n=get_icon(ICON_BREACH_CHROME),set_badge_text("")):lploggedin?(a=get_icon(ICON_RED),n=get_icon(ICON_RED_CHROME)):(a=get_icon(ICON_GRAY),n=get_icon(ICON_GRAY_CHROME));var o={19:a,38:n};chrome.browserAction.setIcon({path:o}),"function"==typeof chrome.browserAction.setPopup&&getsinglefactortype(function(e){"mpwchange"==g_notification_type?chrome.browserAction.setPopup({popup:"mpwchange.html?domain="+encodeURIComponent(g_notification_data.domain)+"&requirechangereuse="+(requirechangereuse()?"1":"0")}):chrome.browserAction.setPopup({popup:!g_ask_native_messaging_from_button&&(lploggedin||null!=g_badgedata||""==e&&1==lpGetPref("enablenewlogin",1))?VaultToggle.useVault4_0()?"extensionLogin.html":"lp_toolstrip.html?browseraction=1":""})})}}}function ease(e){return(1-Math.sin(Math.PI/2+e*Math.PI))/2}function lpAddRejectedSite(e,t,a){var n=new lpobjrejectedaddsite;n.username=e,n.encryptedPassword=lpenc(t),n.tld=a,n.rejectedTime=lp_get_gmt_timestamp(),g_rejectedaddsites[g_rejectedaddsites.length]=n}function loggedOut(e,t){L("BG : loggedOut from="+t);var a=lpGetPref("clearfilledfieldsonlogoff",0);g_manual_login=!1,get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var a=0;a<get_tabs_length(e[t]);a++){var n=gettaburl(get_tabs(e[t])[a]);n&&lp_url_is_lastpassext(n)&&-1==n.indexOf(VaultToggle.getVaultPage())&&-1==n.indexOf("welcome.html")&&-1==n.indexOf("mathfail.html")&&-1==n.indexOf("login.html")&&-1==n.indexOf("native_messaging.html")&&-1==n.indexOf("dialog=login")&&-1==n.indexOf("dialog=createAccountSimple")&&close_tab(get_tabs(e[t])[a])}}),lploggedin&&(LPPlatform.closePopovers(),lpnp_notify("logout")),notifications_closeall(),closeallnotifications(),closeallclickables(),deleteallattachments(!0),yubikey_cleardata(),googleauth_cleardata(),outofband_cleardata(),securityquestion_cleardata(),sesame_cleardata(),grid_cleardata(),multifactor_cleardata();var n=!1;if(lploggedin||(n=!0),lploggedin=!1,last_idle_check=0,g_local_key=null,g_local_key_hex=null,g_local_hash=lphash=null,g_local_key_hash=null,g_username=lpusername=null,lphash=null,g_username_hash=null,lpusername_hash=null,lpmpstrength=null,lpsendmpstrength=!1,lpsendchallengescore=!1,g_uid=lpuid=null,g_pwdeckey=null,g_sites={},g_tlds={},g_securenotes=new Array,g_applications=new Array,g_prompts=new Array,g_icons=new Array,g_bigicons={},g_icons_length=0,g_multifactorscore=0,g_disablepwalerts=-1,g_local_accts_version=-1,g_server_accts_version=-1,lp_server_attach_version=-1,lp_local_attach_version=-1,g_identities=new Array,g_pendings=new Array,g_shareeautopushes=new Array,g_formfills=new Array,g_emer_sharees=[],g_emer_sharers=[],g_pending_shares=[],g_totp={},g_neverurls=new Array,g_equivalentdomains={},g_urlrules=new Array,g_prefoverrides={},g_loglogins=!1,g_isadmin=!1,g_iscompanyadmin=!1,g_showcredmon=!1,g_launches=new Array,g_fillfieldsmatches=new Array,g_fillfieldsmatchescurridx=new Array,g_loggedinoffline=!1,g_loggedinonline=!1,lp_phpsessid="",g_premium_exp=0,g_enterpriseuser=0,g_enterprisemodel=0,g_loginstarted=!1,lpReadAllPrefs(),rotation=0,drawIconAtRotation(),null!=g_badgedata&&("notification"!=g_badgedata.cmd||"error"!=g_badgedata.type&&"mpwchange"!=g_badgedata.type)&&clear_badge(),rsa_clearvars(),rsa_setpendingsharests(!0),g_genpws=new Array,g_master_password_saved=!1,g_persistent_notifications=new Array,g_rejectedaddsites=new Array,g_shares=new Array,lp_attaches=new Array,g_datacache=[],lpdisableoffline=!1,countryfromip="",g_flags={},g_privkeyattempts=0,sendTS({cmd:"logoff"}),g_generate_pw_pattern_hints={},g_popupfill_hint={},g_popupfill_hint_generate={},g_popupfill_hint_save={},g_popupfill_hint_type={},g_popupfill_last_active={},g_popupfill_last_active_fieldid={},g_popupfill_last_active_fieldtype={},g_popup_tab_docnum=[],g_popup_url_by_tabid=[],g_iframe_hack_src=[],g_pending_pw_change={},OVERRIDENOREFRESH=!0,n||setTimeout(function(){refresh_windows(OVERRIDENOREFRESH)},500),!e){var o="";g_token&&g_token.length&&(o+="&token="+encodeURIComponent(g_token)),lpMakeRequest(base_url+"logout.php?chrome_plugin=1&noredirect=1",o,null,null)}g_token="",LPServer.clearCSRFToken(),"undefined"!=typeof g_oldpbkdf2&&(g_oldpbkdf2=0),update_menus(!0),0!=a&&clear_all_filled_fields(),g_fillfield_confirm_perfield={},g_fillfield_did_fillbest={},g_popupfill_hint={},g_popupfill_hint_generate={},g_popupfill_hint_save={},g_popupfill_last_active={},g_popupfill_last_active_fieldid={},g_popupfill_last_active_fieldtype={},g_popupfill_save_data={},g_popupforminput=[],g_cpwbot&&CPWbot_bg&&"object"==typeof CPWbot_bg&&(CPWbot_bg.logout(),CPWbot_bg=null),g_cpw_server_initiated_tabid=null,g_cpw_aid_queue=[],g_cpwbot&&CPWbatch&&"object"==typeof CPWbatch&&(CPWbatch.cpw_set_batchjob_state(F_NONE),CPWbatch.logout(),CPWbatch=null),cleardeccache(),clear_badge_text(),shutdown_push_listener(),g_usercache={},LPContentScriptFeatures={intro_tutorial_version:LPContentScriptFeatures.intro_tutorial_version},Topics.get(Topics.CLEAR_DATA).publish(),LPTabs.get({interface:"ContentScriptInterface"}).forEach(function(e){e.forEachWindow({each:function(e){void 0!==e.Topics&&e.Topics.publish(Topics.CLEAR_DATA)}})})}function deleteallattachments(e){have_binary_function("delete_files_by_extension")&&(e||lp_get_gmt_timestamp()>g_last_openattach+25)&&call_binary_function("delete_files_by_extension","","*",!0)}function getmenurowheight(){return 20}function getmatchingsitesheight(e){var t=e.length*getmenurowheight();return t>200&&(t=200),t}function getmenuheight(e,t,a,n){var o=15;(g_premium_exp>lp_get_local_timestamp()||g_enterpriseuser)&&--o;var r=getmenurowheight(),i=o*r;if(void 0===e||e){var s=getmatchingsites();s.length>0&&(i+=r,i+=getmatchingsitesheight(s))}return(void 0===t||t)&&(i+=32),(void 0===a||a)&&(i+=15),n&&(i-=50),i}function fillaid(e,t,a){if(!g_sites||!lploggedin)return!1;write_history({cmd:"fillaid",aid:e});var n=!!t;g_last_launch[e]=(new Date).getTime();var o=g_sites[e];return void 0!==o&&"autofill"!==a&&"notrack"!==a&&(a?sendLpImprove("sitelogin",{copy:0,autologin:o.autologin,source:a}):sendLpImprove("sitelogin",{copy:0,autologin:o.autologin,source:"hotkey"}),a="notrack"),void 0!==o&&o&&"1"==o.basic_auth?(setTimeout(function(){fill({tabid:getcurrenttabid(),acct:g_sites[e],docid:null,submit:!1,doconfirm:!0,docnum:"all",allowforce:!0,skip_pwprotect:n,manualfill:!0,desc:"fill_A2",source:a})},100),!0):fill({tabid:getcurrenttabid(),acct:g_sites[e],docid:null,submit:!1,doconfirm:!0,docnum:"all",allowforce:!0,skip_pwprotect:n,manualfill:!0,desc:"fill_A3",source:a})}function setcurrenturl(e){g_currenturl=e}function setcurrenttabid(e){g_currenttabid=e}function addFormfillTab(e){g_tabsWithForms.includes(e)||g_tabsWithForms.unshift(e)}function removeFormfillTab(e){g_tabsWithForms.indexOf(e)>-1&&g_tabsWithForms.splice(g_tabsWithForms.indexOf(e),1)}function getmatchingsites(e,t,a){var n=getcurrenturl(),o=(lpcanonizeUrl(n),lp_gettld_url(n)),r=getsites(o);r=reorderOnURL(r,n,t,a);var i,s,l,_=[];for(i in r)s=r[i].aid,void 0!==g_sites[s]&&(l=g_sites[s],_.push({aid:l.aid,name:l.name,username:getusernamefromacct(l),fiid:l.fiid,type:"account"}));if(g_tabsWithForms.includes(getcurrenttabid())&&LPContentScriptFeatures.omaria)for(noteId in g_securenotes){var c=g_securenotes[noteId],g=c.notetype;isFillableNoteType(g)&&_.push({aid:c.aid,name:c.name,fiid:c.fiid,type:"note"})}return _}function getnevers(){var e=getcurrenturl(),t=lp_gettld_url(e),a=lpcanonizeUrl(e),n=[];return getneverfor(n,"neveraccounts",a,t),getneverfor(n,"neverautologins",a,t),getneverfor(n,"neverformfills",a,t),getneverfor(n,"nevergenerates",a,t),getneverfor(n,"neverautofills",a,t),getneverfor(n,"nevershowicons",a,t),getneverfor(n,"neverenablelp",a,t),n}function getneverfor(e,t,a,n){if(g_neverurls[t]&&g_neverurls[t].length>0)for(var o=0;g_neverurls[t]&&o<g_neverurls[t].length;o++){var r=g_neverurls[t][o];r==a?e.push({type:t,url:r,domain:0}):r==n&&e.push({type:t,url:r,domain:1})}}function getsites(e,t,a){var n,o={};if(void 0===e||null===e||void 0===g_equivalentdomains||null===g_equivalentdomains)return o;if(void 0!==g_equivalentdomains[e]){var r=g_equivalentdomains[e];void 0!==g_equivalentdomains[r]&&(n=g_equivalentdomains[r])}else n=[e];if(void 0!==n)for(var i=0;i<n.length;i++)if(void 0!==g_tlds[n[i]])for(var s in g_tlds[n[i]])if(void 0!==g_sites[s]){if(t){if(g_sites[s].genpw)continue;var l=issharedfolder(g_shares,g_sites[s].group);if(!checkreadonly(l,!0))continue}check_ident_aid(g_sites[s].aid)&&(a&&g_sites[s].aid==a||a&&-1!=a.indexOf(","+g_sites[s].aid+",")||(o[s]=g_tlds[n[i]][s]))}return o}function accthaspassword(e){if(!e)return!1;if(e.save_all){for(var t=0;t<e.fields.length;t++)if("password"==e.fields[t].type&&""!=e.fields[t].value)return!0;return!1}return""!=e.password}function lp_url_is_lastpass(e,t){if(null==e||g_skipurltest&&t)return!1;var a=/^https:\/\/([a-z0-9-]+\.)?lastpass\.(eu|com)\//i;if(0==e.indexOf(base_url)||0==e.indexOf("https://lastpass.com/"))return!0;if("undefined"!=typeof g_loosebasematching){var n=lp_gettld_url(e);return new RegExp(n+"/$").test(base_url)}return a.test(e)}function lp_url_is_lastpassext(e){var t=getchromeurl("",!0);return!(!e||0!=e.indexOf(t))}function openvault(e,t,a){if(!e&&!lploggedin)return void open_login();var n=""==g_vaulturloverride?getchromeurl(VaultToggle.getVaultPage()):g_vaulturloverride;t&&(n+="?cmd="+t),e?get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var o=0;o<get_tabs_length(e[t]);o++){var r=gettaburl(get_tabs(e[t])[o]);if(r==n)return}openURL(n,a)}):openURL(n,a)}function openurlifnotopen(e){get_all_windows({populate:!0},function(t){for(var a=0;a<t.length;a++)for(var n=0;n<get_tabs_length(t[a]);n++){var o=gettaburl(get_tabs(t[a])[n]);if(o==e)return}openURL(e)})}function openimport(){if(lploggedin)if((g_is_win||g_is_mac||g_is_linux)&&have_binary_function("choose_file")){var e="import_other.html";openURL(getchromeurl(e))}else{unlock_plug2web();var e=base_url+"import.php?hasplugin="+LP.en(lpversion)+get_identity_param();lppassusernamehash&&(e=base_url+"gettopost.php?posturl="+LP.en(e)),openURL(e)}}function doimport(e,t){var a=function(a){if(lpimportdata=a,""!=lpimportdata&&null!=lpimportdata){lpimportsource=e,unlock_plug2web();var n=base_url+"import.php?fromplugin=1"+get_identity_param();lppassusernamehash&&(n=base_url+"gettopost.php?posturl="+LP.en(n)),openURL(n)}else t&&alertfrombg(gs("That file is missing or empty.  Please enter the full path of the file to import."))};"wlan"==e?(e="csv",call_binary_function("wlan_pull_csv",a)):"safari"==e?(e="csv",call_binary_function("get_safari_passwords",a)):"opera"==e?(e="csv",call_binary_function("get_opera_passwords",a)):"firefox"==e?(e="csv",g_passwords.search({onComplete:function(e){for(var t="url,username_field,username,password_field,password\n",n=0;n<e.length;n++)t+=csv_encode(e[n].url?e[n].url:"")+","+csv_encode(e[n].usernameField?e[n].usernameField:"")+","+csv_encode(e[n].username?e[n].username:"")+","+csv_encode(e[n].passwordField?e[n].passwordField:"")+","+csv_encode(e[n].password?e[n].password:"")+"\n";a(t)}})):t?call_binary_function("read_file",t,!0,a):call_binary_function("choose_file",null,null,null,!0,function(e){e&&(e=atob(e)),a(e)})}function openimportchrome(){openURL(getchromeurl("import.html"))}function openexport(){lploggedin&&doexport()}function wlanexport(e){if(1==lpGetPref("noexport",0))return void alertfrombg(gs("CompanyPolicyProhibits"));if(!have_binary())return void(confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&install_binary());if(!g_wlan_works)return void(g_wlan_has_exe?alertfrombg(gs("No Wi-Fi adapter was detected on this computer.  This feature requires a Wi-Fi adapter.")):confirm(gs("The LastPass Wi-Fi utility was not detected on this computer.  Would you like to run the LastPass Universal Installer in order to install it?"))&&openbaseurl("installer/"));if(!g_generatedpw&&!e)return void security_prompt(function(){wlanexport(!0)});var t="";for(var a in g_securenotes)if(check_ident_aid(a)){var n=lpmdec_acct(g_securenotes[a].extra,!0,g_securenotes[a],g_shares);"Wi-Fi Password"==getNoteValue("NoteType",n)&&(t+=n+"\n\n")}""!=t&&(loglogin("export"),call_binary_function("wlan_push",t))}function openlastpassexport(e){if(1==lpGetPref("noexport",0))return void alertfrombg(gs("CompanyPolicyProhibits"));if(!have_binary_function("write_file")||!have_binary_function("get_path"))return void alertfrombg(gs("The binary version of the LastPass plugin is required for this operation. It can be downloaded from lastpass.com."));if(!g_generatedpw&&!e)return void security_prompt(function(){openlastpassexport(!0)});var t=rewritelocalfile(!1,!0,!0);loglogin("export"),can_save_file()?setTimeout(function(){call_binary_function("save_file",t,gs("XML Files"),"*.xml",!1,"xml",gs("If not specified, will use a file extension of:"))},1e3):(call_binary_function("write_file","lpexport.xml",t),call_binary_function("get_path",function(e){alertfrombg(gs("Your data has been exported to")+"\n"+e+"lpexport.xml")}))}function openprint(e){unlock_plug2web();var t=base_url+"export.php?plug=1&print=1&hasplugin="+LP.en(lpversion)+get_identity_param();e&&(t+="&notes=1"),lppassusernamehash&&(t=base_url+"gettopost.php?posturl="+LP.en(t)),openURL(t)}function openprefs(e){VaultToggle.useVault4_0()?LPPlatform.openTabDialog("preferences"):(e&&(g_pref_tab=e),openURL(getchromeurl(g_isopera?"options.html":"prefs.html")))}function openhelp(e){var t=g_helpurl;e&&(t+="&topic="+e),openURL(t)}function openpremium(){openURL(base_url+"premium.php")}function openentconsole(){openURL(base_url+"company/#/dashboard")}function openFamilyConsole(){openURL(base_url+"family/#/users/")}function openAllSites(e){for(var t=0;t<e.length;t++){var a=e[t];g_last_launch[a.aid]=(new Date).getTime(),openURL(a.url,function(e,t){console_log("setting aid "+gettabid(e)+" "+t),g_launches[gettabid(e)]=t},a.aid,!0)}}function openall(e,t){var a=null;if(e==gs("favorites"))openfavorites();else if(e==gs("recently usedlower"))openallrecent();else{var n=new Array,o=!1;for(var r in g_sites)check_ident_aid(g_sites[r].aid)&&g_sites[r].group==e&&"http://group"!=g_sites[r].url&&(n.push(g_sites[r]),o|=g_sites[r].pwprotect,null==a&&g_sites[r].pwprotect&&(a=r));if(0==n.length)return;if(!t&&(o||g_prompts.login_site_prompt))return void security_prompt(function(){openall(e,!0)},null,!0,!0,a,!1);openAllSites(n)}}function openallrecent(e){var t=new Array;for(var a in g_sites)check_ident_aid(g_sites[a].aid)&&t.push(g_sites[a]);t.sort(function(e,t){return e.last_touch>t.last_touch?1:-1});for(var n=new Array,o=!1,a=0;n.length<10&&a<t.length;a++)"http://group"!=t[t.length-a-1].url&&(o|=t[t.length-a-1].pwprotect,n[n.length]=t[t.length-a-1]);if(0!=n.length){if(!e&&(o||g_prompts.login_site_prompt))return void security_prompt(function(){openallrecent(!0)});for(var a=0;a<n.length;a++){var r=n[a];g_last_launch[r.aid]=(new Date).getTime(),openURL(r.url,function(e,t){console_log("setting aid "+gettabid(e)+" "+t),g_launches[gettabid(e)]=t},r.aid,!0)}}}function openfavorites(e,t){var a=new Array,n=!1;for(var o in g_sites)check_ident_aid(g_sites[o].aid)&&"1"==g_sites[o].fav&&(a.push(g_sites[o]),n|=g_sites[o].pwprotect);if(0==a.length)return void alertfrombg(gs("NoFavorites"));if(!e&&(n||g_prompts.login_site_prompt))return void security_prompt(function(){openfavorites(!0)});for(var o=0;o<a.length;o++){var r=a[o];g_last_launch[r.aid]=(new Date).getTime(),openURL(r.url,function(e,t){console_log("setting aid "+gettabid(e)+" "+t),g_launches[gettabid(e)]=t},r.aid,!0)}var i={};void 0!==t&&(i={source:t}),sendLpImprove("openfavorites",i)}function addAttach(e){(g_is_win||g_is_mac||g_is_linux)&&have_binary_function("choose_file")?(g_attachname=g_attachbytes="",call_binary_function("choose_file",!0,"","",!0,function(t){if("string"==typeof t&&t.length){var a=t.indexOf("\n"),n=t.substr(0,a),o=t.substr(a+1);3*o.length/4>10485762?alertfrombg(gs("File too large, it must be less than 10MB.")):(g_attachname=n.replace(/\\/g,"/").replace(/.*\//,""),g_attachbytes=o)}e&&e({name:g_attachname,bytes:g_attachbytes})})):confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&install_binary()}function showImageAttach(e){g_img_data=e,openURL(getchromeurl("img.html"))}function canSaveAttach(){return!!have_binary_function("write_file")}function openAttach(e,t,a,n,o,r){if(console.error("OpenAttach: Opening attachid "+t+" for site "+e),!lploggedin)return void console.error("OpenAttach: while not logged in!");if(!have_binary_function("run_file")||!have_binary_function("write_file")){return void alertfrombg(gs("This feature is not available in this version. Please install the binary extension by going to https://lastpass.com/dl"))}if(a&&""!=a)return void alertfrombg(gs("This attachment needs to be saved first."));var i=function(s){console.error("OpenAttach: In callback, decrypting");var l=void 0!==s&&s?s:"unknown";lpdec(o,AES.hex2bin(n),function(_){if(console.error("OpenAttach: in dec cb"),!_){if(!o||0==o.length){var c=get_attach_info(t),g=getacct(e);if(c&&g&&"retry"!=s){var d=issharedfolder(g_shares,g.group);return void get_individual_attachment(c.storagekey,t,0==d?null:d.id,function(e){o=e,i("retry")})}return console.error("OpenAttach: FAILED TO GET INFO"),void alertfrombg(gs("Error opening attachment.")+"\nError C\nfrom="+l+"\nattachsize="+(void 0!==o&&null!=o&&void 0!==o.length?o.length:"undefined")+"\nattachkeysize="+(void 0!==n&&void 0!==n.length?n.length:"undefined"))}return console.error("OpenAttach: FAILED TO DECRYPT"),void alertfrombg(gs("Error opening attachment.")+"\nError A\nfrom="+l+"\nattachsize="+(void 0!==o&&null!=o&&void 0!==o.length?o.length:"undefined")+"\nattachkeysize="+(void 0!==n&&void 0!==n.length?n.length:"undefined"))}if(!r){r="";for(var p in lp_attaches)if(lp_attaches.hasOwnProperty(p)&&lp_attaches[p].id==t){r=lp_attaches[p].mimetype;break}}console.error("OpenAttach: mimetype: "+r);var u="";if(0==r.indexOf("other:application/octet-stream")?u="":0==r.indexOf("other:")?u=r.substring(6):0==r.indexOf("data:audio")?u=r.substring(11):0==r.indexOf("data:")&&-1!=r.lastIndexOf("/")&&(u=r.substr(r.lastIndexOf("/")+1)),!check_run_file_extension(u))return console.error("Cannot run: "+r),!1;if(!a){a="";for(var p in lp_attaches)if(lp_attaches.hasOwnProperty(p)&&lp_attaches[p].id==t){void 0!==lp_attaches[p].filename&&(a=lpdec(lp_attaches[p].filename,AES.hex2bin(n)));break}}if(a||(a=lpcreaterandomhexstring(30)+"."+u),console.error("OpenAttach: filename: "+a),call_binary_function("write_file",a,_,!0,!0),g_is_win){call_binary_function("write_file",a+":Zone.Identifier","[ZoneTransfer]\nZoneId=3",!1,!0)}if(g_is_linux)return void call_binary_function("get_path",!0,function(e){alertfrombg(gs("Your attachment is located at:")+"\n\n"+e+a+"\n\n"+gs("It is recommended that you delete the attachment file after you use it."))});call_binary_function("get_path",!0,function(e){console.error("OpenAttach: running file"),call_binary_function("run_file",e+a)}),0==g_last_openattach&&setInterval(function(){deleteallattachments()},1e4),g_last_openattach=lp_get_gmt_timestamp()})};n?i("B attachkey is invalid"):(console.error("OpenAttach: Reading from disk"),lpReadAttach(t,function(a){a&&console.error("OpenAttach: Read from disk. Size="+a.length),o=a;var r=getacct(e),s=issharedfolder(g_shares,r.group);console.error("OpenAttach: Is share: "+s);var l=0==s?g_local_key:s.sharekey;console.error("OpenAttach: attachkey: "+r.attachkey),n=lpdec(r.attachkey,l),console.error("OpenAttach: decrypted attachkey: "+n),i("lpReadAttach attachid="+t+" id="+e+" "+(null==a?"READ_FAILED":"READ_OK"))}))}function check_run_file_extension(e){return["csv","doc","docx","ppt","pptx","txt","xls","xlsx","pdf","png","gif","jpg","m4a","mpg","wav","avi","rtf","html","htm","mov","tiff","tif","jpeg","wmv","tsv","zip","rar","log"].includes(e)}function saveall(){if(!lploggedin)return void open_login();get_selected_tab(null,function(e){g_saveall_url=gettaburl(e),g_saveall_framestotal=g_CS_count[gettabid(e)],g_saveall_framesdone=0,g_saveall_docnumsdone=new Array,g_saveall_formdata="",g_saveall_tabid=gettabid(e),g_saveall_done=!1,sendCS(g_saveall_tabid,{cmd:"saveall"},"all"),setTimeout(function(){finish_saveall()},1e3)})}function finish_saveall(){g_saveall_done||(g_saveall_done=!0,handleSaveAll(g_saveall_tabid,{cmd:"saveall",addsite:1,url:g_saveall_url,formdata:g_saveall_formdata}))}function alertfrombg(e){"undefined"!=typeof webkitNotifications&&webkitNotifications&&0==webkitNotifications.checkPermission()?handlenotifications("LastPass",e):alert(e)}function openfeedback(){openURL(base_url+"feedback.php")}function opengenpw(e){"hotkey"!=e&&(e="context"),get_selected_tab(null,function(t){if(VaultToggle.useVault4_0()){var a=LPContentScriptFeatures.better_generate_password_enabled?"betterGeneratePassword":"generatePassword";LPPlatform.openPopoverDialog(a,{tabID:t.id,tabURL:gettaburl(t),saveOptions:{source:e}})}else{""!=g_generate_url&&(g_generate_url_prev=g_generate_url),g_generate_url=gettaburl(t);try{if(g_issafari&&"undefined"!=typeof SafariExtensionPopover)return void openpopover(3)}catch(e){g_can_open_popover=!1}g_isfirefoxsdk&&g_firefox_panel?(g_firefox_button_clicked=!0,g_firefox_panel.port.emit("message",{messagetype:"runonload",generate:!0})):openURL(getchromeurl("lp_toolstrip.html?browseraction=1&generate=1&tabid="+en(gettabid(t))))}})}function openchooseprofilecc(e){get_selected_tab(null,function(t){var a=gettabid(t);VaultToggle.useVault4_0()?LPPlatform.openPopoverDialog("chooseProfile",{tabID:a,saveOptions:{source:e}}):openURL(getchromeurl("lp_toolstrip.html?browseraction=1&chooseprofilecc=1&tabid="+en(a)))})}function openchangepw(e,t,a){VaultToggle.useVault4_0()?LPPlatform.openTabDialog("changePassword",{newPassword:e,domain:t,excluded:a}):(g_changepwnewpw=e,g_changepwtld=t,g_changepwexcludeid=a||0,openURL(getchromeurl("lp_toolstrip.html?browseraction=1&changepw=1")))}function opensearch(e){if(!lploggedin)return void open_login();var t="home.html";e&&""!=e&&(t+="?searchstr="+encodeURIComponent(e)),openURL(getchromeurl(t))}function recheckpage(e){if(lploggedin||!e)return lploggedin?void get_selected_tab(null,function(e){sendCS(gettabid(e),{cmd:"recheck"},"all")}):void open_login()}function refreshsites(){cleardeccache(),get_accts()}function clearAllData(){var e=opendb();createDataTable(e),e&&(g_indexeddb?e.transaction("LastPassData","readwrite").objectStore("LastPassData").clear():e.transaction(function(e){e.executeSql("DELETE FROM LastPassData",[],function(e,t){console_log("DESTROYING LastPassData Table")},function(e,t){console_log(t)})}))}function strEndsWith(e,t){return e.match(t+"$")==t}function clearCache(e,t,a,n){if(void 0===t&&(t=!0),void 0===a&&(a=!0),a&&lplog("clearCache : clearing otp"),null!=g_username&&""!=g_username){if(!LPISLOC){if("undefined"!=typeof localStorage){t&&(localStorage_removeItem("lp.uid"),localStorage_removeItem(db_prepend(g_username_hash))),localStorage_removeItem(db_prepend(g_username_hash+"_lt.cac"));for(var o=0;o<localStorage.length;o++){var r=localStorage.key(o);(strEndsWith(r,".att")||t&&(strEndsWith(r,".savedtree")||strEndsWith(r,".sch")))&&localStorage_removeItem(localStorage.key(o))}t&&(g_lp_mpw_user=localStorage.LPMPU,localStorage_removeItem("LPMPU"),localStorage_removeItem(g_lp_mpw_user+"_key_iter"),localStorage_removeItem(g_lp_mpw_user+"LPMPS"),localStorage_removeItem(g_lp_mpw_user+"LPMPH"),localStorage_removeItem(g_lp_mpw_user+"LPMPD"),localStorage_removeItem(g_lp_mpw_user+"LPMNN"),localStorage_removeItem(g_lp_mpw_user+"LPMEX"),localStorage_removeItem(g_lp_mpw_user+"LPMDD"))}have_binary_function("delete_file")&&(call_binary_function("delete_file",db_prepend(g_username_hash)+"_lt.cac"),n||(call_binary_function("delete_file",db_prepend(g_username_hash)+"_lpall.slps"),call_binary_function("delete_file",db_prepend(g_username_hash)+"_lpall.lps"))),t&&have_binary_function("delete_files_by_extension")&&call_binary_function("delete_files_by_extension",db_prepend(g_username_hash),".att"),lp_local_attach_version=-1}var i={},s="";t||(i.icons=!0,i.rsakey=!0,s+=" AND type != 'icons' AND type != 'rsakey'"),a||(i.otp=!0,s+=" AND type != 'otp'"),LPISLOC&&(i.key=!0,i.accts=!0,s+=" AND type != 'key' AND type != 'accts'"),n&&(i.key=!0,s+=" AND type != 'key'");var l=opendb();if(createDataTable(l),l&&(g_indexeddb?l.transaction("LastPassData","readonly").objectStore("LastPassData").index("username_hash").openCursor(IDBKeyRange.only(g_username_hash)).onsuccess=function(e){var t=e.target.result;t&&(void 0===i[t.value.type]&&l.transaction("LastPassData","readwrite").objectStore("LastPassData").delete(g_username_hash+"_"+t.value.type),t.continue())}:l.transaction(function(e){e.executeSql("UPDATE LastPassData SET username_hash=? WHERE username_hash=?"+s,["deleteme",db_prepend(g_username_hash)],function(e,t){var a=opendb();createDataTable(a),a&&a.transaction(function(e){e.executeSql("DELETE FROM LastPassData WHERE username_hash=?"+s,["deleteme"],function(e,t){},function(e,t){console_log(t)})})},function(e,t){console_log(t)})})),t){var _=lpreadretryfile();if(null!=_&&_.length>0){var c=gs("A retry file has been found. This likely means that not all of your site changes have been saved. Would you like to delete this file and potentially lose some changes?");(e||confirm(c))&&lpdeleteretry()}}}}function openabout(){(is_prebuild()||g_isdebug)&&have_binary_function("debug_windows")&&call_binary_function("debug_windows"),openURL(getchromeurl("about.html"))}function opensessions(){openURL(base_url+"sess.php")}function openmyaccount(){openURL(base_url+"my.php")}function openseccheck(){unlock_plug2web(),openURL(base_url+"?securitychallenge=1&lpnorefresh=1")}function openaddsite(){g_site_data=createNewAcct(),g_site_data.addsite="1",g_site_data.noreplace="1",get_selected_tab(null,function(e){g_site_data.url=gettaburl(e),openURL(getchromeurl("site.html"))})||(g_site_data.url="",openURL(getchromeurl("site.html")))}function openeditsite(e){LPPlatform.openTabDialog("site",{vaultItem:e})}function openaddsecurenote(){if(!lploggedin)return void open_login(1);LPContentScriptFeatures.omaria?LPPlatform.openTabDialog("addItem"):(g_site_data=createNewAcct(),g_site_data.sn=1,g_site_data.url="http://sn",openURL(getchromeurl("site.html")))}function openeditsecurenote(e){LPPlatform.openTabDialog("note",{vaultItem:e})}function checkforupdates(){g_notification_type="upgrade",g_notification_data={checking:!0},sendTS({cmd:"notification",type:"upgrade"}),setTimeout(function(){lpMakeRequest(base_url+"upgrade.php?binary="+(have_nplastpass()?1:0)+"&x=1&ver="+LP.en(lpversion)+(g_issafari?"&safarijs=1":"")+(g_isopera?"&opera=1":"")+(g_ismaxthon?"&maxthon=1":"")+(g_isfirefoxsdk?"&firefox=1":""),"",upgrade_response,null)},250)}function fillitem(e,t,a,n,o,r,i){if(check_ident_aid(e)&&!(Object.keys(g_securenotes).indexOf(e)<0)){var s=g_securenotes[e];if(!t&&(s.pwprotect||g_prompts.view_ff_prompt))return void get_selected_tab(null,function(t){var s=a||gettabid(t);security_prompt(function(){fillitem(e,!0,s,n,o,r,i)})});get_selected_tab(null,function(t){var l=a||gettabid(t),_=new Array,c=new Array;for(var g in s)"aid"==g||"notetype"==g||"pwprotect"==g||"decprofilename"==g||"name"==g?_[g]=s[g]:(_[g]=lpmdec_acct(s[g],!0,s,g_shares),"profilelanguage"==g&&void 0!==translations[_[g]]&&(c[_[g]]=translations[_[g]]));if(_.extra)switch(_.notetype){case"Credit Card":_.ccname=LP.getNoteValue("Name on Card",_.extra),_.cctype=LP.getNoteValue("Type",_.extra),_.ccnum=LP.getNoteValue("Number",_.extra),_.cccsc=LP.getNoteValue("Security Code",_.extra),_.ccstart=new Date(LP.getNoteValue("Start Date",_.extra)),_.ccexp=new Date(LP.getNoteValue("Expiration Date",_.extra));break;case"Bank Account":_.bankname=LP.getNoteValue("Bank Name",_.extra),_.bankroutingnum=LP.getNoteValue("Routing Number",_.extra),_.bankacctnum=LP.getNoteValue("Account Number",_.extra),_.bankacctnum||(_.bankacctnum=LP.getNoteValue("IBAN Number",_.extra));break;case"Address":_.title=LP.getNoteValue("Title",_.extra),_.firstname=LP.getNoteValue("First Name",_.extra),_.middlename=LP.getNoteValue("Middle Name",_.extra),_.lastname=LP.getNoteValue("Last Name",_.extra),_.username=LP.getNoteValue("Username",_.extra),_.gender=LP.getNoteValue("Gender",_.extra),_.birthday=new Date(LP.getNoteValue("Birthday",_.extra)),_.company=LP.getNoteValue("Company",_.extra),_.address1=LP.getNoteValue("Address 1",_.extra),_.address2=LP.getNoteValue("Address 2",_.extra),_.address3=LP.getNoteValue("Address 3",_.extra),_.city=LP.getNoteValue("City / Town",_.extra),_.county=LP.getNoteValue("County",_.extra),_.state=LP.getNoteValue("State",_.extra),_.zip=LP.getNoteValue("Zip / Postal Code",_.extra);var d=all_countries.find(function(e){return e.cc2l===LP.getNoteValue("Country",_.extra)});d&&(_.country=d.cc2l,_.country_cc3l=d.cc3l,_.country_name=d.name),_.timezone=LP.getNoteValue("Timezone",_.extra),_.email=LP.getNoteValue("Email Address",_.extra);var p=LP.getNoteValue("Phone",_.extra,null,!0);_.phone=p.num,_.phone3lcc=p.cc3l,_.phoneext=p.ext;var u=LP.getNoteValue("Evening Phone",_.extra,null,!0);_.evephone=u.num,_.evephone3lcc=u.cc3l,_.evephoneext=u.ext;var f=LP.getNoteValue("Mobile Phone",_.extra,null,!0);_.mobilephone=f.num,_.mobilephone3lcc=f.cc3l,_.mobilephoneext=f.ext;var m=LP.getNoteValue("Fax",_.extra,null,!0);_.fax=m.num,_.fax3lcc=m.cc3l,_.faxphoneext=m.ext;break;case"Social Security":_.ssn=LP.getNoteValue("Number",_.extra),_.ssnname=LP.getNoteValue("Name",_.extra)}void 0===c["en-US"]&&(c["en-US"]=translations["en-US"]);var h=LPJSON.stringify(_);void 0!==o&&null!==o||(o=!1),sendCS(l,{cmd:"fillform",toformfill:h,translations:LPJSON.stringify(translations),fromiframe:n,xdomasked:o},"all");var b=document.createElement("a");b.href=t.url;var v=b.hostname;logformfill(e,v,r,null,_.notetype,i)})}}function fillform(e,t,a,n,o,r,i){if(check_ident_ffid(e)&&(!n||check_ident_ffid(n))){verbose_log("fillform entered");for(var s=0;s<g_formfills.length&&g_formfills[s].ffid!=e;s++);if(s!=g_formfills.length){var l;if(n){for(l=0;l<g_formfills.length&&g_formfills[l].ffid!=n;l++);if(l==g_formfills.length)return}if(!t&&(g_formfills[s].pwprotect||n&&g_formfills[l].pwprotect||g_prompts.view_ff_prompt))return void get_selected_tab(null,function(t){var s=a||gettabid(t);security_prompt(function(){fillform(e,!0,s,n,o,r,i)})});get_selected_tab(null,function(t){var _=a||gettabid(t),c=g_formfills[s],g=n?g_formfills[l]:null,d=new Array,p=new Array;for(var u in c)if("ffid"==u||"profiletype"==u||"pwprotect"==u||"creditmon"==u||"decprofilename"==u||"group"==u||"sharefolderid"==u)d[u]=c[u];else if("custom_fields"==u){d[u]=new Array;for(var f=0;f<c[u].length;f++){var m="custom_field"+f;d[m]=new Array,d[m].cfid=c[u][f].cfid,d[m].text=lpmdec_acct(c[u][f].text,!0,c,g_shares),d[m].value=lpmdec_acct(c[u][f].value,!0,c,g_shares),d[m].alttext=lpmdec_acct(c[u][f].alttext,!0,c,g_shares)}}else n&&0==u.indexOf("cc")?d[u]=lpmdec_acct(g[u],!0,g,g_shares):(d[u]=lpmdec_acct(c[u],!0,c,g_shares),"profilelanguage"==u&&void 0!==translations[d[u]]&&(p[d[u]]=translations[d[u]]));void 0===p["en-US"]&&(p["en-US"]=translations["en-US"]);var h=LPJSON.stringify(d);void 0!==r&&null!==r||(r=!1),sendCS(_,{cmd:"fillform",toformfill:h,translations:LPJSON.stringify(translations),fromiframe:o,xdomasked:r},"all");var b=document.createElement("a");b.href=t.url;var v=b.hostname;logformfill(e,v,i,d.profilelanguage,d.notetype)})}}}function getacceptabletlds(e){var t=lp_gettld_url(e),a=t,n=null;if(void 0!==g_equivalentdomains[t]&&(n=g_equivalentdomains[t]),n)for(var o in g_equivalentdomains)o==n&&(a+=","+g_equivalentdomains[o]);return a}function fillcurrent(e,t,a){if(!t&&(g_sites[e].pwprotect||g_prompts.login_site_prompt))return void get_selected_tab(null,function(t){var n=a||gettabid(t);security_prompt(function(){fillcurrent(e,!0,n)})});get_selected_tab(null,function(t){sendCS(a||gettabid(t),{cmd:"fillcurrent",password:getpasswordfromacct(g_sites[e]),domains:getacceptabletlds(g_sites[e].url)},"all")})}function openbaseurl(e){g_isfirefoxsdk?setTimeout(function(){openURL(base_url+e)},0):openURL(base_url+e)}function addprofile(e,t){if(!lploggedin)return void open_login(1);if(VaultToggle.useVault4_0()){var a={defaultData:{profiletype:0}};t&&(a.saveOptions={source:t}),LPPlatform.openTabDialog("formFill",a)}else{if(!e&&g_prompts.view_ff_prompt)return void security_prompt(function(){addprofile(!0,t)});g_formfill_data={},g_formfill_data.cmd="add",g_formfill_data.type=0,g_formfill_data.data=null,openURL(getchromeurl("formfill.html"))}}function addcreditcard(e,t){if(!lploggedin)return void open_login(1);if(VaultToggle.useVault4_0()){var a={defaultData:{profiletype:1}};t&&(a.saveOptions={source:t}),LPPlatform.openTabDialog("formFill",a)}else{if(!e&&g_prompts.view_ff_prompt)return void security_prompt(function(){addcreditcard(!0,t)});g_formfill_data={},g_formfill_data.cmd="add",g_formfill_data.type=1,g_formfill_data.data=null,openURL(getchromeurl("formfill.html"))}}function editprofile(e,t,a){if(!lploggedin)return void open_login(1);if(VaultToggle.useVault4_0()){var n={vaultItem:e};a&&(n.saveOptions={source:a}),LPPlatform.openTabDialog("formFill",n)}else for(var o=0;o<g_formfills.length;++o)if(e==g_formfills[o].ffid){if(!t&&(g_formfills[o].pwprotect||g_prompts.view_ff_prompt))return void security_prompt(function(){editprofile(e,!0,a)});g_formfill_data={},g_formfill_data.cmd="edit",g_formfill_data.type=g_formfills[o].profiletype,g_formfill_data.data=g_formfills[o],openURL(getchromeurl("formfill.html"));break}}function clearforms(e){get_selected_tab(null,function(t){sendCS(gettabid(t),{cmd:"clearforms"},"all");var a=document.createElement("a");a.href=t.url;var n=a.hostname;logclearform(n,e)})}function lostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username))}function googleauthlostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=googleauth")}function outofbandlostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=outofband")}function securityquestionlostkey(){var e=securityquestion_getdata("reseturl");openURL(e&&""!=e?e:base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=securityquestion")}function sesamelostkey(){openURL(base_url+"sesamedisable.php?cmd=sendemail&username="+en(g_username))}function gridlostkey(){openURL(base_url+"griddisable.php?cmd=sendemail&username="+en(g_username))}function multifactorlostkey(e){openURL(base_url+"multifactordisable.php?cmd=sendemail&username="+en(g_username)+"&type="+en(e))}function lpshowError(e,t,a,n,o,r,i,s,l){g_hidecreate&&(n=!1),g_notification_type="error";var _=e;e=gs(e),e=e.replace(/\n/g,"<br/>"),g_notification_data={msg:e,showFeedback:t,showLogin:a,showCreateAccount:n,multifactor_disable_url:o,yellow:r,custombutton:i,customaction:s,showStartTrial:l},sendTS({cmd:"notification",type:"error"}),setTimeout(function(){get_selected_tab(null,function(e){sendCS(gettabid(e),{cmd:"showerrornotification",text:gs(_).replace(/\n/g," "),do_40notify:g_40notify,notificationdata:g_notification_data})})},100),g_safari_error_notifications&&g_can_open_popover||!g_issafari||(g_showerrorlastmsg!=e||(new Date).getTime()-g_showerrorlastts>3e3)&&(g_showerrorlastmsg=e,g_showerrorlastts=(new Date).getTime(),alert(gs(_)),g_showerrorlastts=(new Date).getTime()),console_log(e)}function launch(e,t){if(is_application(e))return void(g_is_win&&have_binary()?lpnp_notify("launch",{data0:LP.get_appaid(e)}):editAid(e,null,t));if(is_formfill(e))return void fillform(LP.get_ffid(e));if(check_ident_aid(e)){var a=get_record(e);if(a){if(a.sn)return void editAid(e);var n=a.pwprotect;if(!t&&(n||g_prompts.login_site_prompt))return void(n?security_prompt(function(){launch(e,!0)},null,null,!0,e,!1):security_prompt(function(){launch(e,!0)}));var o=a.url;o.match(/^[a-z]+?\:\/\//i)||(o="http://"+o),g_last_launch[a.aid]=(new Date).getTime(),g_pending_launch=a.aid,openURL(o,function(e,t){var n=gettabid(e);g_launch_site_tracking_enabled&&SiteLaunchObserver.startLaunchSite(n,a),g_launches[n]=t},a.aid)}}}function get_identity_param(){return"&iid="+LP.en(g_identity)}function add_ident_aid(e){if(""!=g_identity){for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(!(t>=g_identities.length)){var a=g_identities[t];""!=a.aids&&(a.aids+=","),a.aids+=e,a.aidarr=a.aids.split(",")}}}function add_ident_ffid(e){if(""!=g_identity){for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(!(t>=g_identities.length)){var a=g_identities[t];""!=a.ffids&&(a.ffids+=","),a.ffids+=e,a.ffidarr=a.ffids.split(",")}}}function check_ident_aid(e){if(""==g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.aidarr&&(a.aidarr=a.aids.split(",")),lp_in_array(e,a.aidarr)}function check_ident_appaid(e){if(""==g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.appaidarr&&(a.appaidarr=a.appaids.split(",")),lp_in_array(e,a.appaidarr)}function check_ident_ffid(e){if(""==g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.ffidarr&&(a.ffidarr=a.ffids.split(",")),lp_in_array(e,a.ffidarr)}function switch_identity(e,t,a,n,o){if(e!=g_identity&&void 0!==e){var r=!1;if(""!=e){for(var i=0;i<g_identities.length;i++)if(g_identities[i].iid==e){g_identities[i].pw_prompt&&(r=!0);break}if(i>=g_identities.length)return}else for(var i=0;i<g_identities.length;i++)if(g_identities[i].pw_prompt){r=!0;break}if(!t&&(r||g_prompts.switch_identity_prompt))return o&&closePop(),void security_prompt(function(){switch_identity(e,!0)});g_identity=""+e,n||lpnp_notify("switchidentity",{data0:g_identity}),lpPutUserPref("identity",g_identity),lpWriteAllPrefs(),a||refresh_windows(),update_menus(!0)}}function add_identity(){unlock_plug2web(),openURL(base_url+"?ac=1&addidentity=1")}function setup_poll_timer(){setTimeout(function(){poll_server()},6e4)}function compare_tlds(e,t){return"string"==typeof e&&("string"==typeof t&&(e=e.toLowerCase(),t=t.toLowerCase(),e==t||void 0!==g_equivalentdomains[e]&&void 0!==g_equivalentdomains[t]&&g_equivalentdomains[e]==g_equivalentdomains[t]))}function lpreadretry(){return"undefined"==typeof localStorage?null:localStorage_getItem(db_prepend(g_username_hash+".retry"))}function lpdeleteretry(){if("undefined"==typeof localStorage)return null;localStorage_removeItem(db_prepend(g_username_hash+".retry"))}function lpwriteretry(e){return""!=g_username_hash&&null!=g_username_hash&&("undefined"!=typeof localStorage&&!!localStorage_setItem(db_prepend(g_username_hash+".retry"),e))}function getuuid(e,t){if(LPISLOC)return void e("");if("undefined"==typeof localStorage)return void e("");try{var a=function(e){return e=JSON.parse(e),t?(e[t]&&""!=e[t]||(e[t]=lpCreatePass(32,1,1,1,1,1,1,1),setuuid(e[t],t)),e[t]):e};if(have_binary_function("read_file"))call_binary_function("read_file",db_prepend("lp.suids"),function(t){t?unprotect_data(t,!0,function(t){e(a(t))}):call_binary_function("read_file",db_prepend("lp.suid"),function(t){t?unprotect_data(t,!0,e):g_is_win?call_binary_function("read_file",db_prepend("lp.uid"),function(t){t&&setuuid(t),e(t)}):e("")})});else{
var n=localStorage_getItem(db_prepend("lp.uids"));n=n?a(n):localStorage_getItem(db_prepend("lp.uid")),e(n)}}catch(t){console_log("Error in getuuid: "+t),e("")}}function setuuid(e,t,a){(e||a)&&(t&&getuuid(function(n){"object"!=typeof n&&(n={}),""==e&&a?delete n[t]:n[t]=e,n=JSON.stringify(n),have_binary_function("write_file")?protect_data(n,!0,null,function(e){call_binary_function("write_file",db_prepend("lp.suids"),e)}):localStorage_setItem(db_prepend("lp.uids"),n)}),have_binary_function("write_file")?protect_data(e,!0,null,function(e){call_binary_function("write_file",db_prepend("lp.suid"),e)}):localStorage_setItem(db_prepend("lp.uid"),e))}function clearuuid(e){e?setuuid("",e,!0):(delete_file("lp.suid"),delete_file("lp.uid"),"undefined"!=typeof localStorage&&localStorage_removeItem("lp.uid"))}function lpReportError(e,t){var a=e;if(0!=g_prompts.improve&&!(++lperrorcount>100)){var n=a.match(/^(.*)location:\s+/);n&&(a=n[1]);var o="";g_ischrome?o="chrome":g_issafari?o="safari":g_isfirefoxsdk?o="firefoxsdk":g_isfirefox&&(o="firefox");var r="msg=cr() "+o+" lp("+lpversion+") errors("+lperrorcount+"): "+LP.en(a);lpMakeRequest(base_url+"error.php?",r,null,null)}}function lpatob(e){return atob(e)}function lpbtoa(e){return btoa(e)}function lpGetCurrentWindow(){return window}function bin2hex(e){return AES.bin2hex(e)}function url2hex(e){return AES.url2hex(e)}function hex2url(e){return AES.hex2url(e)}function hex2bin(e){return AES.hex2bin(e)}function lp_hex2bin(e){return AES.hex2bin(e)}function ismultifactortaburl(e){return-1!=e.indexOf("browseraction=1&yubikey=1")||-1!=e.indexOf("browseraction=1&googleauth=1")||-1!=e.indexOf("browseraction=1&outofband=1")||-1!=e.indexOf("browseraction=1&securityquestion=1")||-1!=e.indexOf("browseraction=1&sesame=1")||-1!=e.indexOf("browseraction=1&grid=1")}function getLanguage(){var e=lpGetPref("language","");return""==e&&(e=navigator.language),e}function openURL(e,t,a,n,o,r,i){if(e){if(!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ssh://")||e.startsWith("ftp://")||e.startsWith("resource://")||e.startsWith("widget://")||e.startsWith("mxaddon-pkg://")||e.startsWith("ms-browser-extension://")||e.startsWith("moz-extension://")||6==e.indexOf("-extension://")))return void console.log("refusing to open unsafe url: "+e);if("undefined"!=typeof Preferences&&Preferences.get("htmlindialog")&&ischromeurl(e)&&-1==e.indexOf(VaultToggle.getVaultPage())){if(g_isfirefoxsdk&&"undefined"!=typeof g_panel){var s=800,l=600;-1==e.indexOf("login.html")&&-1==e.indexOf("lp_toolstrip.html?browseraction=1&generate=1")||(s=l=400),-1!=e.indexOf("site.html")&&(g_window_before_dialog=g_window_utils.getMostRecentBrowserWindow()),e+=(-1==e.indexOf("?")?"?":"&")+"lpindialog=1";var _="chrome,centerscreen,titlebar,resizable,scrollbars,screenX=0,screenY=0,width="+s+",height="+l;return void setTimeout(function(){g_firefox_html_dialog=g_window_utils.openDialog({features:_}),g_firefox_html_dialog.addEventListener("load",function(){g_tabs.activeTab.url=e})},0)}if(g_ischrome)return void LPPlatform.openDialogWindow({url:e,loadHandler:t})}var c=!1;if(g_isfirefoxsdk){var g=getcurrenturl();if(ischromeurl(g)&&-1!=g.indexOf("lpindialog=1")){if(!i)return g_tabs.activeTab.close(),void setTimeout(function(){openURL(e,t,a,n,o,r,i)},100);c=n=o=!0}}if(void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),0==e.indexOf(base_url))e+=-1==e.indexOf("?")?"?":"&",e+="lang="+LP.en(getLanguage());else if(e==g_forgotpwurl||e==g_helpurl){e+=-1==e.indexOf("?")?"?":"&";var d=getLanguage();d&&(e+="lang="+LP.en(g_useshortlang?d.substring(0,2):d))}get_selected_tab(null,function(e){g_selectedtabid=gettabid(e),g_selectedtab=e}),e.indexOf("sesameusername")>0&&get_all_windows({populate:!0},function(e){for(var t=e.length-1;t>=0;--t)for(var a=get_tabs_length(e[t])-1;a>=0;--a){var n=gettaburl(get_tabs(e[t])[a]);n&&lp_url_is_lastpassext(n)&&close_tab(get_tabs(e[t])[a])}});var p=!1;if(ismultifactortaburl(e))lastopenauthwin=(new Date).getTime();else if(-1!=e.indexOf(VaultToggle.getVaultPage())){var u=(new Date).getTime();u-1e3<lastopenauthwin&&(p=!0)}t||(t=function(e){});var f=lpGetPref("openpref","tabs");"same"!=f||!n&&6!=e.indexOf("-extension://")&&0!=e.indexOf("mxaddon-pkg://")&&0!=e.indexOf("javascript:")||(f="tabs"),"windows"==f&&o&&(f="tabs"),g_isfirefoxsdk&&c&&(void 0==typeof g_window_before_dialog||g_window_before_dialog.closed)&&(f="windows");var m=getcurrenturl();if(m&&0==m.indexOf(getchromeurl("launch.html",!0))&&(f="same"),"same"==f){if(g_ischrome)get_selected_tab(null,function(n){chrome.tabs.update(n.id,{url:e},function(n){L("call openURL:loadurl with "+e),t(n,a)})});else if(g_issafari){var h=safari.application.activeBrowserWindow.activeTab;t(h,a),h.url=e}else if(g_isopera){var h=opera.extension.tabs.getFocused();h?(t(h,a),h.update({url:e})):(h=opera.extension.tabs.create({focused:!0,url:e}),t(h,a))}else if(g_ismaxthon){var h=window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab();t(h,a),h.navigate(e)}else if(g_isfirefoxsdk){var h=g_tabs.activeTab,b=function(e){t(e,a),e.removeListener("ready",b)};h.on("ready",b),h.url=e}}else if("windows"==f)if(g_ischrome)chrome.windows.create({url:e},function(e){e.tabs.length>0&&t(e.tabs[0],a)});else if(g_issafari){var h=safari.application.openBrowserWindow().activeTab;t(h,a),h.url=e}else if(g_isopera){var h=opera.extension.windows.create({focused:!0,url:e});t(h,a)}else if(g_ismaxthon){var h=window.external.mxGetRuntime().create("mx.browser").tabs.newTab({url:e});t(h,a)}else g_isfirefoxsdk&&g_windows.browserWindows.open({url:e,onOpen:function(e){if(void 0===e.lponreadydone&&(e.lponreadydone=!0,e.tabs.length>0)){var n=function(e){t(e,a),e.removeListener("ready",n)};e.tabs[0].on("ready",n)}}});else{var v=!p;if(g_ischrome){var y={url:e,active:!r};is_firefox_webext()||(y.selected=v),chrome.tabs.create(y,function(e){t(e,a)})}else if(g_issafari){var w=p?"background":"foreground";r&&(w="background");var h=safari.application.activeBrowserWindow.openTab(w);t(h,a),h.url=e}else if(g_isopera){var h=opera.extension.tabs.create({focused:!0,url:e});t(h,a)}else if(g_ismaxthon){var h=window.external.mxGetRuntime().create("mx.browser").tabs.newTab({url:e});t(h,a)}else if(g_isfirefoxsdk)if(c){var h=g_model_core.modelFor(g_tabs_utils.openTab(g_window_before_dialog,e,{inBackground:r}));t(h,a)}else setTimeout(function(){var n=function(e){t(e,a),e.removeListener("ready",n)};g_tabs.open({url:e,inBackground:r,onReady:n})},0)}}}function copyusername(e,t,a){if(!lploggedin)return!1;var n=get_record(e);return null!==n&&(!(t&&a&&!check_for_frame_mismatch_ok(a,t,gs("Are you sure you would like to copy your LastPass site's username to the clipboard?"),"copyusername"))&&copytoclipboard(getusernamefromacct(n)))}function copypassword(e,t,a,n){if(!lploggedin)return!1;var o=get_record(e);return null!==o&&(!(a&&n&&!check_for_frame_mismatch_ok(n,a,gs("Are you sure you would like to copy your LastPass site's password to the clipboard?"),"copypassword"))&&(null!=o.sharedfromaid&&""!=o.sharedfromaid&&"0"!=o.sharedfromaid&&"null"!=o.sharedfromaid?(alertfrombg(gs("This is a shared site. You are not permitted to view the password.")),!1):!t&&(o.pwprotect||g_prompts.view_pw_prompt||g_prompts.login_site_prompt)?(security_prompt(function(){copypassword(e,!0,a,n)}),!1):copytoclipboard(getpasswordfromacct(o))))}function copyurl(e,t,a){if(!lploggedin)return!1;var n=get_record(e);return null!==n&&(!(t&&a&&!check_for_frame_mismatch_ok(a,t,gs("Are you sure you would like to copy your LastPass site's URL to the clipboard?"),"copyurl"))&&copytoclipboard(geturlfromacct(n)))}function copynote(e,t,a){var n=get_record(e);if(!t&&(n.pwprotect||g_prompts.edit_sn_prompt))return void security_prompt(function(){copynote(e,!0)});issharedfolder(g_shares,n.group)&&loglogin(get_record_id(n)),copytoclipboard(void 0!==n.extra?lpmdec_acct(n.extra,!0,n,g_shares):"")}function copyprop(e,t,a,n,o,r){var i=get_record(e);if(!a&&(i.pwprotect||g_prompts.edit_sn_prompt))return void security_prompt(function(){copyprop(e,t,!0,n,o,r)});var s=void 0!==i.extra?lpmdec_acct(i.extra,!0,i,g_shares):"",l=LP.getNoteValue(t,s);r&&(l=JSON.parse(l),l=l[r]),copytoclipboard(l)}function refresh_windows(e){var t=!1;void 0!==e&&e&&(t=!0),g_issafari&&g_hidemenubar&&g_can_open_popover&&toggle_menu(!0),get_all_windows({populate:!0},function(e){for(var a=0;a<e.length;a++)for(var n=0;n<get_tabs_length(e[a]);n++)if(lp_url_is_lastpass(gettaburl(get_tabs(e[a])[n]),!0)&&(-1==gettaburl(get_tabs(e[a])[n]).indexOf("lpnorefresh=1")||t)){var o=gettaburl(get_tabs(e[a])[n]);o=o.replace("&nk=1",""),o=o.replace("&showdeleted=1",""),L("refresh_windows() loadurl url:"+o),sendCS(gettabid(get_tabs(e[a])[n]),{cmd:"loadurl",url:o})}})}function clear_all_filled_fields(){get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var a=0;a<get_tabs_length(e[t]);a++)sendCS(gettabid(get_tabs(e[t])[a]),{cmd:"clearfilledfields"},"all")})}function closeallnotifications(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),get_all_windows({populate:!0},function(a){for(var n=0;n<a.length;n++)for(var o=0;o<get_tabs_length(a[n]);o++)sendCS(gettabid(get_tabs(a[n])[o]),{cmd:"closenotification",includeerror:e,excludeother:t})})}function recheckall(){L("BG : recheckall()"),get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var a=0;a<get_tabs_length(e[t]);a++)sendCS(gettabid(get_tabs(e[t])[a]),{cmd:"recheck"},"all")}),setprefs("all","all")}function closecurrenttab(e){if(get_selected_tab(null,function(t){if(""!=e){var a=gettaburl(t),n=getchromeurl(e,!0);if(-1==a.indexOf(n)&&-1==a.indexOf(punycode.URLToASCII(n))&&-1==a.indexOf(base_url+"/"+e))return}close_tab(t),select_selectedtabid()}),g_isfirefoxsdk&&g_firefox_html_panel){if(""!=e&&-1==g_firefox_html_panel.url.indexOf(e))return;g_firefox_html_panel.destroy(),g_firefox_html_panel=null}}function MPWNoNag(){confirm(gs("Are you sure you do not want LastPass to tell you when your Master Password is at risk?"))&&(localStorage_setItem(g_lp_mpw_user+"LPMNN",1),g_lp_mpw_nonag=!0)}function addDomainToMPWNever(){confirm(gs("Disable LastPass Master Password risk warning on this site?"))&&(g_lp_mpw_exclude[g_lp_mpw_bad_url]=1,localStorage_setItem(g_lp_mpw_user+"LPMEX",JSON.stringify(g_lp_mpw_exclude)))}function mpw_checkVault(e,t,a){if(a&&(mpw_num_sites=e.length,mpw_retval=""),e.length){var n=e.pop(),o=n.passworddec;""===o?mpw_num_sites--:make_lp_key_hash_iterations(g_lp_mpw_salt,o,100,function(e,t){t==g_lp_loggedinhsh&&(""===mpw_retval?mpw_retval=n.id:mpw_retval+="."+n.id),mpw_num_sites--})}0!==mpw_num_sites?setTimeout(function(){mpw_checkVault(e,t,!1)},0):t(mpw_retval)}function fill_default_ffid(e){if(!lploggedin)return void open_login();var t=lpGetPref("defaultffid","0");if(check_ident_ffid(t))for(var a=0;a<g_formfills.length;a++)if(g_formfills[a].ffid==t)return void fillform(t,null,null,null,null,null,e);confirm(gs("You have not yet chosen a default form fill profile.  Would you like to choose one now?"))&&openprefs()}function setprefs(e,t,a,n){var o=getInt(lpGetPref("highlightFields",1)),r=getInt(lpGetPref("warninsecureforms",0)),i=1===getInt(g_cid)?1:0,s=getInt(lpGetPref("infieldPopupEnabled",i)),l=getInt(lpGetPref("dontfillautocompleteoff",0)),_=getInt(lpGetPref("donotoverwritefilledfields",0)),c=getInt(lpGetPref("showGenerateNotifications",1)),g=getInt(lpGetPref("showFormFillNotifications",1)),d=getInt(lpGetPref("showNotificationsAfterClick",1)),p=getInt(lpGetPref("alwayschooseprofilecc",0)),u=getInt(lpGetPref("automaticallyFill",1)),f=getInt(lpGetPref("notificationsBottom",0));is_guiless()&&(o=r=d=c=g=0);for(var m={cmd:"setprefs",highlightFields:o,warninsecureforms:r,infieldPopupEnabled:s,dontfillautocompleteoff:l,donotoverwritefilledfields:_,showGenerateNotifications:c,showFormFillNotifications:g,showNotificationsAfterClick:d,alwayschooseprofilecc:p,automaticallyFill:u,g_cpwbot:g_cpwbot,notificationsBottom:f,do_40notify:g_40notify},h=0;h<g_lp_hotkeys.length;h++){var b=g_lp_hotkeys[h];m[b+"KeyCode"]=lpGetPref(b+"KeyCode"),m[b+"Mods"]=lpGetPref(b+"Mods")}m.do_hotkeys=!g_isfirefoxsdk||"undefined"==typeof g_ff_hotkeys,a&&isSpecialSite(a)&&(m.specialsite="1");var v=(getcsinfo(e,t),getcsinfo_top(e,t));if(v&&(m.top_origin=v.origin,m.top_domain=v.domain),!g_cpwbot||!CPWbot_bg||null===CPWbot_bg.get_pwchangestate()||CPWbot_bg.get_okstate()||CPWbot_bg.get_failstate()||CPWbot_bg.in_bagration()||CPWbot_bg.get_pwchangetabid()!=e)g_cpwbot&&(m.in_cpwbot=0);else{if(m.in_cpwbot=1,m.docaptcha=CPWbot_bg.get_docaptchastate()?1:0,CPWbot_bg&&g_CS_tops&&g_CS_tops[e]==t){var y=CPWbot_bg.get_last_overlay_message();if(y){var w={msg:y};m.msg=JSON.stringify(w)}}CPWbot_bg.show_cpwbot_overlay(e,null,null)}if(!debug&&!g_isdebug||!CPWbot_bg||!0!==CPWbot_bg.get_failstate()&&!0!==CPWbot_bg.get_okstate()||e==CPWbot_bg.get_selenium_tabid()&&(L("force result div again WTF"),!0===CPWbot_bg.get_failstate()?CPWbot_bg.show_selenium_fail(e):!0===CPWbot_bg.get_okstate()&&CPWbot_bg.show_selenium_ok(e)),m.do_experimental_popupfill=do_experimental_popupfill,m.lploggedin=lploggedin,m.ff_currpass_regexp=get_ff_translation("ff_currpass_regexp"),m.ff_username_regexp=get_ff_translation("ff_username_regexp"),m.ff_loginform_regexp=get_ff_translation("ff_loginform_regexp"),m.ff_bankacctnum_regexp=get_ff_translation("ff_bankacctnum_regexp"),m.ff_email_regexp=get_ff_translation("ff_email_regexp"),m.ff_company_regexp=get_ff_translation("ff_company_regexp"),m.ff_firstname_regexp=get_ff_translation("ff_firstname_regexp"),m.ff_search_regexp=get_ff_translation("ff_search_regexp"),m.ff_captcha_regexp=get_ff_translation("ff_captcha_regexp"),m.ff_cctype_regexp=get_ff_translation("ff_cctype_regexp"),m.ff_lastname_regexp=get_ff_translation("ff_lastname_regexp"),m.ff_address1_regexp=get_ff_translation("ff_address1_regexp"),m.ff_remember_regexp=get_ff_translation("ff_remember_regexp"),m.ff_combineddummy_regexp=get_ff_translation("ff_combineddummy_regexp"),m.ff_password_regexp=get_ff_translation("ff_password_regexp"),m.ff_question_answer_regexp=get_ff_translation("ff_question_answer_regexp"),m.ff_country_regexp=get_ff_translation("ff_country_regexp"),m.ff_city_regexp=get_ff_translation("ff_city_regexp"),m.ff_forgot_regexp=get_ff_translation("ff_forgot_regexp"),m.ff_canceltxt_regexp=get_ff_translation("ff_canceltxt_regexp"),m.ff_signuptxt_regexp=get_ff_translation("ff_signuptxt_regexp"),m.ff_helptxt_regexp=get_ff_translation("ff_helptxt_regexp"),m.ff_signintxt_regexp=get_ff_translation("ff_signintxt_regexp"),a){setcurrenturl(a),m.nevers=LPJSON.stringify(getnevers());var k=g_CS_tops[e];if(g_CS_tops&&void 0!==k&&null!==k&&k!=t){var x=g_CS[e][k],P=gettaburl(g_CS[e][k]);if(!P&&x&&x.name&&(P=punycode.URLToASCII(x.name)),P){var S=getnevers();getnevers_given(P,S),m.nevers=LPJSON.stringify(S)}}if(do_experimental_popupfill){var C=lp_gettld_url(a),I=getsites(C);I=reorderOnURL(I,a,!0),m.sitescount=I.length}}if(n&&(m.actiontlds=n),"all"==e)get_all_windows({populate:!0},function(e){for(var t=0;t<e.length;t++)for(var a=0;a<get_tabs_length(e[t]);a++)sendCS(gettabid(get_tabs(e[t])[a]),m,"all")}),g_generate_pw_pattern_hints={};else{if(sendCS(e,m,t),g_cpwbot&&CPWbot_bg){var O={cmd:"loadurl",docnum:t,tld:lp_gettld_url(a),url:a};CPWbot_bg.push_event_queue("loadurl",e,O)}g_generate_pw_pattern_hints[e]=null}}function get_registry_value(e,t,a,n){var o=a;g_is_win&&have_binary_function("get_registry_value")?call_binary_function("get_registry_value",e,t,a,function(e){"string"!=typeof e&&(e=a),n(e)}):n(o)}function gotourl(e){var t=get_record(e);if(t){var a=geturlfromacct(t);""!=a&&(a.match(/^[a-z]+?\:\/\//i)||(a="http://"+a),openURL(a))}}function deleteNever(e,t){var a=void 0!==t&&t,n=0;switch(e.type){case"nevergenerates":n=1;break;case"neverformfills":n=2;break;case"neverautologins":n=3;break;case"neverautofills":n=4;break;case"nevershowicons":n=6;break;case"neverenablelp":n=8}var o="delete=1&type="+LP.en(n)+"&url="+LP.en(e.url);lpMakeRequest(base_url+"add_never.php",o,function(t){if(4==t.readyState&&200==t.status&&null!=t.responseXML&&null!=t.responseXML.documentElement){var n=t.responseXML.documentElement,o=n.getElementsByTagName("ok"),r=n.getElementsByTagName("error");if(o.length>0){for(var i=new Array,s=0;g_neverurls[e.type]&&s<g_neverurls[e.type].length;s++){var l=g_neverurls[e.type][s];l!=e.url&&i.push(l)}g_neverurls[e.type]=i,g_local_accts_version++,rewritelocalfile()}else if(r.length){var _=r[0].getAttribute("message");_&&(a||LP.alert(_))}}},function(){},null)}function db_prepend(e){return LPISLOC&&(e="local_"+e),e}function changemasterpassword(){setTimeout(function(){openbaseurl("?ac=1&opensettings=1")},100)}function change_master_password(e,t,a,n){var o=get_key_iterations(e),r=make_lp_key_iterations(e,t,o),i=[],s=[],l=[],_=[],c=getBG();if(!(c.reencrypt(i,c.g_sites,r)&&c.reencrypt(s,c.g_securenotes,r)&&c.reencrypt(l,c.g_applications,r)&&c.reencrypt(_,c.g_formfills,r)))return alertfrombg(gs("An error occurred")),void(a&&n&&n());if(a){var g=c.g_local_key;c.g_local_key=r,c.g_local_key_hex=AES.bin2hex(r),c.g_local_key_hash=SHA256(r);var d=flattendata(g_local_accts_version+1,i,s,g_prompts,_,g_identities,g_equivalentdomains,g_neverurls,g_premium_exp,lpenc(e),g_pendings,g_shareeautopushes,lpmaxid,g_urlrules,g_prefoverrides,g_shares,l,g_enterpriseuser,lp_attaches);return c.g_local_key=g,c.g_local_key_hex=AES.bin2hex(g),c.g_local_key_hash=SHA256(g),n&&n(d),d}c.g_sites=i,c.g_securenotes=s,c.g_applications=l,c.g_formfills=_,c.g_local_accts_version++,c.g_local_key=make_lp_key_iterations(e,t,o),c.g_local_hash=lphash=make_lp_hash_iterations(c.g_local_key,t,o),c.g_local_key_hex=AES.bin2hex(c.g_local_key),c.g_local_key_hash=SHA256(c.g_local_key),c.g_username=e,c.g_username_hash=lpusername_hash=SHA256(e),c.rewritelocalfile(!1,!0),c.g_pwdeckey=c.g_local_key,c.lpWriteKeyFile(),c.lpnp_notify("local_pwchange",{data0:g_username,data1:t}),alertfrombg(gs("Password updated!")),c.closecurrenttab("")}function reencrypt(e,t,a){for(var n in t){var o=[];if(!reencryptArray(o,t[n],a,!1))return!1;e[n]=o}return!0}function reencryptArray(e,t,a,n){try{for(var o in t)if("object"==typeof t[o]){var r=[],i="custom_fields"==o?2:n||"fields"==o;if(!reencryptArray(r,t[o],a,i))return!1;e[o]=r}else if(lp_in_array(o,keystoreencrypt)||"value"==o&&(2==n||n&&fieldisencrypted(t))){var s=lpmdec(t[o],!0);if((null==s||""==s)&&null!=t[o]&&""!=t[o])return!1;var l=lpmenc(s,!0,a);e[o]=l}else e[o]=t[o]}catch(e){return console_error(e),!1}return!0}function fieldisencrypted(e){for(var t in e){if("type"==t&&("password"==e[t]||"text"==e[t]||"hidden"==e[t]||"textarea"==e[t]||"email"==e[t]||"tel"==e[t]))return!0;if("id"==t)return!0}return!1}function clearrecent(){"undefined"!=typeof localStorage&&(localStorage_setItem(g_username_hash+"recent",lp_get_gmt_timestamp()),lpclearrecent=!0)}function getClearRecentTime(){if("undefined"==typeof localStorage)return 0;var e=localStorage_getItem(g_username_hash+"recent");return null==e?0:e}function getRecentCount(){return lpGetPref("recentUsedCount",10)}function IsIconsUpdated(e){return lpclearrecent?(lpclearrecent=!1,!0):g_icons_length!=e}function upgradetoserver(){(g_isopera||confirm(gs("Please note that upgrading from LastPass Local to LastPass Online will result in your password data being uploaded in its encrypted format to LastPass servers.  You will be able to access your data from anywhere, and LastPass will not be able to read it.  Would you like to continue?")))&&security_prompt(function(){LPPlatform.openTabDialog("createAccountSimple")})}function renameGroup(e,t,a,n,o){a=a||{},a.successCallback=n,a.errorCallback=o;var r=void 0!==a.skipConfirm&&a.skipConfirm;if(e!=gs("favorites")&&e!=gs("recently usedlower")){var i=issharedfolder(g_shares,e);if(0!=i&&i.decsharename==e)return void alertfrombg("You cannot rename a top level Shared folder");var s=issharedfolder(g_shares,t);if(checkmove(s,i)&&checkreadonly(s)&&checkreadonly(i)){var l=0==s?g_local_key:s.sharekey,_=t;if(s&&(_=t.substr(s.decsharename.length+1)),(s||i)&&(!s||!i||s.id!==i.id)){var c=[],g=[],d=[g_sites,g_securenotes,g_applications];s&&t.substr(s.decsharename.length+1);for(var p in d){var u=d[p];for(var f in u){var m=u[f];if(m.group==e||0==m.group.indexOf(e+"\\")){c[c.length]=get_record_id(m);var h=t;m.group!=e&&m.group.indexOf("\\")>0&&(h=t+m.group.substr(m.group.indexOf("\\"))),g[get_record_id(m)]=h}}}return void moveIntoSharedFolder(s,i,c,g,!1,!1,r,a)}var d=[g_sites,g_securenotes,g_applications],b=[],v=[],y=[];for(var p in d){var u=d[p];for(var f in u){var m=u[f];if(m.group==e){m.group=t,void 0===b[e]?(y[y.length]=e,v[e]=get_record_id(m)):v[e]+=","+get_record_id(m);var _=t;s&&(_=_.substr(s.decsharename.length+1)),b[e]=_}else if(0==m.group.indexOf(e+"\\")){var w=m.group;m.group=m.group.replace(e+"\\",t+"\\"),void 0===b[w]?(y[y.length]=w,v[w]=get_record_id(m)):v[w]+=","+get_record_id(m);var _=m.group;s&&(_=_.substr(s.decsharename.length+1)),b[w]=_}}}g_local_accts_version++,rewritelocalfile(),n&&n();for(var k="xml=1",x=0;x<y.length;x++)k+="&ids"+x+"="+LP.en(v[y[x]])+"&newgrp"+x+"="+LP.en(lpenc(b[y[x]],l));k+=0==s?"":"&sharedfolderid="+en(s.id),lpMakeRequest(base_url+"groups.php",k,function(){},function(){},null)}}}function getacct(e){return get_record(e)}function moveIntoSharedFolder(e,t,a,n,o,r,i,s){var l=e&&t&&e.id===t.id;if(!i&&!l){var _=gs("You are moving sites to a shared folder. This will potentially make them available to others.\n\nAre you sure you would like to continue?");if(void 0!==e&&e?void 0!==t&&t&&(_=gs("You are moving sites to a different shared folder. This may change who has access to the sites.\n\n Do you want to continue?")):_=gs("You are moving sites from a shared folder into your general vault. This will potentially make them unavailable to others.\n\n Do you want to continue?"),!confirm(_))return!1}var c=void 0!==e&&e?e.sharekey:g_local_key,g=void 0!==t&&t?t.sharekey:g_local_key,d=void 0!==e&&e?e.id:g_uid,p=void 0!==t&&t?t.id:"",u="cmd=uploadaccounts&username="+en(g_username),f="",m=new Array,h={};for(var b in a)if(a.hasOwnProperty(b)){if(!("number"==typeof b||"string"==typeof b&&b.match(/^\d+$/)))return alertfrombg(gs("An error occurred")+" i="+gs(b)+" type "+typeof b),!1;var v,y;"object"==typeof a[b]?(y=!1,v=a[b]):(v=getacct(a[b]),y=!0);var w=v.aid,k=!1;if(null==v)return alertfrombg(gs("Error: This folder has already been moved?")),!1;if(void 0!==v.individualshare&&v.individualshare){if(null!=v.sharedfromaid&&""!=v.sharedfromaid&&"0"!=v.sharedfromaid)return alertfrombg(gs("You cannot move individually shared sites into a shared folder.")),!1;if(o||i)k=!0;else{var _=gs("A site that has been previously shared cannot be moved to a shared folder.\n\nWould you like to make a copy?");if(!confirm(_))return!1;k=!0}}if(!r){if(void 0!==v.sharefolderid&&""!=p&&v.sharefolderid!=p&&v.sharefolderid!=d)return alertfrombg(gs("Please move sites from only one shared folder at a time.")),!1;var x={};for(var P in v)v.hasOwnProperty(P)&&(x[P]=v[P]);var S,C=e?n[w].substr(e.decsharename.length+1):n[w];x.group=e?e.decsharename:"",""!=x.group&&""!=C&&(x.group+="\\"),x.group+=C,y&&(x.extra=lpmenc(lpmdec(v.extra,!0,g),!0,c)),is_application(v)?S="&appname"+b+"="+en(v.appname)+"&name"+b+"="+en(lpenc(v.name,c))+"&type"+b+"="+en("cr")+"&group"+b+"="+en(lpenc(C,c))+"&extra"+b+"="+en(crypto_btoa(x.extra))+"&script"+b+"="+en(v.script)+"&pwprotect"+b+"="+en(v.pwprotect?1:0)+"&wininfo"+b+"="+en(v.wininfo)+"&wintitle"+b+"="+en(v.wintitle)+"&exeversion"+b+"="+en(v.exeversion)+"&exehash"+b+"="+en(v.exehash)+"&fiid"+b+"="+en(v.fiid):(y&&(x.username=lpmenc(lpmdec(v.username,!0,g),!0,c)),y&&(x.password=lpmenc(lpmdec(v.password,!0,g),!0,c)),y&&(x.realm_data=lpmenc(lpmdec(v.realm_data,!0,g),!0,c)),S="&url"+b+"="+en(url2hex(v.url))+"&username"+b+"="+en(crypto_btoa(x.username))+"&password"+b+"="+en(crypto_btoa(x.password))+"&name"+b+"="+en(lpenc(v.name,c))+"&type"+b+"="+en("cr")+"&grouping"+b+"="+en(lpenc(C,c))+"&extra"+b+"="+en(crypto_btoa(x.extra))+"&pwprotect"+b+"="+en(v.pwprotect?1:0)+"&realm"+b+"="+en(crypto_btoa(x.realm_data)),v.save_all&&(S+="&save_all"+b+"=1"),void 0!==v.basic_auth&&"1"==v.basic_auth&&(S+="&basic_auth"+b+"=1"),void 0!==v.notetype&&v.notetype&&v.notetype.length&&(S+="&notetype"+b+"="+en(v.notetype)),void 0!==v.template&&v.template&&v.template.length&&(S+="&template"+b+"="+en(v.template))),d!=g_uid?x.sharefolderid=d:void 0!==x.sharefolderid&&delete x.sharefolderid,void 0!==v.attachkey&&""!=v.attachkey&&(y&&(x.attachkey=lpenc(lpdec(v.attachkey,g),c)),S+="&attachkey"+b+"="+en(x.attachkey)),S+="&origaid"+b+"="+LP.en(w);var L="";x.fields=new Array;for(var P=0;P<v.fields.length;P++){x.fields[P]={};for(var I in v.fields[P])v.fields[P].hasOwnProperty(I)&&(x.fields[P][I]=v.fields[P][I]);var O=v.fields[P].value,A=v.fields[P].type;is_application(v)||"text"==A||"email"==A||"tel"==A||"password"==A||"textarea"==A||"hidden"==A?(y&&(x.fields[P].value=lpmenc(lpmdec(O,!0,g),!0,c)),O=crypto_btoa(x.fields[P].value)):"checkbox"!=A&&"radio"!=A||(O+=v.fields[P].checked?"-1":"-0"),is_application(v)?L+="&fields"+b+"id"+P+"="+en(v.fields[P].id)+"&fields"+b+"type"+P+"="+en(v.fields[P].type)+"&fields"+b+"value"+P+"="+en(O):L+="&fields"+b+"name"+P+"="+en(v.fields[P].name)+"&fields"+b+"type"+P+"="+en(v.fields[P].type)+"&fields"+b+"value"+P+"="+en(O)+"&fields"+b+"formname"+P+"="+en(void 0===v.fields[P].formname?"":v.fields[P].formname)}h[w]=x,u+=S,u+=L,k||o||(f+=en(w)+",",m[m.length]=w)}}return!!r||(u+="&sharedfolderid="+en(d),null!=typeof e&&t&&(u+="&origsharedfolderid="+en(t.id)),o||(u+="&todelete="+f),4==(4&g_loglogins)&&(u+="&reportname="+en(v.name)),8==(8&g_loglogins)&&(u+="&reportusername="+en(v.unencryptedUsername)),lpMakeRequest(base_url+"lastpass/api.php",u,function(e,t,n){if(4==e.readyState&&200==e.status&&e.responseXML&&e.responseXML.documentElement){var o=e.responseXML.documentElement.getElementsByTagName("result");if(o.length>0){var r=!0;for(var i in a)if(a.hasOwnProperty(i)){var s="object"==typeof a[i]?a[i]:getacct(a[i]),l=s.aid,_=h[l];if(s&&_)if(is_application(s)){if(lp_in_array(l,m)&&delete g_applications[get_appaid(l)],_.appaid=o[0].getAttribute("aidmap"+l),!_.appaid){r=!1;break}_.appaid=get_appaid(_.appaid),g_applications[_.appaid]=_}else{var c=lp_gettld_url(s.url);if(lp_in_array(l,m)&&("http://sn"==s.url?delete g_securenotes[l]:delete g_sites[l],void 0!==g_tlds[c]&&void 0!==g_tlds[c][l]&&delete g_tlds[c][l]),_.aid=o[0].getAttribute("aidmap"+l),!_.aid){r=!1;break}"http://sn"==_.url?g_securenotes[_.aid]=_:g_sites[_.aid]=_,void 0===g_tlds[c]&&(g_tlds[c]={}),g_tlds[c][_.aid]=!0;for(var g in lp_attaches)if(lp_attaches.hasOwnProperty(g)&&lp_attaches[g].parent==l){var d=lp_attaches[g],p=new Array;for(var u in d)d.hasOwnProperty(u)&&(p[u]=d[u]);var f=d.id;if(p.id=o[0].getAttribute("attachidmap"+f),!p.id){r=!1;break}p.parent=_.aid,lp_in_array(l,m)?lp_attaches[g]=p:lp_attaches[lp_attaches.length]=p}if(!r)break}}r&&n&&n.successCallback&&n.successCallback(h);var b=parseInt(o[0].getAttribute("accts_version"));if(compare_accounts_versions(b,parseInt(g_local_accts_version)+1)&&(g_local_accts_version=b,g_server_accts_version=b,lp_server_attach_version=parseInt(o[0].getAttribute("attachversion")),r))return rewritelocalfile(),refresh_windows(),void checkAttach()}else{var o=e.responseXML.documentElement.getAttribute("rc");if("SERVER_uploadfailed"==o){var v=gs("Your Shared Folder action failed. Please check your permissions before trying again");n&&n.errorCallback?n.errorCallback(v):alertfrombg(v)}else if("SERVER_sharedfolder_passwordsmustbehidden"==o){var v=gs("Your do not have permission to view this account password so you cannot move it from the current Shared Folder.");n&&n.errorCallback?n.errorCallback(v):alertfrombg(v)}else{var v=gs("Your Shared Folder action failed.");n&&n.errorCallback?n.errorCallback(v):alertfrombg(v)}}}get_accts()},function(){var e=gs("An error occurred");s&&s.errorCallback?s.errorCallback(e):alertfrombg(e)},s),!0)}function moveSelectedToGroup(e,t,a,n,o){a=a||{},a.successCallback=n,a.errorCallback=o;var r=void 0!==a.skipConfirm&&a.skipConfirm,i=t.split(","),s=issharedfolder(g_shares,e),l=null;if(checkreadonly(s)){for(var _=!1,c=0;c<i.length;c++){var g=i[c],d=getacct(g);if(l=issharedfolder(g_shares,d.group),!checkreadonly(l))return;if(!checkmove(s,l))return;!s&&!l||s&&l&&s.id===l.id||(_=!0)}if(_){for(var p=[],c=0;c<i.length;c++)p[i[c]]=e;return void moveIntoSharedFolder(s,l,i,p,!1,!1,r,a)}var u=new Array,f=new Array;if(e==gs("favorites"))for(var c=0;c<i.length;c++){var m=getacct(i[c]);m&&"0"==m.fav&&(u[u.length]=i[c])}(i.length>0||u.length>0||f.length>0)&&changeGroupAndFavorites(i,u,f,e,s,a)}}function changeGroupAndFavorites(e,t,a,n,o,r){var i="",s="",l="",_=new Array;updated={};for(var c=0;c<e.length;c++){var g=e[c],d=getacct(g);d&&n!=gs("favorites")&&(_[_.length]=g,d.group=n,updated[d.aid]=d,i+=l+g,l=",")}l="";for(var c=0;c<t.length;c++){var g=t[c],d=getacct(g);d&&(_[_.length]=g,d.fav="1",updated[d.aid]=d,s+=l+g,l=",")}g_local_accts_version++,g_server_accts_version++,rewritelocalfile(),r&&r.successCallback&&r.successCallback(updated);var p=0==o?g_local_key:o.sharekey,u=n;o&&(u=n.substr(o.decsharename.length+1));var f="aids="+LP.en(i)+"&newfavaids="+LP.en(s)+"&oldfavaids="+LP.en("")+"&newgrp="+LP.en(lpenc(u,p))+"&xml=1";f+=0==o?"":"&sharedfolderid="+en(o.id),lpMakeRequest(base_url+"groups.php",f,lpChangeGroupResponse)}function lpChangeGroupResponse(e){e&&4==e.readyState&&200==e.status&&null!=e.responseXML&&e.responseXML.documentElement}function lpReadFile(e,t){have_binary_function("read_file")?call_binary_function("read_file",e,t):t("")}function setup_is_chrome_portable(){have_binary_function("is_chrome_portable")&&call_binary_function("is_chrome_portable",function(e){g_is_chrome_portable=e})}function is_chrome_portable(){return g_is_chrome_portable}function doexportchoose(){openURL(getchromeurl("export_choose.html"))}function doprintchoose(){openURL(getchromeurl("print_choose.html"))}function exportAttachment(e,t,a,n,o,r){if(!can_save_file())return void alertfrombg(gs("This feature is not available in this version. Please install the binary extension by going to https://lastpass.com/dl"));if(a&&""!=a)return void alertfrombg(gs("This attachment needs to be saved first."));var i=function(a){var s=void 0!==a&&a?a:"unknown";lpdec(o,AES.hex2bin(n),function(l){if(!l){if(!o||0==o.length){var _=get_attach_info(t),c=getacct(e);if(_&&c&&"retry"!=a){var g=issharedfolder(g_shares,c.group);get_individual_attachment(_.storagekey,t,0==g?null:g.id,function(e){o=e,i("retry")})}else alertfrombg(gs("Error opening attachment.")+"\nError C\nfrom="+s+"\nattachsize="+(void 0!==o&&null!=o&&void 0!==o.length?o.length:"undefined")+"\nattachkeysize="+(void 0!==n&&void 0!==n.length?n.length:"undefined"));return}return console.error("attach_callback: FAILED TO DECRYPT"),void alertfrombg(gs("Error opening attachment.")+"\nError B\nattachsize="+(void 0!==o&&null!=o&&void 0!==o.length?o.length:"undefined")+"\nattachkeysize="+(void 0!==n&&void 0!==n.length?n.length:"undefined"))}if(!r){r="";for(var d in lp_attaches)if(lp_attaches.hasOwnProperty(d)&&lp_attaches[d].id==t){r=lp_attaches[d].mimetype;break}}var p="";0==r.indexOf("other:application/octet-stream")?p="":0==r.indexOf("other:")?p=r.substring(6):0==r.indexOf("data:image")?p=r.substring(11):0==r.indexOf("data:audio")?p=r.substring(11):alertfrombg(gs("Unexpected data type:")+" "+r);var u,f;""!=p&&check_run_file_extension(p)?u=f="*."+p:(u=gs("Files"),f=p=""),call_binary_function("save_file",l,u,f,!0,p,gs("If not specified, will use a file extension of:")),l=""})};if(n)i();else{var s=getacct(e);lpReadAttach(t,function(e){o=e;var t=issharedfolder(g_shares,s.group),a=0==t?g_local_key:t.sharekey;n=lpdec(s.attachkey,a),i()})}}function doexport(e){if(1==lpGetPref("noexport",0))return void setTimeout(function(){alertfrombg(gs("CompanyPolicyProhibits"))},0);if(!g_generatedpw&&!e)return void security_prompt(function(){doexport(!0)});var t=can_save_file();g_export_output="url,username,password,extra,name,grouping,fav\n";var a=new Array;for(var n in g_sites)check_ident_aid(n)&&"http://group"!=g_sites[n].url&&(a[a.length]=g_sites[n]);for(var n in g_securenotes)check_ident_aid(n)&&(a[a.length]=g_securenotes[n]);for(var o=0;o<a.length;o++){var r=a[o];if(null==r.sharedfromaid||""==r.sharedfromaid||"0"==r.sharedfromaid){var i=new Array;i[0]=r.url,i[1]=getusernamefromacct(r),i[2]=getpasswordfromacct(r),i[3]=lpmdec_acct(r.extra,!0,r,g_shares),i[4]=r.name,i[5]=r.group,i[6]=r.fav;for(var s="",l="",_=0;_<i.length;_++){var c=csv_encode(i[_]);t||(c=of(c)),s+=l+c,l=","}s+="\n",g_export_output+=s}}if(loglogin("export"),t)return void setTimeout(function(){call_binary_function("save_file",g_export_output,gs("CSV Files"),"*.csv",!1,"csv",gs("If not specified, will use a file extension of:"))},1e3);openURL(getchromeurl("export.html"))}function formfillexport(e){if(1==lpGetPref("noexport",0))return void setTimeout(function(){alertfrombg(gs("CompanyPolicyProhibits"))},0);if(!g_generatedpw&&!e)return void security_prompt(function(){formfillexport(!0)});var t=can_save_file(),a=new Array("profilename","profilelanguage","title","firstname","firstname2","firstname3","middlename","lastname","lastname2","lastname3","username","gender","birthday","ssn","company","address1","address2","address3","city","county","state","state_name","zip","country","country_cc3l","country_name","timezone","email","mobileemail","phone3lcc","phone","phoneext","fax3lcc","fax","faxext","evephone3lcc","evephone","eveext","mobilephone3lcc","mobilephone","mobileext","ccname","ccnum","ccstart","ccexp","cccsc","ccissuenum","bankname","bankacctnum","bankroutingnum","notes"),n="",o="";g_export_output="";for(var r=!0,i=0,s=0;s<g_formfills.length;s++)if(check_ident_ffid(g_formfills[s].ffid)){for(var l="",_=0;_<a.length;_++){var c=a[_];r&&(n+=o+csv_encode(c),o=","),g_export_output+=l+csv_encode(lpmdec_acct(g_formfills[s][c],!0,g_formfills[s],g_shares)),l=","}g_formfills[s].custom_fields.length>i&&(i=g_formfills[s].custom_fields.length);for(var g=0;g<g_formfills[s].custom_fields.length;g++)g_export_output+=","+csv_encode(lpmdec_acct(g_formfills[s].custom_fields[g].text,!0,g_formfills[s],g_shares))+","+csv_encode(lpmdec_acct(g_formfills[s].custom_fields[g].value,!0,g_formfills[s],g_shares))+","+csv_encode(lpmdec_acct(g_formfills[s].custom_fields[g].alttext,!0,g_formfills[s],g_shares));g_export_output+="\n",r=!1}for(var g=1;g<=i;g++)n+=","+csv_encode("customfield"+g+"text")+","+csv_encode("customfield"+g+"value")+","+csv_encode("customfield"+g+"alttext");if(g_export_output=n+"\n"+g_export_output,loglogin("export"),t)return void setTimeout(function(){call_binary_function("save_file",g_export_output,gs("CSV Files"),"*.csv",!1,"csv",gs("If not specified, will use a file extension of:"))},1e3);openURL(getchromeurl("export.html"))}function can_save_file(){return!!have_binary_function("save_file")}function fix_tlds(e,t,a){delete g_tlds[e][a],void 0===g_tlds[t]&&(g_tlds[t]={}),g_tlds[t][a]=!0}function increment_local_accts_version(){g_local_accts_version++}function set_editfieldsopener(e){g_editfieldsopener=e}function close_editfieldsopener(){g_editfieldsopener&&(g_editfieldsopener.close(),g_editfieldsopener=null)}function getcurrenturl(){return g_ischrome||g_iscasper?punycode.URLToASCII(g_currenturl):g_issafari?gettaburl(safari.application.activeBrowserWindow.activeTab):g_isopera?opera.extension.tabs.getFocused()?gettaburl(opera.extension.tabs.getFocused()):"":g_ismaxthon?gettaburl(window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab()):g_isfirefoxsdk?gettaburl(g_tabs.activeTab):void 0}function getcurrenttabid(){return g_ischrome||g_iscasper?g_currenttabid:g_issafari?gettabid(safari.application.activeBrowserWindow.activeTab):g_isopera?gettabid(opera.extension.tabs.getFocused()):g_ismaxthon?gettabid(window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab()):g_isfirefoxsdk?gettabid(g_tabs.activeTab):void 0}function getsinglefactortype(e){var t=function(t){var a=lpGetPref("singlefactortype","");g_prefs_read&&t!=a?have_binary_function("file_exists")?call_binary_function("file_exists","singlefactortype",function(n){n||(t=a),setsinglefactortype(t),e(t)}):(setsinglefactortype(a),e(a)):e(t)};have_binary_function("read_file")?call_binary_function("read_file","singlefactortype",function(e){t(lptrim(e))}):t("")}function setsinglefactortype(e){have_binary_function("write_file")&&call_binary_function("write_file","singlefactortype",e);var t=getBG();t.lpPutGblPref("singlefactortype",e),t.lpWriteAllPrefs()}function get_method(){return g_isopera||is_opera_chromium()?"op":is_edge()?"edge":g_isfirefoxwebext?"ff":g_ischrome?"cr":g_issafari?"sfjs":g_ismaxthon?"mx":g_isfirefoxsdk?is_fennec()?"fennec":"ff":void 0}function get_method_async(e){e(get_method())}function select_selectedtabid(){try{if(g_ischrome)-1!=g_selectedtabid&&(chrome.tabs.update(g_selectedtabid,{selected:!0}),chrome.runtime.lastError&&debug&&L(chrome.runtime.lastError));else if(g_issafari)g_selectedtab&&g_selectedtab.activate();else if(g_isopera){var e=opera.extension.tabs.getFocused();e.update({focused:!0})}else g_ismaxthon?window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab().activate():g_isfirefoxsdk&&g_tabs.activeTab.activate()}catch(e){}}function addEmptyGroup(e,t,a){var n=issharedfolder(g_shares,e);if(checkreadonly(n)){var o=0==n?g_local_key:n.sharekey,r=e;if(n){if(!checkreadonly(n))return;r=e.substr(n.decsharename.length+1)}var i=createNewAcct();i.url="http://group",i.group=e,i.aid="0";var s="ajax=1&extjs=1&name=&url="+LP.en(url2hex(i.url))+"&grouping="+LP.en(lpenc(r,o))+"&username=&password=&extra=&aid=0&openid_url=&isbookmark=0";s+=0==n?"":"&sharedfolderid="+en(n.id),s+=get_identity_param(),lpMakeRequest(base_url+"show.php",s,lpSaveSiteResponse,null,{acct:i,successCallback:t,errorCallback:a})}}function hassites(){var e=!1;for(var t in g_sites)if(g_sites.hasOwnProperty(t)){e=!0;break}for(var t in g_securenotes)if(g_securenotes.hasOwnProperty(t)){e=!0;break}return e}function basicauth_found(e,t,a){e!=g_basicauth_found&&(g_basicauth_found=e,e&&get_selected_tab(null,function(e){compare_tlds(lp_gettld_url(a),lp_gettld_url(gettaburl(e)))?(g_basicauth_tabid=gettabid(e),g_basicauth_origurl=punycode.URLToASCII(a),g_basicauth_url=gettaburl(e),g_basicauth_realm=t,handleFill(gettabid(e),{url:gettaburl(e),topurl:gettaburl(e),docid:0,force:!1,docnum:0})):g_basicauth_found=!1}))}function basicauth_save(e,t,a,n,o){if(lpdbg("basicauth","basicauth_save called"),!lploggedin)return void lpdbg("basicauth","not logged in, aborting");if(""!=e||""!=t){if(a||(a=g_basicauth_realm),n||(n=g_basicauth_url),LPContentScriptFeatures.new_save_site)LPTabState.processBasicAuthentication({username:e,password:t,url:n,realm:a});else{var r=lp_gettld_url(n);if(lpdbg("basicauth","tld is "+r),hasNeverSave(n,r))return void lpdbg("basicauth","have a never save for tld, aborting");var i=void 0!==g_tlds[r]?g_tlds[r]:new Array;for(var s in i)if(check_ident_aid(s)&&void 0!==g_sites[s]){var l=g_sites[s];if(e==lpmdec_acct(l.username,!0,l,g_shares)&&t==lpmdec_acct(l.password,!0,l,g_shares))return void lpdbg("basicauth","already saved, aborting")}if(g_notification_type="save",data=new Object,data.username=e,data.password=t,o||(data.realm=a),data.url=n,data.tld=r,g_notification_data=data,0!=lpGetPref("showSaveSiteNotifications",0)&&(lpdbg("basicauth","showing notification"),sendTS({cmd:"notification",type:"save"})),0!=lpGetPref("showSaveNotificationBar",1)&&(lpdbg("basicauth","checking add site"),lpCheckAddSite(data.username,data.password,r))){lpdbg("basicauth","showing notification bar");var _=function(e){sendCS(e,{cmd:"showaddnotification",text:gs("Should LastPass remember this password?"),notificationdata:LPJSON.stringify(data),do_40notify:g_40notify}),g_persistent_notifications[e]={cmd:"showaddnotification",text:gs("Should LastPass remember this password?"),notificationdata:LPJSON.stringify(data),do_40notify:g_40notify}};g_basicauth_tabid?_(g_basicauth_tabid):get_selected_tab(null,function(e){_(gettabid(e))})}}lpdbg("basicauth","basicauth_save done")}}function cmaction_autofill(e,t){var a,n,o;g_ischrome?(a=gettabid(t),o=contextMenuIdToId[e.menuItemId],n=gettaburl(t)):g_isopera?(a=getcurrenttabid(),o=e.target.id,n=e.documentURL):g_isfirefoxsdk&&(a=getcurrenttabid(),n=getcurrenturl(),o=LPContentScriptFeatures.omaria?contextMenuIdToId[e]:e),sendLpImprove("sitelogin",{copy:0,autologin:0,source:"context"}),handleFill(a,{url:n,topurl:n,docid:0,force:!1,docnum:0,cmd:"autofillaid",aid:o,source:"notrack"})}function cmaction_copyusername(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isopera?a=e.target.id:g_isfirefoxsdk&&(a=LPContentScriptFeatures.omaria?contextMenuIdToId[e]:e),copyusername(a),sendLpImprove("copyitem",{itemtype:"username",source:"context"})}function cmaction_copypassword(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isopera?a=e.target.id:g_isfirefoxsdk&&(a=LPContentScriptFeatures.omaria?contextMenuIdToId[e]:e),copypassword(a),sendLpImprove("copypass",{action:"sitepassword",source:"context"})}function cmaction_copyurl(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isopera?a=e.target.id:g_isfirefoxsdk&&(a=e,LPContentScriptFeatures.omaria&&(a=contextMenuIdToId[a])),copyurl(a)}function cmaction_copyprop(e,t){var a,n,o;g_ischrome?(a=contextMenuIdToId[e.menuItemId],n=contextMenuIdToPropType[e.menuItemId],o=contextMenuIdtoJsonPropType[e.menuItemId]):g_isfirefoxsdk&&(a=contextMenuIdToId[e],n=contextMenuIdToPropType[e],o=contextMenuIdtoJsonPropType[e]),copyprop(a,n,0,-1,null,o),sendLpImprove("copyitem",{itemtype:n,source:"context"})}function cmaction_fillitem(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isfirefoxsdk&&(a=contextMenuIdToId[e]),fillitem(a,null,null,0,null,"context")}function cmaction1(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isopera?a=e.target.id:g_isfirefoxsdk&&(a=e),fillform(a,null,null,null,null,null,"context")}function cmaction2(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isopera?a=e.target.id:g_isfirefoxsdk&&(a=e),editprofile(a,null,"context")}function cmaction_editsite(e,t){var a;g_ischrome?a=contextMenuIdToId[e.menuItemId]:g_isfirefoxsdk&&(a=contextMenuIdToId[e]),openeditsite(a),sendLpImprove("edititem",{itemtype:"Saved Site",source:"context"})}function cmaction_edititem(e,t){var a;g_ischrome?(a=contextMenuIdToId[e.menuItemId],proptype=contextMenuIdToPropType[e.menuItemId]):g_isfirefoxsdk&&(a=contextMenuIdToId[e],proptype=contextMenuIdToPropType[e]),openeditsecurenote(a),sendLpImprove("edititem",{itemtype:proptype,source:"context"})}function cmaction(e){var t=e.split("|");if(2==t.length)switch(t[0]){case"cmaction_autofill":cmaction_autofill(t[1]);break;case"cmaction_copyusername":cmaction_copyusername(t[1]);break;case"cmaction_copypassword":cmaction_copypassword(t[1]);break;case"cmaction_copyurl":cmaction_copyurl(t[1]);break;case"cmaction_copyprop":cmaction_copyprop(t[1]);break;case"cmaction_fillitem":cmaction_fillitem(t[1]);break;case"cmaction1":cmaction1(t[1]);break;case"cmaction2":cmaction2(t[1]);break;case"cmaction_editsite":cmaction_editsite(t[1]);break;case"cmaction_edititem":cmaction_edititem(t[1])}}function rebuildcontextonload(){get_selected_tab(null,function(e){rebuildcontext(gettaburl(e))})}function setbadgetextonload(){get_selected_tab(null,function(e){setbadgetext(gettaburl(e))})}function buildMenuRoot(e,t){if(g_ischrome)contextParents[contextParents.length]=chrome.contextMenus.create({title:gs(e),contexts:[context],parentId:toplevelcontextmenu,onclick:t});else if(g_isfirefoxsdk){var a;a=t?g_context_menu.Item({label:gs(e),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:t}):g_context_menu.Menu({label:gs(e)}),contextParents[contextParents.length]=a,toplevelcontextmenu.addItem(a)}}function buildMenuItem(e,t,a,n,o){var r=null;g_ischrome?r=chrome.contextMenus.create({title:t,contexts:[context],parentId:contextParents[contextParents.length-1],onclick:o}):g_isfirefoxsdk&&(r=menuIdCounter++,contextParents[contextParents.length-1].addItem(g_context_menu.Item({label:gs(t),data:o.name+"|"+r,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}}))),null!=r&&(contextMenuIdToId[r]=e,null!=a&&(contextMenuIdToPropType[r]=a,contextMenuIdtoJsonPropType[r]=n))}function rebuildcontext(e){if(setcurrenturl(e),(!g_ischrome||"undefined"!=typeof chrome&&void 0!==chrome.contextMenus)&&(!g_isopera||opera.contexts.menu)&&!g_issafari&&!g_ismaxthon&&!(g_isfirefoxsdk&&"undefined"==typeof g_context_menu||is_guiless()||1==lpGetPref("hideContextMenus",0)||lastcontexturl==e)){if(lastcontexturl=e,g_ischrome){if(contextParents.length)return void createContextMenus(function(){lastcontexturl=null,rebuildcontext(e)})}else if(g_isopera){for(var t=opera.contexts.menu.length-1;t>=0;t--)opera.contexts.menu.removeItem(t);contextParents=[]}else if(g_isfirefoxsdk){for(var t=contextParents.length-1;t>=0;t--)contextParents[t].destroy();contextParents=[],toplevelcontextmenu&&(toplevelcontextmenu.destroy(),toplevelcontextmenu=null)}contextMenuIdToId=[];var a=can_copy_to_clipboard(),n=a?6:3;if(LPContentScriptFeatures.omaria&&(g_ischrome||g_isfirefoxsdk)){g_isfirefoxsdk&&(toplevelcontextmenu=g_context_menu.Menu({label:gs("LastPass"),image:self.data.url("images/icon16.png"),context:g_context_menu.PredicateContext(function(){return!0})}));var o=lp_gettld_url(e),r=reorderOnURL(getsites(o),e,!0,!1);r.forEach(function(e){var t=e.useusername?" - "+e.useusername:"";buildMenuRoot(e.name+t),buildMenuItem(e.aid,"Fill",null,null,cmaction_autofill),buildMenuItem(e.aid,"Edit",null,null,cmaction_editsite),a&&(buildMenuItem(e.aid,"Copy username","Username",null,cmaction_copyusername),buildMenuItem(e.aid,"Copy password","Password",null,cmaction_copypassword))});for(var i=Object.keys(g_securenotes),s=[],l=0;l<i.length;l++)check_ident_aid(g_securenotes[i[l]].aid)&&fillableNoteTypes.indexOf(g_securenotes[i[l]].notetype)>-1&&s.push(addUserFriendlyDescription(g_securenotes[i[l]]));s.sort(function(e,t){return e.name.localeCompare(t.name)});for(var l=0;l<s.length;l++){var _=s[l];switch(buildMenuRoot(_.decprofilename+"  -  "+_.description),buildMenuItem(_.aid,"Fill",null,null,cmaction_fillitem),buildMenuItem(_.aid,"Edit",_.notetype,null,cmaction_edititem),_.notetype){case"Credit Card":buildMenuItem(_.aid,"Copy card number","Number",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy CVV/Security code","Security Code",null,cmaction_copyprop);break;case"Bank Account":buildMenuItem(_.aid,"Copy account number","Account Number",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy routing number","Routing Number",null,cmaction_copyprop);break;case"Address":buildMenuItem(_.aid,"Copy first name","First Name",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy last name","Last Name",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy address 1","Address 1",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy city/town","City / Town",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy zip/postal code","Zip / Postal Code",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy email address","Email Address",null,cmaction_copyprop),buildMenuItem(_.aid,"Copy phone number","Phone","num",cmaction_copyprop);break;case"Social Security":buildMenuItem(_.aid,"Copy SSN","Number",null,cmaction_copyprop)}}buildMenuRoot("Add Item",function(){openaddsecurenote()}),buildMenuRoot("Recheck Page",function(e,t){recheckpage()}),buildMenuRoot("Generate Secure Password",opengenpw)}if(!lploggedin)return void(g_isopera?(toplevelcontextmenu=opera.contexts.menu.createItem({title:gs("LastPass"),icon:"images/icon16.png",onclick:open_login}),opera.contexts.menu.addItem(toplevelcontextmenu)):g_isfirefoxsdk&&(toplevelcontextmenu=g_context_menu.Item({label:gs("LastPass"),image:self.data.url("images/icon16.png"),context:g_context_menu.PredicateContext(function(){return!0}),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){open_login()}})));g_ischrome&&!LPContentScriptFeatures.omaria?(contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("AutoFill"),contexts:[context],parentId:toplevelcontextmenu}),a&&(contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy Username"),contexts:[context],parentId:toplevelcontextmenu}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy Password"),contexts:[context],parentId:toplevelcontextmenu}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy URL"),contexts:[context],parentId:toplevelcontextmenu})),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Recheck Page"),contexts:[context],parentId:toplevelcontextmenu,onclick:function(e,t){recheckpage()}}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Generate Secure Password"),contexts:[context],parentId:toplevelcontextmenu,onclick:opengenpw}),void 0!==g_prefoverrides.show_formfills&&"1"!==g_prefoverrides.show_formfills||(contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Fill Forms"),contexts:[context],parentId:toplevelcontextmenu}))):g_isopera?(toplevelcontextmenu=opera.contexts.menu.createItem({title:gs("LastPass"),icon:"images/icon16.png",type:"folder"}),opera.contexts.menu.addItem(toplevelcontextmenu),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("AutoFill"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),a&&(contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy Username"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy Password"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy URL"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1])),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Recheck Page"),onclick:function(e){recheckpage()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Generate Secure Password"),onclick:opengenpw}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),void 0!==g_prefoverrides.show_formfills&&"1"!==g_prefoverrides.show_formfills||(contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Fill Forms"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]))):g_isfirefoxsdk&&!LPContentScriptFeatures.omaria&&(toplevelcontextmenu=g_context_menu.Menu({label:gs("LastPass"),image:self.data.url("images/icon16.png"),context:g_context_menu.PredicateContext(function(){return!0})}),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("AutoFill")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),a&&(contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy Username")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy Password")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy URL")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1])),contextParents[contextParents.length]=g_context_menu.Item({label:gs("Recheck Page"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){recheckpage()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Item({label:gs("Generate Secure Password"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){opengenpw()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),void 0!==g_prefoverrides.show_formfills&&"1"!==g_prefoverrides.show_formfills||(contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Fill Forms")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1])));var o=lp_gettld_url(e),r=reorderOnURL(getsites(o),e,!0,!1);r.sort(function(e,t){return e.name&&t.name?e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0:0}),r.length>0?set_badge_text(r.length):clear_badge_text();for(var t=0;t<r.length;t++)for(var c=0;c<=(a?3:0);c++){var g=r[t].useusername;g=void 0!==g&&g.length?" ("+g+")":"";var d=0==c?cmaction_autofill:1==c?cmaction_copyusername:2==c?cmaction_copypassword:cmaction_copyurl;if(g_ischrome&&!LPContentScriptFeatures.omaria){var p=chrome.contextMenus.create({title:r[t].name+g,contexts:[context],parentId:contextParents[c],onclick:d});contextMenuIdToId[p]=r[t].aid,contextParents[contextParents.length]=p}else if(g_isopera)contextParents[c].addItem(opera.contexts.menu.createItem({title:r[t].name+g,onclick:d,id:r[t].aid}));else if(g_isfirefoxsdk&&!LPContentScriptFeatures.omaria){var u=r[t].name+g;""==u&&(u=" "),contextParents[c].addItem(g_context_menu.Item({label:u,data:d.name+"|"+r[t].aid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}}))}}if(0==r.length)for(var c=0;c<=(a?3:0);c++)g_ischrome&&!LPContentScriptFeatures.omaria?chrome.contextMenus.create({title:gs("No Matching Sites!"),contexts:[context],parentId:contextParents[c]}):g_isopera?contextParents[c].addItem(opera.contexts.menu.createItem({title:gs("No Matching Sites!")})):g_isfirefoxsdk&&!LPContentScriptFeatures.omaria&&contextParents[c].addItem(g_context_menu.Item({label:gs("No Matching Sites!")}));if(void 0===g_prefoverrides.show_formfills||"1"===g_prefoverrides.show_formfills){for(var c=0;c<g_formfills.length;c++)if(check_ident_ffid(g_formfills[c].ffid))if(g_ischrome&&!LPContentScriptFeatures.omaria){contextParents[contextParents.length]=chrome.contextMenus.create({title:g_formfills[c].decprofilename,contexts:[context],parentId:contextParents[n]});var p=chrome.contextMenus.create({title:gs("Fill Form"),contexts:[context],parentId:contextParents[contextParents.length-1],onclick:cmaction1});contextMenuIdToId[p]=g_formfills[c].ffid;var p=chrome.contextMenus.create({title:gs("Edit"),contexts:[context],parentId:contextParents[contextParents.length-1],onclick:cmaction2});contextMenuIdToId[p]=g_formfills[c].ffid}else if(g_isopera){var f=opera.contexts.menu.createItem({title:g_formfills[c].decprofilename,type:"folder"});contextParents[n].addItem(f),f.addItem(opera.contexts.menu.createItem({title:gs("Fill Form"),onclick:cmaction1,id:g_formfills[c].ffid})),f.addItem(opera.contexts.menu.createItem({title:gs("Edit"),onclick:cmaction2,id:g_formfills[c].ffid}))}else if(g_isfirefoxsdk&&!LPContentScriptFeatures.omaria){var u=g_formfills[c].decprofilename;""==u&&(u=" ");var f=g_context_menu.Menu({label:u});contextParents[n].addItem(f),f.addItem(g_context_menu.Item({label:gs("Fill Form"),data:"cmaction1|"+g_formfills[c].ffid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}})),f.addItem(g_context_menu.Item({label:gs("Edit"),data:"cmaction2|"+g_formfills[c].ffid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}}))}g_ischrome&&!LPContentScriptFeatures.omaria?(contextParents[contextParents.length]=chrome.contextMenus.create({type:"separator",parentId:contextParents[n]}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Add Profile"),contexts:[context],parentId:contextParents[n],onclick:function(){addprofile(null,"context")}}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Add Credit Card"),contexts:[context],parentId:contextParents[n],onclick:function(){addcreditcard(null,"context")}}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Clear Forms"),contexts:[context],parentId:contextParents[n],onclick:function(){clearforms("context")}}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Choose Profile and Credit Card"),contexts:[context],parentId:contextParents[n],onclick:function(){openchooseprofilecc("context")}})):g_isopera?(contextParents[n].addItem(opera.contexts.menu.createItem({type:"line"})),contextParents[n].addItem(opera.contexts.menu.createItem({title:gs("Add Profile"),onclick:function(){addprofile(null,"context")}})),contextParents[n].addItem(opera.contexts.menu.createItem({title:gs("Add Credit Card"),onclick:function(){addcreditcard(null,"context")}})),contextParents[n].addItem(opera.contexts.menu.createItem({title:gs("Clear Forms"),onclick:function(){clearforms("context")}})),contextParents[n].addItem(opera.contexts.menu.createItem({title:gs("Choose Profile and Credit Card"),onclick:function(){openchooseprofilecc("context")}}))):g_isfirefoxsdk&&!LPContentScriptFeatures.omaria&&(contextParents[n].addItem(g_context_menu.Separator()),contextParents[n].addItem(g_context_menu.Item({label:gs("Add Profile"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){addprofile(null,"context")}})),contextParents[n].addItem(g_context_menu.Item({label:gs("Add Credit Card"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){addcreditcard(null,"context")}})),contextParents[n].addItem(g_context_menu.Item({label:gs("Clear Forms"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){clearforms("context")}})),contextParents[n].addItem(g_context_menu.Item({label:gs("Choose Profile and Credit Card"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){openchooseprofilecc("context")}})))}}}function setbadgetext(e){if(lastbadgeurl!=e){lastbadgeurl=e;var t=lp_gettld_url(e),a=reorderOnURL(getsites(t),e,!0,!1);a.length>0?set_badge_text(a.length):clear_badge_text()}}function createContextMenus(e){lpdbg("context","createContextMenus called"),"undefined"==typeof chrome||void 0===chrome.contextMenus||is_guiless()||context_menus_created&&1!=lpGetPref("hideContextMenus",0)&&!e||(lpdbg("context","not created yet or preference changed"),chrome.contextMenus.removeAll(function(){lpdbg("context","context menu items all removed"),context_menus_created=!1,contextParents=[];0==lpGetPref("hideContextMenus",0)&&(lpdbg("context","creating context menu"),e||(e=cm_callback),toplevelcontextmenu=chrome.contextMenus.create({title:gs("LastPass"),contexts:["all"],onclick:cm_handler},e))}))}function cm_handler(e,t){if(console_log("******Context menu item is clicked****"),e&&(console_log("menuItemId: "+e.menuItemId),console_log("parentMenuItemId: "+e.parentMenuItemId),console_log("mediaType: "+e.mediaType),console_log("linkUrl: "+e.linkUrl),console_log("srcUrl: "+e.srcUrl),console_log("pageUrl: "+e.pageUrl),console_log("frameUrl: "+e.frameUrl),console_log("selectionText: "+e.selectionText),console_log("editable  "+e.editable)),lploggedin){if(g_issafari){var a=new Array,n=new Array;if(LPContentScriptFeatures.omaria)Object.keys(g_securenotes).forEach(function(e){check_ident_aid(g_securenotes[e].aid)&&isFillableNoteType(g_securenotes[e].notetype)&&n.push(g_securenotes[e])});else for(var o=0;o<g_formfills.length;o++)check_ident_ffid(g_formfills[o].ffid)&&(a[a.length]=g_formfills[o]);get_selected_tab(null,function(e){var t=lp_gettld_url(gettaburl(e));sendCS(gettabid(e),{cmd:"showcontext",sites:cache_usernames(reorderOnURL(getsites(t),gettaburl(e),!0,!0)),formfills:LPJSON.stringify(a),securenotes:LPJSON.stringify(n),can_copy:can_copy_to_clipboard()},"all")})}}else open_login()}function cm_callback(){console_log("Context menu callback function called"),context_menus_created=!0}function DeleteOldDynamicFiles(){var e=localStorage_getItem("ff.dat");if(null!=e){var t=e.indexOf("\n");if(-1==t)return;var a=e.substr(0,t);CompareLastPassVersions(ffver,a)>0&&localStorage_removeItem("ff.dat")}}function geteventtargeturl(e){if(g_ismaxthon){var t=geteventtarget(e);return t?t.url:""}if(g_isfirefoxsdk){var t=geteventtarget(e);return t?punycode.URLToASCII(t.url):""}return punycode.URLToASCII(g_isopera?e.message.topurl:e.target.url)}function geteventtarget(e){if(g_ismaxthon){for(var t=window.external.mxGetRuntime().create("mx.browser").tabs,a=0;a<t.length;a++){var n=t.getTab(a);if(n.url==e.topurl)return n}return null}return g_isfirefoxsdk?void 0!==e.worker?e.worker.tab:void 0!==e.target?e.target.tab:null:g_isopera?e.source:e.target}function GetStringResource(e,t){have_binary_function("GetStringResource")?call_binary_function("GetStringResource","",e,t):t("")}function GetImageResource(e,t){have_binary_function("GetImageResource")?call_binary_function("GetImageResource","",e,function(e){t("data:image/png;base64,"+e)}):t("")}function event_dispatch_message(e,t,a){g_isedge?(a.messagetype=t,e.callback(a)):g_issafari?geteventtarget(e).page.dispatchMessage(t,a):g_isopera?(a.messagetype=t,geteventtarget(e).postMessage(a)):g_ismaxthon?(a.messagetype=t,window.external.mxGetRuntime().post(e.pageid,a)):g_isfirefoxsdk&&(a.messagetype=t,e.target.port.emit("message",a))}function gettabidfromevent(e){if(g_isopera){for(var t=opera.extension.windows.getAll(),a=0;a<t.length;a++)for(var n=(get_tabs(t[a]),0);n<get_tabs_length(t[a]);n++)if(punycode.URLToASCII(e.data.topurl)==gettaburl(get_tabs(t[a])[n]))return gettabid(get_tabs(t[a])[n]);return-1}return gettabid(geteventtarget(e))}function LoadData(e,t){var a=new Array,n=localStorage_getItem(e);if(null!=n&&""!=n)for(var o=n.split("\n"),r=0;r<o.length;r++)t&&-1==o[r].indexOf(".")||(a[o[r]]="");if(debug||g_isdebug){var i=Object.keys(a).length;verbose_log("Loaded "+i+" from "+e),write_history({cmd:"LoadData",file:e,num:i})}return a}function LoadSpecialSites(){SpecialSites=LoadData("sites.dat",!0)}function LoadBigIconList(){BigIconList=LoadData("bigicons.dat")}function isSpecialSite(e){return null!=e&&void 0!==SpecialSites[lpcanonizeUrl(e)]}function copytoclipboard(e){if(g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?g_clipboard.set(e):(g_is_win||g_is_mac)&&have_binary_function("copy_to_clipboard")?call_binary_function("copy_to_clipboard",e):Clipboard.copy(e),can_clear_clipboard()){var t=lpGetPref("clearClipboardSecsVal",30);t>0&&setTimeout(function(){clearclipboardif(e)},1e3*t)}return!0}function clearclipboardif(e){g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?g_clipboard.get()==e&&g_clipboard.set(""):(g_is_win||g_is_mac)&&have_binary_function("clear_clipboard_if")&&call_binary_function("clear_clipboard_if",e)}function unlock_plug2web(){g_plug2web_last_initiated=lp_get_gmt_timestamp()}function setup_push_listener(e){if(g_dopushserver){if(60*parseInt(lpGetPref("pollServerVal",15))<=0)return void console.log("No poll timer so no push notifications server.");var t=e.split(" "),a=t[0],n=t[1];push_server_connect(a,n,poll_server_request)}}function shutdown_push_listener(){push_server_disconnect()}function contextMenuOnClick(e,t){console.log("item "+e.menuItemId+" was clicked"),console.log("info: "+JSON.stringify(e)),console.log("tab: "+JSON.stringify(t)),lploggedin||open_login()}function can_copy_to_clipboard(){return!(!g_is_win&&!g_is_mac||!have_binary_function("copy_to_clipboard",!0))||!!(g_ischrome&&!is_firefox_webext()&&!g_isedge||g_isfirefoxsdk&&"undefined"!=typeof g_clipboard)}function can_clear_clipboard(){return!(!g_is_win&&!g_is_mac||!have_binary_function("clear_clipboard_if"))||!(!g_isfirefoxsdk||"undefined"==typeof g_clipboard)}function is_guiless(){return"undefined"!=typeof g_guiless&&1==g_guiless}function skiplogin(){return"undefined"!=typeof g_nologin&&1==g_nologin}function isadmin(){return g_isadmin}function getbaseurl(){return base_url}function update_create_account_data(){}function lpvt_store_data_and_setsinglefactortype(e){var t=getBG();t.have_binary_function("lpvt_store_data")&&t.call_binary_function("lpvt_store_data",e,gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(e){e&&t.setsinglefactortype("vtapi")})}function delete_file(e){var t=getBG();t.have_binary_function("delete_file")&&t.call_binary_function("delete_file",e)}function log(e){console_error(e)}function ReadFileGeneric(e,t,a){var n=function(e){if(lplog("ReadFileGeneric : callback2 called"),null==e)return lplog("ReadFileGeneric : callback2 called -- failed cuz data=null"),void a("");t&&t<e.length&&(lplog("ReadFileGeneric : callback2 called -- truncating from="+e.length+" to="+t),e=e.substring(0,t)),void 0!==a&&(lplog("ReadFileGeneric : callback2 calling callback"),a(e))};have_binary_function("read_file")?(lplog("ReadFileGeneric : calling read_file binary function filename="+e+" filename2="+db_prepend(e)),call_binary_function("read_file",db_prepend(e),n)):(lplog("ReadFileGeneric : calling localStorage_getItem filename="+e),n(localStorage_getItem(e)))}function WriteFileGeneric(e,t){have_binary_function("write_file")?call_binary_function("write_file",db_prepend(e),t):localStorage_setItem(e,t)}function DeleteFileGeneric(e){if(have_binary_function("delete_file"))call_binary_function("delete_file",db_prepend(e));else try{localStorage_removeItem(e)}catch(t){L("Failed to removeItem("+e+") e: "+t)}}function lpevent(e){void 0===g_events[e]&&(g_events[e]=0),g_events[e]=g_events[e]+1}function fastDecryptAttachment(e,t,a,n,o,r){var i=lpdec(n,o);"function"==typeof r&&!have_nplastpass()&&have_pplastpass()?"!"==a.charAt(0)?pplastpass_send_message({cmd:"decryptcbc",key:i,input:a},r):pplastpass_send_message({cmd:"decrypt",key:i,input:a},r):lpdec(a,AES.hex2bin(i),r)}function fastEncryptAttachments(e,t,a){var n=[],o=0;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&o++;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&function(r){enccbc(t[r].bytes,e,function(e){n[n.length]={id:t[r].id,data:e},n.length==o&&a(n)})}(r)}function allow_nplastpass(){if(g_isopera&&g_is_mac){var e=navigator.userAgent.match(/Version\/(\d+)/);if(e&&parseInt(e[1])>=12)return!1}return!0}function get_safari_version(){var e=navigator.appVersion.match(/Version\/(\d+\.\d+)(\.\d+)? Safari/),t=0;return e&&(t=parseFloat(e[1])),t}function handleContextMenu(e){is_guiless()||1==lpGetPref("hideContextMenus",0)||e.contextMenu.appendContextMenuItem("LPContextMenuClick",gs("LastPass"))}function pplastpass_load(e){g_ischrome&&"pplastpass"==e.target.id&&pplastpass_send_message({cmd:"ping"},function(e){"pong"==e&&(g_pplastpass_loaded=!0)})}function pplastpass_message(e){var t=JSON.parse(e.data);if("function"==typeof g_pplastpass_callbacks[t.id]){var a=g_pplastpass_callbacks[t.id];g_pplastpass_callbacks[t.id]=null,a(t.retval)}}function have_pplastpass(){return g_pplastpass_loaded}function pplastpass_send_message(e,t){var a=(new Date).getTime()+"_"+Math.floor(100*Math.random());g_pplastpass_callbacks[a]=t,e.id=a,document.getElementById("pplastpass").postMessage(JSON.stringify(e))}function disablesitealert(e){var t=g_sites[e];if(t){t.noalert=1;var a="id="+LP.en(e),n=issharedfolder(g_shares,t.group);a+=0==n?"":"&sharedfolderid="+en(n.id),lpMakeRequest(base_url+"update_alert.php",a,function(){},function(){}),setTimeout(function(){rewritelocalfile()},0)}}function dopwchange(e,t,a,n){if(!g_cpwbot)return!1;if(!check_ident_aid(e))return!1;var o=get_record(e);if(!o)return!1;var r=o.pwprotect;if(!t&&(r||g_prompts.login_site_prompt))return security_prompt(function(){dopwchange(e,!0,a)}),!1;g_cpwbot&&CPWbot_bg&&(CPWbot_bg.site_html_url=geturlfromacct(o)),CPWbot_bg||"undefined"==typeof CPWbot_bg_lib||(CPWbot_bg=new CPWbot_bg_lib),CPWbot_bg.mark_timestamp("dopwchange"),CPWbot_bg.preinit();var i=((new Date).getTime(),CPWbot_bg.new_session(o.url));return CPWbot_bg.broken_hearted_st_id=setTimeout(function(){CPWbot_bg.broken_hearted(i)},60001),g_ischrome?chrome.tabs.onRemoved.addListener(function(e,t){CPWbot_bg&&e==CPWbot_bg.get_pwchangetabid()&&(verbose_log("tab "+e+" closed, halting"),CPWbatch&&CPWbatch.cpw_get_batchjob_state()&&CPWbatch.cpw_get_batchjob_state()!=F_DONE||cpwbot_halt())}):g_issafari,get_recipe_for_url(o.url,function(t){if(CPWbot_bg&&t){if(CPWbot_bg.mark_timestamp("recipe_callback"),!CPWbot_bg.get_login_url(t))return console_error("bad recipe - login_url property is not defined"),CPWbot_bg.panic("bad recipe"),!1;void 0!==a&&null!==a?(CPWbot_bg.originating_tabid=gettabid(a),CPWbot_bg.originating_tab=a):(CPWbot_bg.originating_tabid=null,CPWbot_bg.originating_tab=null);var n={aid:e,recipe:t};return openURL(CPWbot_bg.get_login_url(t),function(e,t){var n=gettabid(e);if(CPWbot_bg.destination_tabid=n,CPWbot_bg.destination_tab=e,CPWbot_bg.mark_timestamp("openurl_callback"),CPWbot_bg.initialize({tabid:n,aid:t.aid,recipe:t.recipe}),verbose_log("going to run CPWbot_bg.initialize_engine for tabid="+n),CPWbatch&&CPWbatch.cpw_get_batchjob_state()&&CPWbatch.register_worker(n,t.aid),g_issafari&&(e.addEventListener("close",function(){var e=gettabid(this);verbose_log("tab "+e+" closed, halting"),CPWbot_bg&&e==CPWbot_bg.get_pwchangetabid()&&(CPWbatch&&CPWbatch.cpw_get_batchjob_state()&&CPWbatch.cpw_get_batchjob_state()!=F_DONE||cpwbot_halt())},!1),a&&a.addEventListener("close",function(){var e=gettabid(this);verbose_log("site.html was just closed ; site.html="+e+" pwchange tabd="+n),CPWbot_bg&&n==CPWbot_bg.get_pwchangetabid()&&cpwbot_halt()},!1)),!g_robots_txt){CPWbot_bg.do_milestone(n,2,t.recipe),CPWbot_bg.initiate_on_complete(n,t),g_launches[gettabid(e)]=t.aid}},n,!0,!0,!0,!0),!0}return!1}),!0}function disableallalerts(){g_disablepwalerts=!0;lpMakeRequest(base_url+"update_alert.php","all=1",function(){},function(){})}function checkgeneratepassword(e){sendCS(e,{cmd:"checkgeneratepassword"},"all")}function parse_formdata(e){for(var t=e.formdata2.split("\n"),a=!1,n=!1,o="",r="",i=new Array,s=0;s<t.length;s++){var l=t[s],_=l.split("\t");if(4==_.length||5==_.length){var c=decodeURIComponent(_[2]),g=_[3];a&&n||"text"!=g&&"email"!=g&&"tel"!=g||!c.length||(o=c,a=!0),"password"==g&&(i[i.length]=c,!n&&c.length&&(r=c,n=!0))}}e.username=o,e.password=r,e.formdata=e.formdata2}function handleGetNevers(e,t){if(setcurrenturl(t),do_experimental_popupfill){sendCS(e,{cmd:"gotnevers",g_nevers:LPJSON.stringify(getnevers())},"all")}}function isEmptyObject(e){return 0===Object.keys(e).length}function can_allow_reprompt_skip(){return!(g_prompts.company_login_site_prompt||g_prompts.company_copyview_site_prompt)}function update_prefs(){}function changepw_wrapper(e){changePassword(e.newpw,new Array(e.singleaid),void 0!==e.autochange?e.autochange:null)}function openchangepw_wrapper(e){openchangepw(e.newpw,e.tld,void 0===e.excludeid?"":e.excludeid)}function remember_changed_pw(e,t){return e&&t?(verbose_log("storing pw="+(g_show_pw_in_logs||g_isadmin?e:"REDACTED")+" tld="+t+" in g_didchangepw"),g_didchangepw[SHA256(e+t)]=(new Date).getTime(),!0):(verbose_log("tried but failed to store pw="+(g_show_pw_in_logs||g_isadmin?e:"REDACTED")+" tld="+t+" in g_didchangepw"),!1)}function got_inner_text_handler(e,t){g_cpwbot,g_inner_text[e]=t.buf}function got_inner_html_handler(e,t){return!0}function get_cs_inner_text(e,t){sendCS(e,{cmd:"get_inner_text"},t)}function get_cs_inner_html(e,t){sendCS(e,{cmd:"get_inner_html"},t)}function browser_focus(){g_ischrome&&chrome.windows.update(chrome.windows.WINDOW_ID_CURRENT,{focused:!0})}function send_sms_passcodes(e){lpMakeRequest(base_url+"send_sms_passcodes.php",e,function(){alert(gs("An SMS passcode has been sent to your mobile device."))},function(){alert(gs("Request failed; is your Internet connection down?"))})}function create_account_safe(e,t,a){e+="&language2="+encodeURIComponent(getLanguage()),e+="&method="+encodeURIComponent(get_method()),e+=get_devicetype_param(),lpMakeRequest(base_url+"create_account.php",e,function(e){4===e.readyState&&200===e.status&&t(e.responseText)},a)}
function create_account(e,t,a){e+="&language2="+encodeURIComponent(getLanguage()),e+="&method="+encodeURIComponent(get_method()),e+=get_devicetype_param(),lpMakeRequest(base_url+"create_account.php",e,t,a)}function enable_credit_monitoring(e,t,a){lpMakeRequest(base_url+"creditmon.php",e,t,a)}function setup_hotkeys(){if(g_isfirefoxsdk&&"undefined"!=typeof g_ff_hotkeys){for(var e=0;e<g_hotkeys.length;e++)g_hotkeys[e].destroy();g_hotkeys=[];for(var e=0;e<g_lp_hotkeys.length;e++){var t=g_lp_hotkeys[e];!function(e){var t=lpGetPref(e+"KeyCode",0),a=lpGetPref(e+"Mods","");if(0!=t&&""!=a){var n="";-1!=a.indexOf("control")&&(n+="control-"),-1!=a.indexOf("meta")&&(n+="meta-"),-1!=a.indexOf("alt")&&(n+="alt-"),-1!=a.indexOf("shift")&&(n+="shift-"),n+=33==t?"pageup":34==t?"pagedown":35==t?"end":36==t?"home":37==t?"left":38==t?"up":39==t?"right":40==t?"down":189==t?"-":219==t?"[":220==t?"\\":221==t?"]":186==t?";":222==t?"'":188==t?",":187==t?"+":190==t?".":191==t?"/":106==t?"*":192==t?"~":124==t?"printscreen":String.fromCharCode(t).toLowerCase(),g_hotkeys.push(g_ff_hotkeys.Hotkey({combo:n,onPress:function(){processCS(null,{cmd:"runhotkey",hotkey:e})}}))}}(t)}}}function base64_to_binary_ciphertext(e){var t=e.split("|"),a="";if(2==t.length){var n=t[0].slice(1),o=t[1];a="!"+atob(n)+atob(o)}else a="!"==e.charAt(0)?atob(e.slice(1)):"!"+atob(e);return a}function aidkiller(e,t,a){setTimeout(function(){void 0!==a&&a&&(g_cached_hash=null,g_hash_live=0)},t)}function fix_sites_secure_reprompt(){}function fennec_menu(){if(lploggedin){var e=g_chrome.Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(g_chrome.Ci.nsIPromptService),t=e.BUTTON_POS_0*e.BUTTON_TITLE_IS_STRING+e.BUTTON_POS_1*e.BUTTON_TITLE_IS_STRING+e.BUTTON_POS_2*e.BUTTON_TITLE_IS_STRING,a=e.confirmEx(null,gs("LastPass"),null,t,gs("More"),gs("Fill Forms"),gs("AutoFill"),null,{});if(0==a){if(t=e.BUTTON_POS_0*e.BUTTON_TITLE_IS_STRING+e.BUTTON_POS_1*e.BUTTON_TITLE_IS_STRING,0==(a=e.confirmEx(null,gs("More"),null,t,gs("Logoff"),gs("Preferences"),null,null,{})))lplogoff();else if(1==a){var n=[gs("Logoff on browser close"),gs("Logoff after logged in for minutes")],o={};if(e.select(null,gs("Preferences"),gs("Select a preference to edit, then tap OK."),n.length,n,o))switch(o.value){case 0:var r={value:1==lpGetPref("logoffWhenCloseBrowser",0)};e.confirmCheck(null,gs("Logoff on browser close"),null,gs("Logoff on browser close"),r)&&(lpPutGblPref("logoffWhenCloseBrowser",r.value?1:0),lpWriteAllPrefs());break;case 1:var i={value:lpGetPref("logOffAfterLoggedInVal",0)};if(e.prompt(null,gs("Logoff after logged in for minutes"),null,i,null,{})){var s=parseInt(i.value);s>=0&&s<=9999?(lpPutUserPref("logOffAfterLoggedInVal",s),lpWriteAllPrefs()):alert("Invalid value, must be between 0 and 9999.")}}}}else if(1==a)if(0==g_formfills.length)alert(gs("No Form Fill Profiles!"));else{for(var o={},n=new Array,l=0;l<g_formfills.length;l++)n[l]=g_formfills[l].decprofilename;e.select(null,gs("Fill Forms"),null,n.length,n,o)&&fillform(g_formfills[o.value].ffid)}else if(2==a){var _=getmatchingsites();if(0==_.length)alert(gs("No Matching Sites!"));else{for(var o={},n=new Array,l=0;l<_.length;l++){n[l]=_[l].name;var c=getusernamefromacct(_[l]);""!=c&&(n[l]+=" ("+c+")")}e.select(null,gs("AutoFill"),null,n.length,n,o)&&handleFill(getcurrenttabid(),{url:getcurrenturl(),topurl:getcurrenturl(),docid:0,force:!1,docnum:0,cmd:"autofillaid",aid:_[o.value].aid})}}}else open_login()}function getLoginSitePrompt(){return g_prompts.login_site_prompt}function getNameUsernameFromLPA(e){if(!e)return"";var t=e.name,a=getusernamefromacct(e);return""!=a&&(t+=" ("+a+")"),t}function get_breach_data(){return g_breach_data}function needs_secure_reprompt(e){if(!e)return!1;if("string"==typeof e.appaid)return!1;var t=get_record(e.aid);for(var a in t)if(t[a]==SecureReprompter.secure_reprompt_token)return!0;for(var a in t.fields)if(t.fields[a]==SecureReprompter.secure_reprompt_token)return!0;return!1}function frame_and_topdoc_has_same_domain(e){var t=ftd_get_frameparenturl(e),a=ftd_get_topurl(e);return!!(t&&a&&compare_tlds(lp_gettld_url(a),lp_gettld_url(t)))}function ftd_report_error(e,t){var a=sprintf("cmd=showiframeconfirm type=%s tldurl=%s tldurliframe=%s",t,lpcanonizeUrl(ftd_get_topurl(e)),lpcanonizeUrl(ftd_get_frameparenturl(e)));return lplog("ftd_report_error : "+a),lpReportError(a)}function ftd_get_frameparenturl(e){return null===g_popup_url_by_tabid||null===e||void 0===g_popup_url_by_tabid[e]?"":g_popup_url_by_tabid[e]}function ftd_get_topurl(e){if(null===g_CS_tops||null===g_CS||void 0===g_CS[e]||null===g_CS[e]||null===e)return"";var t="",a=g_CS_tops[e];if(void 0===a||null===a){if(console.warn("no topdocnum for tabid="+e),g_ischrome)try{var n;for(n in g_CS[e])if(g_CS[e].hasOwnProperty(n)&&void 0!==g_CS[e][n].sender&&g_CS[e][n].sender&&g_CS[e][n].sender.tab&&g_CS[e][n].sender.tab.url){t=g_CS[e][n].sender.tab.url;break}}catch(e){}return t}if(g_CS[e]){var o=g_CS[e][a];o&&!(t=gettaburl(o))&&o.name&&(t=o.name)}return t}function lpConfirmYesNo(e,t){return confirm(e)}function getnevers_given(e,t){function a(e,t,a,n,o,r){if(g_neverurls[t]&&g_neverurls[t].length>0)for(var i=0;g_neverurls[t]&&i<g_neverurls[t].length;i++){var s=g_neverurls[t][i];s==a?(e.push({type:t,url:s,domain:0}),e.push({type:t,url:o,domain:0})):s==n&&(e.push({type:t,url:s,domain:1}),e.push({type:t,url:r,domain:1}))}}if(e)var n=e,o=getcurrenturl(),r=lp_gettld_url(o);else var o="",r="",n=getcurrenturl();var i=lp_gettld_url(n),s=lpcanonizeUrl(n),l=[];return t&&(l=t),a(l,"neveraccounts",s,i,o,r),a(l,"neverautologins",s,i,o,r),a(l,"neverformfills",s,i,o,r),a(l,"nevergenerates",s,i,o,r),a(l,"neverautofills",s,i,o,r),a(l,"nevershowicons",s,i,o,r),a(l,"neverenablelp",s,i,o,r),l}function openlastpasslegacy(){g_legacy_enabled&&(unlock_plug2web(),openURL(base_url+"?dolegacy=1&lpnorefresh=1"))}function get_browser_history_tlds(e){var t=function(t){for(var a=new Object,n=0;n<t.length;n++)a[lp_gettld_url(t[n].url)]=!0;e(Object.keys(a))};return g_isfirefoxsdk&&"undefined"!=typeof g_places_history?void g_places_history.search().on("end",t):g_ischrome&&void 0!==chrome.permissions?void chrome.permissions.contains({permissions:["history"]},function(e){e?void 0!==chrome.history?chrome.history.search({text:"",startTime:0,endTime:(new Date).getTime(),maxResults:0},t):alert(gs("Please restart your browser to finish enabling history.")):chrome.permissions.request({permissions:["history"]},function(e){e&&alert(gs("Please restart your browser to finish enabling history."))})}):g_issafari&&have_binary_function("get_safari_history")?void call_binary_function("get_safari_history",function(e){for(var a=""!=e?e.split("\n"):new Array,n=0;n<a.length;n++)a[n]={url:a[n]};t(a)}):void t(new Array)}function get_equiv_domains_for_tab(e){}function start_trial(){var e=multifactor_getdata("postdata");return!(!g_trial_available||!e||""==e)&&(e+="&starttrial=1",lpMakeRequest(base_url+"login.php",e,lpLoginResponse,lpLoginError),!0)}function cleardeccache(){"undefined"!=typeof mdec_cache&&(mdec_cache=new Array),"undefined"!=typeof mdec_cache_key&&(mdec_cache_key=null)}function is_human_initiated_action(e){var t=!1;return lp_in_array(e.cmd,["fillfield","fillbest"])&&e.manualfill&&(t=!0),t}function repromptSuccess(){g_reprompt_callback()}function get_plugin_capabilities_handler(e,t){try{var a={lpversion:lpversion,have_nplastpass:have_nplastpass(),nplastpass_version:get_nplastpass_version(),have_native_messaging:have_native_messaging(),have_native_messaging_permission:g_have_native_messaging_permission,have_ws:have_ws(),have_pplastpass:have_pplastpass(),can_cpwbot:g_cpwbot?1:0,can_disable_lp:1};e&&sendCS(e,{cmd:"got_plugin_capabilities",capabilities:JSON.stringify(a)})}catch(e){return console_warn(e),!1}return!0}function refreshGroupNames(e){LPPlatform.refreshGroupNames(e)}function showModalOverlay(e){LPPlatform.showModalOverlay(e)}function removeModalOverlay(e){LPPlatform.removeModalOverlay(e)}function autoChangePassword(e){editAid(e,null,null,"1")}var g_CS={},g_CS_count={},g_CS_tabs={},g_nexttabid=1,g_CS_tops={},g_breach_data=null,g_secret_cache={},g_cached_hash=null,g_hash_live=0,g_breach_alert_set=0,poll_timeout=6e4,debug=!1,g_possiblemax_tuple=[],g_local_key=null,g_local_key_hex=null,g_local_hash=null,g_local_key_hash=null,g_username=null,g_username_hash=null,g_uid=null,g_cid=null,g_pwdeckey=null,g_token="",g_identity="",g_sites={},g_tlds={},g_securenotes={},g_applications={},g_prompts={},g_local_accts_version=-1,g_server_accts_version=-1,g_identities=[],g_formfills=[],g_neverurls=new Array,g_equivalentdomains={},g_urlrules=new Array,g_prefoverrides={},g_pendings=new Array,g_pending_shares=new Array,g_shareeautopushes=new Array,g_shareeautopushests=0,g_loglogins=!1,g_isadmin=!1,g_iscompanyadmin=!1,g_showcredmon=!1,g_launches=new Array,g_last_launch=new Array,ischrome=!0,g_icons=new Array,g_bigicons={},g_bigsquareicons={},g_icons_length=0,g_loggedinoffline=!1,g_loggedinonline=!1,g_shares=new Array,g_emer_sharers=[],g_emer_sharees=[],g_totp={},g_multifactorscore=0,g_disablepwalerts=-1,g_notification_type=null,g_notification_data=null,g_site_data=null,g_img_data=null,g_audio_data=null,g_formfill_data=null,g_reprompt_callback=null,g_reprompt_error_callback=null,g_omnikey_callback=null,g_premium_exp=0,g_enterpriseuser=0,g_enterprisemodel=0,g_lastpollcheck=0,g_lastpoll=0,g_logoff_other_ses=!1,g_generatedpw=!1,g_gblprefs={},g_gblprefs_changed={},g_userprefs={},g_userprefs_changed={},g_fillfieldsmatches=new Array,g_fillfieldsmatchescurridx=new Array,g_fillfield_confirm_perfield={},g_fillfield_did_fillbest={},g_currenturl="",g_currenttabid="",g_tabsWithForms=[],g_badgedata=null,g_saveall_url,g_saveall_framestotal,g_saveall_framesdone,g_saveall_docnumsdone,g_saveall_formdata,g_saveall_tabid,g_saveall_done,g_genpws=new Array,g_genpws_date=new Array,g_lp_hotkeys=new Array("generateHk","recheckHk","searchHk","nextHk","prevHk","homeHk","submitHk","saveallHk","logoffHk","defaultffidHk","openpopoverHk"),g_generate_url="",g_generate_url_prev="",g_changepwnewpw="",g_changepwtld="",g_changepwexcludeid=0,g_curr_fill_aid=0,g_is_win="undefined"!=typeof navigator&&-1!=navigator.appVersion.indexOf("Windows"),g_is_mac="undefined"!=typeof navigator&&-1!=navigator.appVersion.indexOf("Mac"),g_is_linux="undefined"!=typeof navigator&&(-1!=navigator.appVersion.indexOf("Linux")||-1!=navigator.appVersion.indexOf("X11")),g_can_open_popover="undefined"!=typeof SafariExtensionPopover,g_retryonlinetimerid=null,g_notifytimerid=null,g_loggedLogins=new Array,g_master_password_saved=!1,g_create_account_data=null,g_nplastpass=null,g_loginstarted=!1,g_persistent_notifications=new Array,g_rejectedaddsites=new Array,g_checkgeneratepasswordcallback=null,g_db_transaction_tested=!1,g_db_transaction_worked=!1,g_events=[],g_offer_popupfill=!1,g_offer_popupfill=!0,do_experimental_popupfill=g_offer_popupfill,g_is_selenium=!1,g_selenium_bits=-1,g_lp_mpw_user="",g_hidevault=!1,g_hideshowvault=!1,g_hidenotes=!1,g_hideidentities=!1,g_hideexport=!1,g_hideimport=!1,g_hidesharing=!1,g_hideprint=!1,g_hidecreate=!1,g_hidecreatepop=!1,g_hideacctsettings=!1,g_nopoll=!1,g_norecovery=!1,g_nosharingkeys=!1,g_skiphttptest=!0,g_hidesearch=!1,g_hidehelptranslate=!1,g_hidesessions=!1,g_hideseccheck=!1,g_hidelogoffprefs=!1,g_hidescreenkeyboard=!1,g_hideabout=!1,g_hiderecheckpage=!1,g_hidecheckupdates=!1,g_hidegopremium=!1,g_hideappearancebox=!1,g_hiderecentlyusedlistsize=!1,g_helpurl=base_url+"help.php?fromwebsite=1",g_dopushserver=!0,g_checkiterationsreduction=!0,g_forgotpwurl=base_url+"forgot.php",g_vaulturloverride="",g_protect_plug2web=!0,g_shownewloginoption=!0,g_hideopenfavs=!1,g_hidelicenselink=!1,g_hideaboutmanuallink=!1,g_showvaultdefault=0,g_showvaultalways=0,g_hidesaedhotkey=!1,g_hidemenubar=!1,g_showupgradenotes=!0,g_showhistorylinks=!0,g_useshortlang=!1,g_showweakdupalerts=!0,g_runchallenge=!0,g_skipurltest=!1,lppassusernamehash=!1,lpusername=null,lphash=null,lp_rsaprivatekeyhex="",lp_rsaprivatekeyenchex="",lp_rsaprivatekeyenchexserverhash="",g_privkeyattempts=0,g_selectedtabid=-1,g_selectedtab=null,g_export_output="",g_editfieldsopener=null,g_currenttld=null,g_attachname="",g_attachbytes="",SpecialSites={},BigIconList=null,g_cachedffdat=null,g_didchangepw=[],g_plug2web_timeout=20,g_plug2web_last_initiated=0,g_wlan_works=!1,g_wlan_has_exe=!1,LPContentScriptFeatures={intro_tutorial_version:"vault"},g_opera_button=null,g_firefox_login_panel=null,g_firefox_panel=null,g_firefox_preload_menu=!0,g_firefox_delay_menu_data=!0,g_firefox_button_clicked=!1,g_firefox_html_panel=null,g_firefox_html_dialog=null,g_username_vals=new Array,g_datacache=[],g_prefs_read=!1,g_manual_login=!1,g_pplastpass_loaded=!1,g_enable_full_menu=!0,g_flags={},g_basicauth_timer_started=!1,g_onload_started=!1,g_pending_launch=null,pass=!0,g_show_pw_in_logs=!1,g_innerHTML_debug=!1,g_robots_txt=!1,g_skip_ad_frames=!0,g_pending_pw_change={},g_fennec_menu_id=null,g_sharing_enabled=!0,g_folder_sharing_enabled=!0,g_generate_pw_pattern_hints={},g_queeg_mode=!1,g_legacy_enabled=!1,g_enable_checkpoint=!1,g_lp_model=1,g_trial_available=!1,g_is_recovery_login=!1,HUMANIZE_DELAY_QUANTUM=401,g_last_ui_warning=0,g_40notify=!0,g_40fieldicon=!0,g_usercache={},g_ask_totp={},g_note_templates=[],g_reminders=[],g_one_minute_inbox_importer_dialog_enabled=!1,g_one_minute_signup_menu_enabled=!1,g_one_minute_signup_enabled=!1,g_onemin_advert_enabled=!1,g_onemin_advert_app_threshold=5,g_nofolder_feature_enabled=!1,g_basicauth_feature_enabled=!1,g_new_settings_enabled=!1,g_launch_site_tracking_enabled=0,g_first_time_login=!1,g_blob_version={},g_is_legacy_premium=!1,LPTopSites=[];g_open_native_messaging_html=!1,g_have_native_messaging_permission=!1,!have_nplastpass()&&supports_native_messaging()&&"undefined"!=typeof g_do_native_messaging&&g_do_native_messaging&&test_native_messaging(function(e){void 0===e?g_do_native_messaging=!1:e?(g_have_native_messaging_permission=!0,connect_native_messaging()):g_open_native_messaging_html=!0});var shouldOpenDropdown4_0=function(){return!(!lploggedin||!VaultToggle.useVault4_0())&&(!g_badgedata||"notification"!==g_badgedata.cmd||("duplicate"===g_badgedata.alerttype||"error"===g_badgedata.type||"weak"===g_badgedata.alerttype))},shouldOpenLogin4_0=function(){return!(lploggedin||!VaultToggle.useVault4_0())&&(!g_badgedata||"notification"===g_badgedata.cmd&&"mpwchange"!==g_badgedata.type)},g_popoverstartpage=0,share_folder_id="",share_folder_group="",totp_domains={"amazon.com":!0,"dropbox.com":!0,"evernote.com":!0,"facebook.com":!0,"google.com":!0,"mailchimp.com":!0,"salesforce.com":!0},g_alert_reinstall=!1,showFirefoxPanel=function(){var e=function(){shouldOpenDropdown4_0()?LPPlatform.openDropdownPopover():(g_firefox_button_clicked=!0,g_firefox_panel.port.emit("message",{messagetype:"runonload"}))};return function(){if(g_badgedata&&"mpwchange"==g_badgedata.type)return void show_firefox_alt_panel("mpwchange");g_firefox_preload_menu?e():(create_firefox_panel(),e())}}();if(lpbackground=new lpbackgroundcontainer,g_ischrome){var onconnect_listener=function(e){if(0!==e.name.indexOf("requestPort")&&0!==e.name.indexOf("extensionMessaging")){var t=!1,a=e.name;g_isedge&&a.match(/^(0|1)\|/)&&(t="1"==a.charAt(0),a=a.substring(2));var n=!1;if(e.sender.tab&&gettaburl(e.sender.tab)&&punycode.URLToASCII(a)==gettaburl(e.sender.tab)&&(g_loggedLogins=new Array,n=!0,g_datacache[e.sender.tab.id]={html:"",extra:""},g_popupforminput[e.sender.tab.id]=[],do_popupkbdnavreset(e.sender.tab.id),g_isedge&&t&&(g_CS[e.sender.tab.id]=new Array,g_CS_count[e.sender.tab.id]=0)),e.sender.tab&&(L("RAW TAB URL CS["+e.sender.tab.id+"] = "+e.sender.tab.url),L("RAW TAB URL NAME CS["+e.sender.tab.id+"] = "+a),L("CS["+e.sender.tab.id+"] -> BG : CONNECT from tab with url="+gettaburl(e.sender.tab))),void 0!==e.sender&&void 0!==e.sender.tab&&void 0!==e.sender.tab.id){var o=e.sender.tab.id;void 0!==g_CS[e.sender.tab.id]&&g_CS[e.sender.tab.id]||(g_CS[e.sender.tab.id]=new Array,g_CS_count[e.sender.tab.id]=0);var r=g_CS[e.sender.tab.id].length;g_CS[e.sender.tab.id][r]=e,g_CS_count[e.sender.tab.id]++;var i={cmd:"setdocnum",docnum:r};if(do_experimental_popupfill||0!=lpGetPref("showNotificationsAfterClick",1)||(i={cmd:"setdocnum",docnum:r,ff:g_cachedffdat}),g_CS_count[e.sender.tab.id]>=2&&("http://chat.major-design.ru/"==a||a.indexOf("facebook.com/ajax/")>0)){var o=e.sender.tab.id;return lpdbg("connect","skipping connect to document with tabcount="+g_CS_count[e.sender.tab.id]+", istop="+n+", url="+a),sendCS(o,{cmd:"remove_event_listener"},r),void delete g_CS[o][r]}register_new_cs(o,r,a,n);var s=lp_gettld_url(a);if(hasNeverSave(a,s)&&(i.neversave=!0),!n&&is_max_frames_exceeded(e.sender.tab.id,g_CS_count)||hasNeverEnableLP(a,s))L("set killswitch for tab:"+e.sender.tab.id+" url:"+a),i.killswitch=1,set_killswitch_value(o,r,i.killswitch);else if(!n&&g_skip_ad_frames&&skip_CS_by_score(o,r))console.warn("EXPERIMENT: skipping ads/rich content frame "+a),i.killswitch=1,set_killswitch_value(o,r,i.killswitch);else{var l=s.lastIndexOf(".")>0?s.substr(s.lastIndexOf(".")+1):"";i.tld=l,i.tlddata=LPJSON.stringify(void 0===lp_all_tlds[l]?[]:lp_all_tlds[l]),set_killswitch_value(o,r,0);var _=null!==g_pending_launch&&void 0!==g_last_launch&&void 0!==g_last_launch[g_pending_launch]&&(new Date).getTime()-g_last_launch[g_pending_launch]<=25e3;i.is_launch=_}if(add_totp_data(o,s,n,i),sendCS(e.sender.tab.id,i,r),n?(g_CS_tops[e.sender.tab.id]=r,void 0!==g_persistent_notifications[e.sender.tab.id]&&g_persistent_notifications[e.sender.tab.id]&&sendCS(e.sender.tab.id,g_persistent_notifications[e.sender.tab.id]),g_cpwbot&&CPWbot_bg&&CPWbot_bg.score_topdoc(e.sender.tab.id,r,a)):(g_CS_tops[e.sender.tab.id]==r&&(console.warn("page reload case, new topdoc != old topdoc, new topdoc has not registered yet"),console.warn("delete g_CS_tops["+e.sender.tab.id+"]"),delete g_CS_tops[e.sender.tab.id],g_cpwbot&&CPWbot_bg&&(CPWbot_bg.clear_frame_score(e.sender.tab.id,r,a),CPWbot_bg.in_validate()&&CPWbot_bg.force_validate_retry(!0))),void 0!==g_persistent_notifications[e.sender.tab.id]&&g_persistent_notifications[e.sender.tab.id]&&-1!=a.indexOf("streetscape.com")&&setTimeout(function(){sendCS(e.sender.tab.id,g_persistent_notifications[e.sender.tab.id],"all")},10)),!n&&is_max_frames_exceeded(e.sender.tab.id,g_CS_count))return void delete g_CS[e.sender.tab.id][r];no_persistent_messaging()||(e.onMessage.addListener(function(t){receiveCS(e.sender.tab.id,t,0,e)}),e.onDisconnect.addListener(function(){receiveCS(e.sender.tab.id,null,1,e)}))}}};void 0!==chrome.runtime&&void 0!==chrome.runtime.onConnect&&chrome.runtime.onConnect?chrome.runtime.onConnect.addListener(onconnect_listener):void 0!==chrome.extension&&void 0!==chrome.extension.onConnect&&chrome.extension.onConnect&&chrome.extension.onConnect.addListener(onconnect_listener);var listener=function(e,t,a){if(void 0!==e.cmd)if("getnotificationdata"==e.cmd)void 0!==g_datacache[t.tab.id]&&a(g_datacache[t.tab.id]);else if("hideoverlay"==e.cmd||"slidedownoverlay"==e.cmd||"slideupoverlay"==e.cmd||"hidecontext"==e.cmd||"hidetotp"==e.cmd)sendCS(t.tab.id,{cmd:e.cmd},"hidetotp"==e.cmd?"all":null),"hideoverlay"==e.cmd?(g_persistent_notifications[t.tab.id]=null,clear_badge()):"hidetotp"==e.cmd&&(g_ask_totp[t.tab.id]=null);else if("disabletotp"==e.cmd)disabletotp(e.tld);else{if("enabletotp"==e.cmd)return enabletotp(e.tld,t.tab.id,a),!0;if("invitetotp"==e.cmd)invitetotp(e.email,e.phone);else if("popupfillscreateack"==e.cmd)do_experimental_popupfill&&void 0!==t.tab&&lploggedin&&do_popupfillscreateack(t.tab.id);else if("closepopupfills"==e.cmd){if(do_experimental_popupfill&&void 0!==t.tab){var n=t.tab.id;null!=typeof g_popup_tab_docnum[n]?sendCS(t.tab.id,{cmd:e.cmd},g_popup_tab_docnum[n]):sendCS(t.tab.id,{cmd:e.cmd},"all"),delete g_popup_tab_docnum[n],clear_popup_heartbeat(n),e.option&&sendLpImprove("infieldclose",{source:"form",option:e.option})}}else if("autofillaid"==e.cmd||"autologinaid"==e.cmd)e.topurl=gettaburl(t.tab),handleFill(t.tab.id,e);else if("fillgenpassword"==e.cmd){e.cmd="populategeneratedpassword",e.url=t.tab.url,sendCS(t.tab.id,e);var o={},r=e.saveOptions;for(var i in r)o[i]=r[i];o.url=t.tabl.url,o.action="formfill",sendLpImprove("genpassword",o)}else if(void 0!==e.action&&"never"==e.action){if(handleNever(t.tab.id,e),void 0!==e.fromsave&&(g_persistent_notifications[t.tab.id]=null,clear_badge()),do_experimental_popupfill){var s=gettaburl(t.tab);(hasNeverAutologin(s,lp_gettld_url(s))||hasNeverFormFill(s,lp_gettld_url(s))||hasNeverGenerate(s,lp_gettld_url(s))||hasNeverShowIcon(s,lp_gettld_url(s))||hasNeverSave(s,lp_gettld_url(s)))&&(handleGetNevers(n,s),closeclickables(n),g_popupform_active[n]=0,g_popupform_active_choose[n]=0,recheckpage(!0))}}else if("searchvault"==e.cmd){if(void 0!==t.tab&&void 0!==g_datacache[t.tab.id]&&lploggedin){var l=do_searchvault(e.searchQuery,e.searchType,t.tab.id);a(l)}}else if("getpopupfilldata"==e.cmd){if(void 0!==t.tab&&void 0!==g_datacache[t.tab.id]&&lploggedin){var l=do_getpopupfilldata(t.tab.id);a(l)}}else if("popupfillinputget"==e.cmd){if(do_experimental_popupfill&&void 0!==t.tab&&lploggedin){var n=t.tab.id,l=do_popupfillinputget(n);l&&a(l)}}else if("dosaveiframe"==e.cmd){if(do_experimental_popupfill&&void 0!==t.tab&&lploggedin){var l=savesite_from_iframe(e,t.tab.id);a(l)}}else if("popupfillsaveget"==e.cmd){if(do_experimental_popupfill&&void 0!==t.tab&&lploggedin){var l=g_popupfill_save_data;if(l.formdata2){var _=new Array;for(var c in g_sites)if(check_ident_aid(c)){var g=g_sites[c].group;""==g||lp_in_array(g,_)||(_[_.length]=g)}_.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}),l.groups=_,void 0!==e.url&&(l.group=get_default_group(e.url))}a(l),g_popupfill_save_data={}}}else if("popupfillgetgenerateprefs"==e.cmd){var n=t.tab.id,l=do_popupfillgetgenerateprefs(n,e);a(l)}else if("popupfillsetgenerateprefs"==e.cmd){var n=t.tab.id;do_popupfillsetgenerateprefs(n,e)}else if("savePassword"==e.cmd){if(do_experimental_popupfill&&void 0!==t.tab&&lploggedin){Checkpoint.assert(e.url===gettaburl(t.tab),sprintf("generate url mismatch %s != %s",e.url,gettaburl(t.tab))),savePassword(e.pass,gettaburl(t.tab),t.tab.id,!1,e.saveOptions)}}else"dopwchallenge"==e.cmd?(g_popupfill_pw_challenge=null,security_prompt(function(){g_popupfill_pw_challenge=!0},function(){g_popupfill_pw_challenge=!1},!1)):"getpwchallengeresult"==e.cmd?(a(g_popupfill_pw_challenge),e.reset,g_popupfill_pw_challenge=null,null!==g_popupfill_pw_challenge&&(g_popupfill_pw_challenge=null)):"getcpwmsg"==e.cmd?CPWbot_bg&&a({msg:CPWbot_bg.get_last_overlay_message(),minimize_state:cpwbot_get_minimize_dialog_state()}):no_persistent_messaging()&&"connect"==e.cmd?onconnect_listener({sender:t,name:e.name}):receiveCS(t.tab.id,e,0,{tab:t.tab,sender:t})}};void 0!==chrome.runtime&&void 0!==chrome.runtime.onMessage?chrome.runtime.onMessage.addListener(listener):chrome.extension.onRequest.addListener(listener)}var MAX_RETRY_SEND_CS=5,g_safari_error_notifications=!0,g_last_get_totp={},rotation=0,numrotations=0,currrotation=0,ICON_GRAY=0,ICON_RED=1,ICON_GREEN=2,ICON_YELLOW=3,ICON_BREACH=4,ICON_GRAY_CHROME=5,ICON_RED_CHROME=6,ICON_GREEN_CHROME=7,ICON_YELLOW_CHROME=8,ICON_BREACH_CHROME=9;get_icon=function(){var e=function(e){switch(e){case ICON_GRAY:return"19x19_Gray.png";case ICON_GRAY_CHROME:return"19x19_Gray_2x.png";case ICON_RED:return"19x19_Red.png";case ICON_RED_CHROME:return"19x19_Red_2x.png";case ICON_GREEN:return"19x19_Green.png";case ICON_GREEN_CHROME:return"19x19_Green_2x.png";case ICON_YELLOW:return"19x19_Yellow.png";case ICON_YELLOW_CHROME:return"19x19_Yellow_2x.png";case ICON_BREACH:return"19x19_Breach.png";case ICON_BREACH_CHROME:return"19x19_Breach_2x.png"}};return function(t){switch(parseInt(lpGetPref("Icon",1))){default:case 0:case 1:return"images/iconset2/"+e(t);case 2:return"images/iconset3/"+e(t);case 3:return"images/iconset4/"+e(t);case 4:return"images/iconset5/"+e(t)}}}();var g_last_openattach=0,isFillableNoteType=function(e){if(!e)return!1;switch(e){case"Credit Card":case"Address":case"Bank Account":case"Social Security":return!0;default:var t=e.match(/^Custom_(\d+)$/);return t&&2===t.length}};g_pref_tab=null;var g_showerrorlastmsg="",g_showerrorlastts=0,singlefactor_reprompt=function(){var e=function(e,t,a,n){if(g_prompts.multifactor_reprompt||LPISUPEK){var o=multifactor_getdata("password_offline");if(o&&""!=o){if("trueapi"==multifactor_getdata("type")&&have_binary_function("trueapi_get_hash"))return void call_binary_function("trueapi_get_hash",g_username,function(e){if(hash_check==e)return void a();t()})}if((LPISUPEK||"vtapi"==e)&&have_binary_function("lpvt_verify_user"))return void call_binary_function("lpvt_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(e){if(""!=e){var o=e.split("|");if(2==o.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(o[0])),decodeURIComponent(o[1]),get_key_iterations(fix_username(decodeURIComponent(o[0])))))return void a()}if(LPISUPEK&&LPISLOC)return void("function"==typeof n&&n());t()});if("validity"==e&&have_binary_function("validity_verify_user"))return void call_binary_function("validity_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(e){if(""!=e){var n=e.split("|");if(2==n.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(n[0])),decodeURIComponent(n[1]),get_key_iterations(fix_username(decodeURIComponent(n[0])))))return void a()}t()});if("winbio"==e&&have_binary_function("winbio_verify_user"))return void call_binary_function("winbio_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(e){if(""!=e){var n=e.split("|");if(2==n.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(n[0])),decodeURIComponent(n[1]),get_key_iterations(fix_username(decodeURIComponent(n[0])))))return void a()}t()});if("nymi"==e&&have_binary_function("nymi_validate"))return void call_binary_function("nymi_validate",function(e){if(""!=e){var n=e.split("|");if(2==n.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(n[0])),decodeURIComponent(n[1]),get_key_iterations(fix_username(decodeURIComponent(n[0])))))return void a()}t()})}t()};return function(t,a,n){getsinglefactortype(function(o){e(o,t,a,n)})}}(),security_prompt=function(){var e=function(e,t,a,n,o,r){var i=lpGetPref("reprompttime",0),s=(new Date).getTime(),l=get_record(o);if(s>get_last_reprompt_time()&&s-get_last_reprompt_time()<=1e3*i&&!needs_secure_reprompt(l))e();else{if(g_isfirefoxsdk){var _=e,c=g_tabs.activeTab;e=function(){_(),c.activate()}}if(g_reprompt_callback=e,reprompt_callback=e,g_reprompt_error_callback=t,n=!1,l&&l.pwprotect&&needs_secure_reprompt(l)&&(n=!0),VaultToggle.useVault4_0())LPPlatform.openTabDialog("reprompt");else{var g="login.html?isreprompt=1";void 0!==n&&n&&void 0!==o&&(g+="&securereprompt=1&aid="+o,g+="&fromcs=1"),openURL(getchromeurl(g))}}};return function(t,a,n,o,r,i){n?e(t,a,0,o,r):singlefactor_reprompt(function(){e(t,a,0,o,r)},t,a)}}(),LP=this,lperrorcount=0,lastopenauthwin=0;g_ismaxthon&&!String.prototype.startsWith&&(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e});var mpw_num_sites,mpw_retval,keystoreencrypt=["username","password","extra","profilename","firstname","middlename","lastname","email","company","ssn","birthday","address1","address2","city","state","state_name","zip","country","country_cc3l","country_name","mobilephone","mobilephone3lcc","mobileext","evephone","evephone3lcc","eveext","phone","phone3lcc","phoneext","fax","fax3lcc","faxext","ccnum","ccexp","cccsc","address3","title","gender","driverslicensenum","taxid","bankname","bankacctnum","bankroutingnum","timezone","county","ccstart","ccname","ccissuenum","notes","text","alttext","profilelanguage","lastname2","mobileemail","firstname2","firstname3","lastname3"],lpclearrecent=!1;"undefined"==typeof g_is_chrome_portable&&(g_is_chrome_portable=!1);var g_basicauth_found=!1,g_basicauth_origurl="",g_basicauth_url="",g_basicauth_realm="",g_basicauth_tabid=0,toplevelcontextmenu=null,lastcontexturl=null,lastbadgeurl=null,contextParents=[],contextMenuIdToId=[],contextMenuIdToPropType=[],contextMenuIdtoJsonPropType=[],context="all",menuIdCounter=0,context_menus_created=!1;createContextMenus(),this.lpgs=function(e,t){return gs(e,t)},"undefined"!=typeof chrome&&void 0!==chrome.omnibox&&(chrome.omnibox.onInputChanged.addListener(function(e,t){if(lploggedin){if(0==e.length)return;var a=[],n=!g_prompts.edit_sn_prompt&&get_searchNotesPref(),o=search_results(e.toLowerCase(),n);o.sort(lp_sort_case_insensitive_name);var r=0;for(var i in o){var s,l=o[i],_="id";if(l.sn)s=of(l.name),_="sn";else{s=of(l.name);var c=getusernamefromacct(l);""!=c&&(s+=" ("+of(c)+")")}if(a.push({content:gs("Launch")+" "+s+"     "+_+":"+get_record_id(o[i]),description:s}),r++>7)break}t(a)}else t([{content:"login",description:gs("Login to LastPass")}])}),chrome.omnibox.onInputEntered.addListener(function(e){if(lploggedin&&"login"!=e||open_login(),/id:\d+$/.test(e)){var t=e.split("id:"),a=t[1];launchautologin(a)}else if(/id:app\d+$/.test(e)){var t=e.split("id:"),a=t[1];launch(a)}else if(/sn:\d+$/.test(e)){var t=e.split("sn:"),a=t[1];editAid(a)}else getBG().g_isadmin&&(console.log("You entered: "+e),openURL("https://rodan-internal.lastpass.com/admintools/search.php?q="+encodeURIComponent(e)+"&xmarks=on"))})),g_fixpbkdf2=!0;var g_onloaddelay=0;doDelayedOnload=function(){var e=!1;return function(){if(!e&&g_is_mac&&g_issafari&&(lp_ws.setup(),e=!0),g_ischrome&&!is_edge()&&g_do_native_messaging){g_onloaddelay++;var t=localStorage_getItem("hadNativeMessaging");have_binary()||null==t&&g_onloaddelay>5||g_onloaddelay>20?onLoad():setTimeout(function(){doDelayedOnload()},100)}else!window.openDatabase&&window.indexedDB?(0==g_onloaddelay&&opendb(),g_onloaddelay++,g_db||g_onloaddelay>20?onLoad():setTimeout(function(){doDelayedOnload()},100)):onLoad()}}(),"undefined"==typeof document||g_isfirefoxsdk?(doDelayedOnload(),g_isfirefoxsdk&&g_system_unload.when(function(e){onUnload()})):document.addEventListener("DOMContentLoaded",function(){window.addEventListener("load",function(){setTimeout(function(){doDelayedOnload()},0)}),window.addEventListener("unload",function(){onUnload()})}),g_issafari&&(safari.application.addEventListener("contextmenu",handleContextMenu,!1),get_safari_version()>=6?safari.application.addEventListener("beforeSearch",function(e){if(lploggedin){var t=e.query;t&&0==t.indexOf("lp ")&&(e.preventDefault(),opensearch(t.substring(3)))}},!1):safari.application.addEventListener("beforeNavigate",function(e){if(lploggedin){var t=e.url;t&&(t=t.replace(/^\w{2,8}:\/\//,"").replace(/\/$/,""),t=punycode.ToUnicode(unescape(t)).replace("&","%26"),0==t.indexOf("lp ")&&(e.preventDefault(),opensearch(t.substring(3))))}},!1));var g_pplastpass_callbacks=new Object,g_inner_text=[],g_hotkeys=[];SecureReprompter=new function(){this.secretcache={},this.secure_reprompt_token="<SECURE_REPROMPT>",this.most_recent_aid=null,this.add_secret=function(e,t,a,n){this.most_recent_aid=e;for(var o in t.fields)"password"==t.fields[o].type&&(t.fields[o].value=base64_to_binary_ciphertext(t.fields[o].value));var r=this.get_secret_field(t),i=t[r],s=base64_to_binary_ciphertext(i);t[r]=s,a*=1e3,0===a||void 0===a&&void 0!==n?a=3e3:g_cached_hash=n,a<3e3&&(a=3e3),this.secretcache[e]=[t,!0],g_secret_cache=this.secretcache,g_hash_live<a?(aidkiller(e,a,1),g_hash_live=a):aidkiller(e,a)},this.get_secret=function(e){if(void 0===e&&void 0===this.most_recent_aid)return null;void 0===e&&(e=this.most_recent_aid);var t=this.secretcache[e];return void 0===t?null:(t[1],t[0])},this.get_secret_field=function(e){return"http://sn"===e.url?"extra":"password"},this.should_secure_reprompt=function(e){if("http://sn"==e.url){if(e.extra==this.secure_reprompt_token)return!0}else if(e.password==this.secure_reprompt_token)return!0;for(var t in e.fields)if("password"==e.fields[t].type&&e.fields[t].value==this.secure_reprompt_token)return!0;return!1},this.g_secure_reprompt_token="<SECURE_REPROMPT>",this.set_securereprompt_secret=function(e){this.g_securereprompt_secret=e},this.get_securereprompt_secret=function(){var e=this.g_securereprompt_secret;return this.g_securereprompt_secret=null,e}},LPData=function(e){return{getData:function(t){var a=!1;if(t.triggers){a=!0;for(var n in t.triggers)if(t.triggers[n]!==e[n]){a=!1;break}}t.callback(Interfaces.getPrimitives({context:t.context,interface:Interfaces.BackgroundInterface,source:e,syncronizedOnly:a}))},setValue:function(e,t){LPReflection.setValue(Interfaces.BackgroundInterface,e,t)}}}(this);var IntroTutorial=function(){function e(){Topics.get(Topics.LOGIN_FINISHED).subscribeFirst(function(){b=!0,t()}),Topics.get(Topics.ACCTS_VERSION_UPDATED).subscribeFirst(function(){v=!0,t()})}function t(){b&&v&&"context"===LPContentScriptFeatures.intro_tutorial_version&&(b=v=!1,LPPlatform.getCurrentTabDetails(function(e){var t=getchromeurl(VaultToggle.getVaultPage()),i=m.isExtensionsFirstLogin;if(m.isExtensionsFirstLogin=!1,r())if(a(e))y(e.tabID);else if(n(e)){var s=e.tabURL;o(e)&&(s=p(e.tabURL)),LPPlatform.navigateTab({tabId:e.tabID,url:s,loadHandler:g})}else removeModalOverlay(e.tabID),y();else i&&(removeModalOverlay(e.tabID),LPPlatform.hideYoureAlmostDoneMarketingOverlay(e.tabID),LPPlatform.navigateTab({tabId:e.tabID,url:t}))}))}function a(e){return e.tabURL.indexOf("lastpass.com")>=0&&e.tabURL.indexOf("storeRedirect")>=0}function n(e){return e.tabURL.indexOf("lastpass.com")>=0&&e.tabURL.indexOf("lpInstall")>=0}function o(e){return e.tabURL.indexOf("lastpass.com")>=0&&e.tabURL.indexOf("families")>=0}function r(){var e=hassites(),t=Boolean(Number(Preferences.get("showIntroTutorial",1))),a="US"===countryfromip;return t&&!e&&a}function i(){m.isInContext?setTimeout(function(){get_selected_tab(null,function(e){var t=gettabid(e);LPTabs.get({tabID:t}).getTop().LPFrame.openDialog("inContextTutorialLogoutPromptDialog",{hasOverlay:!0},{css:{top:0,right:0}})})},2e3):openvault(),Topics.get(Topics.SITE_ADDED).unsubscribe(i)}function s(e){for(var t in e)e.hasOwnProperty(t)&&(m[t]=e[t]);m.enabled?Topics.get(Topics.SITE_ADDED).subscribe(i):Topics.get(Topics.SITE_ADDED).unsubscribe(i)}function l(e){var t={};for(var a in m)m.hasOwnProperty(a)&&(t[a]=m[a]);if(!e)return t;e(t)}function _(e){h=e}function c(){return h}function g(e){var t=Preferences.get("ShowIntroTutorialLater",null);if(!(t&&Date.now()<new Date(t))&&e&&e.tabDetails){g_onemin_advert_enabled&&OmsNotificationPopup.postponeNotification(!0);e.getTop().LPFrame.openDialog("inContextTutorialWelcomeDialog",null,{css:{top:0,right:0}})}}function d(){var e=getbaseurl();return"/"===e.substr(e.length-1)?e+"how-it-works":e+"/how-it-works"}function p(e){return e.substr(0,e.indexOf("?"))+"/thanksinstall"}function u(e){var t=Preferences.get("ShowIntroTutorialLater",null);t&&Date.now()<new Date(t)||(e?LPPlatform.navigateTab({tabId:e,url:d(),loadHandler:g}):LPPlatform.openTab({url:d(),loadHandler:g}))}function f(e){var t={css:{top:0,right:0,width:"331px",height:"200px"}};"skipped"===e.textChoice&&(t.css.width="100%",t.css.height="100%"),"skipped"!==e.textChoice||m.isAllSet||(t.css.background="rgba(52, 61, 68, 0.6)"),get_selected_tab(null,function(a){var n=gettabid(a);LPTabs.get({tabID:n}).getTop().LPFrame.openDialog("inContextTutorialCompleteDialog",e,t)})}var m={enabled:!1,domain:null,firstLogin:!0,name:null,isInContext:!1,isLoginTheLastPassWay:!1,isAllSet:!1,isExtensionsFirstLogin:!0},h=!1,b=!1,v=!1,y=function(e,t){var a;return function(n){var o=this,r=n;clearTimeout(a),a=setTimeout(function(){a=null,e.call(o,r)},t)}}(u,1500);return{init:e,setState:s,getState:l,setTemporaryDisable:_,getTemporaryDisable:c,completeTutorial:f}}();IntroTutorial.init();var LPIcons=function(){return{get:function(e){return getbigicon(e.url,e)}}}(),OmsNotificationPopup=function(){return{startOms:function(){omsNotification.startOms()},cancelNotification:function(){omsNotification.cancelNotification()},postponeNotification:function(e){omsNotification.postponeNotification(e)},setState:function(e){omsNotification.setState(e)},getState:function(){return omsNotification.getState()}}}();
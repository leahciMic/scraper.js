var CardDialog=function(t){DialogWithGroupInput.call(this,t,{confirmOnClose:!1,hideButtons:!0,hideHeader:!0,type:Account,additionalClasses:"lmiDialog",additionalDropdownClasses:"lmiDropdown"}),this.tiles=[],this.activeTile=null,this.selectedTile=null,this.isSelectable=!1,this.submitted=!1};CardDialog.prototype=Object.create(DialogWithGroupInput.prototype),CardDialog.prototype.constructor=CardDialog,function(){CardDialog.prototype.initialize=function(t){DialogWithGroupInput.prototype.initialize.apply(this,arguments),function(i){i.backButton=t.find("#close").bind("click",function(){i.close()}),i.nextButton=t.find("#submit").bind("click",function(){})}(this)};var t=function(t){for(var i={},e=t.find("[dialogFieldDisplay]"),n=0;n<e.length;++n){i[e[n].getAttribute("dialogFieldDisplay")]=!0}return i},i=function(t,i){for(var e=t.find("[dialogFieldDisplay]"),n=0;n<e.length;++n){var o=e[n],l=o.getAttribute("dialogFieldDisplay"),s=i[l];if(s)switch(l){case"ccnum":o.textContent=Strings.translateString("Ending in %1",s.substr(s.length-4));break;default:o.textContent=s}else"cctype"==l&&i.ccnum&&(o.textContent=a(i.ccnum)?a(i.ccnum):"Payment card")}};CardDialog.prototype.sendTrackingEvent=function(t){},CardDialog.prototype.setupAdd=function(t){t=t||this.data,this.$element.find(".question").text(Strings.translateString("Add this credit card to LastPass?")),this.nextButton.text(Strings.translateString("Add")),this.$element.find(".viewButton").text(Strings.translateString("View Details"));new this.CardTile},CardDialog.prototype.setupUpdate=function(t){switch(t=t||this.data,t.type){case"CreditCard":this.$element.find(".question").text(Strings.translateString("Update this credit card?")),this.nextButton.text(Strings.translateString("Update"));var i="View"+(t.changesCount?" "+t.changesCount:"")+" Changes";this.$element.find(".viewButton").text(Strings.translateString(i));new this.CardTile}};var e=function(t,i,e){var n=$.extend({},t.defaultData);return i&&$.extend(n,i.getFormData($.extend(e,DialogInput.getProperties(t.dialogData),DialogInput.getProperties(t.defaultData)))),n},n=function(t,i,n){return $.extend(e(t,i,n),t.dialogData)},a=function(t){var i=new RegExp("^4");return null!=t.match(i)?"Visa":(i=new RegExp("^5[1-5]"),null!=t.match(i)?"Mastercard":(i=new RegExp("^3[47]"),null!=t.match(i)?"Amex":(i=new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)"),null!=t.match(i)?"Discover":"")))};CardDialog.prototype.hasDuplicates=function(){for(var t=0;t<this.tiles.length;++t)if(this.tiles[t].getDuplicates().length>0)return!0;return!1},CardDialog.prototype.setup=function(o,l){l.saveOptions={source:"savecard"},o.find(".addSiteFavicon").append(LPTools.createElement("img",{class:"favicon",src:a(l.defaultData.ccnum)?"images/"+a(l.defaultData.ccnum)+".png":"images/Other.png"})),this.$element.find(".dialogContent").addClass("dialogBunk2");var s=this,r=o.find(".tileContainer"),d=(o.find(".question"),o.find(".explanation"),o.find(".dialogForm")),c=o.find(".tile.template"),u=t(c),h=DialogInput.getProperties(s.inputFields);this.CardTile=function(t){t=t||{};var a=this,o=c.clone().removeClass("template"),l=s.data,g=null,p=e(l,t.site,h),f=n(l,t.site,h),m=function(t){t&&s.clearErrors(),s.originalData=p,s.populateFields(f)};this.handleHeightChange=function(){var t=function(t,i){var e=function(n){n.target===this&&(t.unbind("transitionend",e),i())};t.bind("transitionend",e)},i=function(i,e){i=i||{};var n=LPTools.getOption(i,"animate",!0),a="animating";n&&(i.animationClass&&(a+=" "+i.animationClass),o.addClass(a));var l=function(t){o.removeClass(a),t&&t.transitionEndHandler&&t.transitionEndHandler(),e({callback:t&&t.onFrameResizeComplete})};i.change(function(e){var a=LPTools.getOption(e,"tileHeight",LPTools.getOption(i,"tileHeight",o.children().first().outerHeight())),s=o.height();return o.css("height",a),a!==s&&n?t(o,function(){l(e)}):l(e),a})};return function(t){LPTools.getOption(t,"animate",!0)?s.requestAnimationFrame(function(e){i(t,e)}):i(t,function(t){s.setFrameSize(),t&&t.callback&&t.callback()})}}(),this.showDetails=function(t){this.handleHeightChange($.extend(t,{animationClass:"details-animatation",change:function(i){null===g&&(g=o.height()),s.activeTile&&s.activeTile!==a&&s.activeTile.hideDetails(t),s.activeTile=a,m(t&&t.clearErrors),o.find(".tileContent").append(d),o.addClass("details");var e=i();s.clickedEdit||(s.clickedEdit=!0,s.sendTrackingEvent("edit"),s.adjustView(!0),s.adjustScrollHeight(e-g))}}))},this.preSubmit=function(){s.activeTile!==this&&(s.activeTile&&(s.activeTile.hideDetails(),s.activeTile=null),m()),s.vaultItem=t.site,!s.vaultItem&&l.dialogData.fields&&(l.saveOptions.saveFromSubmit=!0)},this.hideDetails=function(t){f=s.getData();var i=d.clone();this.handleHeightChange($.extend(t,{animationClass:"details-animatation",change:function(t){o.find(".tileContent").append(i),o.removeClass("details"),t({transitionEndHandler:function(){i.remove()},tileHeight:g})}}))},o.find(".summaryView").bind("click",function(){a.showDetails({clearErrors:!0})}),r.append(o),i(o,t.site?t.site.getFormData(u):l.defaultData),s.tiles.push(this)};Dialog.prototype.setup.apply(this,arguments),"update"===l.action?this.setupUpdate(l):this.setupAdd(l)},CardDialog.prototype.setSelectable=function(t){},CardDialog.prototype.validate=function(t){},CardDialog.prototype.getDialogActions=function(t){},CardDialog.prototype.close=function(t){bg.LPTabState.clear({force:!0}),DialogWithGroupInput.prototype.close.apply(this,arguments)},CardDialog.prototype.open=function(t){var i=this;DialogWithGroupInput.prototype.open.call(i,t)},CardDialog.prototype.adjustScrollHeight=function(t){this.scrollHeight&&(this.scrollHeight+=t,this.tileContainer.css({"max-height":this.scrollHeight}))},CardDialog.prototype.setInitialScrollHeight=function(){if(this.tiles.length>3){this.tileContainer=this.$element.find(".tileContainer");var t=this.tileContainer.height(),i=this.$element.find(".tile").first().height(),e=(t-i*this.tiles.length)/(this.tiles.length-1);this.scrollHeight=3.5*i+3*e,this.tileContainer.css({overflow:"auto","max-height":this.scrollHeight})}},CardDialog.prototype.showInitial=function(){!function(t){t.requestAnimationFrame(function(i){t.show(),t.setInitialScrollHeight(),t.$element.addClass("animate-enter").one("animationend",function(){t.$element.removeClass("animate-enter"),i()})})}(this)};var o=null,l=!1;CardDialog.prototype.showInProcessOverlay=function(){if(this.submitted){var t=this.$element;t.addClass("inProcess").one("animationend",function(){t.addClass("waiting"),setTimeout(function(){l=!0,o&&o()},500)})}},CardDialog.prototype.hideInProcessOverlay=function(){this.$element.removeClass("inProcess waiting")},CardDialog.prototype.closeOnSuccess=function(){},CardDialog.prototype.performValidate=function(t){},CardDialog.prototype.getErrorOptions=function(){return{static:!0,alignTop:!0,showErrorLabel:!1}},CardDialog.prototype.submit=function(){},CardDialog.prototype.handleSubmit=function(t){}}();
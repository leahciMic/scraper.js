function LP_getLPIframe(e,t){if(e||(e=LP_derive_doc()),!e)return null;var r,i=null,o=null;if(t&&(o=e.getElementById(t))&&"IFRAME"==o.tagName.toUpperCase()&&o.name==o.id)return i=o;var n=g_popupfill_parent;if(n||(n=g_popupfill_parent_last),(t=LP_getLPIframeID(e,n))&&(o=e.getElementById(t))&&"IFRAME"==o.tagName.toUpperCase()&&o.name==o.id)return i=o;var a=e.getElementsByTagName("IFRAME");for(r=0;r<a.length;r++)if((o=a[r])&&void 0!==o.id&&null!=o.id){var l=LPMAGICIFRAME;if(0==o.id.indexOf(l)){i=o;break}}return i}function relocate_LPIframe(e,t){if(e||(e=LP_derive_doc()),!e)return!1;var r=!0,i=LP_getLPIframeID(e),o=LP_getLPIframe(e,i);if(o){LP_getComputedStyle(e,o);if(g_iframe_docked){LP_getAbsolutePos(e,g_popupfill_parent)}}else r=!1;return r}function resize_LPIframe(e,t){if(e||(e=LP_derive_doc()),!e||!t)return!1;var r={};if(g_drag_type=LP_DRAG_NODRAG,void 0!==t.height&&void 0!==t.width);else{if(void 0===t.delx||void 0===t.dely)return!1;g_drag_type=LP_DRAG_RESIZE}var i=!1,o=LP_getLPIframeID(e),n=LP_getLPIframe(e,o);if(n){if(g_draggable&&g_drag_type===LP_DRAG_RESIZE){var a=LP_getAbsolutePos(e,n);r={width:a.width+t.delx,height:a.height+t.dely},g_minwidth_override=r.width,g_minheight_override=r.height}else r={width:t.width,height:t.height};i=place_LPIframe(e,r)}return i}function place_LPIframe(e,t){if(e||(e=LP_derive_doc()),!e||!t)return!1;var r=sprintf;"undefined"!=typeof g_isie&&g_isie&&(init_LPfn(),"undefined"!=typeof LPfn&&(r=LPfn.sprintf));var i=!0,o=LP_getLPIframeID(e),n=LP_getLPIframe(e,o);if(n){var a=LP_getAbsolutePos(e,n);if(null===a||parseInt(t.width)<0||parseInt(t.height)<0)verbose_log("invalid iframe pos"),i=!1;else{var l=parseInt(a.top)+"px",s=parseInt(a.left)+"px",_=parseInt(a.height)+"px",f=parseInt(a.width)+"px",p="";void 0!==t.height&&(""===(p=parseInt(t.height))||isNaN(p)||(_=p+"px")),void 0!==t.width&&(""===(p=parseInt(t.width))||isNaN(p)||(f=p+"px")),void 0!==t.left&&(""===(p=parseInt(t.left))||isNaN(p)||(s=p+"px")),void 0!==t.top&&(""===(p=parseInt(t.top))||isNaN(p)||(l=p+"px"));var d=r("width: %s !important; height: %s !important; top: %s !important; left:%s !important;",f,_,l,s);if(""==g_frame_css_str)try{var g=document.body.getAttribute("data-lp-gcss");g&&(g_frame_css_str=LPJSON.parse(g),document.body.removeAttribute("data-lp-gcss"))}catch(t){write_error_to_history(e,"resize_LPIframe",t)}var u=g_frame_css_str+d;u.match(/position: *absolute/)||(u+=" position: absolute;"),normalize_css(n.style.cssText)!=normalize_css(u)&&(n.style.cssText=u,n.setAttribute("width",parseInt(f)),n.setAttribute("height",parseInt(_)))}}else i=!1;return i}function LP_getLPIframeID(e,t){if(!e&&t&&(e=t.ownerDocument),e||(e=LP_derive_doc()),!e)return null;var r=null;if(t){var i=LP_pickFieldName(e,t);r=LPMAGICIFRAME+i}else r=void 0;return r}function LP_computeLPIframeID(e){if("undefined"==typeof SHA256)return LPMAGICIFRAME+e;var t=sprintf;return"undefined"!=typeof g_isie&&g_isie&&(init_LPfn(),"undefined"!=typeof LPfn&&(t=LPfn.sprintf)),SHA256(t("%d-%s",Date.now(),e))}function rot13(e){if(!e)return"$str =~ tr/a-zA-Z/n-za-mN-ZA-M/";for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i>=65&&i<=77||i>=97&&i<=109?i+=13:(i>=78&&i<=90||i>=110&&i<=122)&&(i-=13),t+=String.fromCharCode(i)}return t}function LP_inIframe(e){if(e||(e=window),null!=g_inframe)return g_inframe;try{var t=get_win_self(e);return t!==e.top&&(!is_edge()||(t.location.href!=e.top.location.href||e.frameElement))}catch(e){return!0}}function is_your_popup_showing(e){if(null==e)return!1;var t=e.defaultView;t||"undefined"==typeof window||(t=window);var r=!1;try{if(null==e.location){verbose_log("is_your_popup_showing given a firefox zombie document?");var i=void 0!==LP.lpGetCurrentWindow().getBrowser?LP.lpGetCurrentWindow().getBrowser().contentDocument:LP.getBrowser().contentDocument;closepopupfills(i),r=!0}}catch(e){r=!0}if(r)return!1;if(g_isfirefox&&verbose_log("entered is_your_popup_showing for doc="+e.location.href),g_create_iframe_in_top&&!g_isie&&!g_isfirefox&&LP_inIframe(t))return toplevel_iframe_state_get();if(e.location.href.indexOf("popupfilltab.xul")>0)return!0;for(var o=e.getElementsByTagName("iframe"),n=0;n<o.length;n++)if("function"!=typeof o.hasOwnProperty||o.hasOwnProperty(n)){var a=LPMAGICIFRAME;if(0==o[n].id.indexOf(a))return!0}return!1}function enableScrollOnIframe(e,t){if(null==t&&(t=document||LP.getBrowser().contentDocument),null==t)return null;verbose_log("enabling Scroll on Iframe for "+t.location.href);var r,i=t.getElementsByTagName("IFRAME"),o=null;if(null!=i&&i.length>0)for(r=0;r<i.length;r++){o=i[r];var n=e.replace(/^(https:|http:)/,"");verbose_log("checking iframe src="+lp_ofa(o.src)+" passed href="+lp_ofa(e)),(o.src==e||o.src.indexOf(e)>0||o.src.indexOf(n)>0)&&("undefined"!=typeof g_isie&&g_isie?(o.setAttribute("scrolling","auto"),o.style.overflow="visible",o.style.maxHeight="none"):(o.setAttribute("scrolling","auto"),o.style.overflow="auto"),verbose_log("enabling scroll on iframe to "+lp_ofa(e)))}}function enableScrollWithinIframe(e,t){if(e||(e=LP_derive_doc()),!e)return!1;if(null==t&&(t=window),is_your_popup_showing(e)&&get_win_self(t)!=t.top)if(verbose_log("enabling scroll on body of iframe"),g_isfirefox)e.body.style.overflow="auto";else if(g_isie){var r=0;"undefined"!=typeof init_LPfn&&init_LPfn()&&LPfn&&(r=LPfn.getDocumentMode(document)),r>7?(e.body.style.overflow="visible",e.body.setAttribute("scroll","auto")):e.body.setAttribute("overflow","auto")}else e.body.style.overflow="auto"}function LP_getIframeBySrc(e,t){null==e&&(e=document);var r,i=e.getElementsByTagName("IFRAME");for(r=0;r<i.length;r++)if(i[r].src==t)return i[r];return null}function toplevelpopupsetstate_handler(e){g_create_iframe_in_top&&toplevel_iframe_state_set(!!e)}function toplevel_iframe_state_get(){return g_toplevel_iframe_exists}function toplevel_iframe_state_set(e){g_toplevel_iframe_exists=e}function LP_do_toplevel_iframe_hack(e){return!!e&&(!g_isie&&!g_isfirefox)}function relocate_popupfill_iframes(e,t){if(do_experimental_popupfill)try{var r=e;if(g_isfirefox&&(r=void 0!==LP.lpGetCurrentWindow().getBrowser?LP.lpGetCurrentWindow().getBrowser().contentDocument:LP.getBrowser().contentDocument),!e||!r)return null;if(g_isfirefox&&null==e.location){verbose_log("relocate_popupfill_iframes given zombie document?");var i=void 0!==LP.lpGetCurrentWindow().getBrowser?LP.lpGetCurrentWindow().getBrowser().contentDocument:LP.getBrowser().contentDocument;return void closepopupfills(i)}var o=!1,n=!1;if(!a){var a=e.defaultView;a||(a=e.parentWindow)}"undefined"!=typeof g_iscasper&&g_iscasper&&(a=e.defaultView);var l,s=r.getElementsByTagName("iframe");for(l=0;l<s.length;l++){var _=s[l];if(null,void 0!==_.id&&null!=_.id){var f=LPMAGICIFRAME;if(0==_.id.indexOf(f)){var p=_.id.substr(f.length),d=p;o=!0;var g=LP_getElementByIdOrName(e,p),u=!t;if(g_isfirefox||null!=g&&lpIsVisible(g,u)){var m=null;if(g_isfirefox)null!=(m=ff_get_iframe_pos(e,a,g,d,r))&&(n=!0);else if(m=calculate_iframe_pos(e,g,g_minwidth_override>0?g_minwidth_override:0),g_draggable&&!g_iframe_docked){var c=!1,v=c,h=LP_getAbsolutePos(e,_,v);m.posx=h.left,m.posy=h.top}null!=m&&place_iframe_absolute(e,a,_,m,r)}else if(!g_create_iframe_in_top||g_isie||g_isfirefox||LP_inIframe(a)||!toplevel_iframe_state_get())g_isfirefox||g_double_password_hack||g_double_secret_password_hack||LP_element_is_MaskedField(g)||LP_element_is_UnmaskedField(g)||closepopupfills(e);else{var c=!1,v=c;m=LP_getAbsolutePos(e,_,v),m.posx=m.left,m.posy=m.top,place_iframe_absolute(e,a,_,m,r)}}}}g_isfirefox&&!n&&o&&(verbose_log("found orphan iframe, remove it"),closepopupfills(e))}catch(t){lplog("relocate_popupfill_iframe failed, "+t.message),do_bgiconinput||end_weasel(e),g_isfirefox&&closepopupfills(e)}}function place_iframe_absolute(e,t,r,i,o){if(!(r&&e&&t&&i))return!1;var n,a=null;if("undefined"!=typeof Math){var l=null;g_draggable&&!g_iframe_docked&&(l=LP_getComputedStyle(t,r));try{var s=i.posx,_=i.posy,f=parseInt(s)+"px",p=parseInt(_)+"px",d=0;parseInt(g_minwidth_override)>0?(d=Math.max(parseInt(g_popupfill_iframe_width_save),parseInt(g_minwidth_override))+"px",n=LP_getWindowWidth(t,!0),n&&parseInt(d)+parseInt(f)>n&&(f=n-parseInt(d)-20+"px"),parseInt(f)<0&&(f="0px"),parseInt(p)<0&&(p="0px")):(parseInt(g_popupfill_iframe_width_save)>0?d=parseInt(g_popupfill_iframe_width_save)+"px":(null==a&&(a=LP_getComputedStyle(t,r)),d=a.width),parseInt(f)<0&&(f="0px"),parseInt(p)<0&&(p="0px"));var g=0;if(parseInt(g_minheight_override)>0?g=Math.max(parseInt(g_popupfill_iframe_height_save),parseInt(g_minheight_override))+"px":""!=g_popupfill_iframe_height_save&&parseInt(g_popupfill_iframe_height_save)>0?g=parseInt(g_popupfill_iframe_height_save)+"px":(null==a&&(a=LP_getComputedStyle(t,r)),a&&(g=a.height)),d=Math.min(parseInt(d),MAX_DIALOG_WIDTH)+"px",g_iframe_scroll_hack&&!g_frame_scrollable_set){var u,m=parseInt(g),c=parseInt(d);u=t&&void 0!==t.getComputedStyle?g_isfirefox?LP_getComputedStyle(t,e.documentElement):LP_getComputedStyle(t,e.body):void 0!==e.documentElement?LP_getComputedStyle(t,e.documentElement):LP_getComputedStyle(t,e.body);var v=(parseInt(u.height),parseInt(u.width),t.innerHeight),h=t.innerWidth;if(void 0===v&&(v=LP_getWindowHeight(t,e)),void 0===h&&(h=LP_getWindowWidth(t)),(null!=m&&m>0&&null!=v&&v>0||null!=c&&c>0&&null!=h&&h>0)&&(parseInt(_)+m>v||parseInt(s)+c>h)){if(LP_inIframe(t)){if(g_isfirefox){enableScrollWithinIframe(e,t);var I=LP.getBrowser(),P=I?I.contentDocument:null;P&&P!=e&&enableScrollOnIframe(e.location.href,o)}else g_isie||(verbose_log("ensuring this frame/iframe has scrolling enabled"),sendBG({cmd:"iframescrollenable",href:e.location.href}));g_frame_scrollable_set=!0}}}g_draggable&&!g_iframe_docked&&l&&(i&&void 0!==i.posx&&void 0!==i.posy?(p=parseInt(i.posy)+"px",f=parseInt(i.posx)+"px",parseInt(i.posy)<0&&(p="0px"),parseInt(i.posx)<0&&(f="0px")):(p=l.top,f=l.left)),place_LPIframe(e,{width:d,height:g,top:p,left:f})||(verbose_log("invalid iframe pos"),debug_checkpoint("failed to place iframe"),closepopupfills(e))}catch(e){verbose&&alert("place_abs "+e.message)}return True}}function normalize_css(e){return e=e.replace(/ /g,""),e=e.replace(/1\.0/g,"1"),e=e.replace(/2147483647/g,"2147483648"),e=e.replace("border-top-style:none!important;border-right-style:none!important;border-bottom-style:none!important;border-left-style:none!important;","border-style:none!important;"),g_isie&&(e=e.replace("filter:alpha(opacity=100)!important;",""),e=e.replace("border-style:none!important;",""),e=e.split(";").sort().join(";")),e}function moveIframe_handler(e,t){if(e||(e=LP_derive_doc()),e){var r=e.defaultView;if(r||(r=window),g_draggable&&void 0!==t.delx&&void 0!==t.dely){g_iframe_docked=!1;var i=LP_getLPIframe(e);if(i){var o=LP_getAbsolutePos(e,i);if(o){place_iframe_absolute(e,r,i,{posx:o.left+t.delx,posy:o.top+t.dely})}}}}}function resizeIframe_handler(e,t){e||(e=LP_derive_doc()),e&&t&&resize_LPIframe(e,t)}var MAX_DIALOG_WIDTH=400;
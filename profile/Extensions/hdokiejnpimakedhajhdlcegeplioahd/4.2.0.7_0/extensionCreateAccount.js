var ExtensionCreateAccount=function(e,t){t||(t={}),Dialog.call(this,e,Object.assign(t,{dynamicHeight:!1,responsive:!1,buttonAlign:this.RIGHT_ALIGN,largeButtons:!0,buttonsInsideContent:!0,title:Strings.translateString("Create Account"),hideHeaderTitle:!0,hideBackButton:!0,version:""})),this.isSubmitting=!1};ExtensionCreateAccount.prototype=Object.create(CreateAccountDialog.prototype),ExtensionCreateAccount.prototype.constructor=ExtensionCreateAccount,function(){function e(){m.inputFields.email.onChange(function(e){e&&n(e,function(t){m.inputFields.email.validate({response:t}),p(e)})})}function t(){m.inputFields.password.onChange(function(e){e&&m.inputFields.password.validate({password:m.inputFields.password.getValue(),email:m.inputFields.email.getValue()})}),m.inputFields.password.getElement().keyup(function(e){m.inputFields.password.validate({password:m.inputFields.password.getValue(),email:m.inputFields.email.getValue()},!0)})}function r(){m.inputFields.reconfirm.onChange(function(e){e&&m.inputFields.reconfirm.validate({reconfirm:m.inputFields.reconfirm.getValue(),password:m.inputFields.password.getValue()})})}function i(){m.inputFields.reminder.onChange(function(e){e&&m.inputFields.reminder.validate({reminder:m.inputFields.reminder.getValue(),password:m.inputFields.password.getValue()})})}function n(e,t){bg.LPServer.textRequest({type:"GET",url:"create_account.php",CSRFToken:!1,data:{username:e,check:"avail",mistype:1},success:t,error:t})}function a(e,t){return function(r,i){var n=!1;return t&&(m.clearError(e),n=t.validate(r,function(t){m.addError(e,t)},i)),n}}function s(){if(!m.inputFields.email.fieldValidator){var e=LPTools.createElement("a",{class:"pull-right recovery-link",href:"https://lastpass.com/forgot.php",target:"_blank"},Strings.translateString("Recovery Help")),t=LPTools.createElement("p",null,Strings.translateString("Email address already in use "));t.appendChild(e);var r=new FieldValidator({summary:{id:"validatorSummaryEmail",parentEl:$("label[for='createAccountEmail'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"403",errorMsg:LPTools.createElement("p",null,Strings.translateString("You've made too many attempts, wait 5 minutes and try again.")),isValid:function(e){return!(e.response.status&&403===e.response.status)}},{id:"emailUsed",errorMsg:t,isValid:function(e){return"no"!==e.response}},{id:"emailInvalid",errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure to use a real email address")),isValid:function(e){return"ok"===e.response&&0!==e.response.indexOf("mistype:")&&"emailinvalid"!==e.response}}]});m.inputFields.email.validate=a("email",r),m.inputFields.email.fieldValidator=r}}function o(){if(!m.inputFields.termsAndConditions.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryTermsAndConditions",parentEl:$("label[for='termsAndConditions'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"termsNotChecked",errorMsg:LPTools.createElement("p",null,Strings.translateString("Please agree to the Terms and Conditions")),isValid:function(e){return!0===e.termsAndConditions}}]});m.inputFields.termsAndConditions.validate=a("termsAndConditions",e),m.inputFields.termsAndConditions.fieldValidator=e}}function l(){if(!m.inputFields.password.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryPassword",parentEl:$("label[for='createAccountDialogPassword'].error-summary"),labelEl:$("label[for='createAccountDialogPassword'].validator-label"),errorMsg:LPTools.createElement("p",null,Strings.translateString("Sorry, your password is invalid"))},listParentEl:$("#mpValidators"),isPopup:m.data.isPopup,validators:[{id:"passwordLength",name:LPTools.createElement("p",null,Strings.translateString("At least 8 characters long")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password must be at least 8 characters")),isValid:function(e){return!0===(e.password&&e.password.length>=8)}},{id:"passwordSameAsEmail",name:LPTools.createElement("p",null,Strings.translateString("Not your email")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password shouldn‘t contain your email")),isValid:function(e){return!0===(e.password&&e.email&&-1===e.password.toLowerCase().indexOf(e.email.toLowerCase())&&-1===e.email.toLowerCase().indexOf(e.password.toLowerCase()))}},{id:"easyPassword",name:LPTools.createElement("p",null,Strings.translateString("Not easily guessable")),errorMsg:LPTools.createElement("p",null,Strings.translateString("That‘s in the top 100 most-used passwords")),isValid:function(e){return!0===(e.password&&!e.password.match(/^password\d{0,3}$/i)&&!e.password.match(/^lastpass\d{0,3}$/i)&&!e.password.match(/^.{0,7}$/)&&"12345678"!==e.password&&"123456789"!==e.password&&"1234567890"!==e.password&&"lastpass.com"!==e.password&&"qwertyuiop"!==e.password&&"abcd1234"!==e.password)}}]});m.inputFields.password.validate=a("password",e),m.inputFields.password.fieldValidator=e}}function d(){if(!m.inputFields.reconfirm.fieldValidator){$("#twinsies").hide();var e=new FieldValidator({summary:{id:"validatorSummaryReconfirm",parentEl:$("label[for='createAccountDialogConfirmPassword'].error-summary"),labelEl:$("label[for='createAccountDialogConfirmPassword'].validator-label, #twinsies")},validators:[{id:"reconfirmSameAsPassword",name:LPTools.createElement("p",null,Strings.translateString("Reconfirm same as password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure this matches your master password")),isValid:function(e){return!0===(e.reconfirm&&e.password===e.reconfirm)}}]});m.inputFields.reconfirm.validate=a("reconfirm",e),m.inputFields.reconfirm.fieldValidator=e}}function u(){if(!m.inputFields.reminder.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryReminder",parentEl:$("label[for='createAccountReminder'].error-summary"),labelEl:$("label[for='createAccountReminder'].validator-label")},validators:[{id:"reminderNotPassword",name:LPTools.createElement("p",null,Strings.translateString("Reminder doesn‘t contain password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Reminder can‘t contain your master password")),isValid:function(e){return!(e.password&&-1!==e.reminder.toLowerCase().indexOf(e.password.toLowerCase()))}}]});m.inputFields.reminder.validate=a("reminder",e),m.inputFields.reminder.fieldValidator=e}}function c(){var e=[];for(var t in m.inputFields)m.inputFields.hasOwnProperty(t)&&m.inputFields[t].fieldValidator&&(e=e.concat(m.inputFields[t].fieldValidator.getValidationList()));return e}function p(e){e&&$("#masterPasswordDialogTitle").text(e).attr("title",e)}var m,g;ExtensionCreateAccount.prototype.initialize=function(n){CreateAccountDialog.prototype.initialize.apply(this,arguments),$(".meterContainer").remove(),this.inputFields.password.getElement().LP_addPasswordMeter(this.inputFields.email.getElement(),!this.data.isPopup),m=this;var a=n.find(".buttonContent"),l=n.find(".buttons").detach();a.append(l),s(),o(),e(),t(),r(),i(),m.setDynamicHeight()},ExtensionCreateAccount.prototype.setNextView=function(e){Dialog.prototype.setNextView.apply(this,arguments),bg.sendLpImprove("viewregform",{currentPage:0===this.currentViewIndex?"email":"mpw",version:m.data.version})},ExtensionCreateAccount.prototype.close=function(e){e?Dialog.prototype.close.apply(this,arguments):function(e){LPTools.getOption(e.data,"showcloseconfirm",!0)?(this._backgroundOverlay.show(),dialogs.confirmation.open({title:"LastPass",text:Strings.translateString("Do you really want to quit?  You cannot use LastPass without creating an account."),closeHandler:function(){g.hide()},handler:function(){e.close(!0)}})):e.close(!0)}(this)},ExtensionCreateAccount.prototype.clearError=function(e){var t=this.inputFields[e];t&&t.clearErrors()},ExtensionCreateAccount.prototype.addError=function(e,t){var r=this.inputFields[e];r&&(r._errors.push(t),r.clearErrors=function(){this._errors=[],r._errorElement&&r._errorElement.remove(),this._errorElement=null})},ExtensionCreateAccount.prototype.validate=function(e,t){if(0===this.currentViewIndex)n(e.email,function(r){var i=m.inputFields.email.validate({response:r});i&&(i&=m.inputFields.termsAndConditions.validate(e)),t&&t(i)});else if(this.currentViewIndex===this.views.length-1){var r=m.inputFields.password.validate(e);r&=m.inputFields.reconfirm.validate(e),r&=m.inputFields.reminder.validate(e),t&&t(r)}},ExtensionCreateAccount.prototype.submit=function(){try{if(m.isSubmitting)return;m.isSubmitting=!0;var e=this.getData();this.validate(e,function(t){if(t){var r={currentPage:"mpw",version:m.data.version};bg.sendLpImprove("viewregform",r),m.getNextViewButton()===m.nextButton&&m.views&&m.currentViewIndex<m.views.length-1?(l(),d(),u(),m.setNextView(m.currentViewIndex+1),m.setDynamicHeight()):(bg.sendLpImprove("completedregform",{version:m.data.version}),m.handleSubmit(e,this.data))}else{var i=c().join(","),r={errorlist:i,version:m.data.version};m.inputFields.reminder&&""!==m.inputFields.reminder.getValue()&&(r.isReminder=!0),i.length>0&&(r.currentPage=0===m.currentViewIndex?"email":"mpw",bg.sendLpImprove("validationregform",r))}m.isSubmitting=!1})}catch(e){m.isSubmitting=!1,LPPlatform.logException(e)}},ExtensionCreateAccount.prototype.showInProcessOverlay=function(){g.show(!0)},ExtensionCreateAccount.prototype.setBackgroundOverlay=function(e){g=e}}();
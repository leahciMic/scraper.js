function fix_event_handlers(){lpdbg("site","fixing event handlers");for(var e in event_handlers){lpdbg("site","setting event handler for "+e);var t=document.getElementById("fields").contentWindow.document.getElementById(e);t?(t.onclick=event_handlers[e],lpdbg("site","set event handler for "+e)):lpdbg("site","could not find "+e)}}function onLoad(e){if(clearData(),!e)return void get_data("site",function(){onLoad(!0)});var t,a=getBG();if(a.g_site_data&&(t=a.g_site_data.aid),void 0===t)data=a.g_site_data;else{data=a.g_site_data;var n=!1;void 0!==a.g_site_data.save_all&&1==a.g_site_data.save_all&&(n=!0);var d=get_record(t);for(var i in d)data[i]=d[i]}if(a.g_generatedpw&&(document.getElementById("pwprotect").style.visibility="hidden",document.getElementById("pwprotectlabel").style.visibility="hidden"),existing=data&&void 0!==get_record_id(data)&&get_record_id(data)&&""!=get_record_id(data)&&"0"!=get_record_id(data),existing&&!a.LPISLOC&&a.g_showhistorylinks&&(document.getElementById("usernamehistory").style.display="inline",document.getElementById("passwordhistory").style.display="inline"),data){var l=issharedfolder(a.g_shares,data.group),r=0==l?a.g_local_key:l.sharekey;"http://sn"==data.url&&a.loglogin(get_record_id(data));var s=!1;if(is_application(data)){document.getElementById("usernamehistory").style.display="none",document.getElementById("passwordhistory").style.display="none",set_innertext(document.getElementById("urltext"),gs("Application:")),document.getElementById("url").value=data.appname;var o=0,c=0;for(var p in data.fields)if(data.fields.hasOwnProperty(p))if(""==data.fields[p].type){if(++o>1)break}else if("password"==data.fields[p].type&&++c>1)break;1==o&&1==c||(s=!0)}else{var g=AES._utf8_decode(data.url);!existing&&g.indexOf("homelocal")>=0||(document.getElementById("url").value=g)}if(event_handlers={},data.editfields)document.title=is_application(data)?gs("Edit Application Fields"):gs("Edit Site Fields"),document.getElementById("siteactions").style.display="none",document.getElementById("urlrow").style.display="none",document.getElementById("namegrouprow").style.display="none",document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("notesrow1").style.display="none",document.getElementById("notesrow2").style.display="none",document.getElementById("advsettingswrap").style.display="none",document.getElementById("cpwfieldbtn").style.display="none",document.getElementById("fieldsrow2").style.display="block",document.getElementById("fields").contentWindow.document.body.appendChild(getFieldsHTMLNodes(r));else if(data.save_all||s)document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("fieldsrow1").style.display="block",document.getElementById("fieldsrow2").style.display="block",existing?(document.title=is_application(data)?gs("Edit Application"):gs("Edit Site"),document.getElementById("fields").contentWindow.document.body.appendChild(getFieldsHTMLNodes(r))):(document.title=gs("Add Site"),document.getElementById("fields").contentWindow.document.body.appendChild(getDataHTML()));else if(data.sn)document.title=existing?gs("Edit Secure Note"):gs("Add Secure Note"),document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("urlrow").style.display="none",document.getElementById("addrow").style.display="block",showadvpane();else if(existing){if(is_application(data))document.title=gs("Edit Application"),document.getElementById("username").value=getusernamefromacct(data),document.getElementById("password").value=getpasswordfromacct(data),origusername=a.lpmenc(document.getElementById("username").value,!0,r),origpassword=a.lpmenc(document.getElementById("password").value,!0,r);else{document.title=gs("Edit Site"),document.getElementById("username").value=data.unencryptedUsername;var m=a.lpmdec(data.password,!0,r);g_pwlen=m?m.length:-1,g_pwlen=""==data.password?0:g_pwlen,document.getElementById("password").value=m,origusername=data.username,origpassword=data.password}document.getElementById("editfields").style.display="inline"}else document.title=gs("Add Site"),document.getElementById("username").value=data.username,document.getElementById("password").value=data.password,disable_CPWButton();if(fix_event_handlers(),document.getElementById("exnotehist").style.display=existing?"block":"none",existing||void 0===data.addsite||-1!=AES._utf8_decode(data.url).indexOf("homelocal")||(document.getElementById("group").value=get_default_group(data.url),document.getElementById("name").value=a.getname_url(data.url)),existing){document.getElementById("name").value=data.name,document.getElementById("group").value=data.group;var u=a.lpmdec(data.extra,!0,r);document.getElementById("notes").value=u,document.getElementById("fav").checked="1"==data.fav,document.getElementById("pwprotect").checked=data.pwprotect,document.getElementById("autologin").checked=data.autologin&&"0"!=data.autologin,is_application(data)?document.getElementById("never_autofill_td").style.visibility="hidden":document.getElementById("never_autofill").checked=data.never_autofill}else data.sn&&(document.getElementById("group").value=gs("Secure Notes"));1==data.sn&&(document.getElementById("favcheck").style.display="none",document.getElementById("never_autofill_td").style.display="none",document.getElementById("autologingrp").style.visibility="hidden")}if(existing&&!data.editfields){document.getElementById("del").style.display="inline-block";var _=get_record(get_record_id(data));document.getElementById("share").style.display=a.LPISLOC||_.genpw||void 0!==_.sharedfromaid&&null!=_.sharedfromaid&&""!=_.sharedfromaid&&"0"!=_.sharedfromaid&&"null"!=_.sharedfromaid||void 0!==_.sharefolderid||is_application(_)||!a.g_sharing_enabled?"none":"inline-block"}else document.getElementById("del").style.display="none",document.getElementById("share").style.display="none";var h=new Array;for(t in a.g_sites)if(a.check_ident_aid(t)){var y=a.g_sites[t].group;""==y||lp_in_array(y,h)||(h[h.length]=y)}for(t in a.g_securenotes)if(a.check_ident_aid(t)){var y=a.g_securenotes[t].group;""==y||lp_in_array(y,h)||(h[h.length]=y)}for(t in a.g_applications)if(a.check_ident_appaid(t)){var y=a.g_applications[t].group;""==y||lp_in_array(y,h)||(h[h.length]=y)}if(h.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}),existing||(""==document.getElementById("url").value?document.getElementById("url").focus():document.getElementById("name").focus()),!existing&&data&&!data.save_all&&!data.noreplace){var v=a.getsites(lp_gettld_url(data.url),!0),f=new Array;for(var p in v)f[f.length]=p;f.sort(function(e,t){return a.g_sites[e].name.toLowerCase()<a.g_sites[t].name.toLowerCase()?-1:1});for(var w=document.getElementById("replaceexistingsiteaid"),p=0;p<f.length;p++){var E=a.g_sites[f[p]].name;a.g_sites[f[p]].useusername,""!=a.g_sites[f[p]].useusername&&(E+=" ("+a.g_sites[f[p]].useusername+")"),w.options[w.options.length]=new Option(E,f[p])}if(w.options.length>1)for(var p=1;p<=4;p++)document.getElementById("addreplacerow"+p).style.display="block"}LP_decimate_children(document.getElementById("metercontainer")),document.getElementById("metercontainer").appendChild(ghetto_meter(280,!0,document)),stylize_ghetto_meter(document,280),update_password_meter("",document.getElementById("password").value),data&&data.last_pwchange_gmt&&pw_age_update(data.last_pwchange_gmt),show_cpw_button(data),my_aid=get_record_id(data),buildSecureNotes(existing),onResize(),create_combo("group",h,!0,document,"","group",-22,5),setup_eye_events(document),(getBG().g_is_win||getBG().g_is_mac||getBG().g_is_linux)&&setTimeout(function(){decryptThumbnails(r)},0),document.getElementById("advsettings").addEventListener("click",showadvpane),document.getElementById("lp_docwrite_site14a").addEventListener("click",showadvpane),document.getElementById("fav").addEventListener("change",echoFavorite),echoFavorite(),null!==document.getElementById("name")&&null!==document.getElementById("notestype")&&(document.getElementById("name").addEventListener("keyup",function(){setTimeout(updateFormHeading,100)}),updateFormHeading()),data&&data.openchpw&&show_cpw_dialog("new"),data=a.g_site_data;for(var i in a.g_site_data)data[i]=a.g_site_data[i];n&&(data.save_all=!0),a.g_site_data=null}function updateFormHeading(){""!=document.getElementById("notestype").value?set_innertext(document.getElementById("dynheader"),document.getElementById("name").value+" - "+document.getElementById("notestype").value+(1==data.sn?" "+gs("Secure Note"):"")):(document.getElementById("dynheader").style.display="none",document.getElementById("dynbody").style.backgroundColor="transparent")}function showadvpane(){var e=document.getElementById("advsettings"),t=document.getElementById("checkboxrow1");e.classList.toggle("turn90"),t.classList.toggle("displaynone")}function echoFavorite(){document.getElementById("fav").checked?(document.getElementById("echo_favorite").src="images/favorite.png",set_innertext(document.getElementById("lp_docwrite_site15"),gs("Remove Favorite")),set_innertext(document.getElementById("lp_docwrite_site34"),gs("Remove Site from Favorites"))):(document.getElementById("echo_favorite").src="images/not_favorite.png",set_innertext(document.getElementById("lp_docwrite_site15"),gs("Make Favorite")),set_innertext(document.getElementById("lp_docwrite_site34"),gs("Add Site to Favorites")))}function decryptThumbnails(e){if(void 0!==data&&null!==data&&1==data.sn&&(document.getElementById("lpaddattach").style.display="block",void 0!==data.attachpresent&&"1"==data.attachpresent)){getBG();num_attachments=data.attaches.length;for(var t in data.attaches)data.attaches.hasOwnProperty(t)&&(addThumbnail(data.attaches[t].id,data.attaches[t].mimetype,data.attaches[t].bytes,data.attaches[t].filename,data.attachkey,e),num_attachments--)}}function buildSecureNotes(e){if(0==issharedfolder(getBG().g_shares,data.group).give&&(g_sharedfromaid=1),void 0!==data&&null!==data&&void 0!==data.sn&&1==data.sn){document.getElementById("notesrow0").style.display="block",document.getElementById("notesrow1").style.display="none",document.getElementById("notehistory").style.display=e?"inline-block":"none",document.getElementById("group").style.width="auto",document.getElementById("group").spellcheck=!1;var t=document.getElementById("notestype"),a=t.val,n=[];for(var d in sntemplates){var i=void 0!==sntemplateicons[d]?sntemplateicons[d]:geticonurl("sn");n[n.length]={label:gs(d),image:i,value:d}}e||(create_combo("notestype",n,!0,document,"","notestype",-22,5),document.getElementById("notestype").addEventListener("click",function(){openCombo(null,"notestype","notestype_combo",document)})),e&&(a=getNoteValue("NoteType",document.getElementById("notes").value)),a&&void 0!==sntemplates[a]||(a="Generic"),init_attachment_action_menu(),document.getElementById("autologingrp").setAttribute("colspan","0");var l=document.getElementById("pwaginggrp");null!=l&&l.setAttribute("colspan","2"),buildForm(a),onResize()}else document.getElementById("attachtabletr").style.width="0px"}function disable_CPWButton(){document.getElementById("cpwbtnmini").classList.add("btn_disabled"),document.getElementById("cpwfieldbtn")&&document.getElementById("cpwfieldbtn").classList.add("btn_disabled")}function disable_SaveButton(){document.getElementById("save").classList.add("btn_disabled")}function enable_SaveButton(){document.getElementById("save").classList.remove("btn_disabled")}function update_SaveButton(e){var t=document,a=t.getElementById("save");t&&a&&(check_for_changes()?a.className.indexOf("btn_disabled")>=0&&enable_SaveButton():e!=ENABLE_ONLY&&-1==a.className.indexOf("btn_disabled")&&disable_SaveButton())}function buildForm(e){var t=document.getElementById("notestype");t.value=gs(e),t.val=e;var a=void 0!==sntemplateicons[e]?sntemplateicons[e]:geticonurl("sn");if(t.style.background="url("+a+") no-repeat 2px 2px"+(existing?" rgb(238,238,238)":" rgb(249,249,249)"),document.getElementById("notesrow2").style.display="Generic"==e?"block":"none",document.getElementById("notesrow3").style.display="Generic"==e?"none":"block",document.getElementById("notestype").disabled=!!existing,"Generic"!=e){for(var n=document.getElementById("dynamicnotes");n.hasChildNodes()&&n.childNodes.length>0;)n.removeChild(n.firstChild);var d=sntemplates[e],i=document.createElement("table");i.style.width="100%",i.style.borderSpacing="0px";for(var l in d){var r=document.createElement("tr"),s=document.createElement("td");s.style.whiteSpace="nowrap";var o=document.createElement("td");o.style.width="100%";var c=document.createTextNode(gsproper(l)+":");s.appendChild(c);var p=null,g=null;if("text"==d[l]){if(p=document.createElement("input"),p.type="text",p.spellcheck=!1,p.id="note_"+l,p.style.width="100%",p.style.fontFamily="Courier",existing&&(p.value=getNoteValue(l,document.getElementById("notes").value),"Private Key"==l)){var g=document.createElement("a");set_innertext(g," Copy Key"),g.style.textDecoration="none",g.style.cursor="pointer",g.style.height="15px",g.style.align="right",-1==p.value.indexOf("-----BEGIN")&&-1==p.value.indexOf("END-----")?g.onclick=function(){var e=document.getElementById("note_Private Key").value;getBG().copytoclipboard(e)}:g.onclick=function(){var e=document.getElementById("note_Private Key");pkelparse=e.value.split(/-----BEGIN.*KEY----- | -----END.*KEY-----/),pkelarmor=e.value.split(/-----/);var t="";for(var a in pkelparse[1])":"!=pkelparse[1].charAt(a-1)?t+=pkelparse[1][a].replace(/\u0020/g,"\n"):t+=pkelparse[1][a];return pktotal="-----"+pkelarmor[1]+"-----\n"+t+"\n-----"+pkelarmor[3]+"-----",getBG().copytoclipboard(pktotal),!1}}if("Password"==l){p.type="password";var g=document.createElement("img");g.id="note_eye_img",g.src="images/eye-shown.png",g.style.textDecoration="none",g.style.position="relative",g.style.top="6px",g.style.left="-22px",g.onclick=function(){if(g_sharedfromaid)return alert(gs("This is a shared site. You are not permitted to view the password.")),!1;var e=document.getElementById("note_Password");-1!==document.getElementById("note_eye_img").src.indexOf("images/eye-shown.png")?document.getElementById("note_eye_img").src="images/eye-hidden.png":document.getElementById("note_eye_img").src="images/eye-shown.png";var t=e.type;e.type="password"==t?"text":"password"}}}else if("date"==d[l]||"datemoyr"==d[l]){p=document.createElement("span"),p.style.width="100%";var m=document.createElement("select");m.id="note_"+l+"_mo",m.style.width="auto";var u=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var _ in u)m.options[m.options.length]=new Option(gs(u[_]),u[_]);var h=null;if(existing&&(h=getNoteValue(l,document.getElementById("notes").value),h&&(h=h.split(",")),h&&h.length>0))for(var y in u)if(u[y]==h[0]||gs(u[y])==h[0]){m.value=u[y];break}if(p.appendChild(m),"date"==d[l]){var v=document.createElement("select");v.id="note_"+l+"_day";for(var _=1;_<=31;_++)v.options[v.options.length]=new Option(_,_);h&&h.length>1&&(v.value=h[1]),p.appendChild(v)}var f=document.createElement("input");f.type="text",f.maxLength=4,f.size=4,f.spellcheck=!1,f.id="note_"+l+"_yr";var w="date"==d[l]?2:1;h&&h.length>w&&(f.value=h[w]),p.appendChild(f)}else{if("textarea"!=d[l])continue;s.style.verticalAlign="top",p=document.createElement("textarea"),p.cols=30,p.spellcheck=!1,p.rows=7,p.id="note_"+l,p.style.width="100%",p.style.fontFamily="Courier",existing&&(p.value=getNoteValue(l,document.getElementById("notes").value,!0))}o.appendChild(p),null!==g&&o.appendChild(g),r.appendChild(s),r.appendChild(o),i.appendChild(r)}var E=document.createElement("fieldset");E.appendChild(i),n.appendChild(E),updateFormHeading()}}function onResize(){}function fix_addreplace(){document.getElementById("addnewsite").checked?(document.getElementById("url").disabled=!1,document.getElementById("name").disabled=!1,document.getElementById("group").disabled=!1,document.getElementById("username").disabled=!1,document.getElementById("password").disabled=!1,document.getElementById("notes").disabled=!1,document.getElementById("fav").disabled=!1,document.getElementById("never_autofill").disabled=!1,document.getElementById("pwprotect").disabled=!1,document.getElementById("autologin").disabled=!1,document.getElementById("replaceexistingsiteaid").disabled=!0):document.getElementById("replaceexistingsite").checked&&(document.getElementById("url").disabled=!0,document.getElementById("name").disabled=!0,document.getElementById("group").disabled=!0,document.getElementById("username").disabled=!0,document.getElementById("password").disabled=!0,document.getElementById("notes").disabled=!0,document.getElementById("fav").disabled=!0,document.getElementById("never_autofill").disabled=!0,document.getElementById("pwprotect").disabled=!0,document.getElementById("autologin").disabled=!0,document.getElementById("replaceexistingsiteaid").disabled=!1)}function getSecureNoteFromFields(){if(void 0!==data&&data&&1==data.sn){var e=document.getElementById("notestype").val;if("Generic"==e||"none"==document.getElementById("notesrow0").style.display)return document.getElementById("notes").value;var t="NoteType:"+e+"\n";for(var a in sntemplates[e])"text"==sntemplates[e][a]?t+=a+":"+document.getElementById("note_"+a).value+"\n":"date"==sntemplates[e][a]||"datemoyr"==sntemplates[e][a]?(t+=a+":"+document.getElementById("note_"+a+"_mo").value,"date"==sntemplates[e][a]&&(t+=","+document.getElementById("note_"+a+"_day").value),t+=","+document.getElementById("note_"+a+"_yr").value+"\n"):"textarea"==sntemplates[e][a]&&(t+=a+":"+document.getElementById("note_"+a).value+"\n");return t}return document.getElementById("notes").value}function get_decrypted_attachdata(e){for(var t in g_encatt)if(void 0!==g_encatt[t].id&&g_encatt[t].id==e)return g_encatt[t].data;return""}function dosave(e,t){var a=document.getElementById("replaceexistingsite").checked;if(a&&0==document.getElementById("replaceexistingsiteaid").selectedIndex)return void alert(gs("Please Make a Selection"));var n=getBG();if(!n.lploggedin)return void console_log("Not logged in!");if(data.editfields){var d=issharedfolder(n.g_shares,data.group);if(!checkreadonly(d))return;var i=0==d?n.g_local_key:d.sharekey;if(is_application(data)){var l=get_record(get_record_id(data));l.last_touch=lp_get_gmt_timestamp();for(var r in l.fields){var s=l.fields[r],o=document.getElementById("fields").contentWindow.document.getElementById(s.htmlid);o&&(s.value=n.lpmenc(o.value,!0,i))}var c="appaid="+n.en(l.appaid);for(var r in l.fields){var s=l.fields[r];c+="&fieldid"+r+"="+n.en(s.id)+"&fieldtype"+r+"="+n.en(s.type)+"&fieldvalue"+r+"="+n.en(crypto_btoa(s.value))}c+=0==d?"":"&sharedfolderid="+n.en(d.id),(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.increment_local_accts_version(),n.rewritelocalfile(),n.saveSite(c,l)}else checkFieldsForUpdates(i);return getBG().close_editfieldsopener(),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var p=punycode.URLToASCII(trim(document.getElementById("url").value)),g=document.getElementById("name").value,m=document.getElementById("group").value,u=document.getElementById("username").value,_=document.getElementById("password").value,h=getSecureNoteFromFields(),y=document.getElementById("fav").checked,v=document.getElementById("never_autofill").checked,f=document.getElementById("pwprotect").checked,w=document.getElementById("autologin").checked;if(g_pwlen>0&&0==_.length||-1==g_pwlen&&0==_.length){var E=gs("Are you sure you want to save an empty password?");if(!confirm(E))return}var d=issharedfolder(n.g_shares,m);if(!1===d&&0==m.toLowerCase().indexOf("shared-"))return void alert(gs("Sorry - group names starting with 'Shared-' are created by LastPass to indicate groups shared with other people. Please use a different name."));if(checkreadonly(d)){var b=!1;if(existing&&m!=data.group){if(b=issharedfolder(n.g_shares,data.group),!checkmove(d,b))return}else existing&&(b=d);var i;if(i=existing?0==b?n.g_local_key:b.sharekey:0==d?n.g_local_key:d.sharekey,a){var B=n.g_sites[document.getElementById("replaceexistingsiteaid").value];g=B.name,m=B.group,d=issharedfolder(n.g_shares,m),i=0==d?n.g_local_key:d.sharekey,h=n.lpmdec(B.extra,!0,i),y="1"==B.fav,v=B.never_autofill,f=B.pwprotect,w=B.autologin}if(""==g)return void alert(gs("You must enter a name."));if(h.length>45e3){if(!confirm(gs("The notes field contains too much data.  You may store a maximum of 45,000 characters per note.\n\nWould you like us to truncate the note for you?  You will lose some of your data.")))return;h=h.substring(0,45e3)}var I=!1;if(existing&&m!=data.group&&(d||b)){var x=[get_record_id(data)],k=[];if(k[get_record_id(data)]=m,I=!0,!n.moveIntoSharedFolder(d,b,x,k,!1,!0))return}if(existing&&is_application(data)){var l=get_record(get_record_id(data));l.last_touch=lp_get_gmt_timestamp();var C=getusernamefromacct(l),A=getpasswordfromacct(l);for(var r in l.fields){var s=l.fields[r],S=document.getElementById("fieldsrow2");if("none"!=window.getComputedStyle(S).display){var o=document.getElementById("fields").contentWindow.document.getElementById(s.htmlid);o&&(s.value=n.lpmenc(o.value,!0,i))}else""==s.type&&n.lpmdec_acct(s.value,!0,l,n.g_shares)==C?s.value=n.lpmenc(document.getElementById("username").value,!0,i):"password"==s.type&&n.lpmdec_acct(s.value,!0,l,n.g_shares)==A&&(s.value=n.lpmenc(document.getElementById("password").value,!0,i))}l.name=document.getElementById("name").value,l.group=document.getElementById("group").value,l.appname=document.getElementById("url").value;var T=getSecureNoteFromFields();T!=n.lpmdec(l.extra,!0,i)&&(l.extra=lpmenc(T,!0,i)),l.fav=document.getElementById("fav").checked?"1":"0",l.pwprotect=document.getElementById("pwprotect").checked,l.autologin=document.getElementById("autologin").checked?"1":"0";var L=l.group;if(d&&(l.sharefolderid=d.id,L=L.substr(d.decsharename.length+1)),m!=data.group&&(d||b)){var x=[get_record_id(data)],k=[];return k[get_record_id(data)]=m,n.moveIntoSharedFolder(d,b,x,k,!1,!1,!0),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var c="ajax=1&extjs=1&cmd=updatelpaa&name="+n.en(n.lpenc(l.name,i))+"&grouping="+n.en(n.lpenc(L,i))+"&appname="+n.en(l.appname)+"&extra="+n.en(crypto_btoa(l.extra))+"&appaid="+n.en(l.appaid);"1"==l.fav&&(c+="&fav=on"),l.pwprotect&&(c+="&pwprotect=on"),"1"==l.autologin&&(c+="&autologin=on");for(var r in l.fields){var s=l.fields[r];c+="&fieldid"+r+"="+n.en(s.id)+"&fieldtype"+r+"="+n.en(s.type)+"&fieldvalue"+r+"="+n.en(crypto_btoa(s.value))}return c+=0==d?"":"&sharedfolderid="+n.en(d.id),(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.increment_local_accts_version(),n.rewritelocalfile(),n.saveSite(c,l),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var N=existing?data.sn?n.g_securenotes[get_record_id(data)]:n.g_sites[get_record_id(data)]:n.createNewAcct(),G=!1;for(var r in attaches)attaches.hasOwnProperty(r)&&void 0!==attaches[r]&&(G=!0);if(G&&!t){if(void 0===N.attachkey||""==N.attachkey){var P=SHA256(lpCreatePass(32,1,1,1,1,1,1,1));g_attachkey=n.lpenc(P,i)}else g_attachkey=N.attachkey;var F=AES.hex2bin(n.lpdec(g_attachkey,i)),O=[];for(var r in attaches)attaches.hasOwnProperty(r)&&void 0!==attaches[r]&&(attaches[r].filename=lpenc(attaches[r].filename,F),O[O.length]={id:attaches[r].id,bytes:attaches[r].bytes});if(O.length)return void n.fastEncryptAttachments(F,O,function(e){g_encatt=e,dosave(null,!0)})}var D=lp_gettld_url(AES._utf8_encode(p));if(existing&&!data.sn&&N.tld!=D&&!e&&n.g_prompts.view_pw_prompt)return void n.security_prompt(function(){dosave(1,t)});existing&&!N.sn&&n.fix_tlds(N.tld,D,get_record_id(data)),N.genpw=!1,N.name=g,I||(N.group=m),"http://sn"==p?(N.url=p,N.sn=1):N.url=AES._utf8_encode(p),N.tld=D,N.unencryptedUsername=u,u!=n.lpmdec(N.username,!0,i)&&(N.username=n.lpmenc(u,!0,i)),_!=n.lpmdec(N.password,!0,i)&&(N.password=n.lpmenc(_,!0,i)),h!=n.lpmdec(N.extra,!0,i)&&(N.extra=n.lpmenc(h,!0,i)),N.fav=y?"1":"0",N.autologin=w,N.never_autofill=v,N.pwprotect=f,existing||(N.aid="0"),0!=d&&(N.sharefolderid=d.id,0==d.give&&(N.sharedfromaid=1,g_sharedfromaid=!0));var R="",W=[];if(G){void 0!==N.attachkey&&""!=N.attachkey||(N.attachkey=g_attachkey,R+="&attachkey="+n.en(N.attachkey)),N.attachpresent="1",N.retrieveattach=1;var H=0;for(var r in attaches)attaches.hasOwnProperty(r)&&void 0!==attaches[r]&&(R+="&filename"+H+"="+n.en(attaches[r].filename),R+="&mimetype"+H+"="+n.en(attaches[r].mimetype),R+="&attachid"+H+"="+n.en(attaches[r].id),R+="&attachbytes"+H+"="+n.en(get_decrypted_attachdata(attaches[r].id)),void 0===W.add&&(W.add=[]),W.add[W.add.length]=existing?{id:N.aid+"-"+attaches[r].id,mimetype:attaches[r].mimetype,parent:N.aid,filename:attaches[r].filename}:{id:attaches[r].id,mimetype:attaches[r].mimetype,filename:attaches[r].filename},H++)}if(removedattach.length>0){N.retrieveattach=1;for(var r=0;r<removedattach.length;r++)R+="&rmattach"+r+"="+n.en(removedattach[r]),void 0===W.remove&&(W.remove=[]),W.remove[W.remove.length]=removedattach[r]}var L=m;if(d&&(L=m.substr(d.decsharename.length+1)),existing){if(p!=data.url||g!=data.name||m!=data.group||u!=data.unencryptedUsername||_!=n.lpmdec(data.password,!0,i)||h!=n.lpmdec(data.extra,!0,i)||y!=("1"==data.fav)||v!=data.never_autofill||f!=data.pwprotect||w!=data.autologin||attaches.length>0||removedattach.length>0){N.sn?n.g_securenotes[N.aid]=N:n.g_sites[N.aid]=N;for(var r in N.fields)if(N.fields.hasOwnProperty(r)){var j=N.fields[r];is_encrypted_field(j.type)&&null!=origpassword&&""!=origpassword&&null!=j.value&&""!=j.value&&n.lpmdec_acct(j.value,!0,N,n.g_shares)==n.lpmdec_acct(origpassword,!0,N,n.g_shares)&&(!0,"password"==j.type&&(j.value=N.password)),is_encrypted_field(j.type)&&null!=origusername&&""!=origusername&&null!=j.value&&""!=j.value&&n.lpmdec_acct(j.value,!0,N,n.g_shares)==n.lpmdec_acct(origusername,!0,N,n.g_shares)&&(!0,"text"!=j.type&&"email"!=j.type&&"tel"!=j.type&&"url"!=j.type||(j.value=N.username))}if(m!=data.group&&(d||b)){var x=[get_record_id(data)],k=[];return k[get_record_id(data)]=m,n.moveIntoSharedFolder(d,b,x,k,!1,!1,!0),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.applyattacharraychanges(W),n.increment_local_accts_version(),n.rewritelocalfile();var c="ajax=1&extjs=1&name="+n.en(n.lpenc(g,i))+"&url="+n.en(AES.url2hex(p))+"&grouping="+n.en(n.lpenc(L,i))+"&username="+n.en(crypto_btoa(N.username))+"&password="+n.en(crypto_btoa(N.password))+"&extra="+n.en(crypto_btoa(N.extra))+"&openid_url=&aid="+n.en(get_record_id(data))+"&basic_auth=0&isbookmark=0&localupdate=1";c+=f?"&pwprotect=on":"",c+=v?"&never_autofill=on":"",c+=w?"&autologin=on":"",c+=y?"&fav=on":"",c+=0==d?"":"&sharedfolderid="+n.en(d.id),"http://sn"==p&&void 0!==n.g_loglogins&&n.g_loglogins&&(c+="&n="+AES.url2hex(g)),"http://sn"!=N.url&&"http://group"!=N.url&&8==(8&n.g_loglogins)&&(c+="&un="+en(AES.bin2hex(n.lpmdec_acct(origusername,!0,N,n.g_shares)))),c+=R,N.attacharraychanges=W,N.newvalues=[],n.saveSite(c,N);var M=n.getsites(D,!0);if(_!=n.lpmdec(data.password,!0,i)&&array_length(M)>1){var Y=n.lpmdec(data.password,!0,i),U=!1,K=","+get_record_id(data)+",";for(var V in M)getpasswordfromacct(n.g_sites[V])==Y&&get_record_id(data)!=V?U=!0:K+=","+V+",";U&&n.openLinkedSites(_,D,K)}}data.save_all&&checkFieldsForUpdates(i)}else{N.fields=new Array;var q=[],z=updateAndEncryptData2(n,N.username,N.password,N.fields,N,q,i),c="name="+n.en(n.lpenc(g,i))+"&grouping="+n.en(n.lpenc(L,i))+"&data="+n.en(n.bin2hex(z))+"&extra="+n.en(n.lpenc(h,i))+(f?"&pwprotect=on":"")+(v?"&never_autofill=on":"")+(w?"&autologin=on":"")+(y?"&fav=on":"");if(c+="&extjs=1&localupdate=1",c+=0==d?"":"&sharedfolderid="+n.en(d.id),void 0!==data.realm&&(N.realm_data=n.lpmenc(data.realm,!0,i),N.basic_auth="1",c+="&basic_auth=1&realm="+n.en(n.lpenc(data.realm,i))),"http://sn"==p){var X=getNoteValue("NoteType",h);N.notetype=X,c+=X&&""!=X?"&notetype="+n.en(X):""}a&&(c+="&replacing=1"),c+=R,data.save_all?(N.save_all=!0,c+="&ajax=1&aid=0&save_all=1&url="+n.en(AES.url2hex(p))+"&openid_url=&username=&password=",N.newvalues=q,n.saveAllSite(c,N)):void 0!==data.formdata?(c+="&ref="+n.en(AES.url2hex(p)),a&&(c+="&aid="+n.en(document.getElementById("replaceexistingsiteaid").value)),void 0!==data.createacct&&data.createacct&&void 0!==data.username_field&&(N.fields=new Array,c+="&createacct=1&username_field="+n.en(data.username_field)),N.newvalues=q,n.saveSiteFromSubmit(c,N)):(c+="&ajax=1&aid=0&url="+n.en(AES.url2hex(p))+"&openid_url=&username="+n.en(crypto_btoa(N.username))+"&password="+n.en(crypto_btoa(N.password)),N.newvalues=q,N.attacharraychanges=W,n.saveSite(c,N))}setTimeout(function(){getBG().closecurrenttab("site.html")},0)}}function checkFieldsForUpdates(e){var t=getBG(),a=document.getElementById("fields").contentWindow.document,n=!1;for(var d in data.fields){var i=data.fields[d];if(is_encrypted_field(i.type)){var l=a.getElementById(i.htmlid);if(l&&void 0!==l.value&&t.lpmdec(i.value,!0,e)!=l.value){n=!0;var r=t.lpmenc(l.value,!0,e);""!=i.value&&""!=t.g_sites[get_record_id(data)].username&&i.value==t.g_sites[get_record_id(data)].username&&""!=l.value&&(t.g_sites[get_record_id(data)].username=r,t.g_sites[get_record_id(data)].unencryptedUsername=l.value),""!=i.value&&""!=t.g_sites[get_record_id(data)].password&&i.value==t.g_sites[get_record_id(data)].password&&""!=l.value&&(t.g_sites[get_record_id(data)].password=r),i.value=r}}else if("checkbox"==i.type||"radio"==i.type){var s=i.checked,o=a.getElementById(i.htmlid)&&a.getElementById(i.htmlid).checked;s!=o&&(n=!0,i.checked=o)}else if("select-one"==i.type&&i.faketype){var l=a.getElementById(i.htmlid);l&&void 0!==l.value&&i.value!=l.value&&(n=!0,i.value=l.value)}}if(n){(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&(t.update_site(get_record_id(data)),t.update_fields(get_record_id(data),data.fields)),t.increment_local_accts_version(),t.rewritelocalfile();var c="update=1&aid="+t.en(get_record_id(data))+"&urid=0",p="",g=[];for(var d in data.fields){var i=data.fields[d];if(i.htmlid&&a.getElementById(i.htmlid)){var m;if(m=data.editfields&&""==i.formname?"_"+i.name:"_"+i.formname+"_"+i.name,is_encrypted_field(i.type)){var u=a.getElementById(i.htmlid).value;g.push(u),u=crypto_btoa(i.value),p+=m+"="+t.en(u)+"&"}else if("checkbox"==i.type)a.getElementById(i.htmlid).checked&&(p+=m+"="+t.en(i.value)+"&");else if("select-one"==i.type&&i.faketype){var u=a.getElementById(i.htmlid).value;p+=m+"="+t.en(u)+"&"}}}p+="&auto=1";var _=issharedfolder(t.g_shares,data.group);p+=0==_?"":"&sharedfolderid="+t.en(_.id),t.saveFields(c,p,{aid:data.aid,newvalues:g})}}function updateAndEncryptData2(e,t,a,n,d,i,l){for(var r="",s=void 0!==data.formdata?data.formdata.split("\n"):new Array,o=!1,c=0,p=0,g=0;g<s.length;g++){var m=s[g],u=m.split("\t");4!=u.length&&5!=u.length||("text"==u[3]||"email"==u[3]||"tel"==u[3]||"url"==u[3]?c++:"password"==u[3]&&p++)}0!=c||2!=p||data.save_all||(o=!0);for(var g=0;g<s.length;g++){var m=s[g],u=m.split("\t");if(4==u.length||5==u.length){var _=data.save_all?decodeURIComponent(u[0]):"0",h=decodeURIComponent(u[1]),y=decodeURIComponent(u[2]),v=getBG().lpmenc(y,!0,l),f=u[3];if("text"==f||"password"==f||"hidden"==f||"textarea"==f||"email"==f||"tel"==f||"url"==f){if("email"==f&&y==data.username&&(v=t),"tel"==f&&y==data.username&&(v=t),"url"==f&&y==data.username&&(v=t),"text"==f&&y==data.username&&(v=t),"password"==f&&o?(v=t,o=!1):"password"==f&&y==data.password&&(v=a),y=lpmdec(v,!0,l),i&&i.push(y),r+=_+"\t"+e.en(h)+"\t"+e.en(crypto_btoa(v))+"\t"+e.en(f)+"\n","hidden"!=f){var w={};w.otherfield=data.save_all,w.name=h,w.type=f,w.value=v,w.checked=!1,w.formname=data.save_all?_:"",w.urid="0",w.otherlogin="0",w.url="",n[n.length]=w}}else if("action"==f)r+=_+"\taction\t"+e.en(y)+"\taction\n",d.action=AES.url2hex(y);else if("method"==f)r+=_+"\tmethod\t"+e.en(y)+"\tmethod\n",d.method=y;else if(r+=_+"\t"+e.en(h)+"\t"+e.en(y)+"\t"+e.en(f)+"\n","checkbox"==f||"radio"==f||"select-one"==f){var w={};w.otherfield=data.save_all,w.name=h,w.type=f,"checkbox"==f||"radio"==f?(w.checked="-1"==y.substring(y.length-2),w.value=y.substring(0,y.length-2)):w.value=y,w.formname=data.save_all?_:"",w.urid="0",w.otherlogin="0",w.url="",n[n.length]=w}}}return r}function getDataHTML(){var e=newelt("div"),t=newelt("link");t.type="text/css",t.href="general.css",e.appendChild(t);for(var a=data.formdata.split("\n"),n=0;n<a.length;n++){var d=a[n],i=d.split("\t");if(4==i.length||5==i.length){var l=data.save_all?decodeURIComponent(i[0]):"0",r=decodeURIComponent(i[1]),s=decodeURIComponent(i[2]),o=i[3],c=uniqid(l+"_"+r);if("text"==o||"password"==o||"email"==o||"tel"==o||"url"==o){var p=newelt("label");set_innertext(p,r);var g=newelt("input","",c);if(g.name=r,g.type=o,g.value=s,e.appendChild(p),e.appendChild(g),"password"==o){event_handlers[c+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1};var m;g_eyeimgid=c+"toggleimg";var m=newelt("a","eye",c+"toggle"),u=newelt("img","",g_eyeimgid);u.alt=gs("[Show]"),u.src="images/eye-shown.png",m.appendChild(u),e.appendChild(m)}e.appendChild(newelt("br"))}else if("textarea"==o){var _=newelt("label");set_innertext(_,r);var h=newelt("textarea");h.readonly=!0,h.name=r,h.style.verticalAlign="top",set_innertext(h,s),e.appendChild(_),e.appendChild(h),e.appendChild(newelt("br"))}else if("select-one"==o){var y=newelt("select");y.name=r;var v=newelt("option");v.value=s,set_innertext(v,s),y.appendChild(v),e.appendChild(y),e.appendChild(newelt("br"))}else if("checkbox"==o||"radio"==o){if(checked="-1"==s.substring(s.length-2)?" checked":"","radio"==o&&""==checked)continue;s=s.substring(0,s.length-2);var f=newelt("input");f.type=o,f.value=s,f.disabled=!0,checked.length>0&&(f.checked=!0);var w=newelt("label");set_innertext(w,r),e.appendChild(f),e.appendChild(w),e.appendChild(newelt("br"))}}}return e}function showaddfield(){var e=getBG(),t=issharedfolder(e.g_shares,data.group);if(checkreadonly(t)){var a=document.getElementById("fields").contentWindow.document;a.getElementById("addfield").style.display="block",a.getElementById("newname").focus()}}function doaddfield(){var e=getBG(),t=issharedfolder(e.g_shares,data.group);if(checkreadonly(t)){var a=document.getElementById("fields").contentWindow.document,n=a.getElementById("newname").value,d=a.getElementById("newtype").value,i=d;"select-one"==i&&(i="text");var l=a.getElementById("newformname")?a.getElementById("newformname").value:"";if(""==n)return void alert(gs("You must enter a name."));for(var r in data.fields)if(data.fields[r].name==n&&(data.editfields||data.fields[r].formname==l))return void alert(gs("You must enter a unique name."));var s=uniqid(l+"_"+n),o=newelt("div");if("text"==d||"password"==d||"select-one"==d||"email"==d||"tel"==d||"url"==d){var c=newelt("label");set_innertext(c,n);var p=newelt("input","",ofja(s));if(p.type=ofja(i),c.appendChild(p),o.appendChild(c),"password"==d){g_eyeimgid=s+"toggleimg";var g=newelt("a","eye",ofja(s));g.id=ofja(s)+"toggle",g.href="#",g.className="eye";var m=newelt("img","",ofja(g_eyeimgid));m.id=ofja(g_eyeimgid),m.alt=gs("[Show]"),g.appendChild(m),o.appendChild(g)}}else if("textarea"==d){var u=newelt("textarea","",ofja(s));o.appendChild(u)}else if("checkbox"==d){var _=newelt("input","",ofja(s)),h=newelt("label");h.for=ofja(s),set_innertext(h,n),o.appendChild(_),o.appendChild(h)}var y=newelt("a","",ofja(s)+"delete"),v=newelt("div","","");set_innertext(y,"[ - ]"),y.href="#",set_innertext(v,n),y.appendChild(v);var f=a.createElement("div");f.id=s+"_div",f.appendChild(o),a.body.appendChild(f),event_handlers={},"password"==d&&(event_handlers[s+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1}),event_handlers[s+"delete"]=function(){var e=this.id.substring(0,this.id.length-6)+"_div",t=this.children[0].value;return parent.delete_field(e,t,""),!1},lpdbg("site","1 added event handler for "+s+"delete"),fix_event_handlers();var p=new Object;p.otherfield=!data.editfields,p.name=n,p.type=d,"select-one"==d&&(p.faketype=i),p.value="",p.formname=l,p.checked=!1,p.urid="0",p.otherlogin="0",p.url="",p.htmlid=s;var w=0;for(var r in data.fields)data.fields.hasOwnProperty(r)&&r>w&&(w=r);"string"==typeof w&&(w=parseInt(w)),0===data.fields.length?data.fields[0]=p:data.fields[w+1]=p,(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&e.update_fields(get_record_id(data),data.fields),e.increment_local_accts_version(),e.rewritelocalfile();var E="add=1&aid="+e.en(data.aid)+"&urid=0&name="+e.en(n)+"&type="+d;data.editfields||(E+="&formname="+e.en(l)),E+="&auto=1";var b=0==t?"":"sharedfolderid="+e.en(t.id);e.saveFields(E,b,{aid:data.aid}),a.getElementById("newname").value="",a.getElementById("newtype").selectedIndex=0,a.getElementById("newformname")&&(a.getElementById("newformname").value=""),a.getElementById("addfield").style.display="none"}}function newelt(e,t,a){var n=document.createElement(e);return t&&(n.className=t),a&&(n.id=a),n}function getFieldsHTMLNodes(e){var t=getBG(),a=document.createElement("div"),n=newelt("link","","");if(n.rel="stylesheet",n.src="general.css",n.type="text/css",a.appendChild(n),!is_application(data)){event_handlers.addfieldlink=function(){return parent.showaddfield(),!1},event_handlers.doaddfield=function(){parent.doaddfield()};var d=newelt("a","");d.href="#",d.id="addfieldlink",set_innertext(d,gs("Add Field")),a.appendChild(d),a.appendChild(document.createElement("br"));var i=newelt("div","","addfield");i.style.display="none";var l=newelt("label"),r=newelt("input","","newname");r.type="text",set_innertext(l,gs("Name:")),l.appendChild(r),i.appendChild(l),i.appendChild(newelt("br"));var s=newelt("label");set_innertext(s,gs("Type:"));var o=newelt("select","","newtype"),c=newelt("option","","");c.value="text",set_innertext(c,gs("Text"));var p=newelt("option","","");p.value="password",set_innertext(p,gs("Password"));var g=newelt("option","","");g.value="select-one",set_innertext(g,gs("Select"));var m=newelt("option","","");if(m.value="checkbox",set_innertext(m,gs("Checkbox")),o.appendChild(c),o.appendChild(p),o.appendChild(g),o.appendChild(m),s.appendChild(o),i.appendChild(s),i.appendChild(newelt("br")),!data.editfields){var u=newelt("label");set_innertext(u,gs("Form Name:")),u.appendChild(newelt("input","","newformname")),i.appendChild(u)}var u=newelt("input","","doaddfield");u.type="button",u.value=gs("Add"),i.appendChild(u),i.appendChild(newelt("br")),i.appendChild(newelt("br")),a.appendChild(i)}var _=new Array;for(var h in data.fields){var y=data.fields[h],u=y.formname,v=is_application(data)?h:y.name,f=y.value?y.value:"",w=f,E=y.type,b=v+"_"+E+"_"+f;if(void 0===_[b]){_[b]=!0;var B=uniqid(u+"_"+v);y.htmlid=B;var I=newelt("div");if(is_application(data)&&""==E||"text"==E||"password"==E||"email"==E||"tel"==E||"url"==E){w=crypto_btoa(f),f=t.lpmdec(f,!0,e);var x=newelt("input","",ofja(B));x.value=f;var k=newelt("label");if(set_innertext(k,v),k.appendChild(x),I.appendChild(k),"password"==E){event_handlers[B+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1};var C=newelt("a","",ofja(B)+"toggle");C.href="#";var A=newelt("span","","");set_innertext(A,gs("[Show]")),C.appendChild(A),I.appendChild(C),x.type="password",g_pw_field_ids.push(B)}}else if("textarea"==E){w=crypto_btoa(f),f=t.lpmdec(f,!0,e);var S=newelt("label");set_innertext(S,v);var T=document.createElement("textarea","",ofja(B));set_innertext(T,f),S.appendChild(T),I.appendChild(S)}else if("select-one"==E){var L=newelt("label");set_innertext(L,v);var N=newelt("select","",ofja(B)),G=newelt("option");G.value=f,set_innertext(G,f),N.appendChild(G),L.appendChild(N),I.appendChild(L)}else{if("checkbox"!=E&&"radio"!=E)continue;var P=y.checked?" checked":"";if("radio"==E&&""==P)continue;var F=newelt("input","",ofja(B));F.type=ofja(E),F.checked=y.checked,I.appendChild(F);var O=newelt("label");O.for=ofja(B),set_innertext(O,v),I.appendChild(O)}if(!is_application(data)){event_handlers[B+"delete"]=function(){var e=this.children,t=encodeURIComponent(get_innertext(e[0])),a=AES.hex2bin(get_innertext(e[1])),n=this.id.substring(0,this.id.length-6)+"_div";return parent.delete_field(n,t,a),!1},lpdbg("site","2 added event handler for "+B+"delete");var D=newelt("a","",ofja(B)+"delete");set_innertext(D,"[ - ]"),D.href="#";var R=newelt("div","",ofja(B)+"value"),W=newelt("div","",ofja(B)+"origval");R.style.display="none",set_innertext(R,v),W.style.display="none",set_innertext(W,AES.bin2hex(w)),I.appendChild(D),D.appendChild(R),D.appendChild(W)}var H=newelt("div","",ofja(B)+"_div");H.appendChild(I),a.appendChild(H)}}return a}function delete_field(e,t,a){try{if(confirm(gs("Are you sure you would like to delete this field?"))){var n=getBG(),d=issharedfolder(n.g_shares,data.group);if(!checkreadonly(d))return;var i=document.getElementById("fields").contentWindow.document;if(!i.getElementById(e))return void alert("Sorry, deletion of the field failed. Please re-save the site.");i.getElementById(e).style.display="none";for(var l in data.fields)if(data.fields.hasOwnProperty(l)&&data.fields[l].name==t){var r=data.fields[l].value;is_encrypted_field(data.fields[l].type)&&(r=crypto_btoa(r)),r==a&&(void 0!==data.fields.splice?data.fields.splice(l,1):delete data.fields[l])}(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_fields(get_record_id(data),data.fields),n.increment_local_accts_version(),n.rewritelocalfile();var s="delete=1&aid="+n.en(get_record_id(data))+"&urid=0&name="+n.en(t)+"&value="+n.en(a);s+="&auto=1";var o=0==d?"":"sharedfolderid="+n.en(d.id);n.saveFields(s,o,{aid:data.aid})}}catch(e){console_log("caught exception in delete_field: "+e.message)}}function dodel(){getBG().deleteAid(get_record_id(data),window,!1,!1,function(){setTimeout(function(){getBG().closecurrenttab("site.html")},0)})}function doshare(){if(!check_for_changes()||confirm(gs("Are you sure you want to share this item?  Doing so will cause you to lose any changes you have made to this item!"))){var e=getBG();e.unlock_plug2web(),e.openbaseurl("?ac=1&share="+e.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}}function docancel(){setTimeout(function(){getBG().closecurrenttab("site.html")},0)}function show_history(e){if(!check_for_changes()||confirm(gs("Are you sure you want to view history?  Doing so will cause you to lose any changes you have made to this item!"))){var t="";e==HISTORY.USERNAME?t="username":e==HISTORY.PASSWORD?t="password":e==HISTORY.EXTRA&&(t="note");var a=getBG();a.unlock_plug2web(),a.openbaseurl("?ac=1&"+t+"history="+a.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}}function toggle_password(e,t,a){if("password"==e.type){if(existing){var n=getBG();if(null!=data.sharedfromaid&&""!=data.sharedfromaid&&"0"!=data.sharedfromaid&&"null"!=data.sharedfromaid)return void alert(gs("This is a shared site. You are not permitted to view the password."));if(n.g_prompts.view_pw_prompt)return void(g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?n.security_prompt(function(a){e.type="text",t.children[0].children[0].src=get_eye_src(e.type,"glow"),t.children[0].children[0].setAttribute("alt",gs("[Hide]")),set_innertext(t.children[0].children[1],gs("Hide Password"))}):n.security_prompt(function(){e.type="text",set_innertext(t,gs("[Hide]"))}))}existing&&!logged&&(n.loglogin(get_record_id(data)),logged=!0),e.type="text",g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?(t.children[0].children[0].src=get_eye_src(e.type,"glow"),t.children[0].children[0].setAttribute("alt",gs("[Hide]")),set_innertext(t.children[0].children[1],gs("Hide Password"))):set_innertext(t,gs("[Hide]"))}else e.type="password",g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?(t.children[0].children[0].src=get_eye_src(e.type),t.children[0].children[0].setAttribute("alt",gs("[Show]")),set_innertext(t.children[0].children[1],gs("Show Password"))):set_innertext(t,gs("[Show]"))}function gsproper(e){return gs(e+"proper")!=e+"proper"?gs(e+"proper"):gs(e)}function check_for_changes(){var e=getBG(),t=document.getElementById("url").value,a=document.getElementById("name").value,n=document.getElementById("group").value,d=document.getElementById("username").value,i=document.getElementById("password").value,l=getSecureNoteFromFields(),r=document.getElementById("fav").checked,s=document.getElementById("never_autofill").checked,o=document.getElementById("pwprotect").checked,c=document.getElementById("autologin").checked,p=issharedfolder(e.g_shares,n),g=0==p?e.g_local_key:p.sharekey;return is_application(data)?t!=data.appname||a!=data.name||n!=data.group||d!=getusernamefromacct(data)||i!=getpasswordfromacct(data)||l!=e.lpmdec(data.extra,!0,g)||r!=("1"==data.fav)||o!=data.pwprotect||c!=("1"==data.autologin):t!=data.url||a!=data.name||n!=data.group||d!=data.unencryptedUsername||i!=e.lpmdec(data.password,!0,g)||l!=e.lpmdec(data.extra,!0,g)||r!=("1"==data.fav)||s!=data.never_autofill||o!=data.pwprotect||c!=data.autologin}function doeditfields(){var e=getBG();if(!check_for_changes()||confirm(is_application(data)?gs("LoseChangesApp"):gs("LoseChanges"))){e.g_site_data=new Array;for(var t in data)e.g_site_data[t]=data[t];e.g_site_data.editfields=1,e.set_editfieldsopener(window),e.openURL(getchromeurl("site.html"),null,e.g_site_data)}}function showattach(e){e.getAttribute("src_hidden")&&e.getAttribute("src_hidden").length?getBG().showImageAttach(e.getAttribute("src_hidden")):openattach(e)}function openattach(e){var t=e.getAttribute("filename")?e.getAttribute("filename"):"";getBG().openAttach(get_record_id(data),e.getAttribute("attachid"),t)}function addattach(){getBG().have_binary()?getBG().addAttach(function(){getBG().g_ischrome&&addattachcb()}):confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&getBG().install_binary()}function addThumbnail(e,t,a,n,d,i){var l=get_extension_from_mimetype(t),r=check_filename_badchars(l),s=null;if(s=r==FILENAME_FRAGMENT_VALID?"."+l:0==r.length||r==FILENAME_FRAGMENT_EMPTY?"":"."+gs(l),d&&i)try{var o=AES.hex2bin(lpdec(d,i));n=lpdec(n,o)}catch(e){n=""}null!==n&&""!=n||(n="attachment"+num_attachments+s);var c=document.getElementById("attachtable"),p=document.createElement("tr"),g=document.createElement("td");g.id=e,g.style.height="28px",g.style.width="80%",g.style.background="url('images/paperclip.png') no-repeat 2px 2px #e6e6e6";var m=document.createElement("span");m.style.fontWeight="bold",m.style.position="relative",m.style.left="32px",m.style.top="6px",m.style.cursor="pointer",m.appendChild(document.createTextNode(n)),a&&""!=a&&0==t.indexOf("data:image")?(m.setAttribute("attachid",e),d?(getBG().fastDecryptAttachment(e,t,a,d,i,function(e){getBG().g_ischrome&&(e&&e.length?m.setAttribute("src_hidden",t+";base64,"+e):m.setAttribute("src_hidden",""))}),m.addEventListener("click",function(){attachment_action_menu(this,showattach)})):(a&&a.length?m.setAttribute("src_hidden",t+";base64,"+a):m.setAttribute("src_hidden",""),getBG().have_binary()?m.addEventListener("click",function(){attachment_action_menu(this,showattach)}):m.addEventListener("click",function(){showattach(this)}))):(m.setAttribute("attachid",e),getBG().have_binary()?m.addEventListener("click",function(){attachment_action_menu(this,openattach)}):m.addEventListener("click",function(){openattach(this)}));var u=document.createElement("span");u.className="attachx",u.setAttribute("attachid",e),u.addEventListener("click",function(){rmattach(this)}),set_innertext(u,"     "),g.appendChild(m),g.appendChild(u),p.appendChild(g),c.insertBefore(p,c.firstChild),attachnum++}function createAttachId(){for(;;){var e=Math.floor(99999*Math.random());for(var t in data.attaches)if(data.attaches.hasOwnProperty(t)&&data.attaches[t].id==get_record_id(data)+"-"+e)break;for(var t=0;t<attaches.length&&(void 0===attaches[t]||attaches[t].id!=e);t++);return e}}function rmattach(e){var t=e.getAttribute("attachid");if(confirm(gs("Are you sure you would like to remove this attachment?"))){if(void 0!==data.attachpresent&&"1"==data.attachpresent)for(var a in data.attaches)data.attaches.hasOwnProperty(a)&&t==data.attaches[a].id&&(removedattach[removedattach.length]=t);delete attaches[t],delThumbnail(t)}}function delThumbnail(e){for(var t=document.getElementById("attachtable"),a=0;a<t.children.length;a++){var n=t.children[a];if(n.children&&n.children.length&&n.children[0].id==e)return void t.removeChild(n)}}function attachment_action_doSave(){if(null!=open_attach_target){var e=open_attach_target.getAttribute("filename")?open_attach_target.getAttribute("filename"):"";getBG().exportAttachment(get_record_id(data),open_attach_target.getAttribute("attachid"),e)}else alarm("error, trying to save an attachment that does not exist");close_attach_list()}function clearData(){for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++)"button"!=e[t].type&&(e[t].value="");for(var a=document.getElementsByTagName("textarea"),t=0;t<a.length;t++)a[t].value=""}function uniqid(e){return e||(e=""),"a"+SHA256(e+"_"+(new Date).getTime()+"_"+Math.floor(100*Math.random()))}function setup_eye_events(e){if(g_eye_show){e.getElementById("passwordtoggle");e.getElementById("passwordtoggleimg").style.verticalAlign="bottom"}}function eye_over(e){if(null!=e&&null!=e.target){var t=document.getElementById("passwordtoggleimg"),a=document.getElementById("password");e.target==t&&(t.src=get_eye_src(a.type,"glow"))}}function eye_out(e){if(null!=e&&null!=e.target){var t=document.getElementById("passwordtoggleimg"),a=document.getElementById("password");e.target==t&&(t.src=get_eye_src(a.type))}}function get_eye_src(e,t){return"password"==e?"images/eye-shown.png":"images/eye-hidden.png"}function docpwbtn(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;var n=data.aid,d=data.url;return g_cpwbot&&d&&void 0!==t.dopwchange&&(g_start_time=(new Date).getTime(),t.cpwbot_preinit(),g_cpw_progress_ctr=20,show_cpw_dialog("progress"),setTimeout(function(){insert_cpw_placeholder_msg(a,gs("LastPass is loading..."))},5003),setTimeout(function(){cpw_status_check()},CPW_WAKETIME),g_ischrome?get_selected_tab(null,function(e){t.dopwchange(n,!1,e)}):t.dopwchange(n,!1)),!1}function docpwdebug(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;if(g_cpwbot){if(document.getElementById("cpwmsgdiv"))return!1;var n=a.createElement("div");n.style.height="200px",n.style.width="100%",n.style.overflow="auto",n.style.backgroundColor="blue",n.style.color="yellow",n.style.padding="3px",n.id="cpwmsgdiv";var d=a.getElementById("sitebody");d?d.appendChild(n):a.body.appendChild(n)}return!1}function cpw_status_check(){var e=getBG(),t=document;if(!t||!e||!data)return!1;var a=!1,n=!1,d=!1,i=!1,l=!1,r=!1,s=t.getElementById("cpwmsgdiv");if(s&&(g_ischrome?set_innertext(s,e.cpwbot_get_user_debug_messages()):e.cpwbot_get_user_debug_messages()),g_ischrome){cpw_progress_update(e.cpwbot_get_dialog_msg())}else e.cpwbot_get_dialog_msg();var o=get_current_state(!0);switch(lpdbg("site","BG.current_state is "+o),o){case"FAIL":a=!0,n=!0;break;case"CAPTCHA":a=!0,n=!0,d=!0;break;case"DOCAPTCHA":i=!0;break;case"TIMEOUT":a=!0,n=!0,r=!0;break;case"FAIL_PW_SAVED":a=!0,n=!0,l=!0;break;case"DONE":case"OK":a=!0;break;case 0:case null:a=!1}if(form_refresh(),i)g_start_time=(new Date).getTime();else{(new Date).getTime()>g_start_time+POLL_MAXTIME&&(a=!0,n=!0,lpdbg("site","max timeout"))}a?(show_cpw_dialog(n?d?"captcha":r?"timeout":l?"fail_pw_saved":"fail":"dismiss"),g_ischrome?setTimeout(function(){form_refresh()},3001):setTimeout(function(){get_data("siterefresh",function(){form_refresh()})},3001)):setTimeout(function(){cpw_status_check()},CPW_WAKETIME)}function form_refresh(){var e=getBG(),t=document;if(!t||!e||!data)return!1;if(!e.lploggedin)return!1;var a=(new Date).getTime(),n=0;if(my_aid){var d=get_record(my_aid,!0);if(d){var i="";void 0!==e.g_pending_pw_change&&(i=e.lpdec_acct(e.g_pending_pw_change[my_aid],d,e.g_shares));var l=getpasswordfromacct(d);if(d.save_all){var r,s=document.getElementById("fields").contentWindow.document;for(r=0;r<g_pw_field_ids.length;r++){var o=s.getElementById(g_pw_field_ids[r]);if(o){var c=o.value;l&&o&&i&&i!=l&&(l==c||i==c)&&(lpdbg("site","using pending pw instead of g_sites"),l=i),l&&o&&(c===l?console.warn("REFRESH: no change"):c&&l&&(o.value=l,lpdbg("site","REFRESH: reset password iframe field from "+(e.g_show_pw_in_logs?c:"REDACTED")+" to "+(e.g_show_pw_in_logs?l:"REDACTED")))),update_SaveButton()}}}else{var o=t.getElementById("password"),c=o.value;if(l&&o&&i&&i!=l&&(l==c||i==c)&&(lpdbg("site","using pending pw instead of g_sites"),l=i,n=a/1e3),l&&o)if(c===l);else if(c&&l){o.value=l,lpdbg("site","REFRESH: reset password from "+(e.g_show_pw_in_logs?c:"REDACTED")+" to "+(e.g_show_pw_in_logs?l:"REDACTED"));var p=data.group,g=issharedfolder(e.g_shares,p),m=0==g?e.g_local_key:g.sharekey;data.password=e.lpmenc(l,!0,m),pw_age_update(n>0?n:d.last_pwchange_gmt),update_password_meter("",t.getElementById("password").value),update_SaveButton()}}}}return!1}function show_cpw_button(e){var t=getBG(),a=document;if(!a||!t||!e)return!1;var n=!1;!g_cpwbot&&void 0!==t.g_cpwbot&&t.g_cpwbot&&(g_cpwbot=t.g_cpwbot);var d=issharedfolder(t.g_shares,e.group);if(e&&(d?(checkreadonly(d,!0)?(n=!1,lpdbg("site","in shared folder, writable")):(n=!0,lpdbg("site","in shared folder, readonly")),"1"===d.associative&&lpdbg("site","entry is in linked account")):e.individualshare?null!=e.sharedfromaid&&""!=e.sharedfromaid&&"0"!=e.sharedfromaid&&"null"!=e.sharedfromaid?(lpdbg("site","individual share, readonly"),n=!0):(lpdbg("site","individual share, writable"),n=!1):n=!1),g_cpwbot&&e&&"1"==e.pwch&&!n)if(e.save_all)enable_cpw_field_btn(document);else{var i=a.getElementById("cpwbtnmini");i&&(i.addEventListener("click",function(e){document.getElementById("cpwbtnmini").classList.contains("btn_disabled")||show_cpw_dialog("new")}),i.style.fontSize="12px",i.style.display="inline-block");var l=a.getElementById("pwspacer");l&&(l.style.display="inline-block",l.style.width="50px")}else{var i=a.getElementById("cpwbtnmini");i&&(i.style.display="none");var l=a.getElementById("pwspacer");l&&(l.style.display="none");var r=a.getElementById("cpwfieldbtn");r&&(r.style.display="none")}}function pw_age_update(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;e=parseInt(e);var n=(new Date).getTime(),d=180;d=0,n=null===n?0:parseInt(n/1e3)-60*d;var i="Never";if(!e||"number"!=typeof e||!n||isNaN(e)||isNaN(n)||n<e){i="";var l=a.getElementById("pwagelabel");l&&(l.style.display="none")}else{var l=a.getElementById("pwagelabel"),r=n-e;r<60?i=r.toString()+" "+(1==r?gs("second"):gs("seconds")):r<3600?(r=parseInt(r/60),i=r.toString()+" "+(1==r?gs("minute"):gs("minutes"))):r<86400?(r=parseInt(r/3600),i=r.toString()+" "+(1==r?gs("hour"):gs("hours"))):r<604800?(r=parseInt(r/86400),i=r.toString()+" "+(1==r?gs("day"):gs("days"))):r<2592e3?(r=parseInt(r/604800),i=r.toString()+" "+(1==r?gs("week"):gs("weeks"))):r<31536e3?(r=parseInt(r/2592e3),i=r.toString()+" "+(1==r?gs("month"):gs("months"))):(r=parseInt(r/31536e3),i=r.toString()+" "+(1==r?gs("year"):gs("years")))}var s=a.getElementById("pwagediv");s.style.fontStyle="italic",s&&(set_innertext(s,i),a.getElementById("pwagelabel").style.display="inline")}function hide_cpw_dialog(){var e=getBG(),t=document;if(!t||!e||!data)return!1;var a=(t.getElementById("pwcontainer"),t.getElementById("cpwdialog"));a&&(a.style.display="none");var n=t.getElementById("modalbg");if(n&&(n.style.display="none"),void 0!==e.cpwbot_halt){var d=get_current_state();"FAIL"!=d&&"CAPTCHA"!=d&&"DONE"!=d&&"OK"!=d&&"TIMEOUT"!=d&&0!=d&&null!==d&&e.cpwbot_halt()}data&&data.openchpw&&e.close_cpw_tabs()}function append_text_with_b(e,t){var a=t.indexOf("<b>"),n=t.indexOf("</b>");e.appendChild(e.ownerDocument.createTextNode(t.substring(0,a)));var d=e.ownerDocument.createElement("b");set_innertext(d,t.substring(a+3,n)),e.appendChild(d),e.appendChild(e.ownerDocument.createTextNode(t.substring(n+4)))}function show_cpw_dialog(e,t,a,n,d){var i=getBG(),l=document;if(!l||!i||!data)return!1;var r=(l.getElementById("notesrow1"),l.getElementById("pwcontainer"),l.getElementById("modalbg"));r.style.width=l.body.clientWidth,r.style.height=l.body.clientHeight,r.style.display="block";var s=l.getElementById("dlghdg"),o=l.getElementById("dlghtml");o.style.fontSize="12px";var c=l.getElementById("bcnd"),p=l.getElementById("bokd"),g=l.getElementById("bdis"),m=null;switch(c&&0==(event_flags&EV_CX)&&(c.addEventListener("click",function(e){hide_cpw_dialog()}),l.getElementById("dlgclose").addEventListener("click",function(e){hide_cpw_dialog()}),g.addEventListener("click",function(e){hide_cpw_dialog()}),event_flags|=EV_CX),p&&0==(event_flags&EV_OK)&&(p.addEventListener("click",function(e){return docpwbtn(e),!1}),event_flags|=EV_OK),set_innertext(c,gs("No, Thanks")),set_innertext(p,gs("Change Password Now")),set_innertext(g,gs("Dismiss")),set_innertext(s,sprintf(gs("%s Password One-Click Change"),"LastPass")),e){case"new":g_cpw_heard_from_bg=!1,LP_decimate_children(o);var u=l.createElement("p");set_innertext(u,sprintf(gs("%s will now attempt to change your password to a strong, generated password that will be saved in your vault and known only to you."),"LastPass")),o.appendChild(u),o.appendChild(l.createElement("br")),u=l.createElement("p"),append_text_with_b(u,sprintf(gs("In order to complete the process, %s will have to log in to %s and navigate through a number of windows quickly. It is normal to see windows flashing and changing quickly, and may take several moments. We'll let you know when you're all set!"),"LastPass","<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="block",p.style.display="block",g.style.display="none";break;case"progress":LP_decimate_children(o);var _=l.createElement("b");set_innertext(_,gs("Overall Progress:")),o.appendChild(_),o.appendChild(l.createElement("br"));var h=l.createElement("div");h.className="progress_container";var y=l.createElement("div");y.className="progress_bar",y.id="progress_bar",h.appendChild(y),o.appendChild(h),h=l.createElement("div"),h.id="stepbystep",o.appendChild(h),h=l.createElement("div"),h.id="advanced",o.appendChild(h),l.getElementById("progress_bar").style.width="10%",c.style.display="none",p.style.display="none",g.style.display="none";break;case"update":if(l.getElementById("progress_bar").style.width=t+"%",a){var v=l.createElement("p");"DOCAPTCHA"==get_current_state()&&(v.className="boldred");var f=l.createTextNode(a);v.appendChild(f),l.getElementById("stepbystep").appendChild(v),g_cpw_heard_from_bg||(g_cpw_heard_from_bg=!0,(m=l.getElementById("cpw_placeholder_msg"))&&m.parentNode.removeChild(m))}if(n){var v=l.createElement("i"),f=l.createTextNode(gs("Complete!"));v.appendChild(f);var u=l.getElementById("stepbystep").lastChild;u&&u.appendChild(v)}if(d){var v=l.createElement("p"),f=l.createTextNode(d);v.appendChild(f),l.getElementById("advanced").appendChild(v)}break;case"dismiss":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));var u=l.createElement("p");append_text_with_b(u,sprintf(gs("Congratulations! Your password for %s was updated, and is now saved in your LastPass vault. Your change will sync on every device."),"<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block",set_innertext(g,gs("OK"));break;case"fail":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));var u=l.createElement("p");append_text_with_b(u,sprintf(gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),"<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"captcha":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));var u=l.createElement("p");set_innertext(u,gs("Unable to proceed, the website does not allow automated password change.")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"timeout":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));var u=l.createElement("p");set_innertext(u,gs("Timed out waiting for the page to load.  Retry?")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"fail_pw_saved":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));var u=l.createElement("p");append_text_with_b(u,sprintf(gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),"<b>"+of(data.name)+"</b>")+gs("The random password that was generated has been saved to your vault.")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block"}var w=l.getElementById("cpwdialog");w.style.display="block",w.style.height="250px",w.style.width="470px",w.style.left=(parseInt(l.body.clientWidth)-470)/2+"px",w.style.top=(parseInt(l.body.clientHeight)-470)/2+"px",g_ischrome||(g_cpwbot_pwchangestate="init_state_dingbats")}function notehist(){var e=getBG();e.unlock_plug2web(),e.openbaseurl("?ac=1&notehistory="+e.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}function cpw_progress_update(e){e&&e!=g_lastmsg&&(g_lastmsg=e,g_cpw_progress_ctr+=20,g_cpw_progress_ctr>90&&(g_cpw_progress_ctr=95),show_cpw_dialog("update",g_cpw_progress_ctr,e,!1,""))}function get_current_state(e){if(g_ischrome)return getBG().cpwbot_getpwchangestate();var t=g_cpwbot_pwchangestate;return e&&getBG().cpwbot_getpwchangestate(),t}function enable_cpw_field_btn(e){var t=e.getElementById("cpwfieldbtn");t&&(t.addEventListener("click",function(t){e.getElementById("cpwfieldbtn").classList.contains("btn_disabled")||e.getElementById("cpwbtnmini").classList.contains("btn_disabled")||show_cpw_dialog("new")}),t.style.fontSize="12px",t.style.display="inline-block",t.style.marginTop="5px",t.style.marginBottom="5px")}function accelerator_key_handler(e){if(!g_do_keyaccel)return!0;if(!e||!e.keyCode)return!1;var t=!0,a=!1;try{"undefined"!=typeof navigator&&void 0!==navigator.platform&&0==navigator.platform.toLowerCase().indexOf("mac")&&(t=!1,a=!0)}catch(e){}var n=document;if(!n)return!1;switch(e.keyCode){case KEY_ESCAPE:break;case KEY_S:(e.ctrlKey&&a||e.altKey&&t)&&("function"!=typeof e.preventDefault&&e.preventDefault(),is_savebtn_disabled(n)||dosave(),LP_stopEventPropagation(e))}return!0}function is_savebtn_disabled(e){e||(e=document);var t=e.getElementById("save");return!t||t.className.indexOf("btn_disabled")>=0}function insert_cpw_placeholder_msg(e,t){e||(e=document);var a=e.getElementById("cpw_placeholder_msg");if(t&&!g_cpw_heard_from_bg&&null===a){var n=e.createElement("p"),d=e.createTextNode(t);n.id="cpw_placeholder_msg",n.appendChild(d),e.getElementById("stepbystep").appendChild(n)}}var data=null,existing=null,origusername=null,origpassword=null,attachnum=0,attaches=[],removedattach=[],g_eye_show=!0,g_eyeimgid=null,g_start_time=null,POLL_MAXTIME=3e5,g_pwlen=0,pass=!0,g_sharedfromaid=!1,g_pw_field_ids=[],ENABLE_ONLY=!0,g_do_keyaccel=!0,KEY_S=83,event_handlers={},HISTORY={USERNAME:0,PASSWORD:1,EXTRA:2},logged=!1,CPW_WAKETIME=97,my_aid=null,g_cpw_progress_ctr=0,g_lastmsg="",event_flags=0,EV_CX=1,EV_OK=2,g_cpw_heard_from_bg=!1,g_cpwbot_pwchangestate=null;
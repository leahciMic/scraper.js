var SharedFolderAccessDialog=function(e){ContainerSelectionDialog.call(this,e),this.member=null,this.selectedAids=null,this.leftHeader=null,this.leftHeaderText=null,this.rightHeader=null,this.rightHeaderText=null};SharedFolderAccessDialog.prototype=Object.create(ContainerSelectionDialog.prototype),SharedFolderAccessDialog.prototype.constructor=SharedFolderAccessDialog,function(){SharedFolderAccessDialog.prototype.initialize=function(e){ContainerSelectionDialog.prototype.initialize.apply(this,arguments),this.leftHeader=e.find(".identityLeft .header"),this.leftHeaderText=this.leftHeader.text(),this.leftPlaceHolder=e.find(".availableSearch"),this.leftPlaceHolderText=this.leftPlaceHolder.attr("placeholder"),this.rightHeader=e.find(".identityRight .header"),this.rightHeaderText=this.rightHeader.text(),this.rightPlaceHolder=e.find(".selectedSearch"),this.rightPlaceHolderText=this.rightPlaceHolder.attr("placeholder"),this.otherMembersElement=$("#sharedFolderAccessOtherUsers"),function(e){e.inputFields.hidebydefault.onChange(function(t){t?(e.leftHeader.text(e.rightHeaderText),e.leftPlaceHolder.attr("placeholder",e.rightPlaceHolderText),e.rightHeader.text(e.leftHeaderText),e.rightPlaceHolder.attr("placeholder",e.leftPlaceHolderText)):(e.leftHeader.text(e.leftHeaderText),e.leftPlaceHolder.attr("placeholder",e.leftPlaceHolderText),e.rightHeader.text(e.rightHeaderText),e.rightPlaceHolder.attr("placeholder",e.rightPlaceHolderText))}),e.inputFields.applyToOthers.onChange(function(t){t?e.otherMembersElement.show():e.otherMembersElement.hide()})}(this)},SharedFolderAccessDialog.prototype.setup=function(){ContainerSelectionDialog.prototype.setup.apply(this,arguments);for(var e=[],t=dialogs.sharedFolder.getDialog().containers.existingMembers.getItemChildren(),r=0,i=t.length;r<i;++r){var a=t[r];a!==this.member&&e.push(new SharedFolderAccessCheckbox(a))}e.length>0&&(this.containers.otherMembers=new Container(e,{allowDrag:!1,searchInput:"sharedFolderAccessOtherUsersSearch",publishSelect:!1}),this.containers.otherMembers.initialize(document.getElementById("sharedFolderAccessOtherUsersContainer")))};var e=function(e){for(var t={},r=0,i=e.length;r<i;++r)t[e[r]]=!0;return t};SharedFolderAccessDialog.prototype.open=function(t,r){if(void 0===r){var i={shareid:t.getShareID()};return t instanceof SharedFolderUser?i.uid=t.getID():i.cgid=t.getID(),void LPRequest.makeDataRequest(LPProxy.getSharedFolderRestrictions,{params:i,success:this.createDynamicHandler(function(e){this.open(t,e)})})}var a=r.aids;if(this.member=t,this.selectedAids=e(a),!this.member._sharedGroup.isDownloaded())return void function(e){dialogs.confirmation.open({title:Strings.translateString("Error"),text:Strings.translateString("Folder must be downloaded in order to edit a member's access. Would you like to download now?"),handler:function(){e._sharedFolderItem.startDownloading(),Dialog.prototype.closeAllDialogs()}})}(this.member._sharedGroup);var o=LPProxy.getItemsByShareID(this.member._sharedGroup.getID());this.restrictedItems=[];for(var s=[],l=0,d=r.restrictedItems.length;l<d;++l){var n=r.restrictedItems[l];n.aid=n.id,n.group=n.group||"";var h=-1!==n.url.indexOf("http://sn")?new Note(n,this.member._sharedGroup,[]):new Account(n,this.member._sharedGroup);h._data.name=LPProxy.decryptMobile(h._data.name,!1,h.getKey()),h._data.group=LPProxy.decryptMobile(h._data.group,!1,h.getKey()),o.push(h);var c=h instanceof Note?new NoteDisplay(h):new AccountDisplay(h);s.push(c)}var g=new GroupDisplay(this.member._sharedGroup,s);if(this.restrictedItems.push(g),LPProxy.assignItemsToGroups(this.restrictedItems),this.availableAids={},0===o.length)return void dialogs.alert.open({title:Strings.translateString("Edit Access"),text:Strings.translateString("Please add items to this folder before editing a member's access.")});for(var l=0,d=o.length;l<d;++l){var p=o[l].getID();void 0===this.selectedAids[p]&&(this.availableAids[p]=!0)}ContainerSelectionDialog.prototype.open.apply(this,[{title:"Edit Access: "+t.toString(),defaultData:{hidebydefault:"1"===r.hidebydefault}}])};var t=function(e){var t={filter:e},r=LPProxy.getSites(t).concat(LPProxy.getNotes(t));return LPProxy.assignItemsToGroups(r,!1)};SharedFolderAccessDialog.prototype.getAvailableItems=function(e){return t(this.availableAids)},SharedFolderAccessDialog.prototype.getSelectedItems=function(e){return this.restrictedItems};var r=function(e){for(var t=[],r=0,i=e.length;r<i;++r)t.push(e[r].getID());return t.join(",")};SharedFolderAccessDialog.prototype.getData=function(e){var t=ContainerSelectionDialog.prototype.getData.apply(this,arguments);return t.aids="",this.containers.selected&&(t.aids=r(this.containers.selected.getItemModelChildren())),t.additionaluids="",t.applyToOthers&&this.containers.otherMembers&&(t.additionaluids=r(this.containers.otherMembers.getSelectedModelItems())),t},SharedFolderAccessDialog.prototype.handleSubmit=function(e){LPRequest.makeRequest(LPProxy.updateSharedFolderRestrictions,{params:$.extend(e,{uid:this.member.getID(!0),shareid:this.member._sharedGroup.getID()})})}}();
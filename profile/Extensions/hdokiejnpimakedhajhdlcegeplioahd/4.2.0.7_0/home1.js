function onLoad(e){if(!e)return void get_data("vault",function(){onLoad(!0)});var t=document.location.href.indexOf("?searchstr=");if(-1!=t){var n=document.location.href.substring(t+11),s=n.indexOf("&");-1!=s&&(n=n.substring(0,s)),document.getElementById("searchbox").value=decodeURIComponent(n)}populate(),document.getElementById("searchbox").focus(),window.addEventListener("keydown",function(e){handle_keydown(e)},!1),setTimeout(function(){checkVersion()},500)}function onResize(){document.getElementById("gridsite")&&(document.getElementById("gridsite").style.height=document.body.clientHeight-document.getElementById("gridsite").offsetTop+"px")}function handle_keydown(e){var t=0!=e.keyCode?e.keyCode:e.charCode;if(40==t||38==t){var n=40==t?g_selectedrow+1:-1==g_selectedrow?g_ids.length:g_selectedrow-1;n+1>g_ids.length||n<0||(-1!=g_selectedrow&&(document.getElementById("site"+g_ids[g_selectedrow]).className="site"),g_selectedrow=n,document.getElementById("site"+g_ids[g_selectedrow]).className="site focus")}else 13==t&&-1!=g_selectedrow&&ls(g_ids[g_selectedrow])}function clearkeyboardnav(){-1!=g_selectedrow&&(document.getElementById("site"+g_ids[g_selectedrow]).className="site",g_selectedrow=-1)}function populate(){var e=getBG(),t=document.getElementById("searchbox").value.toLowerCase();g_lastsearch=t;var n=!e.g_prompts.edit_sn_prompt&&e.get_searchNotesPref(),d=search_results(t,n,"gridsite");void 0!==d&&d.sort(e.lp_sort_case_insensitive_name),s=[],g_ids=[],g_selectedrow=-1,event_handlers={};for(var r in d)g_ids.push(get_record_id(d[r])),s.push(getsitehtml(d,r));var i=document.createElement("div");i.id="gridclear",i.className="clear",s.push(i),LP_decimate_children(document.getElementById("gridsite"));for(var r=0;r<s.length;r++)document.getElementById("gridsite").appendChild(s[r]);for(var r in event_handlers)document.getElementById(r).onclick=event_handlers[r];s=null,document.getElementById("gridsite").style.height=document.body.clientHeight-document.getElementById("gridsite").offsetTop+"px",g_current_version=e.g_local_accts_version,d.length>0&&(g_selectedrow=0,document.getElementById("site"+g_ids[0]).className="site focus")}function checkVersion(e){if((g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&!e)return void getBG().update_state("search");var t=getBG();t.lploggedin&&g_current_version==t.g_local_accts_version||populate(),setTimeout(function(){checkVersion()},500)}function search_go(){populate()}function search_clear(){document.getElementById("searchbox").value="",populate()}function sp(e,t,n){if(get_innertext(e)==gs("Show")){var s=getBG(),d=get_record(t);if(null!=d.sharedfromaid&&""!=d.sharedfromaid&&"0"!=d.sharedfromaid&&"null"!=d.sharedfromaid)return void alert(gs("This is a shared site. You are not permitted to view the password."));if(!n&&(d.pwprotect||s.g_prompts.view_pw_prompt))return void s.security_prompt(function(){sp(e,t,!0)});set_innertext(e,s.getpasswordfromacct(get_record(t)))}else set_innertext(e,gs("Show"))}function os(e){var t=getBG();return t.editAid(e,window),is_in_panel()&&t.closecurrenttab("home.html"),!1}function ds(e){return getBG().deleteAid(e,window),!1}function ls(e){var t=getBG();return t.launch(e),setTimeout(function(){window_close("home.html")},0),is_in_panel()&&t.closecurrenttab("home.html"),!1}function search_keyup(e,t){var n=e.charCode?e.charCode:e.keyCode?e.keyCode:e.which?e.which:0,s=document.getElementById("searchbox").value;g_searchhasfocus&&40!=n&&38!=n&&13!=n&&s.length>2&&populate()}function getsitehtml(e,t,n){id=get_record_id(e[t]),name=trunc(e[t].name,MAX_SITENAME_LEN),username=void 0!==e[t].unencryptedUsername?trunc(e[t].unencryptedUsername,MAX_SITEUSERNAME_LEN):"",event_handlers["launch"+id]=function(){return ls(this.id.substring(6))},event_handlers["show"+id]=function(){return sp(this,this.id.substring(4))},event_handlers["edit"+id]=function(){return os(this.id.substring(4))},event_handlers["delete"+id]=function(){return ds(this.id.substring(6))};var s=document.createElement("div");s.className="site",s.id="site"+id;var d=document.createElement("div");d.className="border";var r=document.createElement("div");r.className="sitename";var i=document.createElement("span");i.className="content",i.appendChild(sprite_gethtmlfromrecord(e[t]));var a=document.createElement("a");a.setAttribute("target","_blank"),a.setAttribute("href","#"),a.id="launch"+id,set_innertext(a,name),i.appendChild(a),r.appendChild(i),d.appendChild(r);var r=document.createElement("div");r.className="siteusername",i=document.createElement("span"),i.className="content",set_innertext(i,username),r.appendChild(i),d.appendChild(r);var r=document.createElement("div");r.className="sitepassword",i=document.createElement("span"),i.className="content";var a=document.createElement("a");a.setAttribute("href","#"),a.id="show"+id,set_innertext(a,gs("Show")),i.appendChild(a),r.appendChild(i),d.appendChild(r);var r=document.createElement("div");if(r.className="sitefavorite",i=document.createElement("span"),i.className="content","1"==e[t].fav){var o=document.createElement("img");o.setAttribute("src","images/icon_favorite.png"),i.appendChild(o)}r.appendChild(i),d.appendChild(r);var r=document.createElement("div");if(r.className="sitenote",i=document.createElement("span"),i.className="content",""!=e[t].extra){var o=document.createElement("img");o.setAttribute("src","images/icon_note.png"),i.appendChild(o)}r.appendChild(i),d.appendChild(r);var r=document.createElement("div");if(r.className="siteprotected",i=document.createElement("span"),i.className="content",e[t].pwprotect){var o=document.createElement("img");o.setAttribute("src","images/icon_protected.png"),i.appendChild(o)}r.appendChild(i),d.appendChild(r);var r=document.createElement("div");if(r.className="siteautologin",i=document.createElement("span"),i.className="content",e[t].autologin){var o=document.createElement("img");o.setAttribute("src","images/icon_autologin.png"),i.appendChild(o)}r.appendChild(i),d.appendChild(r);var r=document.createElement("div");return r.className="siteaction",a=document.createElement("a"),a.setAttribute("href","#"),a.id="edit"+id,set_innertext(a,gs("Edit")),r.appendChild(a),i=document.createElement("span"),set_innertext(i,"|"),r.appendChild(i),a=document.createElement("a"),a.setAttribute("href","#"),a.id="delete"+id,set_innertext(a,gs("Delete")),r.appendChild(a),r.appendChild(document.createTextNode("   ")),d.appendChild(r),s.appendChild(d),s}function sprite_gethtmlfromrecord(e){return getBG().geticonhtmlfromrecord(e,document)}function trunc(e,t){return e||(e=""),e.length<=t?e:e.substr(0,t)+"..."}var g_current_version=0,g_selectedrow=-1,g_searchhasfocus=!1,g_ids=[],g_lastsearch=null,MAX_GROUPNAME_LEN=80,MAX_SITENAME_LEN=30,MAX_SITEUSERNAME_LEN=15;
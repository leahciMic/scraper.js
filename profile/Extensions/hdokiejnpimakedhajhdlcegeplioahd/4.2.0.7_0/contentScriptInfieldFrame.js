function LP_keypress_handler(e){"use strict";return 27==e.keyCode?void LPInfieldFrame.close("close"):9==e.keyCode?void LPInfieldFrame.close("away"):void 0}var lpResizeEvent=function(){"use strict";function e(){o||(o=setTimeout(function(){o=null,t()},66))}function t(){r&&r()}function n(t){r=t,window.addEventListener("resize",e)}function i(){r=null,window.removeEventListener("resize",e)}var o,r;return{attachWindowResizeEvent:n,detachWindowResizeEvent:i}}(),LPInfieldFrame=function(){"use strict";function e(e,t){var n;return function(){var i=this,o=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(i,o)},t)}}function t(t){(w=w||e(n,100))(t)}function n(e){if(v)return void(v=!1);if(e.iframe&&!e.fieldEl)try{e.fieldEl=$(e.iframe).contents().find("#"+e.id)[0]}catch(e){}if(e&&("focus"!==e.eventType||!E)){if(u){if(p.id===e.id)return;o("away")}!0===bg.get("LPContentScriptFeatures").better_generate_password_enabled&&(m="betterContentScriptPopup.html"),e.url=m,p=e,u=LPFrame.openFrame({url:m,interfaceDefinition:Interfaces.InfieldPopupInterface}),s(),d(),lpResizeEvent.attachWindowResizeEvent(d),window.addEventListener("click",i,!0),bg.sendLpImprove("newinfieldopen",{source:"formv2",option:e.eventType})}}function i(e){return(!p||e.target.id!==p.id&&e.target!==p.fieldEl)&&(o("away"),!0)}function o(e){u&&(e&&(v="action"==e,bg.sendLpImprove("newinfieldclose",{source:"formv2",option:e}),"close"===e&&(E=!0,p.fieldEl&&(LP_addEventHandler(p.fieldEl,"click",launchPopup,!1),realLaunchPopup&&p.fieldEl.removeEventListener("focus",realLaunchPopup)))),window.removeEventListener("click",i),lpResizeEvent.detachWindowResizeEvent(),u&&(u.close(),Topics.publish(Topics.INFIELD_NOTIFICATION_CLOSED)),u=null,p=null)}function r(e,t){var n={};return e&&(n.height=e),t&&(n.width=t),n}function l(e){var t=375;!0===bg.get("LPContentScriptFeatures").better_generate_password_enabled&&(t=310);var n={top:0,left:0};if(e){var i={top:0,left:0};e.iframe&&(i=e.iframe.getBoundingClientRect());var o={bottom:parseInt(e.posy),left:parseInt(e.posx),width:e.width};e.fieldEl&&e.fieldEl.getBoundingClientRect?o=e.fieldEl.getBoundingClientRect():e.fieldBox&&(o=e.fieldBox),n.top=window.pageYOffset+i.top+o.bottom,n.left=window.pageXOffset+i.left+o.left+o.width-t,n.left<=0&&(n.left=window.pageXOffset+i.left+o.left-10)}return n}function f(e){u&&u.getInterface().lpInfield.setArrowPosition({position:e})}function s(){u&&u.css({display:"block",position:"absolute",height:"0px"})}function a(e,t){u&&u.css(r(e,t))}function d(e){var t=null;if(p.fieldEl&&!$(p.fieldEl).is(":visible"))o();else if(u){t=l(p),t.infieldOffset=360,!0===bg.get("LPContentScriptFeatures").better_generate_password_enabled&&(t.infieldOffset=295);var n=Math.abs(parseInt(p.posx)-t.left)>10||t.left>t.infieldOffset&&t.left<window.outerWidth;n&&f(t.left<=0?25:t.infieldOffset),u.css(t),e&&"function"==typeof e&&e(t),csTop.Topics.publish(Topics.INFIELD_FRAME_POSITION_CHANGED,t)}}function c(e,t,n){(e==punycode.URLToASCII(document.location.href)||has_same_tld(e,document.location.href))&&populategeneratedpassword(e,t,n)}var u,p,v,w,m="contentScriptPopup.html",E=!1;return{close:o,show:s,openFrame:t,resizeFrame:a,positionFrame:d,fillGeneratedPassword:c}}();
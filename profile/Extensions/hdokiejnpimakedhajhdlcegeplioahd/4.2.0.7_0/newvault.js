function getpartnerurl(e){return""!=g_partnername&&(e+=(e.indexOf("?")>=0?"&":"?")+"partnername="+encodeURIComponent(g_partnername)),e}function fix_group(e){return e==g_xlat_none&&(e=""),e}function onLoad(e,t){try{if("undefined"!=typeof g_is_safari&&"undefined"==typeof LPFromWebsite)return void(e<50?(e++,setTimeout(function(){onLoad(e)},25)):document.location.href=document.location.href);if("undefined"==typeof g_is_safari&&!t)return void get_data("vault",function(){onLoad(e,!0)});if("function"!=typeof getBG||void 0===getBG()||null==getBG())return void setTimeout(function(){onLoad()},50);var n=getBG();g_urlprefix=n.base_url;var r=document.createElement("base");r.href=g_urlprefix,document.head.appendChild(r),document.location.href.lastIndexOf("/")>0&&(gLocalBaseUrl=document.location.href.substr(0,document.location.href.lastIndexOf("/")+1)),n.LPISLOC&&(document.getElementById("accountsettingscontainer").style.display="none"),n.g_hideidentities&&(document.getElementById("identitycontainer").style.display="none"),n.g_hideseccheck&&(document.getElementById("seccheckcontainer").style.display="none"),refresh_legacy_link(document),sr(document,"submit","value","Searchproper"),document.getElementById("q").setAttribute("placeholder",gs("Search Vault")),LP_decimate_children(document.getElementById("lpusername"));var i=document.createElement("b"),o=document.createElement("a");o.setAttribute("href",""),o.id="lpusernamelink",set_innertext(o,gs("Login")),i.appendChild(o),document.getElementById("lpusername").appendChild(i),onResize(),inittabs(),setusernametext(n.g_username),g_view==VIEWS.GRID&&grid_init_vault_search(),$("#gridview").click(function(e){g_view=VIEWS.GRID,populate(gLastSearch),showView()}),$("#listview").click(function(e){g_view=VIEWS.TREE,populate(gLastSearch),showView()}),gTimerId=setInterval(function(){checkLoggedInHome()},gPollInterval);var a=getcolvisibility("usernamecol"),s=getcolvisibility("ltnamecol");document.getElementById("usercol").className=a?"usercolvisible":"usercolhidden",document.getElementById("ltcol").className=s?"ltcolvisible":"ltcolhidden",document.getElementById("ltcol").style.paddingRight=a?"calc(5% + 20px)":"5%",create_combo("grpsel",new Array),document.getElementById("grpsel_combo").style.height="150px",document.getElementById("grpsel_combo").style.overflow="auto",document.getElementById("q").focus(),showhide_ident_actions(n&&convert_object_to_array(n.g_identities).length?I_SHOW:I_HIDE),document.getElementById("addsecurenote").style.display=n.g_hidenotes?"none":"block",document.getElementById("lpimport").style.display=n.g_hideimport?"none":"block",document.getElementById("lpexport").style.display=n.g_hideexport?"none":"block",g_xlat_runame=gs("recently usedlower"),g_xlat_pendingname=gs("(New Pending Share Offers)"),g_xlat_favorites=gs("favorites"),g_xlat_edit=gs("Edit"),g_xlat_delete=gs("Delete"),g_xlat_share=gs("Share"),g_xlat_none=gs("(none)"),g_xlat_chpw=gs("Change Password"),getBG().VaultToggle.supportsVault4_0()||(document.getElementById("vaultToggle").style.display="none")}catch(e){alert("homelocal2 onLoad:"+e)}}function onUnLoad(){gTimerId&&(clearInterval(gTimerId),gTimerId=null),saveGroupState()}function onResize(){for(var e=0;e<tabnames.length;e++)document.getElementById(tabnames[e])&&(document.getElementById(tabnames[e]).style.height=document.body.clientHeight-gTreeHeightOffset+20+"px");document.getElementById("thetree")&&(document.getElementById("thetree").style.height=document.body.clientHeight-gTreeHeightOffset-14+"px"),document.getElementById("thegrid")&&(document.getElementById("thegrid").style.height=document.body.clientHeight-gTreeHeightOffset+20+"px")}function checkLoggedInHome(e){try{var t=getBG(),n=t.lploggedin;if(("undefined"!=typeof g_issafari&&g_issafari||"undefined"!=typeof g_isopera&&g_isopera||"undefined"!=typeof g_ismaxthon&&g_ismaxthon||"undefined"!=typeof g_isfirefoxsdk&&g_isfirefoxsdk)&&!e)return void t.update_state("vault");var r="";if(n&&(r=t.g_username,refresh_ident_actions()),n!=gLastLoginState||r!=gCurr_username)if(g_cachedOpenGroups=null,n)window_load_loggedin(r);else{try{var i=new Object;i.static="{}",g_view==VIEWS.TREE?$(function(){$("#thetree").tree({data:{type:"json",opts:i}})}):($("#thegrid").scrollTop(),$("#thegrid").empty())}catch(e){}finish_vault_search(),g_rootnodeid=null,g_lastnodeid=null,window_load_loggedoff(),update_identity_popup()}if(gLastLoginState=n,gCurr_username=r,g_username=lpusername=r,gLastLoginState){var o=t.g_local_accts_version;(o>gAccts_version||t.IsIconsUpdated(gIconsLength)||t.g_identity!=gIdentity)&&(window_load_loggedin(r),finish_vault_search(),gAccts_version=o,massoperation=!0,populateNewData(gLastSearch),massoperation=!1,saveGroupState(),populateff(gLastSearch),populateident(gLastSearch),update_identity_popup(),setusernametext(r),showads())}}catch(e){alert("checkLoggedInHome:"+e)}}function setusernametext(e){var t=getBG(),n=document.getElementById("lplogoff");if(!t.lploggedin){LP_decimate_children(document.getElementById("lpusername"));var r=document.createElement("b"),i=document.createElement("a");return i.setAttribute("href",""),i.id="lpusernamelink",set_innertext(i,gs("Login")),r.appendChild(i),document.getElementById("lpusername").appendChild(r),void(n&&(n.style.display="none"))}n.style.display="block";var o="";for(var a in t.g_identities)if(t.g_identities.hasOwnProperty(a)&&t.g_identity==t.g_identities[a].iid){o=t.g_identities[a].deciname;break}""==o?set_innertext(document.getElementById("lpusername"),of(e)):set_innertext(document.getElementById("lpusername"),of(e+" ("+o+")"))}function window_load_loggedin(e){var t=getBG();document.getElementById("identity").disabled=0,document.getElementById("enterpriseaction").style.display=!g_hideenterprisetab&&getBG().g_iscompanyadmin?"list-item":"none",document.getElementById("enterprise").style.display=g_hideenterprisetab||"1"==getBG().g_enterpriseuser?"none":"table-cell","1"==t.g_enterpriseuser&&(document.getElementById("lpfriendemail").style.display=document.getElementById("lpgift").style.display="none"),document.getElementById("addsharedfolder").style.display=t.g_folder_sharing_enabled?"list-item":"none",document.getElementById("shares").style.display=t.g_hidesharing||!t.g_folder_sharing_enabled?"none":"table-cell",document.getElementById("credmon").style.display="1"==getBG().g_showcredmon?"table-cell":"none",document.getElementById("linkpersonal").style.display="1"!=getBG().g_enterpriseuser||g_hideenterprisetab||""!=get_personal_linked()?"none":"list-item",document.getElementById("removepersonal").style.display="1"!=getBG().g_enterpriseuser||g_hideenterprisetab||""==get_personal_linked()?"none":"list-item",setusernametext(e),void 0!==getBG().get_securityChallengeScore&&getBG().get_securityChallengeScore(function(e){var t=!1;for(var n in getBG().g_sites)if(getBG().g_sites.hasOwnProperty(n)){t=!0;break}e&&t&&(document.getElementById("securitycheckscore").style.display="block",document.getElementById("securitycheckscore").style.color="#fff",document.getElementById("securitycheckscore").style.backgroundColor=getscorecolor(e),set_innertext(document.getElementById("securitycheckscore"),parseInt(e)+"%"),document.getElementById("securitycheckscore").style.display="inline")}),refresh_legacy_link(document),g_local_key=getBG().g_local_key,g_key_iterations=getBG().get_key_iterations(e)}function showads(){if(getBG().lploggedin&&getBG().g_premium_exp<lp_get_local_timestamp()&&"1"!=getBG().g_enterpriseuser&&-1==document.location.href.indexOf("cmd=video")){"none"==getComputedStyle(document.getElementById("adframe")).display&&(document.getElementById("adframe").style.display="block",document.getElementById("rightside").style.display="block",document.getElementById("adframe").setAttribute("src",getpartnerurl(g_urlprefix+"ads.php?nobr=1&noga=1&rand="+Math.floor(1e3*Math.random()))));document.getElementById("friend").style.display="block"}else document.getElementById("adframe").style.display="none",document.getElementById("rightside").style.display="none",document.getElementById("friend").style.display="none"}function window_load_loggedoff(){document;gAccts_version=-1,gIconsLength=0,g_local_key=null,LP_decimate_children(document.getElementById("lpusername"));var e=document.createElement("b"),t=document.createElement("a");t.setAttribute("href",""),t.id="lpusernamelink",set_innertext(t,gs("Login")),e.appendChild(t),document.getElementById("lpusername").appendChild(e),document.getElementById("q").value="",document.getElementById("credmon").style.display="none",document.getElementById("adframe").style.display="none",document.getElementById("rightside").style.display="none",document.getElementById("friend").style.display="none",document.getElementById("enterpriseaction").style.display="none",document.getElementById("enterprise").style.display=g_hideenterprisetab?"none":"table-cell",document.getElementById("addsharedfolder").style.display="none",document.getElementById("linkpersonal").style.display="none",document.getElementById("removepersonal").style.display="none";for(var n=0;n<tabnames.length;n++)"treepane"!=tabnames[n]&&cleartab(tabnames[n]);setusernametext(getBG().g_username),document.getElementById("securitycheckscore").style.display="none",refresh_legacy_link(document)}function populateNewData(e){var t=!1;for(var n in getBG().g_sites)if(getBG().g_sites.hasOwnProperty(n)){t=!0;break}if(!t)for(var n in getBG().g_securenotes)if(getBG().g_securenotes.hasOwnProperty(n)){t=!0;break}var r=!1;for(var n in getBG().g_pendings)if(getBG().g_pendings.hasOwnProperty(n)){r=!0;break}if(t||r){if(document.getElementById("sitesiframe")){var i=document.getElementById("treepane");i.removeChild(document.getElementById("sitesiframe")),g_view==VIEWS.TREE?document.getElementById("thetree").style.display="block":document.getElementById("thegrid").style.display="block"}showView(),g_view==VIEWS.GRID&&grid_init_vault_search(),g_view!=VIEWS.GRID&&populate(e,!0),SearchTree(0,!0,!0)}else if(!document.getElementById("sitesiframe")){var i=document.getElementById("treepane"),o=document.createElement("iframe");o.id="sitesiframe",o.className="overviewiframe",o.src=getpartnerurl("sites_overview.php?version="+encodeURIComponent(lpversion)),i.appendChild(o),document.getElementById("thetree").style.display="none",document.getElementById("thegrid").style.display="none"}}function showView(){g_view==VIEWS.TREE?($("#thetree").show(),$("#headerli").show(),$("#thegrid").hide()):($("#thetree").hide(),$("#headerli").hide(),$("#thegrid").show())}function isSafariNative(){return"undefined"!=typeof LPFromWebsite&&("undefined"==typeof g_issafari||!g_issafari)}function update_identity_popup(){for(var e=getBG(),t=document.getElementById("identity");t.length;)t.remove(0);var n=document.createElement("option");n.text=gs("All"),n.value="",""==e.g_identity&&(n.selected=1),t.appendChild(n);var r=0;for(var i in e.g_identities)if(e.g_identities.hasOwnProperty(i)){var n=document.createElement("option");n.text=e.g_identities[i].deciname,n.value=e.g_identities[i].iid,e.g_identity==e.g_identities[i].iid&&(n.selected=1),t.appendChild(n),r++}r>0&&!getBG().g_hideidentities?document.getElementById("identitycontainer").style.display="block":document.getElementById("identitycontainer").style.display="none"}function search_matches(e,t){var n=getBG(),r=!n.g_prompts.edit_sn_prompt&&n.get_searchNotesPref(),i=getBG().g_sites[e];if(void 0===i&&void 0===(i=getBG().g_securenotes[e])&&(0==e.indexOf("app")&&(e=e.substring(3)),void 0===(i=getBG().g_applications[e])&&void 0===(i=getBG().g_pendings[e]))){var o=getgroupnamefromid(e);if(o)for(var a in getBG().g_sites)if(getBG().g_sites.hasOwnProperty(a)&&void 0!==getBG().g_sites[a]&&"http://group"==getBG().g_sites[a].url&&getBG().g_sites[a].group==o){i=getBG().g_sites[a];break}if(void 0===i)return!1}return matches(i,t,r)}function init_vault_search(){g_all_li=$("#thetree").find("li"),g_CNTinit_vault++;var e=getBG(),t=!e.g_prompts.edit_sn_prompt&&e.get_searchNotesPref();g_search_array=sites_tokenize(g_all_li,t)}function finish_vault_search(){g_all_li=null,g_search_array=null,lastqstr=null}function sites_tokenize(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r].id,o="id"+i,a="",s=getBG().g_sites[i];if(void 0===s&&void 0===(s=getBG().g_securenotes[i])&&(0==i.indexOf("app")&&(i=i.substring(3)),void 0===(s=getBG().g_applications[i])&&void 0===(s=getBG().g_pendings[i]))){var d=getgroupnamefromid(i);if(d)a=d;else if(void 0===s)continue}if(a){var l;l=a.toLowerCase(),n[o]=l}else if(void 0!==s){var l,g=[];if(g.push(s.name),g.push(s.group),"http://group"!=s.url&&"http://sn"!=s.url&&g.push(s.url),s.unencryptedUsername&&g.push(s.unencryptedUsername),is_application(s)&&(g.push(s.appname),g.push(getusernamefromacct(s))),t&&void 0!==s.extra&&s.extra.length>0&&(void 0===s.url||"http://group"!=s.url)&&!s.pwprotect){var c=getBG().lpmdec_acct(s.extra,!0,s,getBG().g_shares);c&&0!=c.length||console.log("searchinnotes: site aid="+s.aid+" FAILED TO DECRYPT"),g.push(c)}l=g.join(" "),l=l.toLowerCase(),n[o]=l}}return n}function search_string_tokenize(e){var t=[];if(g_CNTsearch_string_tokenize++,!e)return t;if(-1==e.indexOf('"'))t=e.split(/\s+/);else{var n=[];n=e.split('"');for(var r=0;r<n.length;r++)if(r%2)t.push(n[r]);else{var i=[];i=n[r].split(/\s+/);for(var o=0;o<i.length;o++)i[o]=i[o].replace(/^\s+/,""),i[o]=i[o].replace(/\s+$/,""),i[o].length>0&&t.push(i[o])}}return t}function search_it(e,t){g_CNTsearch_it++;var n="id"+e;"string"==typeof t&&(t=[t]);for(var r=1,i=0;i<t.length;i++)if(!g_search_array[n]||-1==g_search_array[n].indexOf(t[i])){r=0;break}return r}function populate(e,n){try{var r=getBG();g_CNTpopulate++;var i=(!r.g_prompts.edit_sn_prompt&&r.get_searchNotesPref(),$("#q").val()),o=0;e!=i&&($("#q").val(e),i=e,o=0),gLastSearch=e,gIconsLength=r.g_icons_length,gIdentity=r.g_identity;var a=[],s=""!=e;g_view==VIEWS.GRID&&s&&(a=search_string_tokenize(e));var d=new Array,l=new Array,g=new Array,c=new Array,u=new Array,p=[r.g_sites,r.g_securenotes];for(var f in p)if(p.hasOwnProperty(f)){var _=p[f];for(var m in _)if(_.hasOwnProperty(m)&&r.check_ident_aid(m)){var h=_[m];if(!(g_view==VIEWS.GRID&&s&&a.length>0)||search_it(m,a)){var v=""!=h.group?h.group:"http://sn"==h.url?gs("Secure Notes"):g_xlat_none;for(v="_"+v;"\\"==v[0];)v=v.substr(1);void 0===d[v]&&(d[v]=new Array,l[l.length]=v,g[v]=void 0===h.aid?null:h.aid),d[v][d[v].length]=h,u[u.length]=h,"1"==h.fav&&(c[c.length]=h)}}}for(var m in r.g_applications)if(r.g_applications.hasOwnProperty(m)&&r.check_ident_appaid(m)){var h=r.g_applications[m];if(!(g_view==VIEWS.GRID&&s&&a.length>0)||search_it(m,a)){var v=""!=h.group?h.group:g_xlat_none;v="_"+v,void 0===d[v]&&(d[v]=new Array,l[l.length]=v,g[v]=void 0===h.aid?null:h.aid),d[v][d[v].length]=h,u[u.length]=h,"1"==h.fav&&(c[c.length]=h)}}var y=0;for(var b in r.g_pendings)if(r.g_pendings.hasOwnProperty(b)){++y;var h=r.g_pendings[b];""==e&&(void 0===d[g_xlat_pendingname]&&(d[g_xlat_pendingname]=new Array,l[l.length]=g_xlat_pendingname,g[g_xlat_pendingname]=null),d[g_xlat_pendingname][d[g_xlat_pendingname].length]=h)}var B=l.length;l.sort(function(e,t){return"_Apps assigned to me"==e?-1:"_Apps assigned to me"==t?1:e.toLowerCase()<t.toLowerCase()?-1:1}),u.sort(function(e,t){return e.last_touch>t.last_touch?1:-1});var w=new Array,I=r.getClearRecentTime(),G=r.getRecentCount();if(""==e)for(var b=0;w.length<G&&b<u.length;b++)"http://group"!=u[u.length-b-1].url&&(u[u.length-b-1].last_touch<I||(w[w.length]=u[u.length-b-1]));w.length&&(l.unshift(g_xlat_runame),d[g_xlat_runame]=w),c.length&&(l.unshift(g_xlat_favorites),d[g_xlat_favorites]=c);var x=[];if(""==e&&(x=getOpenedGroups()),g_view==VIEWS.GRID){$("#thegrid").scrollTop(),$("#thegrid").empty();createTile(l,d,x,e),setupTileEvents()}else{var E=[],S=[];resetgroupnames(),event_handlers={},event_handlers_onmouseover={},event_handlers_onmouseout={},event_handlers_onclick={},styles={};for(var b=0;b<l.length;b++){var k=!1;(""!=e||void 0!==x[l[b]]||1==B&&b==l.length-1)&&(k=!0);var O=void 0===g[l[b]]?null:g[l[b]];void 0!==l[b]&&addGroup(r,d,E,S,l[b],k,!1,x,O)}g_tree&&"undefined"!=typeof g_tree?($.tree.focused().settings.data.opts.static=E,$.tree.focused().refresh()):$(function(){var e=new Object;e.static=E;var t={beforedelete:lpbeforedelete,beforemove:lpbeforemove,onmove:lponmove,check_move:lpcheck_move,onselect:lponselect};populate_done||(t.onrgtclk=lponrgtclk,populate_done=!0),$("#thetree").tree({callback:t,data:{type:"json",opts:e},rules:{multiple:"ctrl",drag_copy:!1,use_max_children:!1,use_max_depth:!1},plugins:{hotkeys:{functions:{return:function(){var e=$.tree.focused().selected;e&&1==e.length&&(isNumber(e[0].id)||is_application(e[0].id))&&ls(e[0].id)}}}}})}),$(".shareimggroup").click(function(){var e=$(this).closest("li").get();if(e.length){var t=e[0],n=getgroupnamefromid(t.id);0==n.indexOf("_")&&(n=n.substring(1)),0==n.indexOf("Shared-")?manageSharedFolder(n):shareFolder(n)}}),$(".toolsimg").click(function(){var e=$(this).closest("li").get();if(e.length){var n=e[0],r=getgroupnamefromid(n.id);0==r.indexOf("_")&&(r=r.substring(1)),openGroupMenu(n,r,t,event)}}),$(".folder").mouseover(function(){sv(null,this)}),$(".folder").mouseout(function(){hv(null,this)})}}catch(e){if("undefined"==typeof LPFromWebsite||"function"!=typeof LPFromWebsite.ipad){if(e.message.indexOf("atob")>=0&&-1==document.location.href.indexOf("retry"))return void(document.location.href=document.location.href+"?retry=1");alert("populate_error:"+e)}}update_identity_popup(),g_view!=VIEWS.GRID&&init_vault_search(),e&&""!=e&&SearchTree(o,n);for(var b in event_handlers)document.getElementById(b)&&(document.getElementById(b).onclick=event_handlers[b]);for(var b in event_handlers_onmouseover)for(var C=document.getElementsByName(b),L=0;L<C.length;L++)C[L].onmouseover=event_handlers_onmouseover[b];for(var b in event_handlers_onmouseout)for(var C=document.getElementsByName(b),L=0;L<C.length;L++)C[L].onmouseout=event_handlers_onmouseout[b];for(var b in event_handlers_onclick)for(var C=document.getElementsByName(b),L=0;L<C.length;L++)C[L].onclick=event_handlers_onclick[b];for(var b in styles){var P=document.getElementById(b);if(P)for(var L in styles[b])P.style[L]=styles[b][L]}}function getSubfolders(e,t,n){var r="_"+gs("(none)"),i=""==e?e:e+"\\";for(var o in t)if(0==o.indexOf(i)&&-1==o.substring(i.length).indexOf("\\")){if(""==e&&o==r)continue;var a=o.substring(i.length);-1!=a.indexOf("\\")&&(a=a.substring(0,a.indexOf("\\")));var s=a;0==s.indexOf("_")&&(s=s.substring(1)),-1==jQuery.inArray(s,n)&&n.push(s)}return n}function lpbeforedelete(e,t){var n=getBG();if(($.tree.focused().selected_arr&&$.tree.focused().selected_arr.length)>1){for(var r="",i=new Array,o=0;o<$.tree.focused().selected_arr.length;o++){var a=getmoveid($.tree.focused().selected_arr[o]);a&&""!=a&&(r+=(""!=r?",":"")+a,i[i.length]=$.tree.focused().selected_arr[o])}return n.deleteAid(r,window,!1,!1,function(){for(var e=0;e<i.length;e++)$.tree.focused().cut(i[e])}),!1}var s=!(!is_application(e.id)&&!isNumber(e.id)),d=!1;if(s)d=n.deleteAid(e.id,window,!1,!1,function(){$.tree.focused().cut(e)});else{var l=getgroupnamefromid(e.id);d=n.deleteGroup(fix_group(l),window,function(){$.tree.focused().cut(e)})}return d}function lpbeforemove(e,t,n,r){getBG().lpevent("v_dnd");for(var i="",o=t,a=0;o&&""==o.attr("id")&&a<100;)o=o.parent(),a++;if(a>99||!o)return!1;var s=o.attr("id");s.match(/launch_(nor|fav|rec)_\d+/)&&(s=s.substr(11)),s.match(/accept2_(nor|fav|rec)_\d+/)&&(s=s.substr(12));var i="",d=getBG();if(is_application(s)||isNumber(s)){var l,g;is_application(s)?(l=[d.g_applications],g=get_appaid(s)):(l=[d.g_sites,d.g_securenotes],g=s);for(var c in l)if(l.hasOwnProperty(c)){var u=l[c];for(var p in u)if(u.hasOwnProperty(p)){var f=u[p];if(f.aid==g){if("1"==f.fav){var _=o.parent();for(a=0;_&&""==_.attr("id")&&a<100;)_=_.parent(),a++;if(a<99&&_&&_.attr("id")==g_xlat_favorites){i=g_xlat_favorites;break}}i=f.group;break}}}}else i=getgroupnamefromid(s);if(""!=i&&i!=g_xlat_runame&&i!=g_xlat_pendingname){for(var m=$.tree.focused().selected_arr,h="",v=0;v<m.length;v++)(is_application(getmoveid(m[v]))||isNumber(getmoveid(m[v])))&&(h+=(""==h?"":",")+getmoveid(m[v]));return 0==h.length&&(h=e.attr("id")),0!=h.length&&getBG().moveSelectedToGroup(i,h),!1}}function lponmove(e,t,n,r,i){}function lpcheck_move(e,t,n,r){return $.tree.focused().selected_arr.length>1||!(e&&""!=e.attr("id")&&!is_application(e.attr("id"))&&!isNumber(e.attr("id")))}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function getgroupnamefromid(e,t){var n=g_view==VIEWS.GRID?g_idgroupmap:g_groups;if(void 0===n[e])return e;var r=n[e];return t||0!=r.indexOf("_")||(r=r.substring(1)),r}function getrawgroupid(e){return void 0===g_groupid[e]||null==g_groupid[e]?null:g_groupid[e]}function resetgroupnames(){g_groups={},g_groupindex=2e5,g_groupid={},g_groupnames={}}function getgroupid(e,t){var n="LpGrOuP"+g_groupindex;return g_groups[n]=e,g_groupnames[e]=n,g_groupid[n]=t,"LpGrOuP"+(++g_groupindex-1)}function getgroupidfromname(e){return void 0===g_groupnames[e]||null==g_groupnames[e]?null:g_groupnames[e]}function get_div_id(){for(;;){var e="div"+Math.floor(1e9*Math.random()+1);if(void 0===div_ids[e])return div_ids[e]=!0,e}}function addGroup(t,n,r,i,o,a,l,g,c){var u="",p=o.indexOf("Shared-");for(o===g_xlat_favorites?u=" favorite":o===g_xlat_runame?u=" recent":0!==p&&1!==p||(u=" shared");"\\"==o[0];)o=o.substr(1);for(var f=o.match(/^([^\\]*)\\(.*)$/),_=null!=f,m="",h=0;f&&!l;){var v=f[1],y=f[2];if(m+=(""!=m?"\\":"")+v,void 0===i[m]){addGroup(t,n,r,i,m,a||void 0!==g[m],!0,g,c)}h++,f=y.match(/^([^\\]*)\\(.*)$/)}m=(""==m?"":"\\")+o;var b=[],B=a?"open":"closed",w=n[o];void 0===w&&(w=new Array);var I="nor_";o!=g_xlat_runame&&o!=g_xlat_pendingname?(w.sort(t.lp_sort_case_insensitive_name),o==g_xlat_favorites&&(I="fav_")):(w.sort(function(e,t){return e.last_touch>t.last_touch?-1:1}),o==g_xlat_runame&&(I="rec_"));for(var G=getcolvisibility("usernamecol"),x=getcolvisibility("ltnamecol"),E=navigator.userAgent.match("Gecko/"),S=1==g_showrows?"":"none",k=0;k<w.length;k++){var O=62+15*h;(E||"undefined"!=typeof g_isopera&&g_isopera)&&(O+=20);var C=w[k];if("http://group"!=C.url){var $="",L="",P="<span class='clearboth'></span>";if(void 0!==C.sharerusername){"undefined"!=typeof g_isopera&&g_isopera&&($+="</a>");var T=get_div_id();$+="<div class='actionmenu' id='"+T+"'><a href='#' id='accept_"+I+C.id+"' class='vaultlink'><img src='"+gLocalBaseUrl+"images/vaultaccept.png'/></a> | <a href='#' id='reject_"+I+C.id+"' class='vaultlink'><img src='"+gLocalBaseUrl+"images/vaultreject.png'/></a></div>",styles[T]={paddingRight:O+"px",display:S},event_handlers["accept_"+I+C.id]=function(){return accept(this.id.substring(11))},event_handlers["reject_"+I+C.id]=function(){return reject(this.id.substring(11))},$+=P,$+="<span><a href='#' id='accept2_"+I+C.id+"'>"+gs("Share offer from")+" "+of(t.hex2bin(C.sharerusername))+"</a></span>",event_handlers["accept2_"+I+C.id]=function(){return accept(this.id.substring(12))}}else{var A=safclassdel=safclassshare="";(g_issafari||g_isopera)&&(A=" editsaf",safclassdel=" delsaf",safclassshare=" sharesaf"),L=get_record_id(C);var N,M="<a href='#' id='share_"+I+L+"' class='vaultlink' title='"+g_xlat_share+"'><span class='shareimg"+safclassshare+"'></span></a> ";event_handlers["share_"+I+L]=function(){return s(this.id.substring(10))},t.LPISLOC||C.genpw||void 0!==C.sharedfromaid&&null!=C.sharedfromaid&&""!=C.sharedfromaid&&"0"!=C.sharedfromaid&&"null"!=C.sharedfromaid||void 0!==C.sharefolderid||is_application(C)||0!=t.g_hidesharing||!t.g_sharing_enabled?(N='<font class="hiddenfont">'+M+"</font>",M=""):N="";var F="",R=void 0!==C.sharedfromaid&&"0"!=C.sharedfromaid?C.sharedfromaid:"";void 0!==C.hasbeenshared&&1==C.hasbeenshared?(F="<p class='sharesubtext'><subtext id='sharesub_"+I+L+"'>"+gs("shared")+"</subtext></p>",event_handlers["sharesub_"+I+L]=function(){return s(this.id.substring(13))}):C.individualshare&&(""==R?(F="<p class='sharesubtext'><subtext id='sharesub_"+I+L+"'>"+gs("shared")+"</subtext></p>",event_handlers["sharesub_"+I+L]=function(){return s(this.id.substring(13))}):F="<p class='sharesubtext'>"+gs("shared with you")+"</p>");"undefined"!=typeof g_isopera&&g_isopera&&($+="</a>");var T=get_div_id();$+="<div class='actionmenu' id='"+T+"'>"+N,styles[T]={paddingRight:O+"px",display:S},$+="<a href='#' id='chpw_"+I+L+"' class='vaultlink colhidden' title='"+g_xlat_chpw+"'><span class='chpwimg'></span></a> ",g_cpwbot&&C.pwch&&(event_handlers["chpw_"+I+L]=function(){e(this.id.substring(9),!0)}),$+="<a href='#' id='edit_"+I+L+"' class='vaultlink' title='"+g_xlat_edit+"'><span class='editimg"+A+"'></span></a> ",event_handlers["edit_"+I+L]=function(){return e(this.id.substring(9))},$+=M,$+="<a href='#' id='delete_"+I+L+"' class='vaultlink' title='"+g_xlat_delete+"'><span class='delimg"+safclassdel+"'></span></a></div>",event_handlers["delete_"+I+L]=function(){return d(this.id.substring(11))},$+=P,$+="<span><a href='#' id='launch_"+I+L+"'>"+of(C.name)+"</a>"+F+"</span>",event_handlers["launch_"+I+L]=function(){return ls(this.id.substring(11))}}O="calc(5% + 10px)";var D=G?"usercolvisible":"usercolhidden",W=x?"ltcolvisible":"ltcolhidden",U=of(t.getusernamefromacct(C));""==U&&(U="&nbsp;");var T=get_div_id();$+="<div id='"+T+"' class='"+D+"' name='usercol'>"+U+"</div>",styles[T]={cssFloat:"right",paddingRight:O,display:S};var T=get_div_id();$+="<div id='"+T+"' class='"+W+"' name='ltcol'>"+(void 0!==C.last_touch?of(elapsedTime(C.last_touch)):"")+"</div>",styles[T]={cssFloat:"right",paddingRight:O,display:S},b[b.length]={data:{title:$,icon:t.geticonurlfromrecord(C)},attributes:{id:L,name:L}},event_handlers_onmouseover[L]=function(e){return sv(e,this),!1},event_handlers_onmouseout[L]=function(e){return hv(e,this),!1},event_handlers_onclick[L]=function(e){return lc(e,this),!1}}}var V=o;0==V.indexOf("_")&&(V=V.substring(1));var H=30+15*h,j=o===g_xlat_favorites||o==g_xlat_runame||o==g_xlat_pendingname,T=get_div_id(),$=j?"":"<div class='actionmenu' id='"+T+"'>"+("1"==t.g_enterpriseuser&&!is_personal_linked(V)&&t.g_folder_sharing_enabled?"<a href='#' title='"+g_xlat_share+"'><span class='shareimggroup'></span></a> ":"")+"<a href='#' title='"+gs("Group Actions")+"'><span class='toolsimg'></span></a></div>";if(styles[T]={paddingRight:H+"px"},is_personal_linked(V)&&!_?($+="<span class='boldspan' isgroup='1' >"+of(V)+" - "+of("Linked Personal Account")+"</span>",u=" linked"):$+="<span class='boldspan' isgroup='1' >"+of(V)+"</span>",i[o]=r.length,_){for(var f=o.match(/^([^\\]*)\\(.*)$/),q=null,z=0,K=0;f;){var v=f[1],y=f[2];if(0==z){for(var J=r.length-1;J>=0;J--)if(r[J].group==v){q=r[J].children;break}if(K=0,z=1,!y.match(/^([^\\]*)\\(.*)$/))for(var J=0;J<q.length;J++)if(void 0===q[J].group||q[J].group==v){K=J;break}}else{for(var Y=0,J=0;J<q.length;J++){if(void 0===q[J].group){Y=J-1;break}if(q[J].group==v){Y=J;break}}q=q[Y].children}if(!(f=y.match(/^([^\\]*)\\(.*)$/)))for(var J=0;J<q.length;J++){if(void 0===q[J].group||q[J].group==v){K=J;break}if(J==q.length-1){K=J+1;break}}}var L=getgroupid(o,c),H=30+15*h,T=get_div_id(),$="<div class='actionmenu' id='"+T+"'>"+("1"==t.g_enterpriseuser&&!is_personal_linked(V)&&t.g_folder_sharing_enabled?"<a href='#' title='"+g_xlat_share+"'><span class='shareimggroup'></span></a> ":"")+"<a href='#' title='"+gs("Group Actions")+"'><span class='toolsimg'></span></a></div>";styles[T]={paddingRight:H+"px"},$+="<span class='boldspan' isgroup='1'>"+of(y)+"</span>",q.splice(K,0,{data:$,children:b,state:B,group:y,attributes:{class:"folder",id:L}})}else{0==r.length&&(g_rootnodeid=o),g_lastnodeid=o;var L=getgroupid(m,c);r[r.length]={data:$,children:b,state:B,group:o,attributes:{class:"folder"+u,id:L}}}}function getcolvisibility(e){return 0!=localStorage_getItem(e)}function setcolvisibility(e,t){localStorage_setItem(e,t)}function matches(e,t,n){var r=t.toLowerCase();if(-1!=e.name.toLowerCase().indexOf(r)||e.url&&-1!=e.url.toLowerCase().indexOf(r)||-1!=e.group.toLowerCase().indexOf(r)||e.unencryptedUsername&&-1!=e.unencryptedUsername.toLowerCase().indexOf(r))return!0;if(is_application(e)&&(e.appname&&-1!=e.appname.toLowerCase().indexOf(r)||-1!=getusernamefromacct(e).toLowerCase().indexOf(r)))return!0;if(n&&void 0!==e.extra&&e.extra.length>0&&(void 0===e.url||"http://group"!=e.url)){if(-1!=getBG().lpmdec_acct(e.extra,!0,e,getBG().g_shares).toLowerCase().indexOf(r))return!0}return"has:attachment"==t&&void 0!==e.attachid&&null!=e.attachid&&0!=e.attachid}function getOpenedGroups(){var e=getBG(),t=new Array,n="";if("undefined"==typeof LPFromWebsite){if("undefined"==typeof localStorage)return t;if(g_cachedOpenGroups&&g_cachedOpenGroups.length)n=g_cachedOpenGroups;else{var r=localStorage_getItem(e.db_prepend(e.g_username_hash+".savedtree"));n=e.dec(r),g_cachedOpenGroups=n}}else n=LPFromWebsite.readopengroups();if(!n||""==n)return t;for(var i=n.split(","),o=0;o<i.length;o++)t[i[o].replace("%2C",",")]=1;return t}function saveGroupState(){var e=getBG();if(!massoperation&&e.lploggedin){var t="";if(g_view==VIEWS.GRID)$(".cont:visible").each(function(e,n){var r=getgroupnamefromid(n.id.substr(2),!0);r.replace(",","%2C"),t+=r+","});else{var n=$("#thetree").find(".open");$.each(n,function(e,n){var r=getgroupnamefromid(n.id,!0);r.replace(",","%2C"),t+=r+","})}if("undefined"==typeof LPFromWebsite){if("undefined"==typeof localStorage)return;if(g_cachedOpenGroups!=t){g_cachedOpenGroups=t;var r=e.enc(t);localStorage_setItem(e.db_prepend(e.g_username_hash+".savedtree"),r)}}else LPFromWebsite.saveopengroups(t)}}function lc(e,t){$.tree.focused().select_branch(t,e.ctrlKey|e.metaKey,e.shiftKey)}function sv(e,t){if($(t).children(".actionmenu").find("span").each(function(e){$(this).css("opacity","1.0")}),1!=g_showrows)for(var n=0;n<t.children.length;n++)"DIV"==t.children[n].nodeName&&(t.children[n].style.display="inline-block")}function hv(e,t){if($(t).children(".actionmenu").find("span").each(function(e){$(this).css("opacity","0.2")}),1!=g_showrows)for(var n=0;n<t.children.length;n++)"DIV"==t.children[n].nodeName&&(t.children[n].style.display="none")}function lponopen(e,t){saveGroupState()}function lponclose(e,t){saveGroupState()}function lponselect(){document.getElementById("q").blur()}function lponrgtclk(e,t,n){var r=$.tree.focused().selected_arr&&$.tree.focused().selected_arr.length;1==r&&e!==t.selected&&t.select_branch(e),getBG().lpevent("v_rgt");var i=(new Date).getTime();if(!(g_lastpop>i-500)){if(g_lastpop=i,r>1){for(var o="",a=new Array,d=!1,l=!1,g=0;g<$.tree.focused().selected_arr.length;g++){var c=getmoveid($.tree.focused().selected_arr[g]);c&&""!=c&&(is_application(c)&&(d=!0),get_record(c)&&void 0!==get_record(c).sharefolderid&&(l=!0),o+=(""!=o?",":"")+c,a[a.length]=$.tree.focused().selected_arr[g])}setTimeout(function(){$.contextMenu.create(function(){var t=getBG(),n={};return n[gs("Move Selected to Group")]=function(){t.lpevent("v_multmov"),openMoveGroup(e)},d||l||(n[gs("Share Selected")]=function(){t.lpevent("v_mults"),s(o)}),n[gs("Delete Selected")]=function(){t.lpevent("v_multd"),t.deleteAid(o,window,!1,!1,function(){for(var e=0;e<a.length;e++)$.tree.focused().cut(a[e])})},[n]},{theme:"vista"}).show(t,n)},100)}else if(void 0===e);else if(""==e.id||is_application(e.id)||isNumber(e.id))""!=e.id&&(is_application(e.id)||isNumber(e.id))&&setTimeout(function(){$.contextMenu.create(function(){var t=getBG(),n={};if(void 0!==getBG().g_sites[e.id]||is_application(e.id))("undefined"==typeof g_issafari&&"undefined"==typeof g_isopera&&"undefined"==typeof g_ismaxthon&&"undefined"==typeof g_isfirefoxsdk||"function"==typeof t.can_copy_to_clipboard&&t.can_copy_to_clipboard()||"undefined"!=typeof g_is_safari)&&(n[gs("Copy Username")]=function(){t.copyusername(e.id)},n[gs("Copy Password")]=function(){t.copypassword(e.id)},n[gs("Copy URL")]=function(){t.copyurl(e.id)});else if(void 0!==getBG().g_securenotes[e.id]){var r=getBG().g_securenotes[e.id],i=void 0!==r.notetype?r.notetype:"";void 0!==sntemplates[i]&&void 0!==sntemplates[i].Username&&(n[gs("Copy Username")]=function(){t.copyusername(e.id)});var o=getBG().lpmdec_acct(r.extra,!0,r,getBG().g_shares),a=!1;a|=o.indexOf("Wi-Fi Password")>-1,a|=o.indexOf("Email Account")>-1,a|=o.indexOf("Server")>-1,a=a&&o.indexOf("Password")>-1,(void 0!==sntemplates[i]&&void 0!==sntemplates[i].Password||a)&&(n[gs("Copy Password")]=function(){t.copypassword(e.id)})}n[gs("Move to Group")]=function(){t.lpevent("v_mov"),openMoveGroup(e)},n[gs("Move to Sub-Group")]=function(){t.lpevent("v_msub"),openMoveGroup(e,!0)};var d=get_record(e.id);return is_application(e.id)||!d||void 0!==d.sharefolderid||void 0!==d.sharedfromaid&&null!=d.sharedfromaid&&""!=d.sharedfromaid&&"0"!=d.sharedfromaid&&"null"!=d.sharedfromaid||!t.g_sharing_enabled||(n[gs("Share")]=function(){s(e.id)}),n[gs("Delete")]=function(){t.lpevent("v_rgtd"),t.deleteAid(e.id,window,!1,!1,function(){$.tree.focused().cut(e)})},n[gs("Edit")]=function(){t.lpevent("v_rgte"),t.editAid(e.id,window)},void 0!==getBG().g_sites[e.id]&&(n[gs("Go to URL")]=function(){t.lpevent("v_g2"),t.gotourl(e.id,null)}),[n]},{theme:"vista"}).show(t,n)},100);else{var u=getgroupnamefromid(e.id);0==u.indexOf("_")&&(u=u.substring(1));for(var p=!1,f=e;f.parentNode&&f.parentNode!=f;)if(f=f.parentNode,"thetree"==f.id){p=!0;break}if(!p)return;openGroupMenu(e,u,t,n),n.preventDefault()}n.preventDefault()}}function SearchTree(e,t,n){g_CNTsearch_tree++;var r=!1;document.location.href.indexOf("cmd=viewcreditmon")>0&&1!=g_autoselectcredmontab?(ontabchange(document.getElementById("credmon")),g_autoselectcredmontab=1):"sites"!=g_activetab.id&&(r=!0);var i=$("#q").val(),o=!1;(e||i!=lastqstr)&&(r&&!t&&(ontabchange(document.getElementById("sites")),o=!0),lastqstr=i,gLastSearch=i,g_view==VIEWS.GRID?populate(i,!0):(massoperation=!0,""==i?n||clearTree():$.tree.focused().search(i),massoperation=!1)),r&&!o&&setTimeout(function(){ontabchange(g_activetab)},0),document.getElementById("searchx").src=""==i?gLocalBaseUrl+"images/search.png":gLocalBaseUrl+"images/cancel.png"}function ls(e){var t=getBG();return t.lpevent("v_ls"),t.launch(e),!1}function cu(e){var t=getBG();return t.lpevent("v_cu"),t.copyusername(e),!1}function cp(e){var t=getBG();return t.lpevent("v_cp"),t.copypassword(e),!1}function curl(e){var t=getBG();return t.lpevent("v_curl"),t.copyurl(e),!1}function e(e,t){var n=getBG();return n.lpevent("v_e"),n.editAid(e,window,null,t),!1}function d(e){var t=getBG();return t.lpevent("v_d"),t.deleteAid(e,window),!1}function is_protected(e){"string"==typeof e&&(e=e.split(","));for(var t=0;t<e.length;t++){var n=get_record(e[t]);if(n&&1==n.pwprotect)return!0}return!1}function s(e){return getBG().lpevent("v_s"),callServerFunction("share",e),!1}function MoveFocus(e){if(40==e.keyCode||34==e.keyCode||38==e.keyCode||33==e.keyCode){var t=getgroupidfromname(38==e.keyCode||33==e.keyCode?g_lastnodeid:g_rootnodeid);$.tree.focused().select_branch("#"+t),document.getElementById("q").blur()}}function clearTree(){g_CNTclear_tree++,populate(""),document.getElementById("searchx").src=gLocalBaseUrl+"images/search.png",document.getElementById("q").value=""}function expandall(){if(!getBG().lploggedin)return!1;massoperation=!0,g_view==VIEWS.GRID?($(".cont").each(function(e,t){$(t).show()}),$(".grpclose").removeClass("grpclose").addClass("grpopen")):$.tree.focused().open_all(),massoperation=!1,saveGroupState()}function collapseall(){if(!getBG().lploggedin)return!1;massoperation=!0,g_view==VIEWS.GRID?($(".cont").each(function(e,t){$(t).hide()}),$(".grpopen").removeClass("grpopen").addClass("grpclose")):$.tree.focused().close_all(),massoperation=!1,saveGroupState()}function creategroup(){var e=getBG();e.lploggedin&&(e.lpevent("v_cg"),openCreateGroup(null))}function showformfill(e,t){var n=getBG();return n.lploggedin?(setTimeout(function(){$.contextMenu.create(function(){var e=getBG(),t={};for(var n in e.g_formfills)if(e.g_formfills.hasOwnProperty(n)){var r=e.g_formfills[n].ffid;e.check_ident_ffid(r)&&(t[of(e.g_formfills[n].decprofilename)]=function(e){editff(get_innerText(e))})}var i={};return i[gs("Add Profile")]=function(){getBG().addprofile()},i[gs("Add Credit Card")]=function(){getBG().addcreditcard()},[t,"context-menu-separator",i]},{theme:"vista"}).show(e,t)},0),!1):(n.open_login(1),!1)}function editff(e){var t=getBG();e=$.trim(e);for(var n in t.g_formfills)if(t.g_formfills.hasOwnProperty(n)&&e==$.trim(t.g_formfills[n].decprofilename)){t.editprofile(t.g_formfills[n].ffid);break}}function showmoremenu(e,t){var n=getBG();return n.lploggedin?(setTimeout(function(){$.contextMenu.create(function(){var e={};return gHidePreferences||(e[gs("Preferences")]=function(){getBG().openprefs()}),getBG().LPISLOC||(e[gs("History")]=function(){getBG().unlock_plug2web(),getBG().openbaseurl("?ac=1&openhistory=1")},e[gs("Show Deleted Sites")]=function(){getBG().unlock_plug2web(),getBG().openbaseurl("?ac=1&showdeleted=1")}),getBG().LPISLOC&&getBG().LPISUPEK||(e[gs("Change Password")]=function(){getBG().unlock_plug2web(),getBG().changemasterpassword()}),e[gs("Forums")]=function(){getBG().openURL("http://forums.lastpass.com")},e[gs("Blog")]=function(){getBG().openURL("http://blog.lastpass.com")},getBG().g_isadmin&&(e[gs("Admin Tools")]=function(){getBG().openURL("https://rodan-internal.lastpass.com/admintools/")}),[e]},{theme:"vista"}).show(e,t)},0),!1):(n.open_login(1),!1)}function addsecurenote(){return getBG().lpevent("v_addn"),getBG().openaddsecurenote(),!1}function logoff(){return!!getBG().lploggedin&&(finish_vault_search(),getBG().lpevent("v_off"),saveGroupState(),getBG().loggedOut(!1,"homelocal2"),!1)}function accept(e){getBG().lpevent("v_apt"),callServerFunction("acceptshare",e)}function reject(e){getBG().lpevent("v_rjt"),callServerFunction("rejectshare",e)}function login(){return getBG().lpevent("v_lgn"),getBG().open_login(!0),!1}function changeidentity(e,t){void 0!==t&&1!=t||closepopup();getBG().g_identity;getBG().lpevent("v_cid"),getBG().switch_identity(e),document.getElementById("identity").value=getBG().g_identity,setusernametext(getBG().g_username),closepopup()}function openMoveGroup(e,t,n){if(!addedjqueryui)return addJqueryUI(),void setTimeout(function(){openMoveGroup(e,t,n)},250);void 0!==(gMoveSelected=$.tree.focused().selected_arr)&&0!=gMoveSelected.length||(gMoveSelected=new Array(e));var r=getBG(),o=new Array,a=new Array,s=[r.g_sites,r.g_securenotes,r.g_applications],d="";for(var l in s)if(s.hasOwnProperty(l)){var g=s[l];for(var c in g)if(g.hasOwnProperty(c)){var u=g[c];if(gMoveSelected&&1==gMoveSelected.length&&getmoveid(gMoveSelected[0])==get_record_id(u)&&(d=u.group,t)){""!=u.group&&(o[o.length]=u.group);break}var p=""!=u.group?u.group:gs("(none)");void 0!==p&&void 0===a[p]&&(a[p]="1",o[o.length]=p)}}o.sort(function(e,t){return"_Apps assigned to me"==e?-1:"_Apps assigned to me"==t?1:e.toLowerCase()<t.toLowerCase()?-1:1});var f=!1;""!=d||1!=gMoveSelected.length||isNumber(getmoveid(gMoveSelected[0]))||(d=getmoveid(gMoveSelected[0]),f=!0);var _=-1!=d.indexOf("\\")&&d.substring(d.indexOf("\\")+1).length>0;if(f&&0===d.indexOf("Shared-")&&!_){var m=void 0;if(n){for(i in r.g_sites)if(r.g_sites[i].group==d){m=r.g_sites[i].aid;break}callServerFunction("renamesharedfolder",m)}}else document.getElementById("grpsel").value="",repopulate_combo("grpsel",o),document.getElementById("dialog").title=gs("Change Group Name"),set_innertext(document.getElementById("dialogtext"),gs("Select or enter a new group name")),document.getElementById("dialoggrpinp").style.display="none",document.getElementById("dialoggrpsel").style.display="block",document.getElementById("dosubgroup").value=void 0!==t&&t?"1":"0",1==gMoveSelected.length&&(t?(document.getElementById("dialogtext").appendChild(document.createElement("br")),document.getElementById("dialogtext").appendChild(document.createElement("br")),document.getElementById("dialogtext").appendChild(document.createTextNode(gs("Group will be created or currently exists under")+": ")),document.getElementById("dialogtext").appendChild(document.createElement("br")),document.getElementById("dialogtext").appendChild(document.createTextNode(d))):document.getElementById("grpsel").value=d),$("#dialog").dialog("destroy"),$("#dialog").dialog({autoOpen:!1,bgiframe:!0,modal:!0,width:300,minWidth:300,minHeight:250,dragStop:function(e,t){var n=document.getElementById("grpsel_combo");n&&"block"==n.style.display&&realShowCombo()},close:function(e,t){var n=document.getElementById("grpsel_combo");n&&"block"==n.style.display&&close_combo("grpsel")},buttons:{Change:function(){var e=1==gMoveSelected.length?getmoveid(gMoveSelected[0]):"";if(1!=gMoveSelected.length||""==e||is_application(e)||isNumber(e)){for(var t="",n=0;n<gMoveSelected.length;n++){var e=getmoveid(gMoveSelected[n]);(is_application(e)||isNumber(e))&&(t+=(""==t?"":",")+e)}if(0==t.length)return;var r=document.getElementById("grpsel").value;1==gMoveSelected.length&&"1"==document.getElementById("dosubgroup").value&&r!=d&&0!=r.indexOf(d+"\\")&&(r=d+"\\"+r),getBG().moveSelectedToGroup(r,t)}else{var i=fix_group(document.getElementById("grpsel").value),o=fix_group(e);0==i.indexOf("Shared-")?-1!=i.indexOf("\\")&&0==o.indexOf(i.substr(0,i.indexOf("\\")))?getBG().renameGroup(fix_group(e),i):shareFolder(i.replace("Shared-","")):getBG().renameGroup(o,i)}populate(gLastSearch),$(this).dialog("close")},Close:function(){$(this).dialog("close")}}}),$("#dialog").dialog("open"),$("#grpsel").click()}function openCreateGroup(e){addedjqueryui||(addJqueryUI(),setTimeout(function(){openCreateGroup(e)},250)),selected_global=e,getBG().lpevent("v_cg"),document.getElementById("dialog").title=gs("Group Name"),set_innertext(document.getElementById("dialogtext"),gs("Group Name")),document.getElementById("dialoggrpinp").style.display="block",document.getElementById("grpinp").value="",document.getElementById("dialoggrpsel").style.display="none","function"==typeof $("#dialog").dialog&&($("#dialog").dialog("destroy"),$("#dialog").dialog({autoOpen:!1,bgiframe:!0,modal:!0,width:300,minWidth:300,minHeight:250,buttons:{OK:function(){var e=document.getElementById("grpinp").value;for(null!=selected_global&&(e=fix_group(getmoveid(selected_global))+"\\"+e);"\\"==e[0];)e=e.substr(1);if(e==gs("favorites")||e==g_xlat_runame||e==g_xlat_pendingname)return void alert(gs("That group already exists."));if(null==selected_global&&0==e.indexOf("Shared-"))return void alert(gs("Sorry - group names starting with 'Shared-' are created by LastPass to indicate groups shared with other people. Please use a different name."));var t=getBG(),n=[t.g_sites,t.g_securenotes,t.g_applications];for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];if(a.group==e)return void alert(gs("That group already exists."))}}t.addEmptyGroup(e),populate(gLastSearch),$(this).dialog("close")},Close:function(){$(this).dialog("close")}}}),"function"==typeof $("#dialog").dialog&&$("#dialog").dialog("open")),$("#grpinp").click()}function getmoveid(e){var t="";return t=void 0!==e.id?getgroupnamefromid(e.id,!0):getgroupnamefromid(e.attr("id"),!0),0==t.indexOf("_")&&(t=t.substring(1)),t}function getacct(e){return get_record(e)}function getDragHTMLForNode(e){for(var t=e,n=0;t&&""==t.attr("id")&&n<100;)t=t.parent(),n++;var r=getBG(),i=t.attr("id"),o=getacct(i);return o?"<div><img src='"+r.geticonurlfromrecord(o)+"' />&nbsp;<span>"+of(o.name)+"</span></div>":""}function getDragHTML(e){var t="<div id='jstree-dragged' class='tree default'>";if(null==e)for(var n=$.tree.focused().selected_arr,r=0;r<n.length;r++)t+=getDragHTMLForNode(n[r]);else t+=getDragHTMLForNode(e);return t+="</div>"}function toggleUserCol(){var e=getcolvisibility("usernamecol"),t=getcolvisibility("ltnamecol"),n="usercol",r="usernamecol",i="usercolhidden",o="usercolvisible",a=e;togglestate%2==1?(n="ltcol",r="ltnamecol",i="ltcolhidden",o="ltcolvisible",a=t):document.getElementById("ltcol").style.paddingRight=e?"calc(5% + 20px)":"5%",togglestate++;for(var s=document.getElementsByName(n),d=0;d<s.length;d++)s[d].className=a?i:o,0==d&&setcolvisibility(r,a?"0":"1")}function openinparent(e,t){0!=e.indexOf("http")&&(e=g_urlprefix+e),e+="?";for(var n in t)t.hasOwnProperty(n)&&(e+="&"+en(n)+"="+en(t[n]));window.open(e)}function showpopup(){if(!getBG().lploggedin)return void login();document.getElementById("lppopup").style.display="block"}function closepopup(e){"block"==document.getElementById("lppopup").style.display&&(e&&e.target&&("person"==e.target.id||"identity"==e.target.id||"lpusername"==e.target.id)||(document.getElementById("lppopup").style.display="none")),$("#tilepopup").hide()}function togglerows(){}function callServerFunction(e,t,n,r){var i=getBG();if(i.lploggedin){i.unlock_plug2web();var o=document,a=!1;if("share"==e||"acceptshare"==e||"rejectshare"==e){if(!(a=i.g_prompts.edit_site_prompt||i.g_prompts.edit_sn_prompt)&&"share"==e)for(var s=t.split(","),d=0;d<s.length;d++){var l=get_record(s[d]);if(l&&l.pwprotect){a=!0;break}}}else if("identity"==e||"deleteidentity"==e){if(!(a=i.g_prompts.switch_identity_prompt)&&""!=t)for(var g=convert_object_to_array(i.g_identities),d=0;d<g.length;++d)if(g[d].iid==t&&g[d].pw_prompt){a=!0;break}}else"opencreditmondash"!=e&&"opencreditmondashnoalert"!=e||(a=!1);if(a&&!r)return void i.security_prompt(function(){callServerFunction(e,t,n,!0)});var c=o.body,u=o.createElement("iframe");u.type="content";var p=1e3*Math.random(),f=g_urlprefix+"acctsiframe.php?rand="+p+"&command="+encodeURIComponent(e);t&&(f+="&commandid="+encodeURIComponent(t)),n&&(f+="&commandtoken="+encodeURIComponent(n)),f+="&version="+encodeURIComponent(lpversion),u.setAttribute("src",getpartnerurl(f)),u.id="__serveriframe",u.style.position="absolute",u.style.top=u.style.left="0px";try{var _=c.ownerDocument.defaultView.getComputedStyle(c,"");u.style.width=_.width,u.style.height=_.height}catch(e){}c.appendChild(u)}}function manageSharedFolder(e){var t=getBG(),n=e,r=n.indexOf("\\");-1!=r&&(n=n.substring(0,r));for(var i in t.g_shares)if(t.g_shares[i].decsharename==n){callServerFunction("sharedfolders",t.g_shares[i].id);break}}function shareFolder(e){share_folder_id="",getBG().set_share_folder_id(""),share_folder_group=e,getBG().set_share_folder_group(e),callServerFunction("sharefolder",e)}function sendToManageSharedFolders(e){alert("Please delete Shared Folders using the Manage Shared Folders link")}function openGroupMenu(e,t,n,r){var i=getrawgroupid(e.id);setTimeout(function(){$.contextMenu.create(function(){var n=getBG(),r={};return t!=g_xlat_favorites&&t!=g_xlat_runame&&t!=g_xlat_pendingname&&t!=g_xlat_none&&(0==t.indexOf("Shared-")&&n.g_folder_sharing_enabled?r[gs("Manage Shared Folder")]=function(){manageSharedFolder(t)}:"1"==n.g_enterpriseuser&&!is_personal_linked(t)&&n.g_folder_sharing_enabled&&(r[gs("Share Folder")]=function(){shareFolder(t)}),r[gs("Rename Group")]=function(){n.lpevent("v_ren"),openMoveGroup(e,void 0,!0)},r[gs("Delete Group")]=function(){0==t.indexOf("Shared-")&&-1==t.indexOf("\\")?(callServerFunction("sharedfolders"),sendToManageSharedFolders()):(n.lpevent("v_dg"),n.deleteGroup(fix_group(t),window,function(){$.tree.focused().cut(e)},"homelocal2.html B",0,i))},r[gs("Create Sub-Group")]=function(){n.lpevent("v_csub"),openCreateGroup(e)}),r[gs("Open All")]=function(){n.openall(t)},[r]},{theme:"vista"}).show(n,r)},0)}function contains(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function refresh_ident_actions(){var e=getBG();e&&convert_object_to_array(e.g_identities).length&&showhide_ident_actions(I_SHOW)}function showhide_ident_actions(e){getBG();if(e==I_SHOW){document.getElementById("ident").style.display="table-cell";document.getElementById("lpidentities").style.display="block"}else document.getElementById("ident").style.display="none",document.getElementById("lpidentities").style.display="none"}function grid_sites_tokenize(e){var t,n=getBG(),r={},i=[n.g_sites,n.g_securenotes,n.g_applications,n.g_pendings];for(var t in i)if(i.hasOwnProperty(t)){var o=i[t];for(var a in o)if(o.hasOwnProperty(a)){var s,d=o[a],l=d.aid,g="id"+l,c=[];if(d.name&&c.push(d.name),d.group&&c.push(d.group),"http://group"!=d.url&&"http://sn"!=d.url&&c.push(d.url),d.unencryptedUsername&&c.push(d.unencryptedUsername),is_application(d)&&(c.push(d.appname),c.push(getusernamefromacct(d))),e&&void 0!==d.extra&&d.extra.length>0&&(void 0===d.url||"http://group"!=d.url)&&!d.pwprotect){var u=getBG().lpmdec_acct(d.extra,!0,d,getBG().g_shares);u&&0!=u.length||console.log("searchinnotes: site aid="+d.aid+" FAILED TO DECRYPT"),c.push(u)}s=c.join(" "),s=s.toLowerCase(),r[g]=s}}return r}function grid_init_vault_search(){var e=getBG(),t=!e.g_prompts.edit_sn_prompt&&e.get_searchNotesPref();return g_search_array=grid_sites_tokenize(t),!0}function refresh_legacy_link(e){var t=getBG();return!!t&&(g_dolegacy=is_user_premium(),t.g_legacy_enabled&&t.lploggedin&&g_dolegacy?function(e){if(!e)return!1;var t=e.getElementById("legacy_li");return!!t&&(t.style.display="block",!0)}(e):function(e){if(!e)return!1;var t=e.getElementById("legacy_li");return!!t&&(t.style.display="none",!0)}(e))}var gLastLoginState=0,gAccts_version=-1,gCurr_username="",gTimerId=null,gIconsLength=0,gLastSearch="",gIdentity="",gSearchWhileType=!0,gTreeHeightOffset=147,gPollInterval=500,gHidePreferences=!1,gLocalBaseUrl="",g_hideprofilecopy=1,g_hideidentcopy=1,g_localvault=1,g_showrows=1,g_autoselectcredmontab=0,g_partnername="",g_hideenterprisetab=!1,g_CNTsearch_it=0,g_CNTsearch_string_tokenize=0,g_CNTinit_vault=0,g_CNTpopulate=0,g_CNTsearch_tree=0,g_CNTclear_tree=0,event_handlers={},event_handlers_onmouseover={},event_handlers_onmouseout={},event_handlers_onclick={},styles={},VIEWS={TREE:0,GRID:1},g_view=VIEWS.TREE,g_groupidmap=[],g_idgroupmap=[],g_dolegacy=null,g_all_li=[],g_search_array={},populate_done=!1,g_groups={},g_groupindex=2e5,g_groupid={},g_groupnames={},div_ids={},g_rootnodeid=null,g_lastnodeid=null,g_cachedOpenGroups=null,g_lastpop=0,lastqstr="",massoperation=!1,gMoveSelected=null,selected_global,togglestate=0;document.addEventListener("click",closepopup,!0);var translations=[];translations.DeleteSiteConfirm=gs("Are you sure you want to delete this site?"),translations.DeleteSite=gs("Delete Site?"),translations.DeleteIdentityConfirm=gs("Are you sure you want to delete this identity?"),translations.DeleteIdentity=gs("Delete Identity?"),translations["Invalid Password."]=gs("Invalid Password."),translations["Add Site"]=gs("Add Site"),translations["Add Profile"]=gs("Add Profile"),translations["Add Identity"]=gs("Add Identity"),this.updated_enc=function(){return!0};var g_waitbox=null;this.show_waitbox=function(e,t){g_waitbox&&(g_waitbox.hide(),g_waitbox.destroy());var n=gs("Submitting...");void 0!==e&&null!=e&&1==e?n=gs("LastPass must reencrypt all of your data because of a key change.")+"<br/><br/>"+gs("This may take a while...")+"<br/><br/>"+gs("Please keep this page open until the operation completes.")+'<br/><br/><div id="changepw_progress" class="width300div"></div>':void 0!==t&&t&&""!=t&&(n=t);var t=gs("Please Wait..."),r=Math.min(750,200+4*n.length);g_waitbox=new Ext.Window({closable:!1,width:r,autoHeight:!0,layout:"fit",modal:!0,title:t,bodyStyle:"padding: 20px",id:"waitbox",html:"<br/><br/><b>"+n+"</b><br/><br/>"}),g_waitbox.show()},this.hide_waitbox=function(){g_waitbox&&(g_waitbox.hide(),g_waitbox.destroy(),g_waitbox=null)},this.populateff=function(e,t){for(var n=getBG(),r=convert_object_to_array(n.g_formfills),i=new Array,o=0;o<r.length;o++){var a=r[o];n.check_ident_ffid(a.ffid)&&i.push(a)}populateffcommon(i,e,t)},this.openff=function(e){getBG().lpevent("v_off"),getBG().editprofile(e)},this.delff=function(e){confirm(gs("Are you sure you would like to delete this form fill profile?"))&&(getBG().lpevent("v_dff"),getBG().deleteformfill(e))},this.populateident=function(e,t){var n=convert_object_to_array(getBG().g_identities);if(n.length){if(document.getElementById("identiframe")){var r=document.getElementById("identpane");r.removeChild(document.getElementById("identiframe"))}populateidentcommon(n,e)}else if(!document.getElementById("identiframe")){for(var r=document.getElementById("identpane");r.children.length;)r.removeChild(r.children[0]);var i=document.createElement("iframe");i.id="identiframe",i.className="overviewiframe",i.src=getpartnerurl("ident_overview.php"),r.appendChild(i)}},this.openident=function(e){return getBG().lpevent("v_oid"),callServerFunction("identity",e),!1},this.delident=function(e){return getBG().lpevent("v_did"),confirm(gs("Are you sure you want to delete this identity?"))&&callServerFunction("deleteidentity",e,getBG().g_token),!1},this.populateshares_remote=function(e){cleartab("sharepane");var t=document.getElementById("sharepane");if(!document.getElementById("shareiframe")){getBG().unlock_plug2web();var n=document.createElement("iframe");n.id="shareiframe",n.className="overviewiframe",n.src=getpartnerurl("share_overview.php?extension=1"),t.appendChild(n)}},this.populatealerts=function(e){cleartab("credmonpane");var t=document.getElementById("credmonpane");if(!document.getElementById("credmoniframe")){var n=document.createElement("iframe");n.id="credmoniframe",n.className="overviewiframe",n.src=getpartnerurl("credmon_overview.php"),t.appendChild(n)}},this.cleartab=function(e){for(var t=document.getElementById(e);t&&t.children.length;)t.removeChild(t.children[0])},this.refreshsites=function(){getBG().refreshsites()},g_haspluginrsa=!1;var g_loaded=!1,g_func=null;this.doneloadingexternaljs=function(){g_loaded=!0,g_func&&g_func(),g_func=null},this.openaddbytab=function(){if(getBG().lploggedin)return"ident"==g_activetab.id?callServerFunction("identity",""):"ff"==g_activetab.id||"credmon"==g_activetab.id?getBG().addprofile():getBG().openaddsite(),!1},this.opencreditmondash=function(e,t){if(getBG().lploggedin)return e?callServerFunction("opencreditmondash",t):callServerFunction("opencreditmondashnoalert",t),!1},window.addEventListener("message",function(e){if(void 0!==getBG().base_url&&0==getBG().base_url.indexOf(e.origin)){var t=e.data+"";if("addprofile"==t||"addidentity"==t)openaddbytab();else if(t.indexOf("showcredmondash_")>=0){var n=t.substr(16);opencreditmondash(!0,n)}else if(t.indexOf("showcredmondashnoalert_")>=0){var r=t.substr(23);opencreditmondash(!1,r)}else if("object"==typeof e.data)if("getdata"==e.data.msg)0==e.data.url.indexOf(getBG().base_url)&&(g_ipctarget=e,getBG().processCS(null,{cmd:"ipcgetdata",url:e.data.url,callback:website_event_callback},null));else if("refreshsites"==e.data.msg)getBG().refreshsites();else if("closeiframe"==e.data.msg){var i=document.body,o=document.getElementById("__serveriframe");i&&o&&i.removeChild(o)}else if("websiteevent"==e.data.msg)g_websiteeventtarget=e,document.getElementById("eventtype").value=e.data.eventtype,document.getElementById("eventdata1").value=e.data.eventdata1,document.getElementById("eventdata2").value=e.data.eventdata2,document.getElementById("eventdata3").value=e.data.eventdata3,document.getElementById("eventdata4").value=e.data.eventdata4,document.getElementById("eventdata5").value=e.data.eventdata5,website_event();else if(0==e.data.msg.indexOf("sharefolder_")){var a=e.data.msg.match(/^sharefolder_([^_]+)_(.*)$/);if(a){var n=a[1],s=a[2];"undefined"!=typeof share_folder_group&&share_folder_group==s&&(share_folder_id=n,getBG().set_share_folder_id(n))}}}},!1);var I_SHOW=!0,I_HIDE=!1;$(document).bind("DOMContentLoaded",function(){$("#vaultToggle").bind("click",function(e){e.preventDefault(),e.stopPropagation(),getBG().VaultToggle.toggleVault4_0(window)})});
LPRequest={},function(e){var t={},s=function(){for(var e in t)clearTimeout(t[e]);t={}};Topics.get(Topics.REFRESH_DATA).subscribe(s),Topics.get(Topics.CLEAR_DATA).subscribe(s),e.getNewRequestID=function(){var e=0;return function(){return++e}}(),e.makeRequest=function(){var s=function(e,t){return function(){for(var s=0,r=e.length;s<r;++s)e[s].unlock();t&&t.apply(window,arguments)}},r=function(e,t){return function(){for(var s=0,r=e.length;s<r;++s)e[s].lockForUpdate();t.apply(window,arguments)}},n=function(e,s){var r=function(r){try{Topics.get(Topics.REQUEST_SUCCESS).publish(e),s&&(clearTimeout(s),delete t[e.requestID]),r&&Topics.get(Topics.SUCCESS).publish(r)}catch(e){LPPlatform.logException(e)}};return e&&e.success?function(){var t=arguments,s=e.successMessage;t.length>0&&"string"==typeof t[0]&&(s=void 0===s?t[0]:s,t=Array.prototype.slice.call(t,1));try{e.success.apply(window,t)}catch(e){LPPlatform.logException(e)}r(s)}:r},o=function(e,s){var r=function(r){try{switch(r){case"notoken":r=Strings.translateString("No token was provided. Request could not be completed.");break;case"session_expired":r=Strings.translateString("ErrorSessionMsg");break;case"not_allowed":r=Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again");break;case"invalidxml":r=Strings.translateString("Invalid XML response.");break;case"invalidjson":r=Strings.translateString("Invalid JSON response.");break;case"offline":r=Strings.translateString("This request cannot be completed because you are currently offline.");break;case void 0:r=Strings.Vault.UNEXPECTED_ERROR}Topics.get(Topics.ERROR).publish(r),Topics.get(Topics.REQUEST_ERROR).publish(e),s&&(clearTimeout(s),delete t[e.requestID])}catch(e){LPPlatform.logException(e)}};return e&&e.error?function(t){r(t),e.error()}:r},i=function(e){return function(t){Topics.get(Topics.REQUEST_STATUS).publish(t,e)}};return function(a,c){if(c.confirm){var u=c.confirm;return delete c.confirm,u.handler=function(){e.makeRequest(a,c)},void Topics.get(Topics.CONFIRM).publish(u)}c.requestID=e.getNewRequestID();var l=null;if(LPTools.getOption(c,"showTimeWarning",!0)&&(l=setTimeout(function(){T(Strings.translateString("Sorry, this request is taking longer than normal."))},3e4),t[c.requestID]=l),c.items&&LPTools.getOption(c,"lockItems",!1)){var p=c.items;p instanceof Array||(p=[p]),a=r(p,a),c.success=s(p,c.success),c.error=s(p,c.error),c.confirm&&(c.confirm.closeHandler=s(p))}var g,f=n(c,l),T=o(c,l);c.params?g=[{params:c.params,requestArgs:c.requestArgs,success:f,error:T,status:c.status?i(c):null}]:(g=LPTools.getOption(c,"parameters",[]),g instanceof Array||(g=[g]),g.push(f),g.push(T)),Topics.get(Topics.REQUEST_START).publish(c);try{a.apply(window,g)}catch(e){LPPlatform.logException(e),T(Strings.Vault.UNEXPECTED_ERROR)}}}(),e.makeDataRequest=function(t,s){e.makeRequest(t,$.extend(!0,s,{dialogRequest:!1}))},e.makeUpdateRequest=function(t,s){e.makeRequest(t,$.extend(!0,s,{requestSuccessOptions:{incrementAccountsVersion:!0}}))},e.makeLockItemUpdateRequest=function(e,t){this.makeUpdateRequest(e,$.extend(t,{lockItems:!0}))}}(LPRequest);
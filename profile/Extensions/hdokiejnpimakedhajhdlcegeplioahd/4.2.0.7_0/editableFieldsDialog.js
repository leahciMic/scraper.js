EditableFieldsDialog=function(t,e){e=e||{},e.views=[{selector:".mainView"},{selector:".formFieldsView",title:Strings.translateString("Edit Form Fields"),dynamicHeight:!1}],DialogWithGroupInput.call(this,t,e),this.fieldsElement=null,this.addFieldsButton=null,this.fieldsTable=null,this.postSetupData=null,this.editFormFieldsButton=$(LPTools.buildItemButton(Constants.ACTION_EDIT)),this.editFormFieldsButton.attr("title",Strings.translateString("Edit Form Fields"))},EditableFieldsDialog.prototype=Object.create(DialogWithGroupInput.prototype),EditableFieldsDialog.prototype.constructor=EditableFieldsDialog,function(){var t=function(t,e){DialogInput.Input.call(this,void 0),this.fieldElements=[],this.container=t,this.parentDialog=e};t.prototype=Object.create(DialogInput.Input.prototype),t.prototype.constructor=t,t.prototype.clear=function(){LPTools.removeDOMChildren(this.container)},t.prototype.getValue=function(){for(var t=[],e=0,i=this.fieldElements.length;e<i;++e){var l=this.fieldElements[e];l.data.value=l.input.getValue(),t.push($.extend({},l.data))}return t},t.prototype.setValue=function(t){LPTools.removeDOMChildren(this.container),this.fieldElements=[];for(var e=0,i=t.length;e<i;++e)this.addField(t[e]);LPTools.addZebraStriping(this.container)},t.prototype.addField=function(t){if("hidden"!==t.type){var i=LPTools.createElement("tr","settingsRow");i.appendChild(LPTools.createElement("td","settingLabel",t.name));var l="Form Field "+t.name,a=null;switch(t.type){case"radio":case"select":case"select-one":a=LPTools.createElement("input",{class:"dialogInput",type:"text","aria-label":l});break;case"checkbox":a=LPTools.buildCheckbox(void 0,{checkboxAttributes:{"aria-label":l}});break;default:a=LPTools.createElement("input",{class:"dialogInput",type:t.type,"aria-label":l})}var o=function(){var t=$(a);return t.is("input")?a:t.find("input").get(0)}(),s=new DialogInput.Input(o);this.fieldElements.push({data:t,input:s}),s.setValue(t.value);var n=LPTools.createElement("td","formFieldValue"),d=LPTools.createElement("div");n.appendChild(d),d.appendChild(a),i.appendChild(n);var r=LPTools.createElement("div","rightItemButtons"),p=LPTools.buildItemButton(Constants.ACTION_REMOVE);$(p).bind("click",e(this.parentDialog,this.container,i,this.fieldElements,t)),r.appendChild(p),d.appendChild(r),this.container.appendChild(i),"password"===t.type&&s.getElement().LP_addPasswordEye({checkPermissionHandler:this.parentDialog.checkViewPasswordHandler})}};var e=function(t,e,i,l,a){return function(){for(var o=null,s=0,n=l.length;s<n;++s)if(l[s].data===a){o=s;break}if(null!==o){var d=function(){e.removeChild(i),LPTools.addZebraStriping(e),l.splice(o,1)};t.vaultItem?LPRequest.makeUpdateRequest(LPProxy.deleteField,{parameters:[t.vaultItem,t.vaultItem._data.fields[o]],requestSuccessOptions:{closeDialog:!1},success:function(){d(),t.vaultItem.removeField(o),t.originalData=t.getData(!1)},confirm:{title:Strings.Vault.DELETE,text:Strings.translateString("Are you sure you want to delete field %1?",a.name)}}):d()}}};EditableFieldsDialog.prototype.initialize=function(e){DialogWithGroupInput.prototype.initialize.apply(this,arguments),this.formFieldsView=e.find(".formFieldsView"),this.fieldsTable=e.find(".fieldsTable"),this.fieldsElement=e.find(".fieldsElement"),this.addFieldsButton=e.find(".addFormFieldButton"),this.inputFields.fields=new t(this.fieldsElement.get(0),this),this.addFieldsButton.bind("click",function(t){return function(){dialogs.addFormField.open({sourceDialog:t})}}(this))},EditableFieldsDialog.prototype.getNextViewButton=function(){return this.editFormFieldsButton},EditableFieldsDialog.prototype.setNextView=function(t){DialogWithGroupInput.prototype.setNextView.apply(this,arguments),t>0?this.editFormFieldsButton.hide():this.editFormFieldsButton.show()},EditableFieldsDialog.prototype.postSetup=function(){DialogWithGroupInput.prototype.postSetup.apply(this,arguments),this.postSetupData=this.getData()},EditableFieldsDialog.prototype.clearFields=function(){DialogWithGroupInput.prototype.clearFields.apply(this,arguments),this.postSetupData=null},EditableFieldsDialog.prototype.getData=function(){var t=DialogWithGroupInput.prototype.getData.apply(this,arguments),e=this.postSetupData;if(e&&e.fields&&t.fields)for(var i=t.unencryptedUsername!==e.unencryptedUsername,l=t.password!==e.password,a=null,o=null,s=0;s<t.fields.length;++s){var n=t.fields[s],d=e.fields[s];if(d){var r=n.value!==d.value;e.unencryptedUsername&&e.unencryptedUsername===d.value?i?n.value=t.unencryptedUsername:r&&null===a?t.unencryptedUsername=a=n.value:null!==a&&(n.value=a):e.password&&e.password===d.value&&(l?n.value=t.password:r&&null===o?t.password=o=n.value:null!==o&&(n.value=o))}}return t},EditableFieldsDialog.prototype.setup=function(t,e){if(e.vaultItem?this.addFieldsButton.LP_show():this.addFieldsButton.LP_hide(),this.editFormFieldsButton.LP_hide(),this.$element.removeClass("saveAll"),this.fieldsTable.append(this.fieldsElement),this.formFieldsView.append(this.addFieldsButton),e.defaultData&&e.defaultData.save_all||e.vaultItem&&e.vaultItem._data.save_all){this.$element.addClass("saveAll");var i=t.find(".saveAllFields");i.append(this.fieldsElement),i.after(this.addFieldsButton)}else e.vaultItem&&this.editFormFieldsButton.LP_show();DialogWithGroupInput.prototype.setup.apply(this,arguments)},EditableFieldsDialog.prototype.checkViewPassword=function(t){this.vaultItem?this.vaultItem.canViewPassword()?LPProxy.reprompt(function(e){return function(){t(),bg.loglogin(e.vaultItem.getID())}}(this),{types:AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password.")):t()}}();var AddFormFieldDialog=function(t){Dialog.call(this,t,{closeButtonEnabled:!0,nextButtonText:Strings.translateString("Add"),title:Strings.translateString("Add Form Field"),dynamicHeight:!0,overlayDialog:!0}),this.fieldsInput=null};AddFormFieldDialog.prototype=Object.create(Dialog.prototype),AddFormFieldDialog.prototype.constructor=AddFormFieldDialog,AddFormFieldDialog.prototype.initialize=function(t){Dialog.prototype.initialize.apply(this,arguments),function(t){t.inputFields.type.onChange(function(){var e=!1;return function(i){var l="checkbox"===i;if(l!==e){var a=document.getElementById("addFormFieldDialogValue");if(LPTools.removeDOMChildren(a),e=l,l){var o=LPTools.buildCheckbox();a.appendChild(o),t.inputFields.value.setElement($(o).find("input"))}else{var s=LPTools.createElement("input",{class:"dialogInput",type:"text"});a.appendChild(s),t.inputFields.value.setElement(s)}}}}())}(this)},AddFormFieldDialog.prototype.setup=function(t,e){e.sourceDialog&&e.sourceDialog.vaultItem&&e.sourceDialog.vaultItem._data.save_all?$("#addFormFieldDialogFormName").LP_show():$("#addFormFieldDialogFormName").LP_hide(),Dialog.prototype.setup.apply(this,arguments)},AddFormFieldDialog.prototype.validate=function(t){var e=Dialog.prototype.validate.apply(this,arguments);if(t.name)for(var i=this.data.sourceDialog.inputFields.fields.getValue(),l=0,a=i.length;l<a;++l)i[l].name===t.name&&(this.addError("name","A field with this name already exists."),e=!1);else this.addError("name","Field Name is required."),e=!1;return t.type||(this.addError("type","Field Type is required."),e=!1),e},AddFormFieldDialog.prototype.handleSubmit=function(t){!function(e){var i=$.extend({},t);e.vaultItem.processEnteredFieldData(t),LPRequest.makeUpdateRequest(LPProxy.addField,{parameters:[e.vaultItem,t],success:function(){e.vaultItem.addField(t),e.inputFields.fields.addField(i),e.originalData=e.getData(!1)}})}(this.data.sourceDialog)};